"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3941],{26084:function(e,t,n){var r=n(7983);t.Z=void 0;var i=r(n(47565)),o=n(44810),a=(0,i.default)((0,o.jsx)("path",{d:"M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69zM12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6c3.31 0 6 2.69 6 6s-2.69 6-6 6z"}),"Brightness4");t.Z=a},86736:function(e,t,n){var r=n(7983);t.Z=void 0;var i=r(n(47565)),o=n(44810),a=(0,i.default)((0,o.jsx)("path",{d:"M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69zM12 18c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6zm0-10c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4z"}),"Brightness7");t.Z=a},47565:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r.createSvgIcon}});var r=n(8235)},8235:function(e,t,n){n.r(t),n.d(t,{capitalize:function(){return i.Z},createChainedFunction:function(){return o},createSvgIcon:function(){return a.Z},debounce:function(){return s.Z},deprecatedPropType:function(){return u},isMuiElement:function(){return c.Z},ownerDocument:function(){return l.Z},ownerWindow:function(){return d.Z},requirePropFactory:function(){return f},setRef:function(){return p},unstable_ClassNameGenerator:function(){return F},unstable_useEnhancedEffect:function(){return v.Z},unstable_useId:function(){return h.Z},unsupportedProp:function(){return m},useControlled:function(){return g.Z},useEventCallback:function(){return b.Z},useForkRef:function(){return x.Z},useIsFocusVisible:function(){return w.Z}});var r=n(47976),i=n(91419),o=n(76231).Z,a=n(86452),s=n(5695);var u=function(e,t){return()=>null},c=n(86404),l=n(36843),d=n(83575);n(52643);var f=function(e,t){return()=>null},p=n(22027).Z,v=n(22980),h=n(28626);var m=function(e,t,n,r,i){return null},g=n(75949),b=n(96369),x=n(2346),w=n(65640);const F={configure:e=>{r.Z.configure(e)}}},68031:function(e,t,n){n.d(t,{t:function(){return f}});var r,i,o=n(53939),a=n.n(o),s=n(83134),u=n.n(s),c=n(39324),l=n(41776),d=n(24561),f={getFile:(i=u()(a()().mark((function e(t){var n,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.qr.getState(),r=n.api,e.abrupt("return",r.file.getFile(t));case 2:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)}),parse_process:(r=u()(a()().mark((function e(t){var n,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=l.qr.getState(),r=n.api,d.Vw.setState((function(e){var n=e.currentFiles.findIndex((function(e){return e.id===t}));-1!==n&&(e.currentFiles[n].parse_status="parsing")})),r.file.parseFileProcess([t]).then(function(){var e=u()(a()().mark((function e(n){var r,i,o,s,u,l,f,p,v,h,m,g;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=null===(r=n.body)||void 0===r?void 0:r.getReader(),e.next=3,o.read();case 3:(s=e.sent).done,u=s.value,l=new TextDecoder,f=l.decode(u),p=null===(i=(0,c.RE)(f))||void 0===i?void 0:i[0],v=p.status,h=p.event,m=p.error,g=p.file_info,"resp"===h&&d.Vw.setState((function(e){var n=e.currentFiles.findIndex((function(e){return e.id===t}));-1!==n&&("parsed"===v&&(e.currentFiles[n].parse_status="success",e.currentFiles[n].file_info=g),"failed"!==v&&"filtered"!==v||(e.currentFiles[n].parse_status="error",e.currentFiles[n].file_info=g,e.currentFiles[n].error="解析失败"),e.currentFiles[n].done=!0)})),"error"===h&&d.Vw.setState((function(e){var n=e.currentFiles.findIndex((function(e){return e.id===t}));-1!==n&&(e.currentFiles[n].parse_status="error",e.currentFiles[n].error=m.message||"解析失败",e.currentFiles[n].done=!0)}));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){d.Vw.setState((function(n){var r=n.currentFiles.findIndex((function(e){return e.id===t}));-1!==r&&(n.currentFiles[r].parse_status="error",n.currentFiles[r].error=e.message||"解析失败",n.currentFiles[r].done=!0)}))}));case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})}},64412:function(e,t,n){n.r(t),n.d(t,{default:function(){return X}});var r=n(78095),i=n.n(r),o=n(87752),a=n(41987),s=n(34827),u=n.n(s),c=n(45562),l=n(63313),d=n(63806),f=n(75074),p=n(92075),v=n(68031),h=n(39324),m="content___r3DRA",g=n(44810);function b(e){var t=e.file;return(0,g.jsx)("div",{className:m,children:(0,g.jsx)("img",{src:(0,h.QW)(t),alt:""})})}function x(e){var t=e.file,n=e.options,r=(0,l.useMemo)((function(){var e,n={file:null!==(e=null==t?void 0:t.presigned_url)&&void 0!==e?e:""};return"/pdf/web/viewer.html?"+new URLSearchParams(n).toString()}),[t]),i=(0,l.useRef)(null);return(0,l.useEffect)((function(){if(n){var e=!1;window.onmessage=function(t){var r=t.data||{},o=r.source,a=r.payload;if("PDF"===o&&"textlayerrendered"===(null==a?void 0:a.type)){var s,c,l,d=(a||{}).data,f=null===(s=i.current)||void 0===s?void 0:s.contentWindow,p=((null==f||null===(c=f.PDFViewerApplication)||void 0===c?void 0:c.pdfViewer)||{}).pagesCount,v=void 0===p?0:p;n.page&&v&&n.page<=v&&!e&&(e=!0,setTimeout((function(){f.PDFViewerApplication.pdfViewer.currentPageNumber=n.page}),200));var h=null==n||null===(l=n.highlight)||void 0===l?void 0:l.find((function(e){return(null==e?void 0:e.page)===(null==d?void 0:d.page)}));if(h&&null!=d&&d.page){var m,g,b,x=null==f||null===(m=f.document)||void 0===m?void 0:m.querySelector('#viewer [data-page-number="'.concat(d.page,'"]')),w=null==x?void 0:x.querySelector(".textLayer");if(null==w||null===(g=w.children)||void 0===g||!g.length)return;var F=document.createElement("div");F.classList.add("highlight-overlay"),null===(b=h.bbox)||void 0===b||b.forEach((function(e){var t=document.createElement("div"),n=u()(e,4),r=n[0],i=n[1],o=i,a=r,s=n[2]-r,c=n[3]-i;t.style.top="calc(var(--scale-factor) * ".concat(o,"px)"),t.style.left="calc(var(--scale-factor) * ".concat(a,"px)"),t.style.width="calc(var(--scale-factor) * ".concat(s,"px)"),t.style.height="calc(var(--scale-factor) * ".concat(c,"px)"),F.appendChild(t)})),null==x||x.appendChild(F)}}}}}),[n]),(0,g.jsx)(c.Z,{border:"0",sx:{width:"100%",height:"65vh",border:"none"},component:"iframe",src:r,ref:i})}var w=n(53939),F=n.n(w),Z=n(83134),y=n.n(Z),S=n(74599),C="content___ZxNf8";function k(e){var t,n=e.file,r=(0,l.useState)(""),i=u()(r,2),o=i[0],a=i[1];return(0,l.useEffect)((function(){var e=new AbortController;if(n){var t=n.presigned_url,r=void 0===t?"":t,i=n.extra_info,o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"utf-8",t=null;try{t=new TextDecoder(e)}catch(e){t=new TextDecoder("utf-8")}return t}(null==i?void 0:i.charset);fetch(r,{signal:e.signal}).then(function(){var e=y()(F()().mark((function e(t){var n,r,i;return F()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=null===(n=t.body)||void 0===n?void 0:n.getReader(),i=F()().mark((function e(){var t,n,i,s;return F()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.read();case 2:if(t=e.sent,n=t.done,i=t.value,!n){e.next=7;break}return e.abrupt("return",1);case 7:s=o.decode(i,{stream:!0}),a((function(e){return e.concat(s)}));case 9:case"end":return e.stop()}}),e)}));case 2:if(!r){e.next=8;break}return e.delegateYield(i(),"t0",4);case 4:if(!e.t0){e.next=6;break}return e.abrupt("break",8);case 6:e.next=2;break;case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){return e}))}return function(){a(""),e.abort()}}),[n]),(0,g.jsx)("div",{className:C,children:null!=n&&null!==(t=n.name)&&void 0!==t&&t.endsWith(".md")?(0,g.jsx)(S.U,{content:o}):(0,g.jsx)("p",{children:o})})}function z(e){var t=e.id,n=e.options,r=e.onClose,i=(0,l.useState)(!1),o=u()(i,2),a=(o[0],o[1]),s=(0,l.useState)(),h=u()(s,2),m=h[0],w=h[1];(0,l.useEffect)((function(){if(t){var e=(0,f.VY)(),n=e.ui,i=e.i18n;return a(!0),v.t.getFile(t).then((function(e){return"file"===e.type&&w(e)})).catch((function(){n.message.error(i.fm("msh.chat.file.open.error")),null==r||r()})).finally((function(){a(!1)})),function(){w(void 0)}}}),[t]);var F=(0,l.useMemo)((function(){if(m){var e=m||{},t=e.name,r=void 0===t?"":t,i=e.presigned_url,o=void 0===i?"":i;if(r){var a=r.toLowerCase(),s=a.split(".").pop()||"";if(a.endsWith("pdf"))return(0,g.jsx)(x,{file:m,options:n});if(p.IF.some((function(e){return a.endsWith(e)}))){return(0,g.jsx)(c.Z,{border:"0",sx:{width:"100%",height:"65vh",border:"none"},component:"iframe",src:"https://view.officeApps.live.com/op/embed.aspx?src="+encodeURIComponent(o)})}return p.dC.includes(s)?(0,g.jsx)(b,{file:m}):(0,g.jsx)(k,{file:m})}}}),[m,n]);return(0,g.jsx)(d.Z,{open:!!m,onClose:r,title:null==m?void 0:m.name,footer:!1,modalsx:{paper:{maxWidth:900,width:"80vw",minWidth:300,borderColor:"transparent"},content:{mb:4,p:4},title:{fontSize:14,bgcolor:"var(--msh-paper-bg)"}},children:F})}var j=n(98526),_=n(17741),M=n(92082),R=n(26084),V=n(86736),I=n(30254),P=n(52643),E=n(83715),L=n(37096),D=n(72245),W=n(91419),N=n(3034),K=n(93980),T=n(18548);function q(e){return(0,T.Z)("MuiFab",e)}var H=(0,K.Z)("MuiFab",["root","primary","secondary","extended","circular","focusVisible","disabled","colorInherit","sizeSmall","sizeMedium","sizeLarge","info","error","warning","success"]),A=n(20472);const O=["children","className","color","component","disabled","disableFocusRipple","focusVisibleClassName","size","variant"],B=(0,A.ZP)(D.Z,{name:"MuiFab",slot:"Root",shouldForwardProp:e=>(0,A.FO)(e)||"classes"===e,overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[n.variant],t[`size${(0,W.Z)(n.size)}`],"inherit"===n.color&&t.colorInherit,t[(0,W.Z)(n.size)],t[n.color]]}})((({theme:e,ownerState:t})=>{var n,r;return(0,P.Z)({},e.typography.button,{minHeight:36,transition:e.transitions.create(["background-color","box-shadow","border-color"],{duration:e.transitions.duration.short}),borderRadius:"50%",padding:0,minWidth:0,width:56,height:56,zIndex:(e.vars||e).zIndex.fab,boxShadow:(e.vars||e).shadows[6],"&:active":{boxShadow:(e.vars||e).shadows[12]},color:e.vars?e.vars.palette.text.primary:null==(n=(r=e.palette).getContrastText)?void 0:n.call(r,e.palette.grey[300]),backgroundColor:(e.vars||e).palette.grey[300],"&:hover":{backgroundColor:(e.vars||e).palette.grey.A100,"@media (hover: none)":{backgroundColor:(e.vars||e).palette.grey[300]},textDecoration:"none"},[`&.${H.focusVisible}`]:{boxShadow:(e.vars||e).shadows[6]}},"small"===t.size&&{width:40,height:40},"medium"===t.size&&{width:48,height:48},"extended"===t.variant&&{borderRadius:24,padding:"0 16px",width:"auto",minHeight:"auto",minWidth:48,height:48},"extended"===t.variant&&"small"===t.size&&{width:"auto",padding:"0 8px",borderRadius:17,minWidth:34,height:34},"extended"===t.variant&&"medium"===t.size&&{width:"auto",padding:"0 16px",borderRadius:20,minWidth:40,height:40},"inherit"===t.color&&{color:"inherit"})}),(({theme:e,ownerState:t})=>(0,P.Z)({},"inherit"!==t.color&&"default"!==t.color&&null!=(e.vars||e).palette[t.color]&&{color:(e.vars||e).palette[t.color].contrastText,backgroundColor:(e.vars||e).palette[t.color].main,"&:hover":{backgroundColor:(e.vars||e).palette[t.color].dark,"@media (hover: none)":{backgroundColor:(e.vars||e).palette[t.color].main}}})),(({theme:e})=>({[`&.${H.disabled}`]:{color:(e.vars||e).palette.action.disabled,boxShadow:(e.vars||e).shadows[0],backgroundColor:(e.vars||e).palette.action.disabledBackground}})));var $=l.forwardRef((function(e,t){const n=(0,N.Z)({props:e,name:"MuiFab"}),{children:r,className:i,color:o="default",component:a="button",disabled:s=!1,disableFocusRipple:u=!1,focusVisibleClassName:c,size:l="large",variant:d="circular"}=n,f=(0,I.Z)(n,O),p=(0,P.Z)({},n,{color:o,component:a,disabled:s,disableFocusRipple:u,size:l,variant:d}),v=(e=>{const{color:t,variant:n,classes:r,size:i}=e,o={root:["root",n,`size${(0,W.Z)(i)}`,"inherit"===t?"colorInherit":t]},a=(0,L.Z)(o,q,r);return(0,P.Z)({},r,a)})(p);return(0,g.jsx)(B,(0,P.Z)({className:(0,E.Z)(v.root,i),component:a,disabled:s,focusRipple:!u,focusVisibleClassName:(0,E.Z)(v.focusVisible,c),ownerState:p,ref:t},f,{classes:v,children:r}))})),U=n(53719);function Q(){var e=(0,U.Z)(),t=(0,M.M)("thememode.thememode",(0,M.R)("toggleColorMode")).toggleColorMode;return(0,g.jsx)($,{onClick:t,size:"small",color:"primary",children:"dark"===e.palette.mode?(0,g.jsx)(V.Z,{fontSize:"small"}):(0,g.jsx)(R.Z,{fontSize:"small"})})}var Y=n(48079),G=n(24561),J=n(5269);function X(e){var t=(0,Y.aK)((function(e){return e.filePreviewData})),n=((0,Y.aK)((function(e){return e.showHistory})),(0,J.l)((function(e){return e.debugging})));(0,M.M)("thememode.thememode",(0,M.R)("mode")).mode;return(0,g.jsx)(j.Z,{children:function(e){var r=e.backgroundStyle;return(0,g.jsxs)(_.Z,{full:!0,style:i()({},r),children:[(0,g.jsx)(z,i()(i()({},t),{},{onClose:G.Ee.closePreview})),(0,g.jsx)(o.Z,{sx:{"& > :not(style)":{m:1},position:"fixed",top:function(e){return e.spacing(14)},right:function(e){return e.spacing(4)},zIndex:"fab"},children:n&&(0,g.jsx)(Q,{})}),(0,g.jsx)(_.Z,{full:!0,children:(0,g.jsx)(a.Outlet,{})})]})}})}},24561:function(e,t,n){n.d(t,{Ee:function(){return p},Vw:function(){return v},tm:function(){return h}});var r,i,o,a=n(53939),s=n.n(a),u=n(83134),c=n.n(u),l=n(32163),d=n(41776),f=n(48079),p={getFiles:(i=c()(s()().mark((function e(t){var n,r,i;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=d.qr.getState(),r=n.api,e.next=3,r.file.getFilesByChatId(t);case 3:i=e.sent,f.aK.setState((function(e){var n;e.filesMap[t]||(e.filesMap[t]={}),null==i||null===(n=i.items)||void 0===n||n.forEach((function(n){e.filesMap[t][n.id]=n}))}));case 5:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)}),getCaseFiles:(r=c()(s()().mark((function e(t){var n,r,i;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=d.qr.getState(),r=n.api,e.next=3,r.file.getFilesByCaseId(t);case 3:i=e.sent,f.aK.setState((function(e){var n;e.filesMap[t]||(e.filesMap[t]={}),null==i||null===(n=i.items)||void 0===n||n.forEach((function(n){e.filesMap[t][n.id]=n}))}));case 5:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)}),preview:function(e){f.aK.setState({filePreviewData:e})},closePreview:function(){f.aK.setState({filePreviewData:{id:"",options:void 0}})},openFiles:function(){f.aK.setState({filesOpen:!0})},closeFiles:function(){f.aK.setState({filesOpen:!1})},currentClear:function(){v.getState().reset(),f.aK.setState((function(e){e.checkingToken=!1,e.tokensInfo={}}))}},v=(0,l.Q_)({currentFiles:[],dropFiles:[]}),h=(o=function(e){var t=e.currentFiles,n=!!t.length,r=!0,i=!1;return t.find((function(e){return"success"!==e.parse_status}))&&(r=!1),t.find((function(e){return!e.done}))&&(i=!0),{ready:r,parsing:i,hasFile:n}},{useCurrentFileStatus:function(){return v(o)},getCurrentFileStatus:function(){return o(v.getState())}})}}]);