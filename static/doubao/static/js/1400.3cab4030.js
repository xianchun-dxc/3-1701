/*! For license information please see 1400.3cab4030.js.LICENSE.txt */
(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["1400"],{40837:function(e,t,n){"use strict";e.exports=n.p+"static/image/emoji-tougue.3f2faaa2.png"},26107:function(e,t,n){"use strict";n.d(t,{PromiseName:function(){return i}});var r,i=((r={}).Mssdk="mssdkPromise",r.BdMsSdk="bdmssdkPromise",r.MsSdkReady="msSdkReady",r.TTWid="ttwid",r.Launch="launchPromise",r.ProfileSelfBrief="ProfileSelfBriefPromise",r.AccountInfo="accountInfoPromise",r)},10555:function(e,t,n){"use strict";n.d(t,{botDiscoverPageLoadCount:function(){return r}});var r=36},65718:function(e,t,n){"use strict";n.d(t,{getAid:function(){return r}});var r=function(){return Number(497858)}},44450:function(e,t,n){"use strict";n.d(t,{REFRESH_CHAT_CONVERSATION_COUNT:function(){return r},choicenessBotsCount:function(){return i}});var r=10,i=10},35403:function(e,t,n){"use strict";n.d(t,{FEEDBACK_APP_KEY:function(){return u},FEEDBACK_APP_NAME:function(){return s},brandName:function(){return o},feedbackContact:function(){return i},isCanaryOrDev:function(){return a},scmVersion:function(){return r}});var r=function(){var e;return String((null===(e=window.gfdatav1)||void 0===e?void 0:e.ver)||"unknown")},i="mailto:feedback@mail.doubao.com",o="\u8C46\u5305",a=function(){var e;return(null===(e=window.gfdatav1)||void 0===e?void 0:e.canary)!==0},s="doubao_web",u="doubao_web"},58416:function(e,t,n){"use strict";n.d(t,{ABOUT_ROUTE:function(){return o.ABOUT_ROUTE},ACCOUNT_SETTING_ROUTE:function(){return o.ACCOUNT_SETTING_ROUTE},AUTH_CALLBACK_ROUTE:function(){return o.AUTH_CALLBACK_ROUTE},BOT_DISCOVER_ROUTE:function(){return o.BOT_DISCOVER_ROUTE},CHAT_ALL_THREADS:function(){return o.CHAT_ALL_THREADS},CHAT_NEW_ROUTE:function(){return o.CHAT_NEW_ROUTE},CHAT_PAGE_ROUTE:function(){return o.CHAT_PAGE_ROUTE},COUNTRY_RESTRICTED_ROUTE:function(){return o.COUNTRY_RESTRICTED_ROUTE},CREATE_BOT_ROUTE:function(){return o.CREATE_BOT_ROUTE},DELETE_ACCOUNT_ROUTE:function(){return o.DELETE_ACCOUNT_ROUTE},FEEDBACK_APP_KEY:function(){return r.FEEDBACK_APP_KEY},FEEDBACK_APP_NAME:function(){return r.FEEDBACK_APP_NAME},LOGIN_PAGE_ROUTE:function(){return o.LOGIN_PAGE_ROUTE},MAIN_PAGE_ROUTE:function(){return o.MAIN_PAGE_ROUTE},MOBILE_BIND_ROUTE:function(){return o.MOBILE_BIND_ROUTE},NETWORK_ERROR_ROUTE:function(){return o.NETWORK_ERROR_ROUTE},NEW_CHAT_PAGE_ROUTE:function(){return o.NEW_CHAT_PAGE_ROUTE},NO_ACCESS_ROUTE:function(){return o.NO_ACCESS_ROUTE},PROFILE_PAGE_ROUTE:function(){return o.PROFILE_PAGE_ROUTE},REFRESH_CHAT_CONVERSATION_COUNT:function(){return s.REFRESH_CHAT_CONVERSATION_COUNT},SETTINGS_PAGE:function(){return o.SETTINGS_PAGE},SETUP_PAGE_ROUTE:function(){return o.SETUP_PAGE_ROUTE},USER_BLOCKLIST_ROUTE:function(){return o.USER_BLOCKLIST_ROUTE},USER_PROFILE_ROUTE:function(){return o.USER_PROFILE_ROUTE},WAITLIST_ROUTE:function(){return o.WAITLIST_ROUTE},androidDownloadLink:function(){return i.androidDownloadLink},appDownloadLink:function(){return i.appDownloadLink},botDiscoverPageLoadCount:function(){return u.botDiscoverPageLoadCount},brandName:function(){return r.brandName},choicenessBotsCount:function(){return s.choicenessBotsCount},deleteConfirmLink:function(){return i.deleteConfirmLink},desktopDownloadPath:function(){return i.desktopDownloadPath},disclaimerPoweredBy:function(){return i.disclaimerPoweredBy},extDownloadCdn:function(){return i.extDownloadCdn},feedbackContact:function(){return r.feedbackContact},getAid:function(){return a.getAid},hookSetCookieAsSessionIdKey:function(){return c.hookSetCookieAsSessionIdKey},iOSDownloadLink:function(){return i.iOSDownloadLink},icpLink:function(){return i.icpLink},isCanaryOrDev:function(){return r.isCanaryOrDev},policeLink:function(){return i.policeLink},privacyPolicyLink:function(){return i.privacyPolicyLink},registrationLink:function(){return i.registrationLink},scmVersion:function(){return r.scmVersion},termsOfServiceLink:function(){return i.termsOfServiceLink},yunqueModalLink:function(){return i.yunqueModalLink}});var r=n("35403"),i=n("41079"),o=n("22713"),a=n("65718"),s=n("44450"),u=n("10555"),c=n("63579")},22713:function(e,t,n){"use strict";n.d(t,{ABOUT_ROUTE:function(){return u},ACCOUNT_SETTING_ROUTE:function(){return S},AUTH_CALLBACK_ROUTE:function(){return p},BOT_DISCOVER_ROUTE:function(){return h},CHAT_ALL_THREADS:function(){return L},CHAT_NEW_ROUTE:function(){return C},CHAT_PAGE_ROUTE:function(){return o},COUNTRY_RESTRICTED_ROUTE:function(){return g},CREATE_BOT_ROUTE:function(){return m},DELETE_ACCOUNT_ROUTE:function(){return v},LOGIN_PAGE_ROUTE:function(){return r},MAIN_PAGE_ROUTE:function(){return _},MOBILE_BIND_ROUTE:function(){return b},NETWORK_ERROR_ROUTE:function(){return f},NEW_CHAT_PAGE_ROUTE:function(){return a},NO_ACCESS_ROUTE:function(){return d},PROFILE_PAGE_ROUTE:function(){return y},SETTINGS_PAGE:function(){return s},SETUP_PAGE_ROUTE:function(){return i},USER_BLOCKLIST_ROUTE:function(){return l},USER_PROFILE_ROUTE:function(){return c},WAITLIST_ROUTE:function(){return M}});var r="/",i="/user/setup",o="/chat/",a="/chat/new",s="/chat/settings",u="/chat/settings/about",c="/chat/settings/profile",l="/chat/settings/blocklist",d="/no-access",g="/region-restricted",f="/network-error",v="/delete-account",_="/",p={default:"/auth/callback",apple:"/passport/web/web_login_success",line:"/passport/web/web_login_success"},m="/chat/bot/create",h="/chat/bot/discover",y="/chat/profile",M="/waitlist",S="/chat/settings/account",b="/chat/settings/account/mobile-bind",C="/chat/new",L="/chat/thread/list"},41079:function(e,t,n){"use strict";n.d(t,{androidDownloadLink:function(){return g},appDownloadLink:function(){return l},deleteConfirmLink:function(){return c},desktopDownloadPath:function(){return _},disclaimerPoweredBy:function(){return o},extDownloadCdn:function(){return p},iOSDownloadLink:function(){return d},icpLink:function(){return s},policeLink:function(){return u},privacyPolicyLink:function(){return a},registrationLink:function(){return f},termsOfServiceLink:function(){return i},yunqueModalLink:function(){return v}});var r="https://www.doubao.com",i="".concat(r,"/legal/terms"),o="\u4E91\u96C0\u8BED\u8A00\u6A21\u578B",a="".concat(r,"/legal/privacy"),s="https://beian.miit.gov.cn/#/Integrated/index",u="https://beian.mps.gov.cn/#/query/webSearch?code=11010202010719",c="".concat(r,"/legal/delete_account"),l="https://doubao.zlinkurl.cn/Jenm5",d="https://apps.apple.com/cn/app/%E8%B1%86%E5%8C%85/id6459478672",g="https://www.doubao.com/android/d",f="https://beian.miit.gov.cn/",v="https://www.volcengine.com/product/yunque?utm_campaign=doubao_pc&utm_content=setting_button&utm_medium=setting_button&utm_source=external_cooperation&utm_term=doubao_pc_setting_button",_="/service/settings/v3/?device_platform=web&brand=doubao&aid=582465",p="https://lf3-config.bytetcc.com/obj/tcc-config-web/tcc-v2-data-flow.web.doubao-default"},63579:function(e,t,n){"use strict";n.d(t,{hookSetCookieAsSessionIdKey:function(){return r}});var r="hook_slardar_session_id"},72676:function(e,t,n){"use strict";n.d(t,{getUnreactiveLanguage:function(){return _},getUnreactiveTranslate:function(){return v},reloadForLanguageChange:function(){return p},useTranslateFn:function(){return g},useTranslateInstance:function(){return f}});var r,i=n("92769"),o=n("88802"),a=n("87382"),s=n("78597"),u=n("56216"),c=n("82298"),l=n("49503"),d=n("45431"),g=function(){var e,t=(0,c.useTranslation)().t;return(null===(e=d.localFeatureGating.get())||void 0===e?void 0:e.showI18NKey)?function(e,n){return"".concat(t(e,n),"(").concat(e,")")}:t},f=function(){return(0,c.useTranslation)().i18n},v=l.I18n.t,_=function(){return l.I18n.language};var p=(r=(0,i._)(function(){var e,t,n,r;return(0,o.__generator)(this,function(i){switch(i.label){case 0:return[3,2];case 1:if((!(r=n=null===(t=i.sent().data)||void 0===t?void 0:null===(e=t.profile_brief)||void 0===e?void 0:e.user_language_code)||r===u.BROWSER_LANGUAGE_CODE)&&(r=navigator.language),(0,u.convertDetectedLanguage)(r)!==l.I18n.language)return n&&m(n),a.logger.persist.info({eventName:"loginLanguageReload",meta:{userLanguageCode:n,navigatorLanguage:navigator.language}}),window.location.reload(),[2];i.label=2;case 2:return[2]}})}),function(){return r.apply(this,arguments)}),m=function(e){return s.SyncStorage.setItem("user_language_code",e)}},74175:function(e,t,n){"use strict";n.d(t,{apiService:function(){return c},initFlowApi:function(){return l}});var r=n("80812"),i=n("97798"),o=n("41095"),a=n("78142"),s=n("48817"),u=function(){},c=(0,i.ApiFactory)({httpClient:o.httpClient,getCommonParams:r.getCommonParams,getCommonHeaders:r.getCommonHeaders,subApiServiceConstructors:{setting:s.FlowSettingApiService,message:s.FlowMessageApiService,conversation:s.FlowConversationApiService,suggestwords:s.FlowSuggestwordsApiService,bot:s.FlowBotApiService},baseURL:u()}),l=function(){a.FlowApi.init({httpClient:o.httpClient,getCommonHeaders:r.getCommonHeaders,getCommonParams:r.getCommonParams,subApiServiceConstructors:{setting:s.FlowSettingApiService,message:s.FlowMessageApiService,conversation:s.FlowConversationApiService,suggestwords:s.FlowSuggestwordsApiService,bot:s.FlowBotApiService},baseURL:u()})}},48817:function(e,t,n){"use strict";n.d(t,{FlowBotApiService:function(){return A},FlowConversationApiService:function(){return R},FlowMessageApiService:function(){return k},FlowSettingApiService:function(){return T},FlowSuggestwordsApiService:function(){return w}});var r,i=n("47767"),o=n("92769"),a=n("69420"),s=n("50189"),u=n("95544"),c=n("73209"),l=n("29048"),d=n("26379"),g=n("88802"),f=n("33434"),v=n("26107"),_=n("62920"),p=n("12133"),m=n("44284"),h=n("12682"),y=n("41419"),M=n("58581"),S=n("60909");function b(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(void 0===t?"undefined":(0,l._)(t))?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var C=((r=C||{}).LOGIN="1",r.NOT_LOGIN="0",r),L={_deviceId:null,get deviceId(){if(this._deviceId)return this._deviceId;var I=new Promise(function(e){try{_.useChatStore.subscribe(function(e){return{ttWidConfig:e.ttWidConfig}},function(t){var n=t.ttWidConfig;(0,p.getDeviceID)(n)&&e(!0)},{fireImmediately:!0,equalityFn:f.shallow})}catch(t){e(!0)}});return this._deviceId=I,I}},E=function(e,t){var n=null==e?void 0:e.data;if(!n)return!1;var r=n.extra,i=n.config,o=null==r?void 0:r.is_login,a=null==i?void 0:i.web_id;return t&&o===C.NOT_LOGIN||o===C.LOGIN&&a},T=function(e){(0,c._)(n,e);var t=(0,d._)(n);function n(e){var r;return(0,a._)(this,n),r=t.call(this,e),b((0,i._)(r),"_waitSignal",void 0),r._waitSignal=L,r}return n.prototype.LaunchRequireLogin=function(e,t){var r=this,i=this;return(0,o._)(function(){var o,a,c;return(0,g.__generator)(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,6]),[4,window[v.PromiseName.Launch]];case 1:if((o=l.sent())&&E(o,null==e?void 0:e.fetchGuestDataOnly))return[2,o];throw Error("html launch no data or not login / no web_id");case 2:if(!(a=l.sent()).message.includes("ttwid"))return[3,3];throw a.name="ttwidError",a;case 3:return[4,(0,s._)((0,u._)(n.prototype),"Launch",r).call(i,e,t)];case 4:if((c=l.sent())&&E(c,null==e?void 0:e.fetchGuestDataOnly))return[2,c];throw Error("html launch no data or not login / no web_id");case 5:return[3,6];case 6:return[2]}})})()},n}(m.default),k=function(e){(0,c._)(n,e);var t=(0,d._)(n);function n(e){var r;return(0,a._)(this,n),r=t.call(this,e),b((0,i._)(r),"_waitSignal",void 0),r._waitSignal=L,r}var r=n.prototype;return r.MessageList=function(e,t){var r=this,i=this;return(0,o._)(function(){return(0,g.__generator)(this,function(o){switch(o.label){case 0:return[4,i._waitSignal.deviceId];case 1:return o.sent(),[2,(0,s._)((0,u._)(n.prototype),"MessageList",r).call(i,e,t)]}})})()},r.MessageReport=function(e,t){var r=this,i=this;return(0,o._)(function(){return(0,g.__generator)(this,function(o){switch(o.label){case 0:return[4,i._waitSignal.deviceId];case 1:return o.sent(),[2,(0,s._)((0,u._)(n.prototype),"MessageReport",r).call(i,e,t)]}})})()},r.MessageReplay=function(e,t){var r=this,i=this;return(0,o._)(function(){return(0,g.__generator)(this,function(o){switch(o.label){case 0:return[4,i._waitSignal.deviceId];case 1:return o.sent(),[2,(0,s._)((0,u._)(n.prototype),"MessageReplay",r).call(i,e,t)]}})})()},r.MessageStream=function(e,t){var r=this,i=this;return(0,o._)(function(){return(0,g.__generator)(this,function(o){switch(o.label){case 0:return[4,i._waitSignal.deviceId];case 1:return o.sent(),[2,(0,s._)((0,u._)(n.prototype),"MessageStream",r).call(i,e,t)]}})})()},r.GetMsgContent=function(e,t){var r=this,i=this;return(0,o._)(function(){return(0,g.__generator)(this,function(o){switch(o.label){case 0:return[4,i._waitSignal.deviceId];case 1:return o.sent(),[2,(0,s._)((0,u._)(n.prototype),"GetMsgContent",r).call(i,e,t)]}})})()},r.LatestMessageList=function(e,t){var r=this,i=this;return(0,o._)(function(){return(0,g.__generator)(this,function(o){switch(o.label){case 0:return[4,i._waitSignal.deviceId];case 1:return o.sent(),[2,(0,s._)((0,u._)(n.prototype),"LatestMessageList",r).call(i,e,t)]}})})()},n}(h.default),R=function(e){(0,c._)(n,e);var t=(0,d._)(n);function n(e){var r;return(0,a._)(this,n),r=t.call(this,e),b((0,i._)(r),"_waitSignal",void 0),r._waitSignal=L,r}var r=n.prototype;return r.ConversationClear=function(e,t){var r=this,i=this;return(0,o._)(function(){return(0,g.__generator)(this,function(o){switch(o.label){case 0:return[4,i._waitSignal.deviceId];case 1:return o.sent(),[2,(0,s._)((0,u._)(n.prototype),"ConversationClear",r).call(i,e,t)]}})})()},r.ConversationInfo=function(e,t){var r=this,i=this;return(0,o._)(function(){return(0,g.__generator)(this,function(o){switch(o.label){case 0:return[4,i._waitSignal.deviceId];case 1:return o.sent(),[2,(0,s._)((0,u._)(n.prototype),"ConversationInfo",r).call(i,e,t)]}})})()},r.ConversationList=function(e,t){var r=this,i=this;return(0,o._)(function(){return(0,g.__generator)(this,function(o){switch(o.label){case 0:return[4,i._waitSignal.deviceId];case 1:return o.sent(),[2,(0,s._)((0,u._)(n.prototype),"ConversationList",r).call(i,e,t)]}})})()},r.CreateSection=function(e,t){var r=this,i=this;return(0,o._)(function(){return(0,g.__generator)(this,function(o){switch(o.label){case 0:return[4,i._waitSignal.deviceId];case 1:return o.sent(),[2,(0,s._)((0,u._)(n.prototype),"CreateSection",r).call(i,e,t)]}})})()},r.ConversationInfoAddBot=function(e,t){var r=this,i=this;return(0,o._)(function(){return(0,g.__generator)(this,function(o){switch(o.label){case 0:return[4,i._waitSignal.deviceId];case 1:return o.sent(),[2,(0,s._)((0,u._)(n.prototype),"ConversationInfoAddBot",r).call(i,e,t)]}})})()},n}(y.default),w=function(e){(0,c._)(n,e);var t=(0,d._)(n);function n(e){var r;return(0,a._)(this,n),r=t.call(this,e),b((0,i._)(r),"_waitSignal",void 0),r._waitSignal=L,r}var r=n.prototype;return r.GetSuggestWordsComposite=function(e,t){var r=this,i=this;return(0,o._)(function(){return(0,g.__generator)(this,function(o){switch(o.label){case 0:return[4,i._waitSignal.deviceId];case 1:return o.sent(),[2,(0,s._)((0,u._)(n.prototype),"GetSuggestWordsComposite",r).call(i,e,t)]}})})()},r.GetVideoSuggest=function(e,t){var r=this,i=this;return(0,o._)(function(){return(0,g.__generator)(this,function(o){switch(o.label){case 0:return[4,i._waitSignal.deviceId];case 1:return o.sent(),[2,(0,s._)((0,u._)(n.prototype),"GetVideoSuggest",r).call(i,e,t)]}})})()},r.GetFlowSuggest=function(e,t){var r=this,i=this;return(0,o._)(function(){return(0,g.__generator)(this,function(o){switch(o.label){case 0:return[4,i._waitSignal.deviceId];case 1:return o.sent(),[2,(0,s._)((0,u._)(n.prototype),"GetFlowSuggest",r).call(i,e,t)]}})})()},n}(M.default),A=function(e){(0,c._)(n,e);var t=(0,d._)(n);function n(e){var r;return(0,a._)(this,n),r=t.call(this,e),b((0,i._)(r),"_waitSignal",void 0),r._waitSignal=L,r}var r=n.prototype;return r.EnrichBot=function(e,t){var r=this,i=this;return(0,o._)(function(){return(0,g.__generator)(this,function(o){switch(o.label){case 0:return[4,i._waitSignal.deviceId];case 1:return o.sent(),[2,(0,s._)((0,u._)(n.prototype),"EnrichBot",r).call(i,e,t)]}})})()},r.GenBotIcon=function(e,t){var r=this,i=this;return(0,o._)(function(){return(0,g.__generator)(this,function(o){switch(o.label){case 0:return[4,i._waitSignal.deviceId];case 1:return o.sent(),[2,(0,s._)((0,u._)(n.prototype),"GenBotIcon",r).call(i,e,t)]}})})()},n}(S.default)},20807:function(e,t,n){"use strict";n.d(t,{getSlardarConfig:function(){return h}});var r=n("6462"),i=n("80627"),o=n("24682"),a=n("69581"),s=n("77590"),u=n("50002"),c=n("51401"),l=n("84359"),d=n("83936"),g=n("27622"),f=n.n(g),v=n("58416"),_={autoWrap:!0,ignoreUrls:[/\.(js|css|html)$/gm,/builder-runtime\.hot-update\.json$/gm,/firebaseinstallations\.googleapis\.com/gm].concat((0,r._)([/(.*)\.zijieapi\.com\/list/gm,/(.*)\.byteoversea\.com/gm])),collectBodyOnError:!0,extraExtractor:function(e,t){var n,r,i=function(e){if((0,o.default)(e))return e.startsWith("{")&&(0,d.parseJSON)(e)||{};if((0,a.default)(e)&&e)return e;return{code:"INVALID_JSON"}}(e),c=t?(0,u.default)(t,"response.status"):void 0;if(n=i,200===c&&(0,a.default)(n)&&"code"in n&&0!==n.code)return{code:"".concat(i.code)};if(r=i,200===c&&(0,a.default)(r)&&"message"in r&&"success"!==r.message&&"data"in r&&(0,a.default)(r.data)&&"error_code"in r.data&&(0,s.default)(r.data.error_code))return{error_code:"".concat(i.data.error_code),description:"description"in i.data&&(0,o.default)(i.data.description)?i.data.description:""};else return!1}},p=/^\/chat\/(?!settings|bot|new\b)\S*$/i,m=/^\/bot\/.*$/,h=function(){var e,t,n,r,o={bid:"flow_web",plugins:{ajax:_,fetch:_,jsError:{ignoreErrors:[]},pageview:{extractPid:function(e){var t,n,r=null===(n=i.default.parseUrl(e))||void 0===n?void 0:null===(t=n.url)||void 0===t?void 0:t.replace(window.location.origin,"");return p.test(r)||m.test(r)?r.replace(/\/[^/]*$/i,"/*"):r}}},integrations:[(0,l.refreshPreStartContext)(),f().imageReport({debug:!1,sample_rate:.5})]},a=(null===(r=window)||void 0===r?void 0:null===(n=r._SSR_DATA)||void 0===n?void 0:null===(t=n.context)||void 0===t?void 0:null===(e=t.reporter)||void 0===e?void 0:e.sessionId)||c.default.get(v.hookSetCookieAsSessionIdKey);return a&&(o.sessionId=a),o}},45431:function(e,t,n){"use strict";n.d(t,{isEnableDebug:function(){return g},localFeatureGating:function(){return d}});var r=n("69420"),i=n("9161"),o=n("29048"),a=n("50013"),s=n("17072"),u=n("83936");function c(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(void 0===t?"undefined":(0,o._)(t))?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l="FLOW_WEB_DEBUG_FG",d=new(function(){function e(t){(0,r._)(this,e),this.defaultValues=t,c(this,"isInit",!1),c(this,"values",{})}var t=e.prototype;return t.checkInit=function(){if(!this.isInit){var e=(0,u.parseJSON)(s.SyncStorage.getItem(l));e&&!Array.isArray(e)&&(this.values=e||{})}},t.get=function(){return this.checkInit(),(0,a.default)(this.values,this.defaultValues)},t.set=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.checkInit(),this.values=t?e:(0,i._)({},this.values,e),s.SyncStorage.setItem(l,(0,u.stringifyJSON)(this.values))},e}())({enableMessageListVirtualScroll:!1}),g=function(){return!!d.get().enableDebug}},15906:function(e,t,n){"use strict";var r=n("9161"),i=n("16044"),o=n("40509"),a=n("87382"),s=n("65042"),u=n("68413"),c=n("72182"),l=n("13625"),d=n("45431");if(s.inBrowser){var g,f=((g={}).ApiError="flow_api_error",g.NetworkError="flow_network_error",g.Unhandledrejection="handlePromiseRejection",g);window.addEventListener("unhandledrejection",function(e){var t,n,r,i,o,s,l,d,g=null==e?void 0:e.reason,v="string"==typeof g?{message:g}:g,_=f.Unhandledrejection,p={error_message:null==v?void 0:v.message,error_stack:null==v?void 0:v.stack,error_name:null==v?void 0:v.name};(0,c.isApiError)(g)&&(_=f.ApiError,Object.assign(p,{httpStatus:null==g?void 0:null===(t=g.errorOption)||void 0===t?void 0:t.httpStatus,code:null==g?void 0:null===(n=g.errorOption)||void 0===n?void 0:n.code,logId:null==g?void 0:null===(r=g.errorOption)||void 0===r?void 0:r.logId,url:null==g?void 0:null===(o=g.errorOption)||void 0===o?void 0:null===(i=o.requestConfig)||void 0===i?void 0:i.url})),(0,u.isAxiosError)(g)&&(_=f.NetworkError,Object.assign(p,{httpStatus:null==g?void 0:null===(s=g.request)||void 0===s?void 0:s.status,url:null==g?void 0:null===(l=g.config)||void 0===l?void 0:l.url,axios_error_code:null==g?void 0:g.code,axios_ready_state:null==g?void 0:null===(d=g.request)||void 0===d?void 0:d.readyState})),a.logger.persist.info({eventName:_,message:_,meta:p})})}var v=new a.SlardarReportClient(l.default);v.slardarInstance.on("beforeSend",function(e){if((null==e?void 0:e.ev_type)==="js_error"){var t,n=null==e?void 0:null===(t=e.payload)||void 0===t?void 0:t.error;if((null==n?void 0:n.name)==="ApiError"&&"string"==typeof(null==n?void 0:n.message)){var a=/(.+),.?(logId=.+)/.exec(n.message);if(null!==a){var s=(0,o._)(a,3),u=(s[0],s[1]),c=s[2];n.message=u||n.message,e.payload.extra=(0,i._)((0,r._)({},e.payload.extra),{logId:c})}}}return e}),a.logger.init({disableConsole:!(0,d.isEnableDebug)(),clients:[v],ctx:{meta:{}}})},6314:function(e,t,n){"use strict";n.d(t,{getCountry:function(){return o},setCountry:function(){return a}});var r=n("17072"),i="flow_user_country",o=function(){return r.SyncStorage.getItem(i)},a=function(e){return r.SyncStorage.setItem(i,e)}},97798:function(e,t,n){"use strict";n.d(t,{ApiFactory:function(){return S}});var r=n("9161"),i=n("89334"),o=n("40509"),a=n("56956"),s=n("60909"),u=n("41419"),c=n("82242"),l=n("12682"),d=n("72602"),g=n("22307"),f=n("70083"),v=n("17266"),_=n("37754"),p=n("51792"),m=n("98513"),h=n("44284"),y=n("58581"),M={bot:s.default,conversation:u.default,message:l.default,dataReport:c.default,samantha:_.default,notify:d.default,safety:v.default,profile:g.default,search:p.default,suggestwords:y.default,resource:f.default,setting:h.default,seo:m.default},S=function(e){var t=e.httpClient,n=e.getCommonHeaders,s=e.getCommonParams,u=e.baseURL,c=e.ApiServiceConstructor,l=void 0===c?a.default:c,d=e.subApiServiceConstructors,g=e.apiServiceConstructorOptions,f=void 0===g?{baseURL:u,request:function(e,o){var a=e.params,u=e.headers,c=(0,i._)(e,["params","headers"]);return t((0,r._)({params:(0,r._)({},null==s?void 0:s(),a),headers:(0,r._)({},null==n?void 0:n(),u,null==o?void 0:o.overrideHeaders)},c),o)}}:g,v=e.subApiServiceConstructorOptions,_=void 0===v?{bot:f,conversation:f,message:f,dataReport:f,samantha:f,safety:f,notify:f,suggestwords:f,search:f,profile:f,resource:f,setting:f,seo:f}:v,p=new l(f);return Object.entries((0,r._)({},M,d)).forEach(function(e){var t=(0,o._)(e,2),n=t[0],r=t[1];p[n]=new r(_[n])}),p}},56956:function(e,t,n){"use strict";n.d(t,{default:function(){return a}});var r=n("69420"),i=n("29048");function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(void 0===t?"undefined":(0,i._)(t))?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=function(){function e(t){(0,r._)(this,e),o(this,"request",function(){throw Error("AliceApiService.request is undefined")}),o(this,"baseURL",""),this.request=(null==t?void 0:t.request)||this.request,this.baseURL=(null==t?void 0:t.baseURL)||""}var t=e.prototype;return t.genBaseURL=function(e){return"string"==typeof this.baseURL?this.baseURL+e:this.baseURL(e)},t.CheckUpdate=function(e,t){var n=this.genBaseURL("/alice/update/check");return this.request({url:n,method:"POST"},t)},t.GetQuery=function(e,t){var n=this.genBaseURL("/alice/query"),r=e||{},i={query_text:r.query_text,source:r.source};return this.request({url:n,method:"POST",data:i},t)},t.LoadVideoTT=function(e,t){var n=this.genBaseURL("/alice/media/source/2"),r=e||{},i={query:r.query,search_id:r.search_id,item_ids:r.item_ids,offset:r.offset,limit:r.limit};return this.request({url:n,method:"POST",data:i},t)},t.LoadVideoDY=function(e,t){var n=this.genBaseURL("/alice/media/source/3"),r=e||{},i={query:r.query,search_id:r.search_id,item_ids:r.item_ids,offset:r.offset,limit:r.limit};return this.request({url:n,method:"POST",data:i},t)},t.DebugPromptDetail=function(e,t){var n=this.genBaseURL("/alice/debug/prompt_detail"),r=e||{},i={message_id:r.message_id,type_list:r.type_list};return this.request({url:n,method:"POST",data:i},t)},t.MCheckMusic=function(e,t){var n=this.genBaseURL("/alice/media/mcheck/music"),r=e||{},i={check_list:r.check_list,scene:r.scene};return this.request({url:n,method:"POST",data:i},t)},t.Report=function(e,t){var n=this.genBaseURL("/alice/report/create"),r=e||{},i={report_type:r.report_type,entity_id:r.entity_id,reason_ids:r.reason_ids,reason_detail:r.reason_detail};return this.request({url:n,method:"POST",data:i},t)},t.TemplateRecommendRelated=function(e,t){var n=this.genBaseURL("/alice/template/recommend_related"),r=e||{},i={template_type:r.template_type,template_id:r.template_id,offset:r.offset,size:r.size,enter_time:r.enter_time};return this.request({url:n,method:"POST",data:i},t)},t.TemplateRecommendList=function(e,t){var n=this.genBaseURL("/alice/template/recommend_list"),r=e||{},i={template_type:r.template_type,offset:r.offset,size:r.size,token:r.token};return this.request({url:n,method:"POST",data:i},t)},t.LoadMusicQS=function(e,t){var n=this.genBaseURL("/alice/media/source/4"),r={vid_list:(e||{}).vid_list};return this.request({url:n,method:"POST",data:r},t)},t.GetMsgTemplates=function(e,t){var n=this.genBaseURL("/alice/msg_template/get"),r=e||{},i={cursor:r.cursor,size:r.size,template_lang:r.template_lang,cold_start:r.cold_start};return this.request({url:n,method:"POST",data:i},t)},t.SearchCards=function(e,t){var n=this.genBaseURL("/alice/media/card_search"),r=e||{},i={query_params:r.query_params,query_type:r.query_type};return this.request({url:n,method:"POST",data:i},t)},e}()},60909:function(e,t,n){"use strict";n.d(t,{default:function(){return a}});var r=n("69420"),i=n("29048");function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(void 0===t?"undefined":(0,i._)(t))?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=function(){function e(t){(0,r._)(this,e),o(this,"request",function(){throw Error("AliceBotApiService.request is undefined")}),o(this,"baseURL",""),this.request=(null==t?void 0:t.request)||this.request,this.baseURL=(null==t?void 0:t.baseURL)||""}var t=e.prototype;return t.genBaseURL=function(e){return"string"==typeof this.baseURL?this.baseURL+e:this.baseURL(e)},t.GenBotIcon=function(e,t){var n=this.genBaseURL("/alice/bot/gen_icon"),r=e||{},i={name:r.name,description:r.description,bot_lang:r.bot_lang};return this.request({url:n,method:"POST",data:i},t)},t.GenBotIconByPrompt=function(e,t){var n=this.genBaseURL("/alice/bot/gen_icon_by_prompt"),r=e||{},i={prompt:r.prompt,num:r.num};return this.request({url:n,method:"POST",data:i},t)},t.GetBotList=function(e,t){var n=this.genBaseURL("/alice/bot/get_bot_list"),r=e||{},i={bot_ids:r.bot_ids,bot_list_type:r.bot_list_type,pageIndex:r.pageIndex,pageSize:r.pageSize};return this.request({url:n,method:"POST",data:i},t)},t.UploadFile=function(e,t){var n=this.genBaseURL("/alice/bot/upload_file"),r=e||{},i={file_head:r.file_head,data:r.data};return this.request({url:n,method:"POST",data:i},t)},t.RecommendBots=function(e,t){var n=this.genBaseURL("/alice/bot/recommend"),r=e||{},i={recommend_type:r.recommend_type,page_index:r.page_index,page_size:r.page_size,bot_ids:r.bot_ids,tag_id:r.tag_id,msg_list:r.msg_list,cold_start:r.cold_start};return this.request({url:n,method:"POST",data:i},t)},t.LanguageList=function(e,t){var n=this.genBaseURL("/alice/bot/language_list"),r={bot_id:(e||{}).bot_id};return this.request({url:n,method:"POST",data:r},t)},t.CreateBot=function(e,t){var n=this.genBaseURL("/alice/bot/create"),r=e||{},i={name:r.name,description_for_human:r.description_for_human,icon_uri:r.icon_uri,private_status:r.private_status,voice_type:r.voice_type,ugc_voice:r.ugc_voice,bot_lang:r.bot_lang,muted:r.muted,use_bot_enrich:r.use_bot_enrich,enable_web_search:r.enable_web_search,enable_pic_gen:r.enable_pic_gen,first_met:r.first_met,use_bot_enrich_edit:r.use_bot_enrich_edit,create_channel:r.create_channel};return this.request({url:n,method:"POST",data:i},t)},t.EnrichBot=function(e,t){var n=this.genBaseURL("/alice/bot/enrich"),r=e||{},i={name:r.name,bot_lang:r.bot_lang,need_desc:r.need_desc,need_voice_type:r.need_voice_type};return this.request({url:n,method:"POST",data:i},t)},t.UpdateBot=function(e,t){var n=this.genBaseURL("/alice/bot/update_bot"),r=e||{},i={bot_id:r.bot_id,name:r.name,description_for_human:r.description_for_human,icon_uri:r.icon_uri,model_type:r.model_type,voice_type:r.voice_type,delete:r.delete,bot_lang:r.bot_lang,muted:r.muted,private_status:r.private_status,ugc_voice:r.ugc_voice,message_push:r.message_push,enable_web_search:r.enable_web_search,enable_pic_gen:r.enable_pic_gen,first_met:r.first_met};return this.request({url:n,method:"POST",data:i},t)},t.VoiceTypeList=function(e,t){var n=this.genBaseURL("/alice/bot/voice_type_list"),r=e||{},i={bot_id:r.bot_id,bot_language_code:r.bot_language_code};return this.request({url:n,method:"POST",data:i},t)},t.BotInfo=function(e,t){var n=this.genBaseURL("/alice/bot/info"),r=e||{},i={token:r.token,botId:r.botId};return this.request({url:n,method:"POST",data:i},t)},t.GetBotSubject=function(e,t){var n=this.genBaseURL("/alice/bot/get_bot_subject"),r={bot_id:(e||{}).bot_id};return this.request({url:n,method:"POST",data:r},t)},t.UpdateCallerName=function(e,t){var n=this.genBaseURL("/alice/bot/update_caller_name"),r=e||{},i={bot_id:r.bot_id,caller_name:r.caller_name};return this.request({url:n,method:"POST",data:i},t)},t.GetBotPreset=function(e,t){var n=this.genBaseURL("/alice/bot/get_bot_preset"),r={bot_id:(e||{}).bot_id};return this.request({url:n,method:"POST",data:r},t)},t.GetFirstMet=function(e,t){var n=this.genBaseURL("/alice/bot/first_met"),r={bot_id:(e||{}).bot_id};return this.request({url:n,method:"POST",data:r},t)},t.GetBot=function(e,t){var n=this.genBaseURL("/alice/bot/get_bot"),r={bot_id:(e||{}).bot_id};return this.request({url:n,method:"POST",data:r},t)},t.GetBotListV2=function(e,t){var n=this.genBaseURL("/alice/bot/get_bot_list_v2"),r={bot_id_list:(e||{}).bot_id_list};return this.request({url:n,method:"POST",data:r},t)},t.ActionBarList=function(e,t){var n=this.genBaseURL("/alice/bot/action_bar_list"),r=e||{},i={language_code:r.language_code,bot_id:r.bot_id,conversation_id:r.conversation_id};return this.request({url:n,method:"POST",data:i},t)},t.ActionBarOperationReport=function(e,t){var n=this.genBaseURL("/alice/bot/action_bar_report"),r=e||{},i={language_code:r.language_code,bot_id:r.bot_id,conversation_id:r.conversation_id,action_bar_key:r.action_bar_key,passthrough_field:r.passthrough_field,switch_report:r.switch_report};return this.request({url:n,method:"POST",data:i},t)},t.ActionCards=function(e,t){var n=this.genBaseURL("/alice/bot/action_cards"),r=e||{},i={bot_id:r.bot_id,card_scene:r.card_scene};return this.request({url:n,method:"POST",data:i},t)},e}()},26689:function(e,t,n){"use strict";n.d(t,{BizType:function(){return l},BotActionType:function(){return d},BotMode:function(){return g},BotRecommendType:function(){return f},BotType:function(){return v},CallMode:function(){return _},PrivateStatus:function(){return p}});var r,i,o,a,s,u,c,l=((r={})[r.AI_ARTIST=1]="AI_ARTIST",r);var d=((i={})[i.CreateConversation=1]="CreateConversation",i[i.ArchiveConversation=2]="ArchiveConversation",i);var g=((o={})[o.subject=1]="subject",o[o.guest=2]="guest",o);var f=((a={})[a.Choiceness=1]="Choiceness",a[a.Discovery=2]="Discovery",a[a.NotLogin=3]="NotLogin",a[a.ConversationPage=4]="ConversationPage",a[a.ImmersiveMode=5]="ImmersiveMode",a[a.ParticipantPage=6]="ParticipantPage",a[a.ConversationChatMode=7]="ConversationChatMode",a[a.CocoWebNotLogin=8]="CocoWebNotLogin",a);var v=((s={})[s.User=0]="User",s[s.Coco=1]="Coco",s[s.GuanFang=2]="GuanFang",s[s.CocoWeb=3]="CocoWeb",s);var _=((u={})[u.None=0]="None",u[u.Real=1]="Real",u[u.RealNone=2]="RealNone",u);var p=((c={})[c.Public=1]="Public",c[c.Private=2]="Private",c[c.Unlisted=3]="Unlisted",c)},41419:function(e,t,n){"use strict";n.d(t,{default:function(){return a}});var r=n("69420"),i=n("29048");function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(void 0===t?"undefined":(0,i._)(t))?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=function(){function e(t){(0,r._)(this,e),o(this,"request",function(){throw Error("AliceConversationApiService.request is undefined")}),o(this,"baseURL",""),this.request=(null==t?void 0:t.request)||this.request,this.baseURL=(null==t?void 0:t.baseURL)||""}var t=e.prototype;return t.genBaseURL=function(e){return"string"==typeof this.baseURL?this.baseURL+e:this.baseURL(e)},t.CreateSubConversation=function(e,t){var n=this.genBaseURL("/alice/conversation/create_sub_conversation"),r=e||{},i={conversation_id:r.conversation_id,message_id:r.message_id,scene:r.scene};return this.request({url:n,method:"POST",data:i},t)},t.ConversationPin=function(e,t){var n=this.genBaseURL("/alice/conversation/pin"),r=e||{},i={conversation_id:r.conversation_id,bot_id:r.bot_id,local_conversation_id:r.local_conversation_id,ext:r.ext};return this.request({url:n,method:"POST",data:i},t)},t.ConversationUpdate=function(e,t){var n=this.genBaseURL("/alice/conversation/update"),r=e||{},i={conversation_id:r.conversation_id,name:r.name,local_conversation_id:r.local_conversation_id,bot_id:r.bot_id,ext:r.ext};return this.request({url:n,method:"POST",data:i},t)},t.ConversationInfo=function(e,t){var n=this.genBaseURL("/alice/conversation/info"),r=e||{},i={conversation_id:r.conversation_id,bot_id:r.bot_id,local_conversation_id:r.local_conversation_id,ext:r.ext,init_messages:r.init_messages,bot_source:r.bot_source,scene:r.scene};return this.request({url:n,method:"POST",data:i},t)},t.ConversationUnpin=function(e,t){var n=this.genBaseURL("/alice/conversation/unpin"),r={conversation_id:(e||{}).conversation_id};return this.request({url:n,method:"POST",data:r},t)},t.CreateSection=function(e,t){var n=this.genBaseURL("/alice/conversation/create_section"),r=e||{},i={conversation_id:r.conversation_id,local_conversation_id:r.local_conversation_id,bot_id:r.bot_id,ext:r.ext};return this.request({url:n,method:"POST",data:i},t)},t.MarkConversationRead=function(e,t){var n=this.genBaseURL("/alice/conversation/mark_conversation_read"),r=e||{},i={conversation_id:r.conversation_id,latest_read_idx:r.latest_read_idx};return this.request({url:n,method:"POST",data:i},t)},t.ConversationArchive=function(e,t){var n=this.genBaseURL("/alice/conversation/archive"),r=e||{},i={conversation_id:r.conversation_id,bot_id:r.bot_id,local_conversation_id:r.local_conversation_id};return this.request({url:n,method:"POST",data:i},t)},t.ConversationInfoAddBot=function(e,t){var n=this.genBaseURL("/alice/conversation/add_bot"),r={token:(e||{}).token};return this.request({url:n,method:"POST",data:r},t)},t.ConversationClear=function(e,t){var n=this.genBaseURL("/alice/conversation/clear"),r=e||{},i={conversation_id:r.conversation_id,local_conversation_id:r.local_conversation_id,bot_id:r.bot_id,ext:r.ext};return this.request({url:n,method:"POST",data:i},t)},t.ConversationList=function(e,t){var n=this.genBaseURL("/alice/conversation/list"),r=e||{},i={index:r.index,batch_size:r.batch_size,conversation_types:r.conversation_types};return this.request({url:n,method:"POST",data:i},t)},t.ConversationReport=function(e,t){var n=this.genBaseURL("/alice/conversation/report"),r=e||{},i={conversation_id:r.conversation_id,conversation_type:r.conversation_type,bot_conversation_type:r.bot_conversation_type};return this.request({url:n,method:"POST",data:i},t)},e}()},66080:function(e,t,n){"use strict";n.d(t,{ConversationType:function(){return i}});var r,i=((r={})[r.Coco=1]="Coco",r[r.Bot=2]="Bot",r[r.CocoSub=3]="CocoSub",r[r.CocoWeb=4]="CocoWeb",r[r.CocoWebSub=5]="CocoWebSub",r)},51816:function(e,t,n){"use strict";n.d(t,{CreateScene:function(){return i}});var r,i=((r={})[r.Default=0]="Default",r[r.Landing=1]="Landing",r)},82242:function(e,t,n){"use strict";n.d(t,{default:function(){return a}});var r=n("69420"),i=n("29048");function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(void 0===t?"undefined":(0,i._)(t))?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=function(){function e(t){(0,r._)(this,e),o(this,"request",function(){throw Error("DataReportService.request is undefined")}),o(this,"baseURL",""),this.request=(null==t?void 0:t.request)||this.request,this.baseURL=(null==t?void 0:t.baseURL)||""}var t=e.prototype;return t.genBaseURL=function(e){return"string"==typeof this.baseURL?this.baseURL+e:this.baseURL(e)},t.FetchMsgList=function(e,t){var n=this.genBaseURL("/alice_op/msg/fetch_message_ids"),r=e||{},i={start_time:r.start_time,end_time:r.end_time,content:r.content,user_id:r.user_id,message_id:r.message_id,device_id:r.device_id,page_index:r.page_index,page_size:r.page_size};return this.request({url:n,method:"POST",data:i},t)},t.FetchChainEventList=function(e,t){var n=this.genBaseURL("/alice_op/msg/fetch_chain_events"),r=e||{},i={start_time:r.start_time,end_time:r.end_time,message_id:r.message_id,offset:r.offset,limit:r.limit};return this.request({url:n,method:"POST",data:i},t)},t.FetchAliceChainEventList=function(e,t){var n=this.genBaseURL("/alice/msg/fetch_chain_events"),r=e||{},i={start_time:r.start_time,end_time:r.end_time,message_id:r.message_id,offset:r.offset,limit:r.limit};return this.request({url:n,method:"POST",data:i},t)},t.FetchAliceEventList=function(e,t){var n=this.genBaseURL("/alice/msg/fetch_events"),r=e||{},i={start_time:r.start_time,end_time:r.end_time,message_id:r.message_id,offset:r.offset,limit:r.limit};return this.request({url:n,method:"POST",data:i},t)},e}()},12682:function(e,t,n){"use strict";n.d(t,{default:function(){return a}});var r=n("69420"),i=n("29048");function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(void 0===t?"undefined":(0,i._)(t))?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=function(){function e(t){(0,r._)(this,e),o(this,"request",function(){throw Error("MessageApiService.request is undefined")}),o(this,"baseURL",""),this.request=(null==t?void 0:t.request)||this.request,this.baseURL=(null==t?void 0:t.baseURL)||""}var t=e.prototype;return t.genBaseURL=function(e){return"string"==typeof this.baseURL?this.baseURL+e:this.baseURL(e)},t.StreamCallBot=function(e,t){var n=this.genBaseURL("/alice/message/stream_call_bot"),r={payload:(e||{}).payload};return this.request({url:n,method:"POST",data:r},t)},t.MessageReplay=function(e,t){var n=this.genBaseURL("/alice/message/replay"),r={payload:(e||{}).payload};return this.request({url:n,method:"POST",data:r},t)},t.MessageList=function(e,t){var n=this.genBaseURL("/alice/message/list"),r=e||{},i={conversation_id:r.conversation_id,cursor:r.cursor,batch_size:r.batch_size,bot_id:r.bot_id};return this.request({url:n,method:"POST",data:i},t)},t.MessageStream=function(e,t){var n=this.genBaseURL("/alice/message/stream_reply"),r=e||{},i={seq_st:r.seq_st,seq_ed:r.seq_ed,reply_id:r.reply_id,binary_type:r.binary_type,token:r.token};return this.request({url:n,method:"POST",data:i},t)},t.MessageReport=function(e,t){var n=this.genBaseURL("/alice/message/report"),r=e||{},i={message_id:r.message_id,reply_id:r.reply_id,action:r.action,position:r.position,feedbackDetail:r.feedbackDetail,conversation_id:r.conversation_id,feedbackSource:r.feedbackSource};return this.request({url:n,method:"POST",data:i},t)},t.GetMessageReply=function(e,t){var n=this.genBaseURL("/alice/message/get_reply"),r=e||{},i={message_id:r.message_id,conversation_id:r.conversation_id};return this.request({url:n,method:"POST",data:i},t)},t.UpdateMsgContent=function(e,t){var n=this.genBaseURL("/alice/message/update_content"),r=e||{},i={msg_id:r.msg_id,display_content:r.display_content,content:r.content};return this.request({url:n,method:"POST",data:i},t)},t.LatestMessageList=function(e,t){var n=this.genBaseURL("/alice/conversation/latest_messagelist"),r={request_list:(e||{}).request_list};return this.request({url:n,method:"POST",data:r},t)},t.GetMsgContent=function(e,t){var n=this.genBaseURL("/alice/message/content"),r={msg_id:(e||{}).msg_id};return this.request({url:n,method:"POST",data:r},t)},t.GetAnswerActionContent=function(e,t){var n=this.genBaseURL("/alice/message/answer_action_content"),r=e||{},i={action_key:r.action_key,msg_id:r.msg_id,bot_id:r.bot_id,conversation_id:r.conversation_id,section_id:r.section_id};return this.request({url:n,method:"POST",data:i},t)},t.CheckMessageSendRateLimit=function(e,t){var n=this.genBaseURL("/alice/message/rate_limit");return this.request({url:n,method:"POST"},t)},t.PutChatRecord=function(e,t){var n=this.genBaseURL("/alice/message/put_chat_record"),r=e||{},i={conversation_id:r.conversation_id,tool_message_id:r.tool_message_id,switch_message_id:r.switch_message_id};return this.request({url:n,method:"POST",data:i},t)},t.CmdList=function(e,t){var n=this.genBaseURL("/alice/message/cmd_list"),r=e||{},i={last_cmd_index:r.last_cmd_index,batch_size:r.batch_size};return this.request({url:n,method:"POST",data:i},t)},t.MessagePreHandle=function(e,t){var n=this.genBaseURL("/alice/message/pre_handle"),r=e||{},i={content_type:r.content_type,content:r.content};return this.request({url:n,method:"POST",data:i},t)},t.MessageListV2=function(e,t){var n=this.genBaseURL("/alice/message/list/v2"),r=e||{},i={conversation_id:r.conversation_id,start_index:r.start_index,batch_size:r.batch_size,is_reverse:r.is_reverse,end_index:r.end_index};return this.request({url:n,method:"POST",data:i},t)},t.MessageStreamV2=function(e,t){var n=this.genBaseURL("/alice/message/stream"),r=e||{},i={seq_st:r.seq_st,seq_ed:r.seq_ed,reply_id:r.reply_id,binary_type:r.binary_type,token:r.token};return this.request({url:n,method:"POST",data:i},t)},t.SaveBotReply=function(e,t){var n=this.genBaseURL("/alice/message/save_bot_reply"),r=e||{},i={user_id:r.user_id,conversation_id:r.conversation_id,bot_id:r.bot_id,question_id:r.question_id,contents:r.contents,suggests:r.suggests,source_type:r.source_type,for_historical_question:r.for_historical_question,biz_id:r.biz_id,tenant_id:r.tenant_id};return this.request({url:n,method:"POST",data:i},t)},t.SaveMessageShareInfo=function(e,t){var n=this.genBaseURL("/alice/message/share/save"),r=e||{},i={conv_id:r.conv_id,message_id_list:r.message_id_list,enable_generate_title:r.enable_generate_title,is_allow_seo:r.is_allow_seo};return this.request({url:n,method:"POST",data:i},t)},t.GetMessageShareInfo=function(e,t){var n=this.genBaseURL("/alice/message/share/get"),r={share_id:(e||{}).share_id};return this.request({url:n,method:"POST",data:r},t)},t.MessageAfterAuthorization=function(e,t){var n=this.genBaseURL("/alice/message/after_authorization"),r={scene:(e||{}).scene};return this.request({url:n,method:"POST",data:r},t)},e}()},96988:function(e,t,n){"use strict";n.d(t,{CmdType:function(){return o},FeedbackType:function(){return a}});var r,i,o=((r={})[r.MessageDelete=1]="MessageDelete",r[r.MessageLike=2]="MessageLike",r[r.MessageDislike=3]="MessageDislike",r[r.MessageIDLocalMapping=4]="MessageIDLocalMapping",r[r.MessageNotCompliant=5]="MessageNotCompliant",r[r.ConversationArchive=11]="ConversationArchive",r[r.ConversationAdd=12]="ConversationAdd",r[r.ConversationCreateSection=13]="ConversationCreateSection",r[r.ConversationClearHistory=14]="ConversationClearHistory",r[r.ConversationUpdate=15]="ConversationUpdate",r[r.ConversationRead=16]="ConversationRead",r[r.ConversationLandingInsert=17]="ConversationLandingInsert",r[r.OnboardingBegin=21]="OnboardingBegin",r[r.OnboardingFail=22]="OnboardingFail",r[r.OnboardingCancel=23]="OnboardingCancel",r[r.OnboardingNeedStart=26]="OnboardingNeedStart",r[r.UserBanned=31]="UserBanned",r[r.UserBanRelease=32]="UserBanRelease",r[r.UserConfigUpdate=41]="UserConfigUpdate",r[r.NeedLocation=51]="NeedLocation",r[r.TTSBegin=91]="TTSBegin",r[r.UserMute=101]="UserMute",r[r.UserMuteRelease=102]="UserMuteRelease",r[r.TouristReachChatLimit=1e3]="TouristReachChatLimit",r);var a=((i={})[i.Default=0]="Default",i[i.Like=1]="Like",i[i.Unlike=2]="Unlike",i[i.Better=3]="Better",i[i.Almost=4]="Almost",i)},68534:function(e,t,n){"use strict";n.d(t,{ConnectionType:function(){return u},ContentType:function(){return c},MessageType:function(){return l},MetaType:function(){return d},PushMessageStatus:function(){return g}});var r,i,o,a,s,u=((r={})[r.WebSocket=0]="WebSocket",r[r.HttpChunk=1]="HttpChunk",r[r.Http=2]="Http",r);var c=((i={})[i.Text=1]="Text",i[i.Suggest=2]="Suggest",i[i.Music=3]="Music",i[i.WebView=4]="WebView",i[i.Video=5]="Video",i[i.Image=6]="Image",i[i.File=7]="File",i[i.PluginSearchResult=8]="PluginSearchResult",i[i.AwemeVideoList=9]="AwemeVideoList",i[i.Composite=10]="Composite",i[i.Card=50]="Card",i[i.BotCard=51]="BotCard",i[i.CopilotCard=60]="CopilotCard",i[i.Widget=100]="Widget",i);var l=((o={})[o.Message=1]="Message",o[o.Ack=2]="Ack",o[o.Loading=3]="Loading",o);var d=((a={})[a.Replaceable=1]="Replaceable",a[a.Insertable=2]="Insertable",a);var g=((s={})[s.Available=1]="Available",s[s.InVisible=2]="InVisible",s[s.Broken=3]="Broken",s[s.Streaming=4]="Streaming",s[s.Unselected=5]="Unselected",s[s.NotCompliant=6]="NotCompliant",s)},72602:function(e,t,n){"use strict";n.d(t,{default:function(){return a}});var r=n("69420"),i=n("29048");function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(void 0===t?"undefined":(0,i._)(t))?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=function(){function e(t){(0,r._)(this,e),o(this,"request",function(){throw Error("NotifyApiService.request is undefined")}),o(this,"baseURL",""),this.request=(null==t?void 0:t.request)||this.request,this.baseURL=(null==t?void 0:t.baseURL)||""}var t=e.prototype;return t.genBaseURL=function(e){return"string"==typeof this.baseURL?this.baseURL+e:this.baseURL(e)},t.GetNoticeGroupUnreadCount=function(e,t){var n=this.genBaseURL("/alice/notice/get_unread_count"),r={groups:(e||{}).groups};return this.request({url:n,method:"POST",data:r},t)},t.GetNoticeList=function(e,t){var n=this.genBaseURL("/alice/notice/list"),r=e||{},i={min_cursor:r.min_cursor,max_cursor:r.max_cursor,count:r.count,need_read_time:r.need_read_time};return this.request({url:n,method:"POST",data:i},t)},t.MarkReadNotice=function(e,t){var n=this.genBaseURL("/alice/notice/mark_read"),r=e||{},i={group:r.group,last_read_time:r.last_read_time,mark_count:r.mark_count,notice_id:r.notice_id};return this.request({url:n,method:"POST",data:i},t)},t.GetPushContent=function(e,t){var n=this.genBaseURL("/alice/notice/push_content"),r=e||{},i={group_id:r.group_id,user_id:r.user_id};return this.request({url:n,method:"POST",data:i},t)},t.ReportOCPCEvent=function(e,t){var n=this.genBaseURL("/alice/notice/report_ocpc"),r=e||{},i={landing_page_url:r.landing_page_url,app_id:r.app_id,event_ts:r.event_ts,event_name:r.event_name,event_params:r.event_params};return this.request({url:n,method:"POST",data:i},t)},t.GetNoticeBanner=function(e,t){var n=this.genBaseURL("/alice/notice/banner");return this.request({url:n,method:"POST"},t)},t.UpdateRedDot=function(e,t){var n=this.genBaseURL("/alice/notice/update_red_dot"),r=e||{},i={user_id:r.user_id,all_red_dot:r.all_red_dot,red_dot:r.red_dot};return this.request({url:n,method:"POST",data:i},t)},e}()},22307:function(e,t,n){"use strict";n.d(t,{default:function(){return a}});var r=n("69420"),i=n("29048");function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(void 0===t?"undefined":(0,i._)(t))?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=function(){function e(t){(0,r._)(this,e),o(this,"request",function(){throw Error("ProfileApiService.request is undefined")}),o(this,"baseURL",""),this.request=(null==t?void 0:t.request)||this.request,this.baseURL=(null==t?void 0:t.baseURL)||""}var t=e.prototype;return t.genBaseURL=function(e){return"string"==typeof this.baseURL?this.baseURL+e:this.baseURL(e)},t.ProfileBotList=function(e,t){var n=this.genBaseURL("/alice/profile/bot_list"),r=e||{},i={visit_id:r.visit_id,index:r.index,limit:r.limit};return this.request({url:n,method:"POST",data:i},t)},t.ProfileInfo=function(e,t){var n=this.genBaseURL("/alice/profile/self"),r={visit_id:(e||{}).visit_id};return this.request({url:n,method:"POST",data:r},t)},t.CheckProfileInfoDefault=function(e,t){var n=this.genBaseURL("/alice/profile/info_default"),r={entity_id:(e||{}).entity_id};return this.request({url:n,method:"POST",data:r},t)},t.UserHitProfileRegister=function(e,t){var n=this.genBaseURL("/alice/profile/hit_register");return this.request({url:n,method:"POST"},t)},t.UpdateProfile=function(e,t){var n=this.genBaseURL("/alice/profile/update_profile"),r=e||{},i={entity_id:r.entity_id,nickname:r.nickname,user_name:r.user_name,avatar_url:r.avatar_url,is_register:r.is_register,user_language_code:r.user_language_code};return this.request({url:n,method:"POST",data:i},t)},t.CheckUserNameUnique=function(e,t){var n=this.genBaseURL("/alice/profile/user_name_unique"),r=e||{},i={user_name:r.user_name,entity_id:r.entity_id};return this.request({url:n,method:"POST",data:i},t)},t.ProfileOverview=function(e,t){var n=this.genBaseURL("/alice/profile/overview"),r={visit_id:(e||{}).visit_id};return this.request({url:n,method:"POST",data:r},t)},t.ProfileBrief=function(e,t){var n=this.genBaseURL("/alice/profile/self_brief");return this.request({url:n,method:"POST"},t)},t.ReportAwemeOpenID=function(e,t){var n=this.genBaseURL("/alice/profile/report_aweme_open_id"),r=e||{},i={client_key:r.client_key,open_id:r.open_id};return this.request({url:n,method:"POST",data:i},t)},t.OperateUserVoice=function(e,t){var n=this.genBaseURL("/alice/profile/update_user_voice"),r=e||{},i={uid:r.uid,voice_id:r.voice_id,operate:r.operate};return this.request({url:n,method:"POST",data:i},t)},t.GetUserVoice=function(e,t){var n=this.genBaseURL("/alice/profile/get_user_voice"),r={uid:(e||{}).uid};return this.request({url:n,method:"POST",data:r},t)},e}()},70083:function(e,t,n){"use strict";n.d(t,{default:function(){return a}});var r=n("69420"),i=n("29048");function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(void 0===t?"undefined":(0,i._)(t))?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=function(){function e(t){(0,r._)(this,e),o(this,"request",function(){throw Error("ResourceApiService.request is undefined")}),o(this,"baseURL",""),this.request=(null==t?void 0:t.request)||this.request,this.baseURL=(null==t?void 0:t.baseURL)||""}var t=e.prototype;return t.genBaseURL=function(e){return"string"==typeof this.baseURL?this.baseURL+e:this.baseURL(e)},t.GetFileURL=function(e,t){var n=this.genBaseURL("/alice/message/get_file_url"),r=e||{},i={uris:r.uris,type:r.type,format:r.format};return this.request({url:n,method:"POST",data:i},t)},t.UploadImage=function(e,t){var n=this.genBaseURL("/alice/upload/image"),r=e||{},i={file_type:r.file_type,biz_type:r.biz_type,data:r.data};return this.request({url:n,method:"POST",data:i},t)},t.FileUpload=function(e,t){var n=this.genBaseURL("/alice/upload/file"),r=e||{},i={file_type:r.file_type,biz_type:r.biz_type,data:r.data};return this.request({url:n,method:"POST",data:i},t)},t.GetUploadAuthToken=function(e,t){var n=this.genBaseURL("/alice/upload/auth_token"),r=e||{},i={scene:r.scene,data_type:r.data_type};return this.request({url:n,method:"POST",data:i},t)},e}()},17266:function(e,t,n){"use strict";n.d(t,{default:function(){return a}});var r=n("69420"),i=n("29048");function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(void 0===t?"undefined":(0,i._)(t))?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=function(){function e(t){(0,r._)(this,e),o(this,"request",function(){throw Error("SafetyApiService.request is undefined")}),o(this,"baseURL",""),this.request=(null==t?void 0:t.request)||this.request,this.baseURL=(null==t?void 0:t.baseURL)||""}var t=e.prototype;return t.genBaseURL=function(e){return"string"==typeof this.baseURL?this.baseURL+e:this.baseURL(e)},t.AgeGateCheck=function(e,t){var n=this.genBaseURL("/alice/age_gate/check"),r={scene:(e||{}).scene};return this.request({url:n,method:"POST",data:r},t)},t.AgeGateReport=function(e,t){var n=this.genBaseURL("/alice/age_gate/report"),r=e||{},i={birthday:r.birthday,scene:r.scene,pass:r.pass};return this.request({url:n,method:"POST",data:i},t)},t.AgeGateDelete=function(e,t){var n=this.genBaseURL("/alice/age_gate/delete"),r={uid:(e||{}).uid};return this.request({url:n,method:"POST",data:r},t)},t.RedirectByRegion=function(e,t){var n=this.genBaseURL("/alice/safety/redirect_by_region"),r={key:(e||{}).key};return this.request({url:n,method:"GET",params:r},t)},t.GetReportReasons=function(e,t){var n=this.genBaseURL("/alice/safety/report/reasons"),r={report_type:(e||{}).report_type};return this.request({url:n,method:"GET",params:r},t)},t.ConversationReport=function(e,t){var n=this.genBaseURL("/alice/safety/report/create/conversation"),r=e||{},i={report_type:r.report_type,conversation_ID:r.conversation_ID,reason_ID:r.reason_ID,reason_detail:r.reason_detail,report_message:r.report_message,report_source:r.report_source,reporter_user_ID:r.reporter_user_ID};return this.request({url:n,method:"POST",data:i},t)},t.ConversationAppeal=function(e,t){var n=this.genBaseURL("/alice/safety/conversation/appeal"),r={conversation_id:(e||{}).conversation_id};return this.request({url:n,method:"POST",data:r},t)},t.UserReport=function(e,t){var n=this.genBaseURL("/alice/safety/report/create/user"),r=e||{},i={report_type:r.report_type,reporter_user_id:r.reporter_user_id,reported_user_id:r.reported_user_id,reason_id:r.reason_id,reason_detail:r.reason_detail,report_messages:r.report_messages,report_source:r.report_source};return this.request({url:n,method:"POST",data:i},t)},e}()},37754:function(e,t,n){"use strict";n.d(t,{default:function(){return a}});var r=n("69420"),i=n("29048");function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(void 0===t?"undefined":(0,i._)(t))?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=function(){function e(t){(0,r._)(this,e),o(this,"request",function(){throw Error("SamanthaApiService.request is undefined")}),o(this,"baseURL",""),this.request=(null==t?void 0:t.request)||this.request,this.baseURL=(null==t?void 0:t.baseURL)||""}var t=e.prototype;return t.genBaseURL=function(e){return"string"==typeof this.baseURL?this.baseURL+e:this.baseURL(e)},t.GetFeed=function(e,t){var n=this.genBaseURL("/samantha/feed");return this.request({url:n,method:"GET"},t)},t.ThreadList=function(e,t){var n=this.genBaseURL("/samantha/thread/list"),r=e||{},i={index:r.index,batch_size:r.batch_size};return this.request({url:n,method:"POST",data:i},t)},t.ThreadDelete=function(e,t){var n=this.genBaseURL("/samantha/thread/delete"),r=e||{},i={thread_id:r.thread_id,conversation_id:r.conversation_id};return this.request({url:n,method:"POST",data:i},t)},t.ThreadUpdate=function(e,t){var n=this.genBaseURL("/samantha/thread/update"),r=e||{},i={thread_id:r.thread_id,conversation_id:r.conversation_id,name:r.name};return this.request({url:n,method:"POST",data:i},t)},t.ThreadCreate=function(e,t){var n=this.genBaseURL("/samantha/thread/create"),r=e||{},i={conversation_id:r.conversation_id,message_id:r.message_id};return this.request({url:n,method:"POST",data:i},t)},t.GetSkillGuidance=function(e,t){var n=this.genBaseURL("/samantha/skill/guidance"),r={config_key:(e||{}).config_key};return this.request({url:n,method:"POST",data:r},t)},t.GetRecommendSkills=function(e,t){var n=this.genBaseURL("/samantha/skill/recommend");return this.request({url:n,method:"POST"},t)},t.CreateOrGetMainThread=function(e,t){var n=this.genBaseURL("/samantha/thread/main/create_or_get");return this.request({url:n,method:"POST"},t)},t.GetSamanthaWebHitStatus=function(e,t){var n=this.genBaseURL("/samantha/user/web_hit_status/get");return this.request({url:n,method:"GET"},t)},t.UpdateSamanthaWebHitStatus=function(e,t){var n=this.genBaseURL("/samantha/user/web_hit_status/update"),r=e||{},i={status:r.status,hit_source:r.hit_source};return this.request({url:n,method:"POST",data:i},t)},t.DetectLang=function(e,t){var n=this.genBaseURL("/samantha/plugin/detect_lang"),r={raw_text:(e||{}).raw_text};return this.request({url:n,method:"POST",data:r},t)},t.GetThreadShareInfo=function(e,t){var n=this.genBaseURL("/samantha/thread/share/info"),r={thread_id:(e||{}).thread_id};return this.request({url:n,method:"POST",data:r},t)},t.GetThreadShareSnapshot=function(e,t){var n=this.genBaseURL("/samantha/thread/share/snapshot/get"),r=e||{},i={share_id:r.share_id,need_bot:r.need_bot};return this.request({url:n,method:"POST",data:i},t)},t.SaveThreadShareInfo=function(e,t){var n=this.genBaseURL("/samantha/thread/share/save"),r=e||{},i={thread_id:r.thread_id,message_index_end:r.message_index_end,is_allow_seo:r.is_allow_seo};return this.request({url:n,method:"POST",data:i},t)},t.DeleteShareThreadInfo=function(e,t){var n=this.genBaseURL("/samantha/thread/share/delete"),r={share_id:(e||{}).share_id};return this.request({url:n,method:"POST",data:r},t)},t.GetTouristFeed=function(e,t){var n=this.genBaseURL("/samantha/feed/tourist_get");return this.request({url:n,method:"GET"},t)},t.GetYouTubeShare=function(e,t){var n=this.genBaseURL("/samantha/plugin/get_youtube_share"),r={share_id:(e||{}).share_id};return this.request({url:n,method:"GET",params:r},t)},t.CreateYouTubeShare=function(e,t){var n=this.genBaseURL("/samantha/plugin/youtube_share"),r={content:(e||{}).content};return this.request({url:n,method:"POST",data:r},t)},t.GetUtmInfo=function(e,t){var n=this.genBaseURL("/samantha/desktop/get_utm"),r={id:(e||{}).id};return this.request({url:n,method:"GET",params:r},t)},t.SaveUtmInfo=function(e,t){var n=this.genBaseURL("/samantha/desktop/save_utm"),r={info:(e||{}).info};return this.request({url:n,method:"POST",data:r},t)},t.GetLatestCRXInfo=function(e,t){var n=this.genBaseURL("/samantha/plugin/latest_crx_info");return this.request({url:n,method:"GET"},t)},t.Txt2Img=function(e,t){var n=this.genBaseURL("/samantha/cozeplugin/txt2img"),r=e||{},i={app_id:r.app_id,time:r.time,sign:r.sign,size:r.size,prompt:r.prompt,n:r.n,quality:r.quality,style:r.style};return this.request({url:n,method:"POST",data:i},t)},e}()},25026:function(e,t,n){"use strict";n.d(t,{ConversationType:function(){return i}});var r,i=((r={})[r.Coco=1]="Coco",r[r.Bot=2]="Bot",r[r.CocoSub=3]="CocoSub",r[r.CocoWeb=4]="CocoWeb",r[r.CocoWebSub=5]="CocoWebSub",r)},24815:function(e,t,n){"use strict";n.d(t,{SkillType:function(){return i}});var r,i=((r={})[r.Default=0]="Default",r[r.ReadAndSummarize=1]="ReadAndSummarize",r[r.WriteAssistant=2]="WriteAssistant",r[r.ImageGeneration=3]="ImageGeneration",r[r.Search=4]="Search",r[r.Translate=5]="Translate",r[r.ReadPDF=6]="ReadPDF",r[r.ReadWebsite=7]="ReadWebsite",r)},51792:function(e,t,n){"use strict";n.d(t,{default:function(){return a}});var r=n("69420"),i=n("29048");function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(void 0===t?"undefined":(0,i._)(t))?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=function(){function e(t){(0,r._)(this,e),o(this,"request",function(){throw Error("SearchApiService.request is undefined")}),o(this,"baseURL",""),this.request=(null==t?void 0:t.request)||this.request,this.baseURL=(null==t?void 0:t.baseURL)||""}var t=e.prototype;return t.genBaseURL=function(e){return"string"==typeof this.baseURL?this.baseURL+e:this.baseURL(e)},t.Search=function(e,t){var n=this.genBaseURL("/alice/comprehensive/search"),r=e||{},i={keyword:r.keyword,index_type:r.index_type,offset:r.offset,size:r.size};return this.request({url:n,method:"POST",data:i},t)},e}()},98513:function(e,t,n){"use strict";n.d(t,{default:function(){return a}});var r=n("69420"),i=n("29048");function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(void 0===t?"undefined":(0,i._)(t))?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=function(){function e(t){(0,r._)(this,e),o(this,"request",function(){throw Error("SeoApiService.request is undefined")}),o(this,"baseURL",""),this.request=(null==t?void 0:t.request)||this.request,this.baseURL=(null==t?void 0:t.baseURL)||""}var t=e.prototype;return t.genBaseURL=function(e){return"string"==typeof this.baseURL?this.baseURL+e:this.baseURL(e)},t.GetDemo=function(e,t){var n=this.genBaseURL("/seo_api/demo"),r={pageId:(e||{}).pageId};return this.request({url:n,method:"GET",params:r},t)},t.GetItem=function(e,t){var n=this.genBaseURL("/seo_api/item/get"),r={id:(e||{}).id};return this.request({url:n,method:"GET",params:r},t)},t.GetList=function(e,t){var n=this.genBaseURL("/seo_api/item/list"),r=e||{},i={page_size:r.page_size,page_num:r.page_num};return this.request({url:n,method:"GET",params:i},t)},t.GetRecommendList=function(e,t){var n=this.genBaseURL("/seo_api/item/recommend"),r=e||{},i={page_size:r.page_size,page_num:r.page_num,recommend_type:r.recommend_type};return this.request({url:n,method:"GET",params:i},t)},t.GetUgcTalkSeoInfo=function(e,t){var n=this.genBaseURL("/seo_api/ugc/talk"),r={share_id:(e||{}).share_id};return this.request({url:n,method:"GET",params:r},t)},e}()},44284:function(e,t,n){"use strict";n.d(t,{default:function(){return a}});var r=n("69420"),i=n("29048");function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(void 0===t?"undefined":(0,i._)(t))?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=function(){function e(t){(0,r._)(this,e),o(this,"request",function(){throw Error("SettingApiService.request is undefined")}),o(this,"baseURL",""),this.request=(null==t?void 0:t.request)||this.request,this.baseURL=(null==t?void 0:t.baseURL)||""}var t=e.prototype;return t.genBaseURL=function(e){return"string"==typeof this.baseURL?this.baseURL+e:this.baseURL(e)},t.BanAppeal=function(e,t){var n=this.genBaseURL("/alice/user/ban_appeal"),r={user_id:(e||{}).user_id};return this.request({url:n,method:"POST",data:r},t)},t.SyncUserConfig=function(e,t){var n=this.genBaseURL("/alice/user/config/sync"),r={configs:(e||{}).configs};return this.request({url:n,method:"POST",data:r},t)},t.CreateBlocklistUser=function(e,t){var n=this.genBaseURL("/alice/user/blocklist/create"),r={blocklist_user_id:(e||{}).blocklist_user_id};return this.request({url:n,method:"POST",data:r},t)},t.Launch=function(e,t){var n=this.genBaseURL("/alice/user/launch"),r=e||{},i={ug_landing_tag:r.ug_landing_tag,select:r.select};return this.request({url:n,method:"POST",data:i},t)},t.GetFeedbackList=function(e,t){var n=this.genBaseURL("/alice/user/feedback_list"),r=e||{},i={iid:r.iid,appkey:r.appkey,min_id:r.min_id,max_id:r.max_id,count:r.count};return this.request({url:n,method:"POST",data:i},t)},t.GetAccountInfo=function(e,t){var n=this.genBaseURL("/alice/user/get_account_info");return this.request({url:n,method:"POST"},t)},t.DeleteBlocklistUser=function(e,t){var n=this.genBaseURL("/alice/user/blocklist/delete"),r={blocklist_user_id:(e||{}).blocklist_user_id};return this.request({url:n,method:"POST",data:r},t)},t.InnerSSOToken=function(e,t){var n=this.genBaseURL("/alice/user/inner_sso_token");return this.request({url:n,method:"ANY"},t)},t.GetTabbarConfig=function(e,t){var n=this.genBaseURL("/alice/user/tabbar/config");return this.request({url:n,method:"POST"},t)},t.InnerSSOTokenVerify=function(e,t){var n=this.genBaseURL("/alice/user/inner_sso_token_verify");return this.request({url:n,method:"POST"},t)},t.GetUserBlocklist=function(e,t){var n=this.genBaseURL("/alice/user/blocklist/list"),r=e||{},i={index:r.index,limit:r.limit};return this.request({url:n,method:"POST",data:i},t)},t.GetWebAnonID=function(e,t){var n=this.genBaseURL("/alice/user/get_web_anon_id");return this.request({url:n,method:"POST"},t)},t.PullUserConfig=function(e,t){var n=this.genBaseURL("/alice/user/config/pull"),r=e||{},i={objects:r.objects,reason:r.reason};return this.request({url:n,method:"POST",data:i},t)},t.ActHeartbeat=function(e,t){var n=this.genBaseURL("/alice/user/act_heartbeat");return this.request({url:n,method:"POST"},t)},t.GetUserOgfQuota=function(e,t){var n=this.genBaseURL("/alice/user/get_user_ogf_quota");return this.request({url:n,method:"POST"},t)},t.Dynamic=function(e,t){var n=this.genBaseURL("/alice/user/dynamic"),r={key_list:(e||{}).key_list};return this.request({url:n,method:"POST",data:r},t)},t.AuthSuccessReport=function(e,t){var n=this.genBaseURL("/alice/user/auth_success_report"),r=e||{},i={push_open:r.push_open,scene:r.scene};return this.request({url:n,method:"POST",data:i},t)},t.OpAdvanceSwitch=function(e,t){var n=this.genBaseURL("/alice/user/op_advance"),r={op_type:(e||{}).op_type};return this.request({url:n,method:"POST",data:r},t)},e}()},58581:function(e,t,n){"use strict";n.d(t,{default:function(){return a}});var r=n("69420"),i=n("29048");function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(void 0===t?"undefined":(0,i._)(t))?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=function(){function e(t){(0,r._)(this,e),o(this,"request",function(){throw Error("SuggestwordsApiService.request is undefined")}),o(this,"baseURL",""),this.request=(null==t?void 0:t.request)||this.request,this.baseURL=(null==t?void 0:t.baseURL)||""}var t=e.prototype;return t.genBaseURL=function(e){return"string"==typeof this.baseURL?this.baseURL+e:this.baseURL(e)},t.GetVideoSuggest=function(e,t){var n=this.genBaseURL("/alice/suggestwords/get_video_suggest"),r=e||{},i={item_id:r.item_id,item_id_good:r.item_id_good,video_suggest_type:r.video_suggest_type};return this.request({url:n,method:"POST",data:i},t)},t.GetSuggestWords=function(e,t){var n=this.genBaseURL("/alice/suggestwords"),r=e||{},i={query_text:r.query_text,source:r.source};return this.request({url:n,method:"POST",data:i},t)},t.GetTrendsTopic=function(e,t){var n=this.genBaseURL("/alice/suggestwords/trends_topic");return this.request({url:n,method:"POST"},t)},t.GetFlowSuggest=function(e,t){var n=this.genBaseURL("/alice/suggestwords/get_flow_suggest"),r=e||{},i={prompt_content:r.prompt_content,response_content:r.response_content,language:r.language};return this.request({url:n,method:"POST",data:i},t)},t.GetSuggestWordsComposite=function(e,t){var n=this.genBaseURL("/alice/suggestwords/composite"),r=e||{},i={query_text:r.query_text,source:r.source};return this.request({url:n,method:"POST",data:i},t)},e}()},64194:function(e,t,n){"use strict";n.d(t,{EventType:function(){return i}});var r,i=((r={})[r.Message=1]="Message",r[r.Cmd=2]="Cmd",r[r.AppAction=3]="AppAction",r)},41095:function(e,t,n){"use strict";n.d(t,{httpClient:function(){return c}});var r=n("9161"),i=n("16044"),o=n("11068"),a=n("72662"),s=n("42623"),u=a.default.create({timeout:1e4});u.interceptors.response.use(function(e){var t=e.data,n=e.headers,r=e.statusText,i=e.status,a=e.config;return(0,o.apiResponseFilter)({responseBody:void 0===t?{}:t,responseHeaders:n,responseStatusText:r,responseStatusCode:i,requestConfig:{url:a.url}})},function(e){if((0,s.isAxiosError)(e)){var t=e.response;if(t){var n,r,i=t.data,a=t.headers,u=t.statusText,c=t.status;if((0,o.apiErrorEmitWithStatusCode)(e,null==e?void 0:null===(n=e.response)||void 0===n?void 0:n.status))return;(0,o.apiResponseFilter)({responseBody:void 0===i?{}:i,responseHeaders:a,responseStatusText:u,responseStatusCode:c,requestConfig:{url:null==e?void 0:null===(r=e.config)||void 0===r?void 0:r.url}})}}throw e});var c=function(e,t){return u.request((0,r._)((0,i._)((0,r._)({},e),{params:(0,r._)({},e.params,(null==t?void 0:t.overrideParams)||{})}),(null==t?void 0:t.overrideConfig)||{}))}},78142:function(e,t,n){"use strict";n.d(t,{FlowApi:function(){return g}});var r,i,o,a=n("69420"),s=n("93426"),u=n("9161"),c=n("89334"),l=n("29048"),d=n("97798"),g=function(){function e(){(0,a._)(this,e)}return e.init=function(e){if(!this._apiService){var t=e.httpClient,n=e.getCommonHeaders,r=e.getCommonParams,i=e.baseURL,o=e.ApiServiceConstructor;this._apiService=(0,d.ApiFactory)({ApiServiceConstructor:o,apiServiceConstructorOptions:{baseURL:i,request:function(e,i){var o=e.params,a=e.headers,s=(0,c._)(e,["params","headers"]);return t((0,u._)({params:(0,u._)({},null==r?void 0:r(),o),headers:(0,u._)({},null==n?void 0:n(),a)},s),i)}},httpClient:t})}},e.checkInit=function(){if(!this._apiService)throw Error("Flow Api has not initialized")},(0,s._)(e,null,[{key:"apiService",get:function(){return this.checkInit(),this._apiService}}]),e}();r=g,o=void 0,(i=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(void 0===t?"undefined":(0,l._)(t))?t:String(t)}(i="_apiService"))in r?Object.defineProperty(r,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[i]=o},26498:function(e,t,n){"use strict";n.d(t,{ErrorCodes:function(){return a},ErrorCodesWithI18n:function(){return o}});var r,i,o=((r={})[r.UserInvalid=710022e3]="UserInvalid",r[r.CountryRestricted=710022017]="CountryRestricted",r[r.SharkBlock=710022002]="SharkBlock",r[r.NonCompliantContent=710012005]="NonCompliantContent",r[r.LoginInvalid=710012001]="LoginInvalid",r[r.InnerSSOInvalid=710012006]="InnerSSOInvalid",r[r.UserBanReleased=710012009]="UserBanReleased",r[r.UserBanned=710012008]="UserBanned",r[r.UserBanAppealing=710012011]="UserBanAppealing",r[r.UserBanAppealFailed=710012010]="UserBanAppealFailed",r[r.UserNoAuthUseBot=710012012]="UserNoAuthUseBot",r[r.ProfileUpdateNotPass=710012015]="ProfileUpdateNotPass",r[r.ProfileInReview=710012013]="ProfileInReview",r[r.ProfileNotFound=710012014]="ProfileNotFound",r[r.ProfileInputLengthExceeded=710012018]="ProfileInputLengthExceeded",r[r.ProfileUpdateNotEnabled=710012019]="ProfileUpdateNotEnabled",r[r.CannotEditBotCauseReviewing=710014001]="CannotEditBotCauseReviewing",r);var a=((i={})[i.UNKNOWN_ERROR=1]="UNKNOWN_ERROR",i[i.SHARK_BLOCKED=710022002]="SHARK_BLOCKED",i[i.COUNTRY_RESTRICTED=710022017]="COUNTRY_RESTRICTED",i[i.CONTENT_UNAVAILABLE=710012005]="CONTENT_UNAVAILABLE",i[i.NOACCESS=710012e3]="NOACCESS",i[i.NO_PERMISSION=710020101]="NO_PERMISSION",i[i.BAD_REQUEST=710020201]="BAD_REQUEST",i[i.INVALID_PARAMS=710020202]="INVALID_PARAMS",i[i.USER_INVALID=710022e3]="USER_INVALID",i[i.SYSTEM_ERROR=710020702]="SYSTEM_ERROR",i[i.NOT_LOGIN=710012001]="NOT_LOGIN",i[i.NO_INNER_SSO_TOKEN=710012006]="NO_INNER_SSO_TOKEN",i[i.LIMIT_TO_SEND_MESSAGE=710022004]="LIMIT_TO_SEND_MESSAGE",i[i.BOT_INVALID=710022005]="BOT_INVALID",i[i.BOT_BANNED=710022010]="BOT_BANNED",i[i.BOT_REVIEWING=710022011]="BOT_REVIEWING",i[i.CONVERSATION_INVALID=710022006]="CONVERSATION_INVALID",i[i.NEED_TO_WAIT=710012007]="NEED_TO_WAIT",i[i.CLEAR_LAST_PROMPT=710022008]="CLEAR_LAST_PROMPT",i[i.USER_BANNED=710012008]="USER_BANNED",i[i.USER_BAN_RELEASED=710012009]="USER_BAN_RELEASED",i[i.USER_BAN_APPEALING=710012011]="USER_BAN_APPEALING",i[i.USER_BAN_APPEAL_FAILED=710012010]="USER_BAN_APPEAL_FAILED",i[i.NETWORK_TIMEOUT=710010701]="NETWORK_TIMEOUT",i[i.MYSQL_ERROR=710020801]="MYSQL_ERROR",i[i.PARAMS_VALID_FAILED=710020203]="PARAMS_VALID_FAILED",i[i.REDIS_ERROR=710020803]="REDIS_ERROR",i[i.USER_NO_AUTH_USE_BOT=710012012]="USER_NO_AUTH_USE_BOT",i[i.USER_NOT_EXISTED=710012014]="USER_NOT_EXISTED",i[i.OPEN_AUTH_INVALID=710012020]="OPEN_AUTH_INVALID",i[i.IMAGE_SAFETY_ERROR=710025003]="IMAGE_SAFETY_ERROR",i[i.FILE_SAFETY_ERROR=710025004]="FILE_SAFETY_ERROR",i[i.CONVERSATION_MESSAGE_OVER_LIMIT=710018001]="CONVERSATION_MESSAGE_OVER_LIMIT",i[i.CONVERSATION_UNDER_REVIEW=710018002]="CONVERSATION_UNDER_REVIEW",i[i.CONVERSATION_SHARE_DELETED=710018003]="CONVERSATION_SHARE_DELETED",i[i.GUEST_REACH_LIMIT=710022013]="GUEST_REACH_LIMIT",i)},44332:function(e,t,n){"use strict";n.d(t,{BufferedEventEmitter:function(){return u}});var r=n("69420"),i=n("6462"),o=n("29048"),a=n("72193");function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(void 0===t?"undefined":(0,o._)(t))?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=function(){function e(){(0,r._)(this,e),s(this,"eventEmitter",new a.default),s(this,"started",!0),s(this,"buffer",[])}var t=e.prototype;return t.emit=function(e){for(var t,n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];if(!this.started){this.buffer.push({event:e,args:r});return}(t=this.eventEmitter).emit.apply(t,[e].concat((0,i._)(r)))},t.on=function(e,t){this.eventEmitter.on(e,t)},t.off=function(e,t){this.eventEmitter.off(e,t)},t.start=function(){if(!this.started){this.started=!0;var e=!0,t=!1,n=void 0;try{for(var r,o=this.buffer[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var a=r.value,s=a.event,u=a.args;this.emit.apply(this,[s].concat((0,i._)(u)))}}catch(e){t=!0,n=e}finally{try{!e&&null!=o.return&&o.return()}finally{if(t)throw n}}}},t.stop=function(){this.started=!1},t.clear=function(){this.buffer=[]},e}()},72046:function(e,t,n){"use strict";n.d(t,{APIErrorEvent:function(){return o},apiErrorEventEmitter:function(){return a}});var r,i=n("44332");var o=((r={}).UNAUTHORIZED="unauthorized",r.NOACCESS="noAccess",r.SHARK_BLOCK="sharkBlocked",r.COUNTRY_RESTRICTED="countryRestricted",r.CONVERSATION_INVALID="conversationInvalid",r.NEED_TO_WAIT="needToWait",r.USER_BANNED="userBanned",r.USER_BANNED_OTHER="userBannedOther",r.USER_BAN_RELEASE="userBanRelease",r.NETWORK_ERROR="networkError",r),a=new i.BufferedEventEmitter},59248:function(e,t,n){"use strict";n.d(t,{getLogIdFromHeaders:function(){return r}});var r=function(e){return null==e?void 0:e["x-tt-logid"]}},11068:function(e,t,n){"use strict";n.d(t,{apiErrorEmitWithStatusCode:function(){return f},apiResponseFilter:function(){return g},isApiError:function(){return l},isApiErrorWithI18n:function(){return d}});var r=n("9161"),i=n("16044"),o=n("87382"),a=n("26498"),s=n("69581"),u=n("72046"),c=n("59248"),l=function(e){return e instanceof o.ApiError||(null==e?void 0:e.name)==="ApiError"},d=function(e){if(!l(e))return!1;if(null==e||null===(t=e.errorOption)||void 0===t||!t.code||null==e||null===(n=e.errorOption)||void 0===n||!n.message)return!1;var t,n,r,i,u=Object.values(a.ErrorCodesWithI18n).filter(function(e){return"number"==typeof e});return!!((0,s.default)(e)&&e instanceof o.ApiError&&u.includes(Number(null==e?void 0:null===(r=e.errorOption)||void 0===r?void 0:r.code))&&(null==e?void 0:null===(i=e.errorOption)||void 0===i?void 0:i.message))},g=function(e){var t=e.responseBody,n=void 0===t?{}:t,s=e.responseHeaders,l=e.responseStatusCode,d=e.responseStatusText,g=e.requestConfig,f=n.code,v=n.msg,_=(0,c.getLogIdFromHeaders)(s);if(401===l)throw u.apiErrorEventEmitter.emit(u.APIErrorEvent.UNAUTHORIZED),new o.ApiError({message:v,code:String(f),httpStatus:d||String(l),logId:_,response:n,requestConfig:g});if(200!==l)throw new o.ApiError({message:v,code:String(f),httpStatus:d||String(l),logId:_,response:n,requestConfig:g});if(200===l&&0!==f){switch(f){case a.ErrorCodes.NOACCESS:u.apiErrorEventEmitter.emit(u.APIErrorEvent.NOACCESS,v,_);break;case a.ErrorCodes.SHARK_BLOCKED:u.apiErrorEventEmitter.emit(u.APIErrorEvent.SHARK_BLOCK,v,_);break;case a.ErrorCodes.COUNTRY_RESTRICTED:u.apiErrorEventEmitter.emit(u.APIErrorEvent.COUNTRY_RESTRICTED,v,_);break;case a.ErrorCodes.NOT_LOGIN:case a.ErrorCodes.NO_INNER_SSO_TOKEN:case a.ErrorCodes.OPEN_AUTH_INVALID:u.apiErrorEventEmitter.emit(u.APIErrorEvent.UNAUTHORIZED,v,_);break;case a.ErrorCodes.NEED_TO_WAIT:u.apiErrorEventEmitter.emit(u.APIErrorEvent.NEED_TO_WAIT,v,_);break;case a.ErrorCodes.USER_BANNED:u.apiErrorEventEmitter.emit(u.APIErrorEvent.USER_BANNED,v,_);break;case a.ErrorCodes.USER_BAN_RELEASED:case a.ErrorCodes.USER_BAN_APPEALING:case a.ErrorCodes.USER_BAN_APPEAL_FAILED:u.apiErrorEventEmitter.emit(u.APIErrorEvent.USER_BANNED_OTHER,v,_)}throw new o.ApiError({message:v,code:String(f),httpStatus:d||String(l),logId:_,response:n,requestConfig:g})}if(200===l)return(0,i._)((0,r._)({},n),{_meta:{logId:_}})},f=function(e,t){var n,r=null!==(n=e.response)&&void 0!==n?n:{},i=r.headers,o=r.data,a=(0,c.getLogIdFromHeaders)(i);return 401===t&&(u.apiErrorEventEmitter.emit(u.APIErrorEvent.UNAUTHORIZED,null==o?void 0:o.msg,a),!0)}},1251:function(e,t,n){"use strict";n.d(t,{choicenessBotsCount:function(){return r},pkgType:function(){return i}});var r=10,i="release_version"},40789:function(e,t,n){"use strict";n.d(t,{VisitPage:function(){return o},usePageHistoryStore:function(){return s}});var r,i=n("85205");var o=((r={}).LANDING="landing",r.WELCOME_PAGE="welcome_page",r.LOGIN_HOME="login_home",r.PHONE_LOGIN="phone_login",r.VERIFY_CODE="verify_code",r.CHAT="chat",r.CHAT_LIST="bot_list",r.CHAT_LIST_UNLOGIN="chat_list_unlog",r.SETTING="setting",r.BOT_SETTING="bot_setting",r.NEW_CHAT_SETTING="new_chat_setting",r.PROFILE_SETTING="profile_setting",r.BOT_LIST_DISCOVER="bot_list_discover",r.BOT_LIST_DISCOVER_SEARCH="bot_list_discover_search",r.BOT_LIST_DISCOVER_UNLOGIN="bot_list_discover_unlog",r.BOT_LIST_DISCOVER_SEARCH_UNLOGIN="bot_list_discover_search_unlog",r.BOT_LIST_PROFILE="bot_list_profile",r.BOT_LIST_OTHERS="bot_list_others",r.PROFILE_PHOTO_SELF="profile_photo_self",r.PROFILE_PHOTO_OTHERS="profile_photo_others",r.BOT_PHOTO="bot_photo",r.REGISTRATION_PROCESS="registration_process",r.BOT_CREATE_PAGE="bot_create_page",r.TEMPLATE_DETAIL="template_detail",r.SEARCH_LANDING="search_landing",r.THREAD_PAGE="thread_page",r.NEW_TAB_PAGE="newtab_page",r.OTHER="other",r),a=function(e){return e[e.length-1]},s=(0,i.create)()(function(e,t){return{history:[],setCurrentPage:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.isTemporary;if(void 0!==i&&i){e({temporaryCurrentPage:n});return}e({temporaryCurrentPage:void 0});var o=t().history;if(n!==a(o)){if(0===o.length){e({history:[n]});return}e({history:[a(o),n]})}},getCurPrevPage:function(e){var n=t(),r=n.temporaryCurrentPage,i=n.history,s=2===i.length?i[0]:void 0;return{curPage:!e&&r?r:a(i),prevPage:null!=s?s:o.LANDING}}}})},80812:function(e,t,n){"use strict";n.d(t,{getCommonHeaders:function(){return h},getCommonParams:function(){return S},getSocketCommonParams:function(){return y}});var r=n("83316"),i=n("9161"),o=n("16044"),a=n("5681"),s=n.n(a);n("51401");var u=n("78597"),c=n("12133"),l=n("62920"),d=n("10173"),g=n("49503"),f=n("89066"),v=n("90839"),_=n("71530"),p=n("20636"),m=n("1251"),h=function(){var e={};if((0,_.isEnableDebug)()){var t,n=null===(t=_.localFeatureGating.get())||void 0===t?void 0:t["x-tt-env"];n&&(e["x-tt-env"]=String(n),e["x-use-ppe"]="1")}return e};function y(e){return(0,i._)((0,o._)((0,i._)({"use-olympus-account":1},function(e){var t=e.device_platform,n=e.version_code,r=e.access_key,i=e.fpid,o=e.aid,a=e.ttwid,u=window;if(u.byted_acrawler&&a){var c=s()("device_platform=".concat(t,"&version_code=").concat(n,"&access_key=").concat(r,"&fpid=").concat(i,"&aid=").concat(o,"&ttwid=").concat(a));return{"X-Bogus":u.byted_acrawler.frontierSign({"X-MS-STUB":c})["X-Bogus"],"X-MS-STUB":c,referer:document.referrer}}}({fpid:e.ws_product_id,access_key:e.ws_access_key,aid:e.ws_app_id,ttwid:e.ttwid,version_code:d.version_code,device_platform:d.device_platform})||{}),{pkg_type:m.pkgType,version_code:d.version_code,device_platform:d.device_platform,language:g.I18n.language,samantha_web:1,web_id:(0,f.checkAndGetTeaToken)().web_id,device_id:(0,c.getDeviceID)({tt_wid:e.ttwid,web_id:e.web_id})}),{},function(){if((0,_.isEnableDebug)()){var e,t,n=null===(e=_.localFeatureGating.get())||void 0===e?void 0:e["x-tt-env"];return n?(t={},(0,r._)(t,"x-use-".concat("ppe"),1),(0,r._)(t,"x-tt-env",String(n)),t):{}}return{}}())}var M=function(){if(!l.useChatStore.getState||"function"!=typeof l.useChatStore.getState)return{};var e=l.useChatStore.getState().ttWidConfig;return{device_id:(0,c.getDeviceID)(e)}},S=function(){var e=(0,v.getCountry)(),t=(0,f.checkAndGetTeaToken)().web_id||u.inBrowser&&String(window.Tea.getConfig("user_unique_id"));return(0,i._)((0,o._)((0,i._)((0,o._)((0,i._)({version_code:d.version_code,language:g.I18n.language,device_platform:d.device_platform,aid:(0,p.getAid)(),pkg_type:m.pkgType},M()),{web_id:t,"use-olympus-account":1}),{}),{region:e,sys_region:e,samantha_web:1}),{})}},20636:function(e,t,n){"use strict";n.d(t,{getAid:function(){return i}});var r=n("52420"),i=function(){return r.FlowConfig.hasInit?r.FlowConfig.appId:Number(497858)}},71530:function(e,t,n){"use strict";n.d(t,{isEnableDebug:function(){return l},isEnableMessageListVirtualScroll:function(){return g},localFeatureGating:function(){return c}});var r=n("69420"),i=n("9161"),o=n("29048"),a=n("78597");function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(void 0===t?"undefined":(0,o._)(t))?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u="FLOW_WEB_DEBUG_FG",c=new(function(){function e(){(0,r._)(this,e),s(this,"isInit",!1),s(this,"values",{})}var t=e.prototype;return t.checkInit=function(){if(!this.isInit){var e=(0,a.parseJSON)(a.SyncStorage.getItem(u));e&&!Array.isArray(e)&&(this.values=e||{})}},t.get=function(){return this.checkInit(),this.values},t.set=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.checkInit(),this.values=t?e:(0,i._)({},this.values,e),a.SyncStorage.setItem(u,(0,a.stringifyJSON)(this.values))},e}()),l=function(){return!!c.get().enableDebug},d=function(){if((0,a.isChromeChromium)()){if((0,a.isMobile)())return!1;var e=(0,a.getChromeVersion)();return!!e&&!(e.major<103)&&!0}return!1},g=function(){if(!d())return!1;var e=c.get().enableMessageListVirtualScroll;return void 0!==e&&e}},90839:function(e,t,n){"use strict";n.d(t,{getCountry:function(){return i}});var r=n("78597"),i=function(){return r.SyncStorage.getItem("flow_user_country")}},89066:function(e,t,n){"use strict";n.d(t,{checkAndGetTeaToken:function(){return k},configTeaCountry:function(){return I},loadTeaLandingUrl:function(){return b},markCurPage:function(){return m},saveTeaLandingUrl:function(){return S},useEnterFrom:function(){return C},useMarkCurPageOnClick:function(){return y},useMarkCurPageOnMount:function(){return h},useTeaVar:function(){return _},useWatchTeaAbConfig:function(){return p}});var r,i=n("92769"),o=n("40509"),a=n("6462"),s=n("88802"),u=n("52983"),c=n("83911"),l=n("78597"),d=n("65042"),g=n("25363"),f=n("32208"),v=n("40789"),_=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=(0,o._)((0,u.useState)(!0),2),i=r[0],a=r[1],s=(0,o._)((0,l.useLocalStorageState)("libra_setting_".concat(e),{defaultValue:t}),2),c=s[0],d=void 0===c?t:c,g=s[1];return(0,u.useEffect)(function(){a(!0),window.Tea.getVar(e,t,function(e){g(e),a(!1)})},n),L.getTeaDataOverrides(),{loading:i,value:d}},p=function(){var e=(0,o._)((0,u.useState)(0),2),t=e[0],n=e[1];return(0,u.useEffect)(function(){var e="ab-complete",t=function(){return n(function(e){return e+1})};return window.Tea.on(e,t),function(){window.Tea.off(e,t)}},[]),t};(0,i._)(function(e,t){return(0,s.__generator)(this,function(n){return[2,new Promise(function(n){window.Tea.getVar(e,t,function(e){n(e)})})]})});var m=function(e,t){return v.usePageHistoryStore.getState().setCurrentPage(e,t),v.usePageHistoryStore.getState().getCurPrevPage()},h=function(e,t){(0,u.useEffect)(function(){m(e,t)},[])},y=function(e,t,n){var r=(0,u.useRef)(e);r.current=e;var i=(0,u.useRef)(null),o=n||i;return(0,u.useEffect)(function(){var e=o.current;if(e){var n=function(){m(r.current,t)};return e.addEventListener("click",n,{capture:!0}),function(){e.removeEventListener("click",n,{capture:!0})}}},[]),o},M="",S=function(e){M=e},b=function(e){return e&&M.length>300?M.slice(0,300):M},C=function(){var e,t=(0,f.useLocation)().state,n=void 0===t?{}:t;return null!==(e=null==n?void 0:n.enter_from)&&void 0!==e?e:"other"};var L=(r={},{override:function(e){var t=e.Plugins.Tea;Object.create(t).getVar=function(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];var s=(0,o._)(n,3),u=s[0],l=s[2];if((0,c.default)(r[u]))return t.getVar.apply(t,(0,a._)(n));l(r[u])}},setTeaDataOverrides:function(e){return Object.assign(r,null!=e?e:{})},getTeaDataOverrides:function(){return r}}),I=function(e){var t,n;null===(t=(n=window.Tea).config)||void 0===t||t.call(n,{evtParams:{inner_region:e}})},E={tokens:{},meanKeys:["user_unique_id","web_id"]},T=function(){if(window.Tea&&!window.fetchingTeaToken){window.fetchingTeaToken=!0;var e=(0,g.schedule)(function(){window.fetchingTeaToken=!1},5e3);window.Tea.getToken(function(t){e.exec(),E.tokens=t})}},k=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return!e&&E.meanKeys.some(function(e){return!E.tokens[e]})&&d.inBrowser&&T(),E.tokens}},72182:function(e,t,n){"use strict";n.d(t,{isApiError:function(){return o}});var r=n("87382"),i=n("36175");function o(e){return e instanceof r.ApiError||(0,i.isObject)(e)&&"ApiError"===e.name}},68413:function(e,t,n){"use strict";n.d(t,{isAxiosError:function(){return i}});var r=n("36175");function i(e){return(0,r.isObject)(e)&&!0===e.isAxiosError}},36175:function(e,t,n){"use strict";n.d(t,{isObject:function(){return r}});var r=function(e){return null!==e&&"object"==typeof e}},56216:function(e,t,n){"use strict";n.d(t,{BROWSER_LANGUAGE_CODE:function(){return i},convertDetectedLanguage:function(){return o}});var r=n("40509"),i="browser_language";function o(e){e===i&&(e=navigator.language);var t=e.toLowerCase(),n=(0,r._)(t.split(/-|_/),1)[0];if("zh"===n)return["zh","zh-cn","zh-sg","zh_cn"].includes(t)?"zh":"zh-Hant";return"ms"===n?"ms-MY":"th"===n?"th-TH":n}},98897:function(e,t,n){"use strict";n.d(t,{sendEnterConversationCmd:function(){return l},sendLeaveConversationCmd:function(){return d},upCmdTasks:function(){return u}});var r=n("87382"),i=n("50289"),o=n("1525"),a=n("96049"),s=n("10173"),u={},c=function(e){return new Promise(function(t,n){var r="loading",i=setTimeout(function(){return r="timeout",n(Error("timeout"))},s.sendMessageWaitAckTimeout);u[e]={success:function(){clearTimeout(i),"loading"===r&&(r="success",t())}}})},l=function(e){var t=(0,r.createReportEvent)({eventName:"up_cmd_conversation_id",meta:{conversationId:e}}),n={local_message_id:(0,i.createLocalMessageId)(),conversation_id:e,up_cmd_type:o.UpCmdType.Conversation_in};return a.FlowNetAdaptor.socketAdaptor.sendCmd(n),c(n.local_message_id).then(function(){return t.addDurationPoint("success"),t.success()},function(e){return t.error(e)})},d=function(e){var t=(0,r.createReportEvent)({eventName:"up_cmd_conversation_out",meta:{conversationId:e}}),n={local_message_id:(0,i.createLocalMessageId)(),conversation_id:e,up_cmd_type:o.UpCmdType.Conversation_out};return a.FlowNetAdaptor.socketAdaptor.sendCmd(n),c(n.local_message_id).then(function(){return t.addDurationPoint("success"),t.success()},function(e){return t.error(e)})}},75761:function(e,t,n){"use strict";n.d(t,{getBotIdByConversationId:function(){return c},getChatTypeForTea:function(){return g},getInfoByConversationId:function(){return u},getUnreadCount:function(){return f}});var r,i=n("53641"),o=n("52420"),a=n("62920"),s=n("87575"),u=function(e){if(!e)return{};var t=a.useChatStore.getState().conversationMap[e],n=(null==t?void 0:t.bot_id)?i.FlowBot.actions.getBot(null==t?void 0:t.bot_id):{};return{conversation:t,botInfo:n}},c=function(e,t){var n=u(e),r=n.botInfo,o=n.conversation,a=(null==r?void 0:r.id)||(null==r?void 0:r.bot_id)||(null==o?void 0:o.bot_id);return a||!t?a:e?i.FlowBot.actions.getBotIdFromLocalConversation(e):void 0},l=function(e){return o.FlowConfig.userId===e};var d=((r=d||{}).default="default",r.defaultNew="default_new",r.otherDefault="other_default",r.selfCreated="self_created",r.othersCreated="others_created",r),g=function(e,t,n){var r,i,o=u(e),a=o.conversation,c=o.botInfo;if((0,s.isCocoConversation)(a)||(0,s.isCocoConversationType)(n))return d.default;if((0,s.isCocoSubConversation)(a)||(0,s.isCocoSubConversationType)(n))return d.defaultNew;if(l(null==a?void 0:null===(r=a.bot_creator_info)||void 0===r?void 0:r.creator_id)||l(null==t?void 0:null===(i=t.creator_info)||void 0===i?void 0:i.creator_id))return d.selfCreated;else if((0,s.isUserBotType)(null==a?void 0:a.bot_type)||(0,s.isUserBotType)(null==c?void 0:c.bot_type)||(0,s.isUserBotType)(null==t?void 0:t.bot_type))return d.othersCreated;else if((0,s.isGuanFangBotType)(null==a?void 0:a.bot_type)||(0,s.isGuanFangBotType)(null==c?void 0:c.bot_type)||(0,s.isGuanFangBotType)(null==t?void 0:t.bot_type))return d.otherDefault;else if((0,s.isCocoBotType)(null==c?void 0:c.bot_type)||(0,s.isCocoBotType)(null==t?void 0:t.bot_type))return d.default;else return""},f=function(e){var t=Number(null==e?void 0:e.message_index)||0,n=Number(null==e?void 0:e.read_message_index)||0;return t>n?t-n:0}},11372:function(e,t,n){"use strict";n.d(t,{getConversationTypeById:function(){return i},getThreadIdByConversationId:function(){return o}});var r=n("62920"),i=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e){var n=r.useChatStore.getState(),i=(n.conversationMap[e]||{}).conversation_type;if(i||!t)return i;var o=(n.localConversationMap[e]||{}).conversation_type;return e?o:void 0}},o=function(e){if(e){var t=r.useChatStore.getState().conversationLinks.find(function(t){return t.conversationId===e});return null==t?void 0:t.threadId}}},53277:function(e,t,n){"use strict";n.d(t,{findLastAvailableMessageFromStore:function(){return S},findLastAvailableMessageLinkFromStore:function(){return m},findLastMessageByMatchEqualIdFromStore:function(){return _},findLastMessageByMessageLinkReplyIdFromStore:function(){return p},findLastMessageFromStore:function(){return l},getIsSoftLinkForTea:function(){return b},getLastAvailableReplyMessageFromStore:function(){return g},getLastLocalMessageFromStore:function(){return d},getLastMessageIndexForUnreadCount:function(){return M},getLastMessageIndexFromMessageLinksStore:function(){return h},getLocalMessageFromStore:function(){return v},getLocalMessageReportMeta:function(){return E},getMessageFromStore:function(){return f},getMessageLength:function(){return L},getMessageTypeForTea:function(){return C},messageFrom:function(){return I}});var r=n("24682"),i=n("68534"),o=n("62920"),a=n("46750"),s=n("68602"),u=n("87575"),c=n("2322"),l=function(e,t,n){var r=o.useChatStore.getState(),i=(0,a.createGetMessage)((0,a.getMessageState)(r,e)),u=(0,s.findLastLink)(t||[],function(e){return n({messageLink:e,getMessage:function(){return i(e)}})});return{messageLink:u,message:u?i(u):void 0}},d=function(e){var t=l(e,o.useChatStore.getState().messageLinkMap[e],function(e){var t=e.messageLink;return t.isLocalMessage&&!!t.messageId}).message;return t&&(0,u.isLocalMessage)(t)?t:void 0},g=function(e){var t=o.useChatStore.getState(),n=t.messageLinkMap[e],r=(0,a.createGetMessage)({localMessageMap:t.localMessageMap[e],messageMap:t.messageMap[e]}),i=(0,s.findLastLink)(n,function(e){var n=r(e);return!!n&&(0,u.isMessageAvailable)(n)&&!!n.reply_id&&!(0,u.isSendMessage)(n,t.userInfo.secUserId)});return i?r(i):void 0},f=function(e,t,n){var r=n||o.useChatStore.getState();return(0,a.createGetMessage)((0,a.getMessageState)(r,e))(t)},v=function(e,t,n){var r;return(null===(r=(n||o.useChatStore.getState()).localMessageMap[e])||void 0===r?void 0:r[t])||{}},_=function(e){var t=e.conversationId,n=e.replyId,r=o.useChatStore.getState(),i=(0,s.findLastMessageLinkByMatchEqualId)({messageLinks:r.messageLinkMap[t],replyId:n,getMessage:(0,a.createGetMessage)((0,a.getMessageState)(r,t))});return i?f(t,i,r):void 0},p=function(e){var t,n=e.messageLink,r=e.conversationId,i=o.useChatStore.getState(),a=null===(t=f(r,n,i))||void 0===t?void 0:t.reply_id;return l(r,i.messageLinkMap[r],function(e){return e.messageLink.messageId===a}).message},m=function(e,t){for(var n=t.length-1;n>=0;n--){var r=t[n],i=t[n-1],o=f(e,r),a=f(e,i);if((0,u.isAvailableCrowdTestMessage)(o)&&(0,u.isAvailableCrowdTestMessage)(a))return(0,u.isUnselectedCrowdTestMessage)(o)?i:r;if((0,u.isMessageAvailable)(o))return r}},h=function(e){var t=o.useChatStore.getState().messageLinkMap[e];return y(e,t)},y=function(e,t){var n=(0,s.findLastRemoteMessageLink)(t);if(!n)return 0;var r=f(e,n);return r?Number(r.index||0):0},M=function(e,t,n){var r=y(e,t);return r<((null==n?void 0:n.message_index)||0)?r:(null==n?void 0:n.message_index)||0},S=function(e){var t=o.useChatStore.getState(),n=t.messageLinkMap[e]?m(e,t.messageLinkMap[e]):void 0;return{lastAvailableMessage:n?f(e,n):void 0,lastAvailableMessageLink:n}},b=function(e){if(e&&(0,u.isTextMessage)(e)){var t=(e.contentObj||{}).text;return(0,r.default)(t)&&t.includes("coco://sendMessage")?1:0}return 0},C=function(e){if(!e)return"text";if((0,u.isImageMessage)(e))return"pic";if((0,u.isVideoMessage)(e))return"video";if((0,u.isMusicMessage)(e))return"music";else if((0,u.isFileMessage)(e))return"file";else if((0,u.isCardListMessage)(e))return"search_card";else return"text"},L=function(e){if(e&&(0,u.isTextMessage)(e)){var t=(e.contentObj||{}).text;return(0,r.default)(t)?t.length:0}return 0};function I(e){var t,n=i.ConnectionType;return e.next_connection_type===n.WebSocket?c.MessageFrom.Socket:e.next_connection_type===n.HttpChunk?c.MessageFrom.HttpChunk:null===(t=e.localInfo)||void 0===t?void 0:t.from}function E(e){var t,n,r,i,o,a,s;return{conversation_id:e.conversation_id,message_id:e.message_id,from:null===(t=e.localInfo)||void 0===t?void 0:t.from,local_message_id:null==e?void 0:e.local_message_id,is_regenerate:"local"in e&&(null==e?void 0:null===(n=e.local)||void 0===n?void 0:n.isRegenerate),has_err:null==e?void 0:null===(r=e.ext)||void 0===r?void 0:r.has_err,log_id:null===(i=e.localInfo)||void 0===i?void 0:i.logId,inner_log_id:null==e?void 0:null===(o=e.ext)||void 0===o?void 0:o.log_id,trace_id:null===(a=e.localInfo)||void 0===a?void 0:a.traceId,retried:null==e?void 0:null===(s=e.localInfo)||void 0===s?void 0:s.retried,next_connection_type:null==e?void 0:e.next_connection_type}}},50289:function(e,t,n){"use strict";n.d(t,{abortPullMessage:function(){return L},checkSendMessageDisabled:function(){return M},cleanPrevRegenerateMessagesState:function(){return b},createLocalMessageId:function(){return h},findLocalMessageIdByTaskLocalKey:function(){return E},getAndCheckResolvedConversationId:function(){return y},getFailedExpired:function(){return T},getSendExt:function(){return C}});var r=n("9161"),i=n("32023"),o=n("87382"),a=n("68534"),s=n("53277"),u=n("53641"),c=n("52420"),l=n("62920"),d=n("2322"),g=n("46750"),f=n("87575"),v=n("72951"),_=n("68602"),p=n("96049"),m=n("10173"),h=function(){return(0,i.default)()},y=function(e){var t=e.ctx,n=t.conversationId,r=t.localConversationId||n;if(!r)throw Error("conversationId is empty");return r},M=function(e){var t=e.ctx,n=e.resolved,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l.useChatStore.getState(),i=S({store:r,conversation:r.conversationMap[n.conversationId]}).cancelReason;if(i)return o.logger.persist.info({eventName:"send_message_cancel",meta:{local_message_id:n.localMessageId,from:d.MessageFrom.Socket,conversation_id:t.conversationId,conversation_type:t.conversationType,reason:i}}),!!i},S=function(e){var t=e.store,n=e.conversation,r=(null==n?void 0:n.bot_id)?u.FlowBot.actions.getBot(n.bot_id):{};return(null==r?void 0:r.disabled)?{cancelReason:"bot deleted"}:t.rateLimitConfig.isLimited?{cancelReason:"rate limit"}:{}};function b(e){var t=e.conversationId,n=e.store,r=(0,s.findLastAvailableMessageFromStore)(t).lastAvailableMessageLink;(null==r?void 0:r.regen_head)&&n.updateMessageList({conversationId:t,immerUpdate:function(e){var t=e.draftMessageLinks,n=e.draftRegenerateMessageMap,i=e.draftMessageMap,o=e.draftLocalMessageMap,a=(0,g.createGetMessage)({localMessageMap:o,messageMap:i});t.forEach(function(t){if(t.regen_head===r.regen_head){delete t.regen_head,(null===(i=n.messageMap)||void 0===i?void 0:i[t.messageId])&&delete n.messageMap[t.messageId];var i,o=t.isLocalMessage?a(t):void 0;o&&(0,f.isMessageFailed)(o)&&(0,v.logicalDeleteMessage)(e,t)}})}})}var C=function(e,t){var n=e.replace,i=e.remove,o=e.regenerate,a=e.scene,u=e.resolved,l=function(e){var t,n=e.conversationId,r=e.store,i=(0,s.getLastAvailableReplyMessageFromStore)(n);if(!!i){if(!(0,f.isImageMessage)(i)){var o=(0,_.findLastLink)(r.messageLinkMap[n],function(e){return!!e.regen_head&&(0,f.isMessageAvailable)((0,s.getMessageFromStore)(n,e,r))});if(o&&!(null==o?void 0:o.isLocalMessage)&&(null===(t=(0,s.getMessageFromStore)(n,o,r))||void 0===t?void 0:t.reply_id)===i.reply_id)return o.messageId}}}({store:t,conversationId:u.conversationId});return(0,r._)({stream:"1"},c.FlowConfig.answerWithSuggest&&{answer_with_suggest:"1"},c.FlowConfig.namedEntityHighlight&&{wiki:"2"},c.FlowConfig.answerWithVideo&&{media_search_type:"1"},n?{replace:"1"}:{},i?{delete:"1"}:{},o?{regen:"1"}:{},n||i||o||!l?{}:{lastRegenerateSelectedMessageId:l},"onboarding_suggestion"===a?{onboarding_v2:"1"}:{},"keyboard_unlog"===a?{scene:a}:{},u.localCreateExt)},L=function(e){p.FlowNetAdaptor.httpChunkAdaptor.abortMessage({replyId:e}),p.FlowNetAdaptor.httpAdaptor.abortMessage({replyId:e})},I=function(e){var t;return null==e?void 0:null===(t=e.localContent)||void 0===t?void 0:t.preprocess_key},E=function(e,t){var n;return t?null===(n=e.find(function(e){return I(e.resolved)===t}))||void 0===n?void 0:n.resolved.localMessageId:void 0},T=function(e,t){return e?Date.now()+m.sendMessageWaitAckTimeout:t!==a.ContentType.File?Date.now()+m.sendImageMessagePreprocessTimeout:void 0}},59157:function(e,t,n){"use strict";n.d(t,{handleLocalBreak:function(){return h}});var r=n("9161"),i=n("16044"),o=n("46593"),a=n("61550"),s=n("59574"),u=n("87382"),c=n("68534"),l=n("78142"),d=n("94661"),g=n("50289"),f=n("53277"),v=n("62920"),_=n("87575"),p=n("78856");function m(e){var t=e.conversationId,n=e.message,f=e.onError,m=v.useChatStore.getState();if(n&&(0,_.isLocalMessage)(n)&&(null==n?void 0:n.local_message_id)){if((0,_.isMessageSending)(n)||(0,_.isMessageSendingRegenerate)(n)){(0,d.finishSendMessageTask)(n.local_message_id);return}if((0,_.isStreamingMessage)(n)||(0,_.isMessageReceiving)(n)){(0,_.isMessageReceivingFirstPackage)(n)?m.logicalDeleteMessage({conversationId:t,messageLink:{isLocalMessage:!0,messageId:n.local_message_id}}):(0,_.isMessageReceivingStream)(n)&&n.message_id&&(0,p.handleUpdateMessage)(m,(0,i._)((0,r._)({conversation_id:t,message_id:n.message_id},(0,o.default)(n,["local","local_message_id"])),{status:c.PushMessageStatus.Broken,ext:(0,i._)((0,r._)({},n.ext),{is_finish:"1"})}));var h=n.reply_id&&"0"!==n.reply_id?n.reply_id:n.message_id;if(h){var y=(0,a.default)(m.messageMap[t]).filter(function(e){return e.reply_id===h}).find(function(e){return e.content_type===c.ContentType.PluginSearchResult&&(0,s.default)(e.contentObj)});(null==y?void 0:y.message_id)&&(0,p.handleUpdateMessage)(m,(0,i._)((0,r._)({conversation_id:t,message_id:y.message_id},(0,o.default)(y,["local","local_message_id"])),{status:c.PushMessageStatus.InVisible,ext:(0,i._)((0,r._)({},n.ext),{is_finish:"1"})})),(0,g.abortPullMessage)(h);var M=(0,u.createReportEvent)({eventName:"break_message"});l.FlowApi.apiService.message.MessageReport({reply_id:h,conversation_id:t,action:"break"}).then(function(){M.addDurationPoint("success"),M.success()},function(e){M.error({reason:"break message failed",error:e}),null==f||f()})}}}}function h(e){var t=(0,f.getLastLocalMessageFromStore)(e);m({conversationId:e,message:t});var n=(0,f.getLastLocalMessageFromStore)(e);(0,_.isCrowdTestMessage)(n)&&m({conversationId:e,message:n})}},40023:function(e,t,n){"use strict";n.d(t,{completeCollectionMessages:function(){return s}});var r=n("51445"),i=n("53277"),o=n("62920"),a=n("87575"),s=function(e){var t=o.useChatStore.getState();return(0,r.default)(e.map(function(e){var n=e.ctx.conversationId;if(!n)return e;if(e.replace&&(null===(o=(0,i.getMessageFromStore)(n,e.replace.messageLink,t))||void 0===o?void 0:null===(r=o.ext)||void 0===r?void 0:r.collection_id)){var r,o,s,u=(0,i.getMessageFromStore)(n,e.replace.messageLink,t),c=null==u?void 0:null===(s=u.ext)||void 0===s?void 0:s.collection_id;if(!c||!(0,a.isTextMessage)(u))return e;var l=t.messageLinkMap[n],d=t.messageMap[n];return l.filter(function(e){var n,r;return(0,a.isSendMessage)(d[e.messageId],t.userInfo.secUserId)&&(null===(r=d[e.messageId])||void 0===r?void 0:null===(n=r.ext)||void 0===n?void 0:n.collection_id)===c}).map(function(t){return t.messageId===u.message_id?e:{ctx:e.ctx,scene:e.scene,replace:{messageLink:t}}})}return e}))}},72429:function(e,t,n){"use strict";n.d(t,{createLocalMessageFormPayload:function(){return g}});var r=n("83316"),i=n("9161"),o=n("16044"),a=n("87382"),s=n("50289"),u=n("62920"),c=n("73373"),l=n("2322"),d=n("10173"),g=function(e){var t,n,g=e.msgPayload,f=e.resolved,v=e.messageExt,_=e.regenerate,p=e.store,m=e.ctx,h=e.scene,y=e.reportEvents,M=e.chatType,S=e.sec_scene,b=e.use_skill,C=e.skill_name,L=e.skill_id,I=e.reportParams,E=(0,i._)({start_local_conversation_id:m.localConversationId,start_conversation_id:m.conversationId,start_bot_id:m.botId,start_local_message_id:f.localMessageId,ext:v,conversation_type:m.conversationType,scene:h,sec_scene:S,use_skill:b,skill_name:C,skill_id:L,is_ogf:!!(null===(n=u.useChatStore.getState().userOgfQuota)||void 0===n?void 0:null===(t=n.quotaSwitchConfig)||void 0===t?void 0:t.value),chat_type:M},I);return u.useChatStore.getState().mergeReportEvents(f.conversationId,f.localMessageId,(0,i._)((0,o._)((0,i._)({},y),{send_message:(0,a.createReportEvent)({eventName:"send_message",meta:E,once:!0})}),b&&C?(0,r._)({},"".concat(C,"_message"),(0,a.createReportEvent)({eventName:"".concat(C,"_message"),meta:E})):{})),(0,c.createLocalMessage)({localMessageStatus:f.isReady?_?l.LocalMessageStatus.SendingRegenerate:l.LocalMessageStatus.Sending:l.LocalMessageStatus.Preprocessing,message:(0,o._)((0,i._)({},g),{reply_id:_?"0":g.reply_id,contentObj:f.contentObj,sec_sender:d.localUser}),failedExpired:(0,s.getFailedExpired)(f.isReady,f.content_type),sendLoadingExpired:Date.now()+d.sendMessageShowLoadingExpired,messageLinks:p.messageLinkMap[f.conversationId],isRegenerate:f.isRegenerate,prevMessageId:f.isRegenerate?null==_?void 0:_.regenerateTailMessageId:void 0,localContent:f.localContent,enterFrom:m.enterFrom})}},21121:function(e,t,n){"use strict";n.d(t,{createMessageContent:function(){return s}});var r=n("50002"),i=n("78597"),o=n("68534"),a=n("50289"),s=function(e,t,n){var s,u,c,l=(0,a.findLocalMessageIdByTaskLocalKey)(n,e);if(!l)return"";var d=null===(c=n.find(function(e){return e.resolved.localMessageId===l}))||void 0===c?void 0:c.resolved;if(!d)return"";if(d.content_type===o.ContentType.Image)return JSON.stringify({image_list:[{key:t}]});if(d.content_type!==o.ContentType.File)return"";return s=t,u=d,(0,i.stringifyJSON)({src:"user-sent",file_list:[{key:s,file_name:(0,r.default)(u,"contentObj.file_list[0].file_name","")}]})}},96362:function(e,t,n){"use strict";n.d(t,{createMessagePayload:function(){return u}});var r=n("9161"),i=n("16044"),o=n("78597"),a=n("68534"),s=n("87681"),u=function(e,t){var n,u,c=e.ctx,l=e.replace,d=e.remove,g=e.regenerate,f=e.content_source,v=e.resolved;return(0,i._)((0,r._)({local_conversation_id:c.localConversationId,bot_id:c.botId,conversation_id:c.conversationId,section_id:t.lastSectionIdMap[v.conversationId]||"",local_message_id:v.localMessageId,message_type:a.MessageType.Message,content_type:v.content_type,content:(0,o.stringifyJSON)(v.contentObj),create_time:Date.now()},l||d?{message_id:null===(u=l||d)||void 0===u?void 0:null===(n=u.messageLink)||void 0===n?void 0:n.messageId}:{},g?{reply_id:g.sentMessageId,local_message_id:g.sentLocalMessageId}:{},v.content_type===a.ContentType.Text?{content_source:(null==f?void 0:f.source)||s.ContentSource.Other,template_id:null==f?void 0:f.templateId}:{}),{ext:v.localCreateExt})}},98221:function(e,t,n){"use strict";n.d(t,{extractAttachmentFromPayload:function(){return f}});var r=n("59391"),i=n("34242"),o=n("21171"),a=n("62920"),s=n("44657"),u=function(e){if("image_key"in e)return{type:"attachment",fileKey:e.image_key,fileName:"Image"};if("image"in e&&e.local_key){var t=s.useAttachmentKey.raw(a.useChatStore.getState(),e.local_key);if(t)return{type:"attachment",fileKey:t,fileName:(0,o.pickAsString)("name")(e.image)||"Image"}}},c=function(e){if("file_key"in e){var t=e.file_name||"";return{type:"attachment",fileKey:e.file_key,fileName:t||"File"}}if("file"in e&&e.local_key){var n=(0,o.pickAsString)("name")(e.file),r=s.useAttachmentKey.raw(a.useChatStore.getState(),e.local_key);if(!r)return;return{type:"attachment",fileKey:r,fileName:n||"File"}}},l=function(e){var t=e.compositeContent.images;if(0!==t.length){var n=t[0];if("key"in n)return{type:"attachment",fileKey:n.key,fileName:"Image"};if("blob"in n&&n.local_key){var r=s.useAttachmentKey.raw(a.useChatStore.getState(),n.local_key);if(!r)return;return{type:"attachment",fileKey:r,fileName:(0,o.pickAsString)("name")(n.blob)||"Image"}}}},d=function(e){var t=e.compositeContent.files;if(0!==t.length){var n=t[0];if("key"in n){var r="file_name"in n&&n.file_name||"";return{type:"attachment",fileKey:n.key,fileName:r||"File"}}if("blob"in n&&n.local_key){var i=(0,o.pickAsString)("name")(n.blob),u=s.useAttachmentKey.raw(a.useChatStore.getState(),n.local_key);if(!u)return;return{type:"attachment",fileKey:u,fileName:i||"File"}}}},g=function(e){if((0,i.isImageMessagePayload)(e))return u(e);if((0,i.isFileMessagePayload)(e))return c(e);if((0,i.isCompositeMessagePayloadWithImages)(e))return l(e);else if((0,i.isCompositeMessagePayloadWithFiles)(e))return d(e)},f=function(e){return(0,r.default)(e).map(function(e){return g(e)}).filter(function(e){return!!e})[0]}},7042:function(e,t,n){"use strict";n.d(t,{getReadAndSummarizeExt:function(){return s}});var r=n("37903"),i=n("24815"),o=n("62920"),a=n("59657"),s=function(){var e=a.useSkillId.raw(o.useChatStore.getState(),i.SkillType.ReadPDF);return(0,r.default)(e)?{}:{input_skill:JSON.stringify({skill_id:e,skill_type:i.SkillType.ReadPDF})}}},31397:function(e,t,n){"use strict";n.d(t,{withResolveVars:function(){return A}});var r=n("83316"),i=n("9161"),o=n("16044"),a=n("32023"),s=n("90396"),u=n("59574"),c=n("51445"),l=n("87382"),d=n("68534"),g=n("34242"),f=n("50289"),v=n("21171"),_=n("53641"),p=n("4899"),m=n("87575"),h=n("62920"),y=n("53277"),M=n("75761"),S=n("11372"),b={onboarding_first_met:"onboarding_first_met_sug",onboarding_welcome_back:"onboarding_welcome_back_sug"},C=function(e){return!!e},L=function(e){var t,n=e.blob,r=e.type,i=e.from,o=e.store,a=e.botId,s=e.localKey;if(s)return{localKey:s,key:(null===(t=o.preprocessTaskMap[s])||void 0===t?void 0:t.key)||""};var u=o.preprocessFile(n,r,{moduleActionId:"",conversationId:"",chatType:"other_default",skillType:0,skillId:"",uploadFrom:"upload_pinbutton",botId:a,from:i});return{localKey:u.local_key,key:u.key}},I={parseTextPayload:function(e,t,n){return{content_type:d.ContentType.Text,contentObj:{text:e.text.trim()},isReady:!0,localCreateExt:(0,o._)((0,i._)({},e.extraExt),{source:n})}},parseImagePayload:function(e,t,n,r){var a=[],s=void 0,u=!1;if("image_key"in e)a.push({key:e.image_key,image_ori:e.image_ori,image_thumb:e.image_thumb}),u=!0;else{var c=L({type:"image",blob:e.image,localKey:e.local_key,botId:n,store:t,from:e.from}),l=c.localKey,g=c.key;a.push({key:g}),s={preprocess_key:l},u=!!g}return{content_type:d.ContentType.Image,contentObj:{image_list:a},isReady:u,localContent:s,localCreateExt:(0,o._)((0,i._)({},e.extraExt),{source:r})}},parseFilePayload:function(e,t,n,r){var a=[],s=void 0,u=!1;if("file_key"in e)a.push({file_name:e.file_name,key:e.file_key}),u=!0;else{var c=L({type:"file",blob:e.file,localKey:e.local_key,botId:n,store:t,from:e.from}),l=c.localKey,g=c.key;a.push({file_name:(0,v.pickAsString)("name")(e.file),key:g||""}),s={preprocess_key:l},u=!!g}return{content_type:d.ContentType.File,contentObj:{file_list:a},isReady:u,localContent:s,localCreateExt:(0,o._)((0,i._)({},e.extraExt),{source:r})}},parseCompositePayload:function(e,t,n,r){var a=void 0,s=!0,u=function(e){var r=[];return e.forEach(function(e,i){if("key"in e)r.push(e);else{var o=L({type:"file",blob:e.blob,localKey:e.local_key,botId:n,store:t,from:e.from}),u=o.localKey,c=o.key;r.push({file_name:(0,v.pickAsString)("name")(e.blob),key:c||""}),0===i&&(a={preprocess_key:u}),s&&(s=!!c)}}),r};return{contentObj:(0,g.isCompositeMessagePayloadWithImages)(e)?{text:e.compositeContent.text,image_model:{image_list:u(e.compositeContent.images)}}:(0,g.isCompositeMessagePayloadWithFiles)(e)?{text:e.compositeContent.text,file_model:{file_list:u(e.compositeContent.files)}}:(0,g.isCompositeMessagePayloadWithLinks)(e)?{text:e.compositeContent.text,link_model:{url:e.compositeContent.links[0]}}:{},content_type:d.ContentType.Composite,isReady:s,localContent:a,localCreateExt:(0,o._)((0,i._)({},e.extraExt),{source:r})}},parseCopySendPayload:function(e,t,n){if(e.copySend){var r=e.copySend.messageLink,o=r?(0,y.getMessageFromStore)(n,r,t):void 0;return{content_type:null==o?void 0:o.content_type,contentObj:null==o?void 0:o.contentObj,localContent:null==o?void 0:o.localContent,isReady:!0,localCreateExt:(0,i._)({},e.extraExt)}}},parseSinglePayload:function(e,t,n,r,i){if("text"in e)return I.parseTextPayload(e,t,i);if("image"in e||"image_key"in e)return I.parseImagePayload(e,t,n,i);if("file"in e||"file_key"in e)return I.parseFilePayload(e,t,n,i);else if("compositeContent"in e&&e.compositeContent)return I.parseCompositePayload(e,t,n,i);else if("copySend"in e&&e.copySend)return I.parseCopySendPayload(e,t,r)}},E={parseTextMessage:function(e,t,n){return{content_type:d.ContentType.Text,isReady:!0,contentObj:{text:(0,p.getMessageText)(e)},localCreateExt:(0,i._)({},n)}},parseImageMessage:function(e,t,n){var r,o,a=e.contentObj.image_list[0].key||(null===(r=t.preprocessTaskMap[(null==e?void 0:null===(o=e.localContent)||void 0===o?void 0:o.preprocess_key)||""])||void 0===r?void 0:r.key);return{content_type:d.ContentType.Image,isReady:!!a,contentObj:{image_list:[{key:a}]},localContent:e.localContent,localCreateExt:(0,i._)({},n)}},parseFileMessage:function(e,t,n){var r,o,a,s,u=e.contentObj.file_list[0].key||(null===(r=t.preprocessTaskMap[(null==e?void 0:null===(o=e.localContent)||void 0===o?void 0:o.preprocess_key)||""])||void 0===r?void 0:r.key);return{content_type:d.ContentType.File,isReady:!!u,contentObj:{file_list:[{key:u,file_name:null===(s=e.contentObj.file_list)||void 0===s?void 0:null===(a=s[0])||void 0===a?void 0:a.file_name}]},localContent:e.localContent,localCreateExt:(0,i._)({},n)}},parseCompositeMessage:function(e,t,n){if((0,m.isCompositeMessageWithLinks)(e))return{content_type:d.ContentType.Composite,contentObj:{text:(null===(u=e.contentObj.text)||void 0===u?void 0:u.trim())||"",link_model:{url:(null===(c=e.contentObj.link_model)||void 0===c?void 0:c.url)||""}},isReady:!0,localCreateExt:(0,i._)({},n)};var r,o,a,s,u,c,l,g=(0,m.isCompositeMessageWithImages)(e),f=(0,m.isCompositeMessageWithFiles)(e),_=g?null===(r=e.contentObj.image_model)||void 0===r?void 0:r.image_list:f?null===(o=e.contentObj.file_model)||void 0===o?void 0:o.file_list:void 0;if(!(null==_?void 0:_[0]))return{content_type:d.ContentType.Text,contentObj:{text:(null===(l=e.contentObj.text)||void 0===l?void 0:l.trim())||""},isReady:!0,localCreateExt:(0,i._)({},n)};var p=_.map(function(n){var r,i;return n.key||(null===(r=t.preprocessTaskMap[(null==e?void 0:null===(i=e.localContent)||void 0===i?void 0:i.preprocess_key)||""])||void 0===r?void 0:r.key)});return{contentObj:g?{text:(null===(a=e.contentObj.text)||void 0===a?void 0:a.trim())||"",image_model:{image_list:p.map(function(e){return{key:e}})}}:f?{text:(null===(s=e.contentObj.text)||void 0===s?void 0:s.trim())||"",file_model:{file_list:_.map(function(e,t){return{file_name:(0,v.pickAsString)("file_name")(e),key:p[t]||""}})}}:{},content_type:d.ContentType.Composite,isReady:p.every(function(e){return!!e}),localContent:e.localContent,localCreateExt:(0,i._)({},n)}},parseSingleMessage:function(e,t,n){var r=(0,i._)({source:n},(0,s.default)(null==e?void 0:e.ext,["msg_template_id","collection_id","input_skill","need_create_thread"]));return(0,m.isTextMessage)(e)&&(0,p.getMessageText)(e)?E.parseTextMessage(e,t,r):(0,m.isImageMessage)(e)?E.parseImageMessage(e,t,r):(0,m.isCompositeMessage)(e)?E.parseCompositeMessage(e,t,r):(0,m.isFileMessage)(e)?E.parseFileMessage(e,t,r):void 0}},T=function(e,t){if(!e)return[];var n,r=null==e?void 0:null===(n=e.ext)||void 0===n?void 0:n.collection_id;if(!r)return[e];var i=h.useChatStore.getState(),o=i.messageLinkMap[t],a=i.messageMap[t];return o.filter(function(e){var t,n;return(0,m.isSendMessage)(a[e.messageId],i.userInfo.secUserId)&&(null===(n=a[e.messageId])||void 0===n?void 0:null===(t=n.ext)||void 0===t?void 0:t.collection_id)===r}).map(function(e){return(0,y.getMessageFromStore)(t,e,i)}).filter(C)},k=function(e,t,n){var r,i,o=b[e.scene]||e.scene,a=e.ctx.botId||(0,M.getBotIdByConversationId)(e.ctx.conversationId)||"",s=I.parseSinglePayload(e,n,a,t,o);if(s)return[s];var c=e.replace,d=e.remove,g=e.regenerate,f=e.resend,v=null!==(i=null===(r=c||d||f)||void 0===r?void 0:r.messageLink)&&void 0!==i?i:g?{messageId:g.sentMessageId,isLocalMessage:!1,regen_head:g.regenerateHeadMessageId}:void 0,_=v?(0,y.getMessageFromStore)(t,v,n):void 0,p=(g?T(_,t):[_].filter(C)).map(function(t){var r,i=(null==t?void 0:null===(r=t.ext)||void 0===r?void 0:r.source)||e.scene;return o=g||c&&"edit"!==e.scene||f?i:e.scene,E.parseSingleMessage(t,n,o)}).filter(C);if(!(0,u.default)(p))return p;throw l.logger.persist.warning("sendMsgUnsupportedTypeOrScene"),Error("Unsupported MessageType")},R=function(e,t){var n,i,o,a,s=t.botId||(0,M.getBotIdByConversationId)(t.conversationId)||"",u=_.FlowBot.actions.getBot(s),c=null!==(o=t.conversationType)&&void 0!==o?o:(0,S.getConversationTypeById)(t.conversationId),l=(0,M.getChatTypeForTea)(t.conversationId,u,c);var g=((n={}).Text="text",n.Picture="pic",n.File="file",n),f=(a={},(0,r._)(a,d.ContentType.Text,g.Text),(0,r._)(a,d.ContentType.Image,g.Picture),(0,r._)(a,d.ContentType.File,g.File),a);return{bot_id:s,chat_type:l,conversation_type:c,message_type:(i=e.content_type)&&f[i]||g.Text}},w=function(e){var t=h.useChatStore.getState(),n=e.regenerate,r=e.replace,a=(null==n?void 0:n.sentLocalMessageId)||(0,f.createLocalMessageId)(),s=(0,f.getAndCheckResolvedConversationId)(e),u=k(e,s,t);return r&&u.forEach(function(e){e.localCreateExt&&delete e.localCreateExt.collection_id}),u.map(function(t){return(0,o._)((0,i._)({},e),{resolved:(0,i._)((0,o._)((0,i._)({},t),{localMessageId:a,conversationId:s,isRegenerate:!!n}),R(t,e.ctx))})})},A=function(e){if(!(e.length<=0)){var t=(0,c.default)(e.map(w)).filter(C);if(0!==t.length){if(1===t.length||t.every(function(e){var t;return!!(null===(t=e.resolved.localCreateExt)||void 0===t?void 0:t.collection_id)}))return t;var n=(0,a.default)();return t.map(function(e){return e.resolved.localCreateExt=(0,o._)((0,i._)({},e.resolved.localCreateExt),{collection_id:n}),e})}}}},94661:function(e,t,n){"use strict";n.d(t,{finishSendMessageTask:function(){return b},sendMessageBase:function(){return S}});var r=n("2945"),i=n("87382"),o=n("78597"),a=n("96049"),s=n("10173"),u={},c=function(e){return!!e.local_message_id&&!!u[e.local_message_id]},l=function(e){var t=e.local_message_id;t&&(u[t]={local_message_id:t,finish:r.default,expired:Date.now()+s.sendMessageWaitAckTimeout})},d=function(e){var t,n=e.local_message_id;if(!n)return!1;var r=null===(t=u[n])||void 0===t?void 0:t.expired;return void 0!==r&&Date.now()-r>0},g=function(e,t){var n=e.local_message_id;n&&u[n]&&(u[n].finish=function(){t(),delete u[n]})},f=function(e){var t;e&&(null===(t=u[e])||void 0===t||t.finish())},v=function(){var e,t;return{promise:new Promise(function(n,r){e=n,t=r}),resolve:e,reject:t}},_=function(e){return!!e.local_message_id},p=function(e){return!!e.local_conversation_id||!!e.conversation_id},m=function(e){return function(t){return new Promise(function(n,r){if(!t.every(_))return i.logger.info("local_message_id is empty, skip to send message"),n("skip");if(!t.every(c))return i.logger.info("task is empty, skip to send message"),n("skip");if(t.some(d))return n("skip");null==e||e(t);var o=t.map(v);t.forEach(function(e,t){return g(e,o[t].resolve)});var a=setTimeout(function(){return r(Error("timeout"))},s.sendMessageWaitTimeout);Promise.all(o.map(function(e){return e.promise})).then(function(){n("finish"),clearTimeout(a)})})}},h=m(function(e){a.FlowNetAdaptor.socketAdaptor.sendMessage(e)}),y=m(function(e){a.FlowNetAdaptor.httpAdaptor.sendMessage(e)}),M=function(e,t){var n=t||e,r=function(t){return e(t).catch(function(e){n(t).catch(function(e){r(t)})})};return r},S=function(e){if(!e.every(_)){i.logger.info("local_message_id is empty, skip sending message");return}if(!e.every(p)){i.logger.info("local_conversation_id or conversation_id is empty, skip sending message");return}e.forEach(function(e){return f(e.local_message_id)}),e.forEach(l),(e.some(function(e){var t;return o.utf8.length("".concat((null==e?void 0:e.content)||"").concat((null==e?void 0:null===(t=e.ext)||void 0===t?void 0:t.browser_explain)||""))>s.maxSendMessageTextLength})?M(y):M(h,y))(e)},b=f},48022:function(e,t,n){"use strict";n.d(t,{sendSupportedMessage:function(){return T}});var r=n("9161"),i=n("16044"),o=n("59391"),a=n("80610"),s=n("83053"),u=n("98806"),c=n("71878"),l=n("94661"),d=n("31397"),g=n("7042"),f=n("98221"),v=n("96362"),_=n("21121"),p=n("72429"),m=n("40023"),h=n("59157"),y=n("50289"),M=n("62920"),S=n("87575"),b=n("10630"),C=n("59657"),L=function(e){return!!(null==e?void 0:e.key)},I=function(e){return!e||e.failed},E=function(e){var t=e.toPostMessages,n=e.localMessages,r=e.payloads;if((0,l.sendMessageBase)(t),n.forEach(function(e){return c.tracker.logSendMessage(e)}),r.some(function(e){return"onboarding"===e.scene})){c.tracker.trackOnBoardingMessageSentEvent();return}r.forEach(function(e,t){return c.tracker.trackSendMessageEvent(e,n[t])}),t.forEach(function(e){return c.tracker.trackSendMessageStartEvent(e)})},T=function(e,t){var n=M.useChatStore.getState(),c=(0,d.withResolveVars)((0,m.completeCollectionMessages)((0,o.default)(e)));if(!!c){var l=c[0].resolved.conversationId||"",T=c.every(function(e){return e.resolved.isReady});if(!c.some(function(e){var t=e.ctx,r=e.resolved;return(0,y.checkSendMessageDisabled)({ctx:t,resolved:r},n)})){var k=b.useLocalConversation.raw(n,l)||b.useConversation.raw(n,l);if(k&&(0,S.isSamantha)(k,t)&&c.every(function(e){var t;return!(null===(t=e.resolved.localCreateExt)||void 0===t?void 0:t.input_skill)})){var R=(0,f.extractAttachmentFromPayload)(e);R?n.addRefContent(R,l):C.useRefContent.raw(n,l)&&c.forEach(function(e){e.resolved.localCreateExt=(0,a.default)(e.resolved.localCreateExt,(0,g.getReadAndSummarizeExt)())})}(0,h.handleLocalBreak)(l),c.forEach(function(e){var t,r,i,o,a,s=e.resend,u=e.replace,c=e.remove;(null==s?void 0:null===(t=s.messageLink)||void 0===t?void 0:t.messageId)?n.logicalDeleteMessage({conversationId:l,messageLink:null==s?void 0:s.messageLink}):(null==u?void 0:null===(r=u.messageLink)||void 0===r?void 0:r.messageId)?(n.logicalDeleteMessage({conversationId:l,messageLink:null==u?void 0:u.messageLink,deleteReply:!0}),(0,y.abortPullMessage)(null==u?void 0:null===(o=u.messageLink)||void 0===o?void 0:o.messageId)):(null==c?void 0:null===(i=c.messageLink)||void 0===i?void 0:i.messageId)&&(n.logicalDeleteMessage({conversationId:l,messageLink:null==c?void 0:c.messageLink,deleteReply:!0}),n.updateMessageList({conversationId:l,immerUpdate:function(e,t){return t.resetMessageLink(c.messageLink)}}),(0,y.abortPullMessage)(null==c?void 0:null===(a=c.messageLink)||void 0===a?void 0:a.messageId))}),!c.some(function(e){return e.resolved.isRegenerate})&&(0,y.cleanPrevRegenerateMessagesState)({store:n,conversationId:l}),n.clearSuggestMessage(l);var w=c.map(function(e){return(0,v.createMessagePayload)(e,n)}),A=c.map(function(e){return(0,y.getSendExt)(e,n)}),O=w.map(function(e,r){return(0,p.createLocalMessageFormPayload)({msgPayload:e,resolved:c[r].resolved,messageExt:A[r],regenerate:c[r].regenerate,store:n,ctx:c[r].ctx,reportEvents:c[r].reportEvents,chatType:t,scene:c[r].scene,sec_scene:c[r].sec_scene,use_skill:c[r].use_skill,skill_name:c[r].skill_name,skill_id:c[r].skill_name,reportParams:c[r].reportParams})});if(O.forEach(function(e,t){!c[t].remove&&u.updateStoreMessage.insertMessageIntoStore(c[t].resolved,n,e,c[t].regenerate)}),T)E({toPostMessages:w.map(function(e,t){return(0,i._)((0,r._)({},e),{ext:A[t]})}),localMessages:O,payloads:c});else{var P=c.map(function(e){var t;return(null===(t=e.resolved.localContent)||void 0===t?void 0:t.preprocess_key)||""}).filter(function(e){return!!e});P.forEach(function(e){var t,r=n.preprocessTaskMap[e],i=c.find(function(t){var n;return(null===(n=t.resolved.localContent)||void 0===n?void 0:n.preprocess_key)===e});(null==r?void 0:r.failed)&&i&&n.reUpload(e,null!==(t=i.ctx.botId)&&void 0!==t?t:"")});var x=M.useChatStore.subscribe(function(e){return P.map(function(t){return e.preprocessTaskMap[t]})},function(e){if(e.some(I)){c.forEach(function(e){var t=e.resolved;return u.updateStoreMessage.setStoreMessageFailed(n,t)}),x();return}if(e.every(L)){var t=new Map(e.map(function(e){return[(0,y.findLocalMessageIdByTaskLocalKey)(c,e.local_key),(0,_.createMessageContent)(e.local_key,e.key,c)]}));t.forEach(function(e,t){var r,i,o=(r=c,(i=t)?r.find(function(e){return e.resolved.localMessageId===i}):void 0);u.updateStoreMessage.updateStoreMessageAfterSend(n,null==o?void 0:o.resolved,e,null==o?void 0:o.regenerate)});var o=w.map(function(e,n){return(0,r._)((0,i._)((0,r._)({},e),{ext:A[n]}),t.has(e.local_message_id)?{content:t.get(e.local_message_id)}:{})});(0,h.handleLocalBreak)(l),n.clearSuggestMessage(l),E({payloads:c,localMessages:O,toPostMessages:o}),x()}},{equalityFn:s.default})}}}}},71878:function(e,t,n){"use strict";n.d(t,{tracker:function(){return g}});var r=n("9161"),i=n("87382"),o=n("68534"),a=n("31566"),s=n("52420"),u=n("53641"),c=n("2322"),l=n("62920"),d=n("87681"),g={logSendMessage:function(e){i.logger.info({message:"send message",meta:{localMessage:e}})},trackSendMessageStartEvent:function(e){a.FlowTea.trackEvent("message_send_start",{from:c.MessageFrom.Socket,type:e.message_type,send_id:e.message_id,section_id:e.section_id,local_message_id:e.local_message_id,conversation_id:e.conversation_id})},trackSendMessageEvent:function(e,t){var n,i,g=e.resolved,f=e.ctx,v=e.scene,_=e.content_source,p=e.sec_scene,m=e.use_skill,h=e.skill_id,y=e.skill_name,M=e.reportParams,S=f.enterFrom,b=l.useChatStore.getState().userOgfQuota;!g.isRegenerate&&a.FlowTea.trackEvent("send_message",(0,r._)({message_type:g.message_type,from:c.MessageFrom.Socket,conversation_id:f.conversationId,conversation_type:g.conversation_type,bot_id:g.bot_id,chat_type:g.chat_type,scene:"seo_keyboard"===v?"keyboard":v,sec_scene:"resend"===v?"resend":p,use_skill:void 0!==m&&m,skill_id:h,skill_name:y,is_gpt4:!!(null==b?void 0:null===(n=b.quotaSwitchConfig)||void 0===n?void 0:n.value)},M,g.content_type===o.ContentType.Text?{original_content_source:(null==_?void 0:_.source)||d.ContentSource.Other}:{},["keyboard_unlog","seo_keyboard"].includes(v)&&s.FlowConfig.loginSource?{previous_page:s.FlowConfig.loginSource}:{},S&&"bot_discover"===S?{user_id:s.FlowConfig.userId,req_id:g.bot_id?u.FlowBot.actions.getBotIdToRequestIdMap()[g.bot_id]:"",recommend_from:"bot_list_discover"}:{},(null===(i=t.ext)||void 0===i?void 0:i.collection_id)?{collection_id:t.ext.collection_id}:{}))},trackOnBoardingMessageSentEvent:function(){a.FlowTea.trackEvent("auto_onboarding_message_sent",{type:"create_chat"})}}},98806:function(e,t,n){"use strict";n.d(t,{updateStoreMessage:function(){return f}});var r,i=n("83316"),o=n("40509"),a=n("6462"),s=n("72951"),u=n("62920"),c=n("2322"),l=n("76289"),d=n("10173"),g=function(e,t,n,r){var i=(0,o._)(e,1)[0];if((0,s.deleteMockReplyMessage)(i),t.isReady){var a,g,f,v=u.useChatStore.getState().getReportEvents(n.conversation_id||"",n.local_message_id||"").send_message;(0,l.addLocalReceivingMessage)({isRegenerate:t.isRegenerate,immerUpdateMessage:e,newLocalMessageId:d.mockReplyConstantMessageId,conversationId:null!==(g=n.conversation_id)&&void 0!==g?g:"",replyId:t.isRegenerate?null!==(f=null==r?void 0:r.sentMessageId)&&void 0!==f?f:"":t.localMessageId,sectionId:n.section_id,timeout:null==n?void 0:null===(a=n.ext)||void 0===a?void 0:a.timeout,scene:String(null==v?void 0:v.getMeta().scene),localMessageStatus:c.LocalMessageStatus.WaitingAck,createdFrom:"send-message",message:{ext:(0,l.mergeOgfExt)()}}),(0,l.appendLocalReceivingMessageLink)({isRegenerate:t.isRegenerate,immerUpdateMessage:e,newLocalMessageId:d.mockReplyConstantMessageId,regenHead:null==r?void 0:r.regenerateHeadMessageId})}},f=(r={insertMessageIntoStore:function(e,t,n,r){t.updateMessageList({conversationId:e.conversationId,immerUpdate:function(){for(var t=arguments.length,i=Array(t),a=0;a<t;a++)i[a]=arguments[a];var s=(0,o._)(i,1)[0],u=s.draftMessageLinks;s.draftLocalMessageMap[e.localMessageId]=n;var c={isLocalMessage:!0,messageId:e.localMessageId};!e.isRegenerate&&u.push(c),g(i,e,n,r)}})}},(0,i._)(r,"setStoreMessageFailed",function(e,t){e.updateMessageList((0,i._)({conversationId:t.conversationId},"immerUpdate",function(e){var n=e.draftLocalMessageMap[t.localMessageId];(null==n?void 0:n.local)&&(n.local.failed=!0,n.local.status=c.LocalMessageStatus.PreprocessFailed)}))}),(0,i._)(r,"updateStoreMessageAfterSend",function(e,t,n,r){if(!!t)e.updateMessageList((0,i._)({conversationId:t.conversationId},"immerUpdate",function(){for(var e=arguments.length,i=Array(e),s=0;s<e;s++)i[s]=arguments[s];var u=(0,o._)(i,1)[0],l=u.draftLocalMessageMap[t.localMessageId],f=u.draftMessageLinks;(null==l?void 0:l.local)&&(l.local.failedExpired=Date.now()+d.sendMessageWaitAckTimeout,l.local.status=r?c.LocalMessageStatus.SendingRegenerate:c.LocalMessageStatus.Sending),l.content=n,l.create_time=Date.now();var v=f.findIndex(function(e){return e.messageId===t.localMessageId});~v&&v!==f.length-1&&f.push.apply(f,(0,a._)(f.splice(v,1))),g(i,t,l,r)}))}),r)},34242:function(e,t,n){"use strict";n.d(t,{isCompositeMessagePayloadWithFiles:function(){return s},isCompositeMessagePayloadWithImages:function(){return a},isCompositeMessagePayloadWithLinks:function(){return u},isFileMessagePayload:function(){return i},isImageMessagePayload:function(){return r}});var r=function(e){return"image"in e||"image_key"in e},i=function(e){return"file"in e||"file_key"in e},o=function(e){return"compositeContent"in e},a=function(e){return o(e)&&"images"in e.compositeContent&&!!e.compositeContent.images},s=function(e){return o(e)&&"files"in e.compositeContent&&!!e.compositeContent.files},u=function(e){return o(e)&&"links"in e.compositeContent&&!!e.compositeContent.links}},11534:function(e,t,n){"use strict";n.d(t,{refreshLaunchConfigAndUpdateStore:function(){return c}});var r=n("92769"),i=n("88802"),o=n("87382"),a=n("78142"),s=n("12133"),u=n("62920");function c(){return l.apply(this,arguments)}function l(){return(l=(0,r._)(function(){var e,t,n;return(0,i.__generator)(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,a.FlowApi.apiService.setting.Launch({})];case 1:if(!(t=(void 0===(e=n.sent().data)?{}:e).config))return[2];return u.useChatStore.setState(function(){return{ttWidConfig:(0,s.getTtWidConfig)(t)}}),[2,t];case 2:return n.sent(),o.logger.info("request failed to get launch config"),[3,3];case 3:return[2]}})})).apply(this,arguments)}},10173:function(e,t,n){"use strict";n.d(t,{INIT_CHAT_CONVERSATION_COUNT:function(){return E},assistantConvIdWithoutCache:function(){return I},chatConversationPageLoadCount:function(){return p},defaultCheckAvailableMessageSize:function(){return _},defaultFetchMessageSize:function(){return v},defaultReceiveMessageTimeout:function(){return a},defaultUploadFileMaxSize:function(){return b},device_platform:function(){return i},httpPullMessageInterval:function(){return S},httpPullMessageTimeout:function(){return M},localUser:function(){return o},maxSendMessageTextLength:function(){return y},mockReplyConstantMessageId:function(){return L},onBoardingConstantMessageId:function(){return m},onboardingWaitTimeout:function(){return l},receiveSuggestMessageTimeout:function(){return d},receiveSuggestReportIdleTimeout:function(){return g},sendImageMessagePreprocessTimeout:function(){return c},sendMessageShowLoadingExpired:function(){return u},sendMessageWaitAckTimeout:function(){return s},sendMessageWaitTimeout:function(){return h},streamMessageDisconnectTimeout:function(){return f},thinkingConstantMessageId:function(){return C},version_code:function(){return r}});var r=20700,i="web",o="LOCAL_USER",a=18e4,s=6e4,u=4e3,c=15e3,l=6e4,d=3e4,g=5e3,f=6e4,v=50,_=20,p=10,m="ONBOARDING_MESSAGE_ID",h=5e3,y=19e3,M=2e3,S=1e4,b=20971520,C="THINKING_MESSAGE_ID",L="MOCK_REPLY_MESSAGE_ID",I="ASSISTANT_CONV_ID_WITHOUT_CACHE",E=20},87681:function(e,t,n){"use strict";n.d(t,{CardType:function(){return l},ChatType:function(){return c},ContentSource:function(){return s},DisabledTag:function(){return u}});var r,i,o,a,s=((r={}).Original="original",r.UseTemplate="use_template",r.ChangeTemplate="change_template",r.Paste="paste",r.Other="other",r.NotMessage="notMessage",r);var u=((i={}).Reviewing="reviewing",i.Ban="ban",i.Delete="delete",i.Private="private",i.Rollback="rollback",i);var c=((o={})[o.Conversation=0]="Conversation",o[o.Bot=1]="Bot",o[o.LocalConversation=2]="LocalConversation",o[o.ProfileBot=3]="ProfileBot",o[o.NewThread=4]="NewThread",o);var l=((a={})[a.RUYI=1]="RUYI",a[a.LEGO=2]="LEGO",a[a.CARD_BUILDER=3]="CARD_BUILDER",a)},27413:function(e,t,n){"use strict";n.d(t,{pushCmdQueue:function(){return L}});var r,i=n("92769"),o=n("9161"),a=n("88802"),s=n("37247"),u=n("59574"),c=n("69581"),l=n("40492"),d=n("87382"),g=n("78597"),f=n("96988"),v=n("72046"),_=n("68534"),p=n("76516"),m=n("72951"),h=n("87681"),y=n("53277"),M=n("48022"),S=n("50289"),b=new s.default({concurrency:1});var C=(r=(0,i._)(function(e,t){var n,r,i,s,b,C,L,I,E,T,k,R,w,A,O,P,x,U,B,F;return(0,a.__generator)(this,function(a){switch(a.label){case 0:if(n=t.conversation_id,r=t.cmd_type,!n||!r)return d.logger.getLogger({namespace:"socket"}).warning("ConversationAdd: invalid conversation_id"),[2];switch(r){case f.CmdType.ConversationRead:return[3,1];case f.CmdType.ConversationAdd:return[3,2];case f.CmdType.ConversationUpdate:return[3,3];case f.CmdType.ConversationArchive:return[3,8];case f.CmdType.ConversationLandingInsert:return[3,9];case f.CmdType.ConversationCreateSection:return[3,10];case f.CmdType.ConversationClearHistory:return[3,11];case f.CmdType.MessageDelete:return[3,13];case f.CmdType.OnboardingBegin:return[3,14];case f.CmdType.OnboardingFail:case f.CmdType.OnboardingCancel:return[3,16];case f.CmdType.UserBanned:return[3,18];case f.CmdType.UserBanRelease:return[3,19];case f.CmdType.OnboardingNeedStart:return[3,20];case f.CmdType.UserConfigUpdate:return[3,23];case f.CmdType.TouristReachChatLimit:return[3,24];case f.CmdType.MessageNotCompliant:return[3,25]}return[3,26];case 1:return s=(i=t.ext||{}).read_message_index,b=i.message_index,d.logger.info({message:"Cmd: ConversationRead",meta:{conversation_id:n,read_message_index:s,message_index:b}}),s&&b&&e.updateConversationMessageIndex({conversationId:n,readMessageIndex:Number(s),messageIndex:Number(b)}),[3,27];case 2:return d.logger.info({message:"Cmd: ConversationUpdate",meta:{conversation_id:n}}),[3,27];case 3:d.logger.persist.info({message:"Cmd: ConversationUpdate",meta:{conversation_id:n}}),a.label=4;case 4:return a.trys.push([4,6,,7]),[4,e.fetchUpdateConversationInfo(n)];case 5:return a.sent(),[3,7];case 6:return(C=a.sent())instanceof Error&&d.logger.persist.error({message:"ConversationUpdate failed",error:C}),[3,7];case 7:case 9:case 13:return[3,27];case 8:return d.logger.info({message:"Cmd: ConversationArchive",meta:{conversation_id:n}}),[3,27];case 10:return d.logger.persist.info({message:"Cmd: ConversationCreateSection",meta:{conversation_id:n,section_id:null==t?void 0:null===(L=t.ext)||void 0===L?void 0:L.section_id}}),(null==t?void 0:null===(I=t.ext)||void 0===I?void 0:I.section_id)&&e.updateLastSectionId(n,null==t?void 0:null===(E=t.ext)||void 0===E?void 0:E.section_id),[3,27];case 11:return d.logger.persist.info({message:"Cmd: ConversationClear",meta:{conversation_id:n}}),[4,e.clearConversationMessages(n)];case 12:case 15:case 17:return a.sent(),[3,27];case 14:return d.logger.persist.info({message:"Cmd: OnboardingBegin",meta:{conversation_id:n}}),[4,e.initOnboarding({conversationId:n})];case 16:return d.logger.persist.info({message:"Cmd: ".concat(r===f.CmdType.OnboardingFail?"OnboardingFail":"OnboardingCancel"),meta:{conversation_id:n}}),[4,e.cancelOnboarding({conversationId:n,reason:"executing onboarding".concat(r===f.CmdType.OnboardingFail?"_fail":"_cancel")})];case 18:return d.logger.persist.info({message:"Cmd: UserBanned",meta:(0,o._)({conversationId:n},t)}),v.apiErrorEventEmitter.emit(v.APIErrorEvent.USER_BANNED,null==t?void 0:null===(T=t.ext)||void 0===T?void 0:T.err_msg),[3,27];case 19:return d.logger.persist.info({message:"Cmd: UserBanRelease",meta:{conversation_id:n,index:t.index,error:null==t?void 0:null===(k=t.ext)||void 0===k?void 0:k.err_msg}}),v.apiErrorEventEmitter.emit(v.APIErrorEvent.USER_BAN_RELEASE,null==t?void 0:null===(R=t.ext)||void 0===R?void 0:R.err_msg),[3,27];case 20:if(d.logger.persist.info({message:"Cmd: OnboardingNeedStart",meta:{conversation_id:n,index:t.index}}),null===(w=document)||void 0===w?void 0:w.hidden)return[2];if(O=(0,y.getLastLocalMessageFromStore)(n)||{},!(0,u.default)(O))return[2];if(P=(0,g.parseJSON)(null===(A=t.ext)||void 0===A?void 0:A.onboarding_v2),x="",(0,c.default)(P)&&"suggested_instructions"in P&&Array.isArray(P.suggested_instructions)&&(x=(0,l.default)((null==P?void 0:P.suggested_instructions)||[])),!x)return[3,22];return[4,(0,M.sendSupportedMessage)({ctx:{conversationId:n},text:String(x),scene:"onboarding"},h.ChatType.Conversation)];case 21:a.sent(),a.label=22;case 22:return[3,27];case 23:return d.logger.info({message:"Cmd: UserConfigUpdate",meta:{conversation_id:n}}),p.FlowEvent.emit("user.configSynced",t),[3,27];case 24:return d.logger.info({message:"Cmd: TouristReachChatLimit",meta:{conversation_id:n}}),p.FlowEvent.emit("guest.reachLimit"),[3,27];case 25:if(U=t.local_message_id,B=t.conversation_id,F=t.message_id,d.logger.info({message:"Cmd: MessageNotCompliant",meta:{conversation_id:n,message_id:F,local_message_id:U}}),!B)return[2];return e.updateMessageList({conversationId:B,immerUpdate:function(e){var t=e.draftLocalMessageMap,n=e.draftMessageMap,r=_.PushMessageStatus.NotCompliant;U&&t[U]&&(t[U].status=r,(0,m.deleteMockReplyMessage)(e)),F&&(n[F]&&(n[F].status=r),(0,S.abortPullMessage)(F),(0,m.deleteLocalReplyMessageByReplyId)(e,F),(0,m.deleteMessageInLocalMessageMapByReplyId)(e,F))}}),[3,27];case 26:d.logger.getLogger({namespace:"socket"}).warning("SKIP: cmdType=".concat(r)),a.label=27;case 27:return[2]}})}),function(e,t){return r.apply(this,arguments)}),L=function(e,t){b.add(function(){return C(e,t)})}},26096:function(e,t,n){"use strict";n.d(t,{dispatchEvent:function(){return s},subscribeEvent:function(){return u},unsubscribeEvent:function(){return c}});var r=n("87382"),i=n("64194"),o=n("46428"),a=n("27413"),s=function(e){var t=e.event,n=e.adaptor;try{var o=t.event_type,a=t.message,s=t.cmd,u=t.message_list;o===i.EventType.Message&&u&&u.forEach(function(e){return n.emit("message",e)}),o===i.EventType.Message&&a&&n.emit("message",a),o===i.EventType.Cmd&&s&&n.emit("cmd",s)}catch(e){e instanceof Error&&r.logger.error({message:"unexpected error in event handler,".concat(e.message),error:e})}},u=function(e){var t=e.action,n=e.adaptor;n.on("message",function(e){return(0,o.handleMessage)(t,e)}),n.on("cmd",function(e){return(0,a.pushCmdQueue)(t,e)})},c=function(e){var t=e.adaptor;t.off("message"),t.off("cmd")}},66991:function(e,t,n){"use strict";n.d(t,{handleAckMessage:function(){return V}});var r,i=n("92769"),o=n("9161"),a=n("16044"),s=n("40509"),u=n("88802"),c=n("77590"),l=n("98199"),d=n("61550"),g=n("45002"),f=n("83911"),v=n("90396"),_=n("50002"),p=n("87382"),m=n("78597"),h=n("68534"),y=n("76289"),M=n("8547"),S=n("91538"),b=n("12270"),C=n("43958"),L=n("53641"),I=n("76516"),E=n("52420"),T=n("31566"),k=n("37519"),R=n("2322"),w=n("35050"),A=n("72951"),O=n("46750"),P=n("87575"),x=n("62920"),U=n("9668"),B=n("87681"),F=n("94661"),N=n("98897"),D=n("53277"),q=n("11372"),j=n("75761");function W(e){var t=(0,s._)(e,1)[0],n=t.draftLocalMessageMap,r=t.draftMessageLinks,i=t.draftMessageMap;r.filter(function(e){var t,r,i=e.isLocalMessage,o=e.messageId;return i&&(null===(r=n[o])||void 0===r?void 0:null===(t=r.local)||void 0===t?void 0:t.status)===R.LocalMessageStatus.ReceivingFirstPackage}).sort(function(e,t){return(0,w.compareMessageIndex)(i[n[t.messageId].reply_id||""],i[n[e.messageId].reply_id||""])}).forEach(function(e,n){n&&(0,A.logicalDeleteMessage)(t,e)})}var G=function(e){var t;return null===(t=e.ext)||void 0===t?void 0:t.collection_id},H=function(e){if(!G(e))return!1;var t,n,r=null===(t=e.localInfo)||void 0===t?void 0:t.messageListCount,i=null===(n=e.localInfo)||void 0===n?void 0:n.inMessageListPos;return(0,c.default)(r)&&(0,c.default)(i)&&i===r-1};var V=(r=(0,i._)(function(e,t){var n,r,i,o,a,c,p,m,h,E,T,w,B,j,V,Q,$,X,Z,ee,et;return(0,u.__generator)(this,function(u){switch(u.label){case 0:if((o=(0,S.getMessageLogger)(null===(n=t.localInfo)||void 0===n?void 0:n.from)).info({message:"Ack Message",meta:{message:t}}),a=t.conversation_id,c=t.message_id,p=t.local_message_id,m=t.bot_id,h=t.local_conversation_id,T=void 0===(E=t.thread_id)?"":E,!p)return o.warning({message:"Invalid Ack Message: local_message_id",meta:{message:t}}),[2];if((0,F.finishSendMessageTask)(p),w=h||a,!c&&p&&!(0,b.isAckMessageError)(t)&&N.upCmdTasks[p])return o.info({message:"UpCmd Ack",meta:{message:t}}),(0,N.upCmdTasks)[p].success(),[2];if(B=!!(null===(r=(0,D.getLocalMessageFromStore)(w,p).local)||void 0===r?void 0:r.isRegenerate),V=(j=e.getReportEvents(w,p)).send_message,Q=j.create_conversation_by_message,!c){if((0,C.handleAckError)(e,t))return function(e,t,n){var r;k.reportEventsHelper.updateMeta(t,K(e)),k.reportEventsHelper.addDuration(t,"has_err"),k.reportEventsHelper.error(t,{reason:"has_err",meta:{has_err:null==e?void 0:null===(r=e.ext)||void 0===r?void 0:r.has_err}}),Y(!1,(0,_.default)(t,"send_message"),n)}(t,j,B),[2];return o.warning({message:"Invalid Ack Message: message_id",meta:{message:t}}),[2]}if(!function(e,t){var n,r,i=(0,S.getMessageLogger)(null===(n=t.localInfo)||void 0===n?void 0:n.from),o=function(e){i.persist.warning({message:"Invalid Ack Message",meta:{reason:e,message:t}})};return e?!!(0,P.isLocalMessage)(e)&&(null==e?void 0:null===(r=e.local)||void 0===r?void 0:r.status)!==R.LocalMessageStatus.SentInLocalConversation||(o("local_sending_message was received ack"),!1):(o("local_sending_message is not exist"),!1)}((0,y.getLocalSendingMessage)({conversationId:w,localMessageId:p}),t))return[2];if($=(0,y.getAllLocalMessageByEqualReplyId)({conversationId:w,replyId:c}),X=(null===(i=(0,l.default)($))||void 0===i?void 0:i.local_message_id)||(0,O.getTemporaryReplyMessageId)(c),(!G(t)||H(t))&&(0,M.handleRegisterHttpPullMessage)({reply_id:t.message_id,conversation_id:t.conversation_id}),k.reportEventsHelper.addDuration(j,"ack"),!((m||T)&&h&&a))return[3,6];Z=!!T,e.updateMessageList({conversationId:a,immerUpdate:function(){for(var e,n,r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];var u=(0,s._)(i,1)[0].draftMessageMap;!(t.message_id&&(0,P.isMessageNotCompliant)(u[t.message_id]))&&(0,y.addLocalReceivingMessage)({isRegenerate:!1,immerUpdateMessage:i,newLocalMessageId:X,conversationId:a,replyId:c,sectionId:t.section_id,timeout:null==t?void 0:null===(e=t.ext)||void 0===e?void 0:e.timeout,scene:null==V?void 0:null===(n=V.getMeta())||void 0===n?void 0:n.scene,localMessageStatus:R.LocalMessageStatus.ReceivingFirstPackage,createdFrom:"ack",message:{ext:(0,y.mergeOgfExt)()}})}}),e.updateMessageList({conversationId:h,immerUpdate:function(e){var t=e.draftLocalMessageMap[p];t.local.failedExpired=void 0,t.local.status=R.LocalMessageStatus.SentInLocalConversation}}),u.label=1;case 1:return u.trys.push([1,3,4,5]),[4,function(e){return z.apply(this,arguments)}({action:e,conversationId:a})];case 2:return u.sent(),null==Q||Q.addDurationPoint("init_conversation_success"),e.updateMessageList({conversationId:a,immerUpdate:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=(0,s._)(t,1)[0],i=r.draftMessageMap;!(c&&(0,P.isMessageNotCompliant)(i[c]))&&((0,d.default)((0,g.default)(r.draftLocalMessageMap,function(e){return(null==e?void 0:e.reply_id)===c})).forEach(function(e){var n=e.local_message_id,i=void 0===n?(0,O.getTemporaryReplyMessageId)(c):n,o=r.draftMessageLinks.find(function(e){return e.messageId===i});(0,f.default)(o)&&(0,y.appendLocalReceivingMessageLink)({isRegenerate:!1,immerUpdateMessage:t,newLocalMessageId:i})}),W(t))}}),e.insertNewConversationAndRemoveOldConversationFromLinks({conversationId:a,originConversationKey:h,threadId:T,index:1},{conversationId:h}),x.useChatStore.getState().moveRefContent(h,a),!Z&&L.FlowBot.actions.updateBot({bot_id:String(m),has_conversation:!0,conversation_id:a}),e.updateLocalConversation(h,{local:{createStatus:U.CreateConversationStatus.Done,newConversationId:a,reportEvent:Q,createFrom:"chatted"}}),[3,5];case 3:return ee=u.sent(),e.updateMessageList({conversationId:h,immerUpdate:function(e){var t=e.draftLocalMessageMap[p];t.local.failed=!0,t.local.status=R.LocalMessageStatus.SentAndCreateConversationFailedInLocalConversation,(0,A.deleteMockReplyMessage)(e)}}),ee instanceof Error&&(null==Q||Q.error({reason:"create_conversation_failed",error:ee,meta:{bot_id:m,thread_id:T}})),[3,5];case 4:return J(t,(0,v.default)(j,["send_message"]),B),[7];case 5:return[3,7];case 6:e.updateMessageList({conversationId:a,immerUpdate:function(){for(var e,n,r,i,o,u=arguments.length,l=Array(u),d=0;d<u;d++)l[d]=arguments[d];var g=(0,s._)(l,1)[0],f=g.draftLocalMessageMap[p],_=(0,P.isRegenerateMessage)(f);J(t,(0,v.default)(j,["send_message"]),_),!_&&(0,A.replaceLocalMessageByRemote)({draft:g,localMessage:f,message:t,useRemoteMessageKey:!1}),(0,A.moveReportEvents)({draft:g,localMessage:f,message:t,omitReportEventProperty:["send_message","create_conversation_by_message"]});var m=(0,A.deleteMockReplyMessage)(g);if(!(!_&&((0,D.findLastMessageByMatchEqualIdFromStore)({conversationId:a,replyId:c})||G(t)&&!H(t)))){var h=g.draftMessageMap;!(t.message_id&&(0,P.isMessageNotCompliant)(h[t.message_id]))&&((0,y.addLocalReceivingMessage)({conversationType:(0,q.getConversationTypeById)(a),isRegenerate:_,regenHead:null==m?void 0:null===(e=m[0])||void 0===e?void 0:e.regen_head,immerUpdateMessage:l,newLocalMessageId:X,conversationId:a,replyId:c,sectionId:t.section_id,timeout:null==t?void 0:null===(n=t.ext)||void 0===n?void 0:n.timeout,scene:null===(i=j.send_message)||void 0===i?void 0:null===(r=i.getMeta())||void 0===r?void 0:r.scene,localMessageStatus:R.LocalMessageStatus.ReceivingFirstPackage,createdFrom:"ack",message:{ext:(0,y.mergeOgfExt)()}}),(0,y.appendLocalReceivingMessageLink)({isRegenerate:_,immerUpdateMessage:l,newLocalMessageId:X,regenHead:null==m?void 0:null===(o=m[0])||void 0===o?void 0:o.regen_head}),W(l))}}}),t.index&&(et=Number(t.index),e.updateConversationMessageIndex({conversationId:a,readMessageIndex:et,messageIndex:et})),u.label=7;case 7:return t.section_id&&e.updateLastSectionId(w,t.section_id),I.FlowEvent.emit("message.receivedAck",e,t),[2]}})}),function(e,t){return r.apply(this,arguments)});function z(){return(z=(0,i._)(function(e){var t,n,r,o,a,s,c;return(0,u.__generator)(this,function(l){switch(l.label){case 0:return t=e.action,n=e.conversationId,[4,t.fetchUpdateConversationInfo(n)];case 1:r=l.sent(),o=3,a=200,s="ack_init_message_list_should_retry",l.label=2;case 2:return l.trys.push([2,4,,5]),[4,(0,m.retryAsync)((0,i._)(function(){var e,i;return(0,u.__generator)(this,function(o){switch(o.label){case 0:return[4,t.initMessageList({conversationId:n,messageCursor:Number(null==r?void 0:r.message_cursor),messageIndex:Number(null==r?void 0:r.message_index),range:{start:Number(null==r?void 0:r.message_cursor),end:Number(null==r?void 0:r.message_index)}})];case 1:if(e=o.sent(),p.logger.persist.info({eventName:"ack_init_message_list",meta:{is_undefined:void 0===e,message_cursor:null==r?void 0:r.message_cursor,message_index:null==r?void 0:r.message_index,length:null==e?void 0:e.length,message_ids:null==e?void 0:e.map(function(e){return e.messageId}).join(",")}}),!(i=(null!=r?r:{}).conversation_id))return p.logger.persist.error({eventName:"ack_init_message_list",error:Error("conversation_id is undefined"),meta:{is_undefined:void 0===e,message_cursor:null==r?void 0:r.message_cursor,message_index:null==r?void 0:r.message_index,length:null==e?void 0:e.length,message_ids:null==e?void 0:e.map(function(e){return e.messageId}).join(","),reason:"conversation_id_is_undefined"}}),[2];if(!e||0===e.length||e.every(function(e){return(0,P.isOnBoardingMessage)((0,D.getMessageFromStore)(i,e))}))throw Error(s);return[2]}})}),o,a)];case 3:return l.sent(),[3,5];case 4:if((c=l.sent())instanceof Error&&c.message===s)return p.logger.persist.error({eventName:"ack_init_message_list",error:Error("retry too more times"),meta:{reason:"retry_too_more_times"}}),[2];throw c;case 5:return[2]}})})).apply(this,arguments)}function K(e){var t,n,r,i,o=e.local_message_id,a=e.conversation_id,s=e.local_conversation_id,u=e.bot_id,c=e.message_id;return{meta:{local_message_id:o,conversation_id:a,local_conversation_id:s,from:null===(t=e.localInfo)||void 0===t?void 0:t.from,bot_id:u||(0,j.getBotIdByConversationId)(a),message_id:c,reply_id:e.reply_id,retried:null===(n=e.localInfo)||void 0===n?void 0:n.retried,log_id:null==e?void 0:null===(r=e.ext)||void 0===r?void 0:r.log_id,section_id:null==e?void 0:e.section_id,message_type:null==e?void 0:e.message_type,collection_id:null===(i=e.ext)||void 0===i?void 0:i.collection_id}}}function J(e,t,n){k.reportEventsHelper.updateMeta(t,K(e)),k.reportEventsHelper.addDuration(t,"ack"),k.reportEventsHelper.success(t),Y(!0,(0,_.default)(t,"send_message"),n)}function Y(e,t,n){if(t&&!n){var r,i,s,u,c,l=t.getMeta(),d=l.local_conversation_id,g=l.conversation_id,f=l.local_message_id,v=l.bot_id,_=l.message_id,p=l.section_id,m=l.scene,y=l.sec_scene,M=l.use_skill,S=l.skill_name,b=l.is_ogf,C=l.from,I=l.collection_id,k=l.message_type,R=l.reply_id,w=(0,j.getInfoByConversationId)(g).botInfo,A=(0,q.getConversationTypeById)(g),O=(0,j.getChatTypeForTea)(g,w,A),P=d||g||"",U=f?null===(r=x.useChatStore.getState().localMessageMap[P])||void 0===r?void 0:r[f]:void 0,F=E.FlowConfig.loginSource,N=E.FlowConfig.enterChatMethod,W=null==U?void 0:null===(i=U.local)||void 0===i?void 0:i.enterFrom;T.FlowTea.trackEvent("send_message_status",(0,o._)((0,a._)((0,o._)({duration:null===(s=t.getDuration())||void 0===s?void 0:s.ack,success:e?1:0,result:e?void 0:"shark",conversation_id:g,conversation_type:A,chat_type:O,bot_id:v,message_id:_,section_id:p,scene:"seo_keyboard"===m?"keyboard":m,sec_scene:y,use_skill:M,skill_name:S,skill_id:S,is_gpt4:b,message_type:(0,D.getMessageTypeForTea)(U),from:C,writing_genre:null===(u=t.getMeta())||void 0===u?void 0:u.writing_genre},F?{previous_page:F}:{}),{enter_chat_method:N}),(null==U?void 0:U.content_type)===h.ContentType.Text?{original_content_source:(null==U?void 0:U.content_source)||B.ContentSource.Other}:{},W&&"bot_discover"===W?{user_id:E.FlowConfig.userId,req_id:v?L.FlowBot.actions.getBotIdToRequestIdMap()[v]:"",recommend_from:"bot_list_discover"}:{},I?{collection_id:I}:{})),T.FlowTea.trackEvent("message_send_end",{type:k,from:C,success:e?1:0,stream:0,section_id:p,result:e?void 0:"shark",reply_id:R,message_id:_,http_count:1,duration:null==t?void 0:null===(c=t.getDuration())||void 0===c?void 0:c.failed,conversation_id:g})}}},14688:function(e,t,n){"use strict";n.d(t,{handleBotInvalid:function(){return _},handleConversationInValid:function(){return m},handleGuestLimitError:function(){return v},handleImageSafetyError:function(){return y},handleLimitError:function(){return f},handlePromptIllegalError:function(){return p},handleUserBanError:function(){return h}});var r=n("9161"),i=n("16044"),o=n("40509"),a=n("26498"),s=n("72046"),u=n("76516"),c=n("53641"),l=n("72951"),d=n("2322"),g=n("75761");function f(e,t){var n=t.ext||{},r=n.limit_time,i=n.limit_tips;e.updateRateLimitConfig({isLimited:!0,limitExpired:Date.now()+1e3*Number(r)||0,limitTips:i})}function v(e,t){u.FlowEvent.emit("guest.reachLimit");var n=t.conversation_id,r=t.local_message_id;n&&r&&e.updateMessageList({conversationId:n,immerUpdate:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=(0,o._)(t,1)[0];(0,l.logicalDeleteMessage)(i,{isLocalMessage:!0,messageId:r}),(0,l.deleteMockReplyMessage)(i)}})}function _(e,t){var n;if(t.conversation_id){if((null==t?void 0:null===(n=t.ext)||void 0===n?void 0:n.has_err)===String(a.ErrorCodes.BOT_REVIEWING)){var r=(0,g.getBotIdByConversationId)(t.conversation_id);c.FlowBot.actions.updateBot({id:r,disabled:!0})}else e.fetchUpdateConversationInfo(t.conversation_id)}}function p(e,t){var n=t.conversation_id,r=t.reply_id,i=t.message_id;n&&r&&i&&(0,l.logicalDeleteMessage)(e,{isLocalMessage:!1,messageId:r})}function m(e,t){if(!t.conversation_id){s.apiErrorEventEmitter.emit(s.APIErrorEvent.CONVERSATION_INVALID);return}var n=e.removeConversationFromLinks,r=e.removeConversationFromMap;n({conversationId:t.conversation_id}),r({conversationId:t.conversation_id}),s.apiErrorEventEmitter.emit(s.APIErrorEvent.CONVERSATION_INVALID)}function h(e){var t;s.apiErrorEventEmitter.emit(s.APIErrorEvent.USER_BANNED,null==e?void 0:null===(t=e.ext)||void 0===t?void 0:t.err_msg)}function y(e,t){var n=t.conversation_id,a=t.local_message_id;if(!!n&&!!a)e.updateMessageList({conversationId:n,immerUpdate:function(){for(var e=arguments.length,n=Array(e),s=0;s<e;s++)n[s]=arguments[s];var u=(0,o._)(n,1)[0],c=u.draftLocalMessageMap[a];c.local=(0,i._)((0,r._)({},c.local),{status:d.LocalMessageStatus.SafetyError,failed:!0}),c.ext=(0,r._)({},c.ext,t.ext),(0,l.deleteMockReplyMessage)(u)}})}},43958:function(e,t,n){"use strict";n.d(t,{handleAckError:function(){return u},handleMessageIllegalError:function(){return c}});var r=n("87382"),i=n("12270"),o=n("14688"),a=n("76516"),s=n("87575"),u=function(e,t){return(0,i.isSharkError)(t)?(a.FlowEvent.emit("network.sharkError",e,t),!0):(0,i.isLimitError)(t)?((0,o.handleLimitError)(e,t),!0):(0,i.isGuestLimitError)(t)?((0,o.handleGuestLimitError)(e,t),!0):(0,i.isConversationInValid)(t)?((0,o.handleConversationInValid)(e,t),!0):(0,i.isBotInvalid)(t)?((0,o.handleBotInvalid)(e,t),!0):(0,i.isUserBanError)(t)?((0,o.handleUserBanError)(t),!0):(0,i.isOpenAuthInvalid)(t)?(a.FlowEvent.emit("network.openAuthInvalid",e,t),!0):(0,i.isImageSafetyError)(t)?((0,o.handleImageSafetyError)(e,t),!0):!!(0,s.isMessageFailed)(t)||!1},c=function(e,t){return!!(0,s.isMessageIllegalError)(t)&&(r.logger.persist.warning({message:"illegal_prompt",meta:{message_id:t.message_id}}),(0,o.handlePromptIllegalError)(e,t),!0)}},12270:function(e,t,n){"use strict";n.d(t,{isAckMessageError:function(){return g},isBotInvalid:function(){return l},isConversationInValid:function(){return c},isFileSafetyError:function(){return v},isGuestLimitError:function(){return a},isImageSafetyError:function(){return f},isLimitError:function(){return o},isOpenAuthInvalid:function(){return d},isSharkError:function(){return s},isUserBanError:function(){return u}});var r=n("26498"),i=n("68534");function o(e){var t;return(null===(t=e.ext)||void 0===t?void 0:t.has_err)===String(r.ErrorCodes.LIMIT_TO_SEND_MESSAGE)}function a(e){var t;return(null===(t=e.ext)||void 0===t?void 0:t.has_err)===String(r.ErrorCodes.GUEST_REACH_LIMIT)}function s(e){var t,n;return(null===(t=e.ext)||void 0===t?void 0:t.has_err)===String(r.ErrorCodes.COUNTRY_RESTRICTED)||(null===(n=e.ext)||void 0===n?void 0:n.has_err)===String(r.ErrorCodes.SHARK_BLOCKED)}function u(e){var t;return(null===(t=e.ext)||void 0===t?void 0:t.has_err)===String(r.ErrorCodes.USER_BANNED)}function c(e){var t;return(null===(t=e.ext)||void 0===t?void 0:t.has_err)===String(r.ErrorCodes.CONVERSATION_INVALID)}function l(e){var t;return[r.ErrorCodes.BOT_INVALID,r.ErrorCodes.BOT_BANNED,r.ErrorCodes.BOT_REVIEWING].includes(Number(null==e?void 0:null===(t=e.ext)||void 0===t?void 0:t.has_err))}function d(e){var t;return(null===(t=e.ext)||void 0===t?void 0:t.has_err)===String(r.ErrorCodes.OPEN_AUTH_INVALID)}var g=function(e){var t;return!!(null===(t=e.ext)||void 0===t?void 0:t.has_err)},f=function(e){var t;return(null==e?void 0:null===(t=e.ext)||void 0===t?void 0:t.has_err)===String(r.ErrorCodes.IMAGE_SAFETY_ERROR)||(null==e?void 0:e.status)===i.PushMessageStatus.NotCompliant},v=function(e){var t;return(null==e?void 0:null===(t=e.ext)||void 0===t?void 0:t.has_err)===String(r.ErrorCodes.FILE_SAFETY_ERROR)||(null==e?void 0:e.status)===i.PushMessageStatus.NotCompliant}},46428:function(e,t,n){"use strict";n.d(t,{handleMessage:function(){return p}});var r=n("9161"),i=n("16044"),o=n("68534"),a=n("8547"),s=n("78856"),u=n("18353"),c=n("10349"),l=n("91538"),d=n("66991"),g=n("52420"),f=n("87575"),v=n("2322"),_=n("96049"),p=function(e,t){var n,p,m,h=t.conversation_id,y=t.message_type,M=t.message_id,S=void 0===M?"":M,b=(0,l.getMessageLogger)(null===(n=t.localInfo)||void 0===n?void 0:n.from);if((null===(p=g.FlowConfig.localFeatureConfig)||void 0===p?void 0:p.consoleFullMessagePacket)&&b.info({message:"Full Message Received, From: ".concat(null===(m=t.localInfo)||void 0===m?void 0:m.from),meta:{message:t}}),!h){b.warning({message:"message.conversation_id is empty when update message in handleMessage",meta:{message:t}});return}var C=(0,i._)((0,r._)({},t),{conversation_id:h});if(y===o.MessageType.Ack){(0,d.handleAckMessage)(e,C);return}if((0,f.isThinkingMessage)(t)){(0,u.handleThinkingMessage)(e,C);var L=t.next_connection_type,I=t.localInfo;L===o.ConnectionType.WebSocket&&(0,a.handleRegisterHttpPullMessage)(t),L===o.ConnectionType.HttpChunk&&(null==I?void 0:I.from)===v.MessageFrom.Socket&&(0,a.handleRegisterHttpChunkPullMessage)(t);return}if(!S){b.warning({message:"message.message_id is empty when update message in handleMessage",meta:{message:t}});return}var E=(0,i._)((0,r._)({},t),{message_id:S,conversation_id:h});if((0,f.isSuggestMessage)(E))(0,c.handleSuggestMessage)(e,E);else{(0,s.handleUpdateMessage)(e,E);var T=t.next_connection_type,k=t.localInfo;T===o.ConnectionType.HttpChunk&&(null==k?void 0:k.from)===v.MessageFrom.Socket&&(0,a.handleRegisterHttpChunkPullMessage)(t),!(0,f.isMessageFinished)(t)&&(T===o.ConnectionType.WebSocket?(0,a.handleRegisterHttpPullMessage)(t):T===o.ConnectionType.HttpChunk&&t.reply_id&&_.FlowNetAdaptor.httpAdaptor.abortMessage({replyId:t.reply_id}))}}},91538:function(e,t,n){"use strict";n.d(t,{getMessageLogger:function(){return a}});var r=n("83316"),i=n("87382"),o=n("2322"),a=function(e){var t,n=o.MessageFrom.HttpChunk,a=o.MessageFrom.Socket,s=o.MessageFrom.HttpLongPolling,u=(t={},(0,r._)(t,n,i.logger.getLogger({namespace:"http-chunk"})),(0,r._)(t,a,i.logger.getLogger({namespace:"socket"})),(0,r._)(t,s,i.logger.getLogger({namespace:"http-long-polling"})),t);return e===n||e===a||e===s?u[e]:i.logger}},10349:function(e,t,n){"use strict";n.d(t,{handleSuggestMessage:function(){return g}});var r=n("9161"),i=n("16044"),o=n("78597"),a=n("98740"),s=n("91538"),u=n("78217"),c=n("31566"),l=n("37519"),d=n("87575"),g=function(e,t){var n,g,f,v=t.contentObj,_=t.conversation_id,p=t.reply_id,m=t.message_id,h=t.section_id,y=(0,d.isFinishReplyLocalMessage)(t),M=(0,s.getMessageLogger)(null===(n=t.localInfo)||void 0===n?void 0:n.from);M.info({message:"Suggest Message",meta:{message:t}});var S=(v||{}).suggest,b=(0,o.isStringArray)(S)?S:[];if(!p){M.warning({message:"invalid suggest message: expect reply_id but found undefined/null"});return}var C=e.getReportEvents(_,p),L=C.message_receive_suggests;y&&p&&(0,u.updateMessageSuggest)(_,m,JSON.stringify(b)),e.updateSuggestMessage(_,function(e){var n,r,i;return(null===(n=t.ext)||void 0===n?void 0:n.onboarding)==="1"||(null===(r=t.ext)||void 0===r?void 0:r.onboarding)==="2"?{replyId:p,loading:!1,failed:!1,expired:void 0,suggests:b}:(null==e?void 0:e.replyId)===p?(!(null===(i=e.suggests)||void 0===i?void 0:i.length)&&(null==L||L.addDurationPoint("first")),null==L||L.addDurationPoint("last",!0),{replyId:p,loading:!1,failed:!1,expired:void 0,suggests:b}):(M.warning({message:"ignore suggest message: non-match reply_id"}),e)}),y&&(l.reportEventsHelper.success(C,{meta:(0,i._)((0,r._)({},(0,a.getRemoteMessageReportMeta)(t)),{is_include_suggests:!0})}),c.FlowTea.trackEvent("receive_prompt",(0,i._)((0,r._)({duration:null==L?void 0:null===(g=L.getDuration())||void 0===g?void 0:g.last,conversation_id:_,section_id:h},(null==b?void 0:b.length)?{success:1,quantity:(null==b?void 0:b.length)||0}:{success:0,result:"prompt_empty"}),{message_id:m,is_cache:"1"===String(null==t?void 0:null===(f=t.ext)||void 0===f?void 0:f.is_from_cache)?1:0})))}},18353:function(e,t,n){"use strict";n.d(t,{handleThinkingMessage:function(){return M}});var r=n("9161"),i=n("16044"),o=n("40509"),a=n("61550"),s=n("45002"),u=n("59574"),c=n("80613"),l=n("83911"),d=n("76289"),g=n("98740"),f=n("37519"),v=n("87575"),_=n("46750"),p=n("72951"),m=n("2322"),h=n("91880"),y=n("10173"),M=function(e,t){var n=t.conversation_id,M=t.reply_id,S=void 0===M?"":M,b=(0,v.isMessageFailed)(t);(0,v.isInSearchLoading)(t)&&e.updateSearchResultStatus(S,!1),e.updateMessageList({conversationId:n,immerUpdate:function(){for(var v=arguments.length,M=Array(v),C=0;C<v;C++)M[C]=arguments[C];var L=(0,o._)(M,1)[0],I=L.draftLocalMessageMap,E=(0,_.getTemporaryReplyMessageId)(S),T=(0,a.default)((0,s.default)(I,function(e){return(null==e?void 0:e.reply_id)===S}));if(S&&(0,u.default)(T)){var k,R,w,A,O=(0,p.deleteMockReplyMessage)(L);(0,d.addLocalReceivingMessage)({isRegenerate:!!(null==O?void 0:null===(k=O[0])||void 0===k?void 0:k.regen_head),regenHead:null==O?void 0:null===(R=O[0])||void 0===R?void 0:R.regen_head,immerUpdateMessage:M,newLocalMessageId:E,conversationId:n,replyId:S,scene:"",sectionId:t.section_id,localMessageStatus:m.LocalMessageStatus.ReceivingStream,createdFrom:"message"}),(0,d.appendLocalReceivingMessageLink)({isRegenerate:!!(null==O?void 0:null===(w=O[0])||void 0===w?void 0:w.regen_head),immerUpdateMessage:M,newLocalMessageId:E,regenHead:null==O?void 0:null===(A=O[0])||void 0===A?void 0:A.regen_head})}var P=I[E];if(P){if((0,h.checkIsNeedDiscardMessage)(P,t))return;var x=(0,r._)({},e.getReportEvents(n,E),e.getReportEvents(n,S||""));b?f.reportEventsHelper.error(x,{reason:"thinking-error",meta:(0,g.getRemoteMessageReportMeta)(t,P)}):f.reportEventsHelper.addDuration(x,"thinking"),I[E]=(0,r._)((0,i._)((0,r._)({},P),{local:(0,i._)((0,r._)({},P.local),{failed:!1,failedExpired:b?void 0:Date.now()+y.defaultReceiveMessageTimeout})}),(0,c.default)(t,l.default))}}})}},78856:function(e,t,n){"use strict";n.d(t,{handleUpdateMessage:function(){return w}});var r=n("83316"),i=n("9161"),o=n("16044"),a=n("40509"),s=n("80613"),u=n("83911"),c=n("35680"),l=n("90396"),d=n("87382"),g=n("76289"),f=n("98740"),v=n("91538"),_=n("43958"),p=n("31566"),m=n("83375"),h=n("76516"),y=n("37519"),M=n("87575"),S=n("46750"),b=n("72951"),C=n("2322"),L=n("91880"),I=n("96049"),E=n("10173"),T=n("11372"),k=n("75761"),R=n("53277"),w=function(e,t){var n,w=t.conversation_id,A=t.message_id,O=t.reply_id,P=void 0===O?"":O,x=(0,T.getConversationTypeById)(w),U=(0,v.getMessageLogger)(null===(n=t.localInfo)||void 0===n?void 0:n.from),B=(0,M.isStreamMessage)(t),F=(0,M.isMessageFinished)(t),N=(0,M.isMessageFailed)(t),D=(0,M.isMessageIllegalError)(t),q=(0,M.isOnBoardingMessage)(t),j=(0,M.isRegenerateMessage)(t),W=(0,M.isMusicMessage)(t),G=(0,M.isFinishReplyLocalMessage)(t),H=q?E.onBoardingConstantMessageId:P,V=!1;if(e.updateMessageList({conversationId:w,immerUpdate:function(){for(var n=arguments.length,v=Array(n),h=0;h<n;h++)v[h]=arguments[h];var T=(0,a._)(v,1)[0];(0,_.handleMessageIllegalError)(T,t)&&d.logger.persist.warning({message:"receive message failed",meta:(0,i._)({},t)});var O=T.draftLocalMessageMap,D=T.draftMessageMap,q=T.draftMessageLinks,W=T.draftRegenerateMessageMap,z=!!D[A],K=(0,S.getTemporaryReplyMessageId)(H),J=O[K],Y=O[A];if((!z||J)&&!Y){var Q,$,X=(0,b.deleteMockReplyMessage)(T);if((0,g.addLocalReceivingMessage)({isRegenerate:j,regenHead:null==X?void 0:null===(Q=X[0])||void 0===Q?void 0:Q.regen_head,immerUpdateMessage:v,newLocalMessageId:A,conversationId:w,replyId:P,message:t,scene:"",sectionId:t.section_id,localMessageStatus:C.LocalMessageStatus.ReceivingStream,createdFrom:"message",conversationType:x}),(0,g.appendLocalReceivingMessageLink)({isRegenerate:j,immerUpdateMessage:v,newLocalMessageId:A,regenHead:null==X?void 0:null===($=X[0])||void 0===$?void 0:$.regen_head}),Y=O[A],V=!0,J){var Z=q.findIndex(function(e){return e.messageId===K});-1!==Z&&q.splice(Z,1),(0,b.physicalDeleteMessage)(T,{isLocalMessage:!0,messageId:K})}}if(!z&&Y){var ee=(0,i._)({},e.getReportEvents(w,Y.local_message_id||""),e.getReportEvents(w,Y.reply_id||"")),et=ee.receive_message,en=(0,f.getRemoteMessageReportMeta)(t,Y);if((0,M.isMessageReceivingFirstPackage)(Y)||V){if(V=!0,N){var er,ei,eo,ea,es,eu,ec={reason:"first-pkg-error",meta:(0,o._)((0,i._)({},en),{is_include_suggests:!1})};y.reportEventsHelper.error(ee,ec)}else y.reportEventsHelper.addDuration(ee,"first"),p.FlowTea.trackEvent("receive_answer",{duration:null==et?void 0:null===(ea=et.getDuration())||void 0===ea?void 0:ea.first,from:null===(es=t.localInfo)||void 0===es?void 0:es.from,next_connection_type:t.next_connection_type,content_type:t.content_type,success:1,conversation_id:w,bot_id:(0,k.getBotIdByConversationId)(w),message_id:A,section_id:null==t?void 0:t.section_id,scene:null==et?void 0:et.getMeta().scene,message_type:(0,R.getMessageTypeForTea)(t),is_cache:"1"===String(null==t?void 0:null===(eu=t.ext)||void 0===eu?void 0:eu.is_from_cache)?1:0});p.FlowTea.trackEvent("message_receive_first_package",{conversation_id:w,status:N?1:0,error_code:null==en?void 0:en.has_err,duration:null==et?void 0:null===(er=et.getDuration())||void 0===er?void 0:er.first,message_id:A,from:null===(ei=t.localInfo)||void 0===ei?void 0:ei.from,next_connection_type:t.next_connection_type,content_type:null==t?void 0:t.content_type}),p.FlowTea.trackEvent("message_answer_start",{stream:1,from:null===(eo=t.localInfo)||void 0===eo?void 0:eo.from,next_connection_type:t.next_connection_type,content_type:t.content_type,section_id:null==t?void 0:t.section_id,reply_id:P,conversation_id:w})}else if(N){var el={reason:B?"stream-error":"error",meta:(0,o._)((0,i._)({},en),{is_include_suggests:!1})};y.reportEventsHelper.error(ee,el)}if((0,L.checkIsNeedDiscardMessageForMultipleReply)(Y,t,H,T))return;if((0,g.isReceiveFirstChunkPacket)(Y,t)&&(y.reportEventsHelper.addDuration(ee,"receive_first_chunk_packet"),p.FlowTea.trackEvent("receive_first_chunk_packet",{conversation_id:w,status:N?1:0,error_code:null==en?void 0:en.has_err,duration:null==et?void 0:null===(ed=et.getDuration())||void 0===ed?void 0:ed.receive_first_chunk_packet,message_id:A,from:null===(eg=t.localInfo)||void 0===eg?void 0:eg.from,next_connection_type:t.next_connection_type,content_type:null==t?void 0:t.content_type})),O[A]=(0,o._)((0,i._)((0,o._)((0,i._)({},Y),{local:(0,o._)((0,i._)({},Y.local),{status:C.LocalMessageStatus.ReceivingStream,failed:!1,failedExpired:F||N?void 0:Date.now()+E.streamMessageDisconnectTimeout})}),(0,s.default)(t,u.default)),{local_message_id:Y.local_message_id}),F){if(U.info({message:"replaceLocalMessageByRemote",meta:en}),(0,b.replaceLocalMessageByRemote)({draft:T,localMessage:Y,message:t}),Y.local.isRegenerate){var ed,eg,ef,ev,e_,ep,em,eh=(0,c.default)(t);eh.ext&&(eh.ext.regen="1"),eh.ext&&(eh.ext.regen_active="1"),W.messageMap=(0,o._)((0,i._)({},W.messageMap),(0,r._)({},A,eh))}(0,b.moveReportEvents)({draft:T,localMessage:Y,message:t,omitReportEventProperty:["receive_message","receive_message_package"]}),H&&I.FlowNetAdaptor.httpAdaptor.abortMessage({replyId:H}),y.reportEventsHelper.addDuration(ee,"success"),y.reportEventsHelper.success((0,l.default)(ee,["receive_message","receive_message_package"]),{meta:en});var ey=ee.receive_message;p.FlowTea.trackEvent("receive_stream",(0,i._)({duration:null==ey?void 0:null===(ef=ey.getDuration())||void 0===ef?void 0:ef.success,from:null===(ev=t.localInfo)||void 0===ev?void 0:ev.from,next_connection_type:t.next_connection_type,content_type:t.content_type,success:1,conversation_id:w,bot_id:(0,k.getBotIdByConversationId)(w),message_id:A,reply_id:H,section_id:null==t?void 0:t.section_id,scene:null==ey?void 0:ey.getMeta().scene,is_onboarding:(0,M.isOnBoardingMessage)(t)?1:0,is_soft_link:(0,R.getIsSoftLinkForTea)(t),message_type:(0,R.getMessageTypeForTea)(t),is_cache:"1"===String(null==t?void 0:null===(e_=t.ext)||void 0===e_?void 0:e_.is_from_cache)?1:0},(0,m.getOnboardingContentSource)(t))),p.FlowTea.trackEvent("message_answer_end",{type:t.message_type,from:null===(ep=t.localInfo)||void 0===ep?void 0:ep.from,next_connection_type:t.next_connection_type,content_type:t.content_type,success:1,stream:1,section_id:null==t?void 0:t.section_id,result:void 0,reply_id:P,message_id:A,duration:null==ey?void 0:null===(em=ey.getDuration())||void 0===em?void 0:em.success,conversation_id:w})}G&&y.reportEventsHelper.success(ee,(0,i._)({is_include_suggest:!1},en))}else V=!z,D[A]=t,!z&&q.push({isLocalMessage:!1,messageId:A}),F&&U.persist.info({message:"Receive Non-local Finished Message",meta:{message_id:A,conversation_id:w,is_exist:z}})}}),t.section_id&&V&&!D){var z=q?void 0:(0,R.getMessageFromStore)(w,{isLocalMessage:!1,messageId:H});(null==z?void 0:z.section_id)!==t.section_id&&e.updateLastSectionId(w,t.section_id)}var K=(0,M.isMessageHasSuggest)(t);if(F&&K&&t.reply_id){var J=(0,d.createReportEvent)({eventName:"message_receive_suggests",meta:{message_id:t.message_id,reply_id:t.reply_id,conversation_type:x}});e.mergeReportEvents(w,t.message_id,{message_receive_suggests:J}),e.updateSuggestMessage(w,function(){return{replyId:P,loading:!0,failed:!1,expired:Date.now()+E.receiveSuggestMessageTimeout,suggests:[]}})}F&&(0,M.isTextMessage)(t)&&e.updateSearchResultStatus(H,!0),W&&e.setMusicAutoPlay(!0),h.FlowEvent.emit("message.updated",e,t),N&&h.FlowEvent.emit("message.serverError",e,t)}},76289:function(e,t,n){"use strict";n.d(t,{addLocalReceivingMessage:function(){return h},appendLocalReceivingMessageLink:function(){return y},getAllLocalMessageByEqualReplyId:function(){return p},getLocalSendingMessage:function(){return m},isReceiveFirstChunkPacket:function(){return _},mergeOgfExt:function(){return M}});var r=n("9161"),i=n("16044"),o=n("40509"),a=n("45002"),s=n("61550"),u=n("33229"),c=n("87382"),l=n("2322"),d=n("62920"),g=n("73373"),f=n("68602"),v=n("10173");function _(e,t){var n,r;return(null===(n=e.localInfo)||void 0===n?void 0:n.from)!==l.MessageFrom.HttpChunk&&(null===(r=t.localInfo)||void 0===r?void 0:r.from)===l.MessageFrom.HttpChunk}function p(e){var t=e.conversationId,n=e.replyId,r=(0,a.default)(d.useChatStore.getState().localMessageMap[t],function(e){return(null==e?void 0:e.reply_id)===n});return(0,s.default)(r)}function m(e){var t,n=e.conversationId,r=e.localMessageId;return null===(t=d.useChatStore.getState().localMessageMap[n])||void 0===t?void 0:t[r]}function h(e){var t,n=e.conversationType,a=e.isRegenerate,s=e.immerUpdateMessage,u=e.newLocalMessageId,l=e.conversationId,d=e.replyId,_=e.sectionId,p=e.scene,m=e.message,h=e.timeout,y=e.regenHead,M=e.localMessageStatus,S=e.createdFrom,b=(0,o._)(s,1)[0],C={conversation_id:l,message_id:d,is_regenerate:a,conversation_type:n,scene:p};if("ack"===S&&b.draftLocalMessageMap[u]){b.draftMessageReportEventMap[u]=(0,i._)((0,r._)({},b.draftMessageReportEventMap[u]),{receive_message:(0,c.createReportEvent)({eventName:"receive_message",meta:C})});return}b.draftLocalMessageMap[u]=(0,g.createLocalMessage)({prevMessageId:a?null===(t=(0,f.findLastLink)(b.draftMessageLinks,function(e){return e.regen_head===y&&!e.isLocalMessage}))||void 0===t?void 0:t.messageId:d,localMessageStatus:M,message:(0,i._)((0,r._)({},void 0===m?{}:m),{conversation_id:l,section_id:_,local_message_id:u,reply_id:d}),failedExpired:Date.now()+(1e3*Number(void 0===h?0:h)||v.defaultReceiveMessageTimeout),messageLinks:b.draftMessageLinks,isRegenerate:a}),b.draftMessageReportEventMap[u]=(0,r._)({},b.draftMessageReportEventMap[u],Object.fromEntries(["receive_message","receive_message_package","receive_total_messages"].map(function(e){return[e,(0,c.createReportEvent)({eventName:e,meta:C})]})))}function y(e){var t=e.isRegenerate,n=e.immerUpdateMessage,r=e.newLocalMessageId,i=e.regenHead,a=(0,o._)(n,1)[0],s=(0,u.default)(a.draftMessageLinks,function(e){return e.messageId===r});if(s)s.regen_head=i;else{var c={isLocalMessage:!0,messageId:r};t&&(c.regen_head=i),a.draftMessageLinks.push(c)}}var M=function(e){var t;return(null===(t=d.useChatStore.getState().userOgfQuota)||void 0===t?void 0:t.nextMessageUseOgf)?(0,i._)((0,r._)({},e),{llm_model_type:"2"}):e}},8547:function(e,t,n){"use strict";n.d(t,{handleRegisterHttpChunkPullMessage:function(){return a},handleRegisterHttpPullMessage:function(){return i},handleRegisterHttpPullMessageImmediately:function(){return o}});var r=n("96049"),i=function(e){r.FlowNetAdaptor.httpAdaptor.pullMessage(e,15e3)},o=function(e){r.FlowNetAdaptor.httpAdaptor.pullMessage(e)},a=function(e){r.FlowNetAdaptor.httpChunkAdaptor.pullMessage(e)}},98740:function(e,t,n){"use strict";n.d(t,{getRemoteMessageReportMeta:function(){return r}});var r=function(e,t){var n,r,i,o,a,s;return{conversation_id:e.conversation_id,message_id:e.message_id,from:null===(n=e.localInfo)||void 0===n?void 0:n.from,local_message_id:null==t?void 0:t.local_message_id,is_regenerate:null==t?void 0:t.local.isRegenerate,has_err:null==e?void 0:null===(r=e.ext)||void 0===r?void 0:r.has_err,log_id:null===(i=e.localInfo)||void 0===i?void 0:i.logId,inner_log_id:null==e?void 0:null===(o=e.ext)||void 0===o?void 0:o.log_id,trace_id:null===(a=e.localInfo)||void 0===a?void 0:a.traceId,retried:null==e?void 0:null===(s=e.localInfo)||void 0===s?void 0:s.retried,next_connection_type:null==e?void 0:e.next_connection_type,content_type:String(e.content_type)}}},44657:function(e,t,n){"use strict";n.d(t,{useAttachmentKey:function(){return r}});var r=(0,n("45981").transformSelectorWithArgs)(function(e,t){return e.preprocessTaskMap[t].key})},59657:function(e,t,n){"use strict";n.d(t,{useComposeEditorValue:function(){return l},useOriginTextEditorValue:function(){return u},usePromptEditorValue:function(){return g},useRefContent:function(){return _},useReplyEditorValue:function(){return c},useSkillId:function(){return v},useSkillMode:function(){return f},useTranslateFormConfig:function(){return s},useWritingAssistantFormConfig:function(){return a},useWritingRichEditorValue:function(){return d}});var r=n("40509"),i=n("83053"),o=n("45981"),a=(0,o.transformSelectorWithArgs)(function(e){var t,n;return null===(n=e.skills)||void 0===n?void 0:null===(t=n.input_config)||void 0===t?void 0:t.write_assistant}),s=(0,o.transformSelectorWithArgs)(function(e){var t,n;return null===(n=e.skills)||void 0===n?void 0:null===(t=n.input_config)||void 0===t?void 0:t.translation});(0,o.transformSelectorWithArgs)(function(e){return e.activeSkillId});var u=(0,o.transformSelectorWithArgs)(function(e){return e.writingSkillState.originTextEditorValue}),c=(0,o.transformSelectorWithArgs)(function(e){return e.writingSkillState.replyEditorValue}),l=(0,o.transformSelectorWithArgs)(function(e){return e.writingSkillState.composeEditorValue}),d=(0,o.transformSelectorWithArgs)(function(e){return e.writingSkillState.writingEditorValue});(0,o.transformSelectorWithArgs)(function(e){return e.readSkillState.linkEditorValue});var g=(0,o.transformSelectorWithArgs)(function(e){return e.readSkillState.promptEditorValue}),f=(0,o.transformSelectorWithArgs)(function(e){return e.skillMode}),v=(0,o.transformSelectorWithArgs)(function(e,t){var n=Object.entries(e.skillMap);return(0,r._)(n.find(function(e){var n=(0,r._)(e,2);return(n[0],n[1]).skill_type===t})||[],1)[0]}),_=(0,o.transformSelectorWithArgs)(function(e,t){return e.refContentMap[t]},i.default)},10630:function(e,t,n){"use strict";n.d(t,{getBotConversationListFromConversationLinks:function(){return C},getThreadLinksFromConversationLinks:function(){return M},useBotConversationList:function(){return L},useBotConversationListData:function(){return b},useConversation:function(){return v},useConversationRecorder:function(){return m},useIsFirstChat:function(){return p},useLocalConversation:function(){return _},useMainConversationLink:function(){return I},useThreadFeedInitiated:function(){return h},useThreadList:function(){return S},useThreadListData:function(){return y}});var r=n("9161"),i=n("16044"),o=n("89334"),a=n("52983"),s=n("33434"),u=n("11790"),c=n("61550"),l=n("45981"),d=n("35453"),g=n("62920"),f=n("87575");(0,l.transformSelectorWithArgs)(function(e){return{conversationLinks:e.conversationLinks,conversationListStatus:e.conversationListStatus,threadListStatus:e.threadListStatus,threadFeedStatus:e.threadFeedStatus,loadConversationList:e.loadConversationList}});var v=(0,l.transformSelectorWithArgs)(function(e,t){return t?e.conversationMap[t]:void 0}),_=(0,l.transformSelectorWithArgs)(function(e,t){return t?e.localConversationMap[t]:void 0});(0,l.transformSelectorWithArgs)(function(e,t){return t?e.actionBarTemplateMap[t]:void 0});var p=function(e){return(0,g.useChatStore)(function(t){if(!((0,u.default)(t.messageMap,e)&&(0,d.hasMoreThanTwoKeys)(t.messageMap[e])))return!0;var n=t.messageMap[e];return!!(0,c.default)(n).every(function(e){return(0,f.isOnBoardingMessage)(e)})||!1},s.shallow)},m=function(e){var t=g.useChatStore.getState().setActiveConversation;(0,a.useEffect)(function(){t(e)},[e])},h=(0,l.transformSelectorWithArgs)(function(e){return e.threadFeedStatus.initiated}),y=(0,l.transformSelectorWithArgs)(function(e){return{conversationLinks:e.conversationLinks,threadIndex:e.threadIndex,botConversationIndex:e.botConversationIndex,threadListStatus:e.threadListStatus,threadFeedStatus:e.threadFeedStatus,loadThreadList:e.loadThreadList,loadThreadFeed:e.loadThreadFeed}});function M(e){var t=e.conversationLinks,n=e.threadIndex,r=e.botConversationIndex;return t.slice(n,r)}var S=function(){var e=y(),t=e.conversationLinks,n=e.threadIndex,a=e.botConversationIndex,s=(0,o._)(e,["conversationLinks","threadIndex","botConversationIndex"]);return(0,i._)((0,r._)({},s),{threadLinks:M({conversationLinks:t,threadIndex:n,botConversationIndex:a})})},b=(0,l.transformSelectorWithArgs)(function(e){return{conversationLinks:e.conversationLinks,botConversationIndex:e.botConversationIndex,conversationListStatus:e.conversationListStatus,loadBotConversationList:e.loadBotConversationList}});function C(e){var t=e.conversationLinks,n=e.botConversationIndex;return t.slice(n)}var L=function(){var e=b(),t=e.conversationLinks,n=e.botConversationIndex,a=(0,o._)(e,["conversationLinks","botConversationIndex"]);return(0,i._)((0,r._)({},a),{botConversationLinks:C({conversationLinks:t,botConversationIndex:n})})},I=(0,l.transformSelectorWithArgs)(function(e){return e.conversationLinks.find(function(e){return(0,f.isCocoConversationType)(e.conversationType)})})},45981:function(e,t,n){"use strict";n.d(t,{transformSelectorWithArgs:function(){return a}});var r=n("6462"),i=n("33434"),o=n("62920"),a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.shallow,n=function(){for(var n=arguments.length,i=Array(n),a=0;a<n;a++)i[a]=arguments[a];return(0,o.useChatStore)(function(t){return e.apply(void 0,[t].concat((0,r._)(i)))},t)};return n.raw=e,n}},10331:function(e,t,n){"use strict";n.d(t,{ErrorCode:function(){return i}});var r,i=((r={})[r.FetchFailed=1001]="FetchFailed",r[r.ResponseIsInvalid=1002]="ResponseIsInvalid",r[r.StreamParseFailed=1003]="StreamParseFailed",r[r.ServerError=1004]="ServerError",r[r.AbortFetch=1005]="AbortFetch",r)},96049:function(e,t,n){"use strict";n.d(t,{FlowNetAdaptor:function(){return l}});var r=n("69420"),i=n("93426"),o=n("29048"),a=n("51890"),s=n("70728"),u=n("63845");function c(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(void 0===t?"undefined":(0,o._)(t))?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l=function(){function e(){(0,r._)(this,e)}return(0,i._)(e,null,[{key:"httpAdaptor",get:function(){var e;return this._httpAdaptor=null!==(e=this._httpAdaptor)&&void 0!==e?e:new s.HttpAdaptor}},{key:"httpChunkAdaptor",get:function(){var e;return this._httpChunkAdaptor=null!==(e=this._httpChunkAdaptor)&&void 0!==e?e:new u.HttpChunkAdaptor}},{key:"socketAdaptor",get:function(){var e;return this._socketAdaptor=null!==(e=this._socketAdaptor)&&void 0!==e?e:new a.SocketAdaptor}}]),e}();c(l,"_httpAdaptor",void 0),c(l,"_httpChunkAdaptor",void 0),c(l,"_socketAdaptor",void 0)},63845:function(e,t,n){"use strict";n.d(t,{HttpChunkAdaptor:function(){return v}});var r=n("47767"),i=n("69420"),o=n("73209"),a=n("29048"),s=n("26379"),u=n("72193"),c=n("83909"),l=n("69046"),d=n("2322"),g=n("26096");function f(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(void 0===t?"undefined":(0,a._)(t))?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var v=function(e){(0,o._)(n,e);var t=(0,s._)(n);function n(){var e;return(0,i._)(this,n),e=t.call(this),f((0,r._)(e),"_workerMap",new Map),f((0,r._)(e),"_poolSize",1),f((0,r._)(e),"_queue",[]),f((0,r._)(e),"_maxRetryAttempt",3),f((0,r._)(e),"_hasInitiated",!1),f((0,r._)(e),"_fetchStream",void 0),f((0,r._)(e),"_baseURL",void 0),f((0,r._)(e),"_getCommonHttpParams",void 0),f((0,r._)(e),"_getCommonHttpHeaders",void 0),f((0,r._)(e),"_action",void 0),f((0,r._)(e),"from",d.MessageFrom.HttpChunk),e._handleEvent=e._handleEvent.bind((0,r._)(e)),e._handleFinish=e._handleFinish.bind((0,r._)(e)),e._handleClean=e._handleClean.bind((0,r._)(e)),e._handleUpdateTask=e._handleUpdateTask.bind((0,r._)(e)),e}var a=n.prototype;return a._initWorker=function(){var e=new c.EventSourceWorker({maxRetryAttempts:this._maxRetryAttempt,fetchStream:this._fetchStream,getCommonHttpParams:this._getCommonHttpParams,getCommonHttpHeaders:this._getCommonHttpHeaders,baseURL:this._baseURL});return e.on("event",this._handleEvent),e.on("finish",this._handleFinish),e.on("clean",this._handleClean),e.on("update_task",this._handleUpdateTask),this._workerMap.set(e.id,e),e},a._handleUpdateTask=function(e,t){var n;null===(n=this._action)||void 0===n||n.updateChunkTask(e,t)},a._handleClean=function(e){var t;null===(t=this._action)||void 0===t||t.removeChunkTask(e)},a._handleFinish=function(e){var t=this._workerMap.get(e);if((null==t?void 0:t.status)===l.WorkerStatus.idle){var n=this._queue.pop();n&&(null==t||t.startTask(n))}},a._handleEvent=function(e){(0,g.dispatchEvent)({event:e,adaptor:this})},a._checkMessageInWorking=function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=this._workerMap.values()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0)if(i.value.replyId===e)return!0}catch(e){n=!0,r=e}finally{try{!t&&null!=o.return&&o.return()}finally{if(n)throw r}}var a=!0,s=!1,u=void 0;try{for(var c,l=this._queue[Symbol.iterator]();!(a=(c=l.next()).done);a=!0)if(c.value.replyId===e)return!0}catch(e){s=!0,u=e}finally{try{!a&&null!=l.return&&l.return()}finally{if(s)throw u}}return!1},a.init=function(e,t){var n,r,i,o,a,s;!this._hasInitiated&&((0,g.subscribeEvent)({action:e,adaptor:this}),this._action=e,this._poolSize=(null===(n=t.httpChunkConfig)||void 0===n?void 0:n.poolSize)||1,this._maxRetryAttempt=(null===(r=t.httpChunkConfig)||void 0===r?void 0:r.retryAttempt)||3,this._getCommonHttpParams=null===(i=t.httpChunkConfig)||void 0===i?void 0:i.getCommonHttpParams,this._getCommonHttpHeaders=null===(o=t.httpChunkConfig)||void 0===o?void 0:o.getCommonHttpHeaders,this._fetchStream=null===(a=t.httpChunkConfig)||void 0===a?void 0:a.fetchStream,this._baseURL=null===(s=t.httpChunkConfig)||void 0===s?void 0:s.baseURL,this._hasInitiated=!0)},a.resumeChunkTask=function(e){var t=this;e.forEach(function(e){var n=e.replyId;!(!n||t._checkMessageInWorking(n))&&e&&t._pullMessage(e)})},a.pullMessage=function(e){var t,n=e.reply_id;if(!(!n||this._checkMessageInWorking(n))){var r=null===(t=this._action)||void 0===t?void 0:t.createChunkTask(n,e);r&&this._pullMessage(r)}},a._pullMessage=function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=this._workerMap.values()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;if(a.status===l.WorkerStatus.idle){a.startTask(e);return}}}catch(e){n=!0,r=e}finally{try{!t&&null!=o.return&&o.return()}finally{if(n)throw r}}if(this._workerMap.size<this._poolSize){this._initWorker().startTask(e);return}this._queue.push(e)},a.abortMessage=function(e){var t=e.replyId,n=this._queue.findIndex(function(e){return e.replyId===t});if(~n){this._queue.splice(n,1),this._handleClean(t);return}var r=!0,i=!1,o=void 0;try{for(var a,s=this._workerMap.values()[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;u.replyId===t&&u.abort()}}catch(e){i=!0,o=e}finally{try{!r&&null!=s.return&&s.return()}finally{if(i)throw o}}},a.drop=function(){this._hasInitiated=!1,(0,g.unsubscribeEvent)({adaptor:this})},n}(u.default)},74920:function(e,t,n){"use strict";n.d(t,{RetryCounter:function(){return a}});var r=n("69420"),i=n("93426"),o=n("29048"),a=function(){function e(){var t,n,i,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;(0,r._)(this,e),this._maxRetryAttempts=a,t=this,i=0,(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(void 0===t?"undefined":(0,o._)(t))?t:String(t)}(n="_attempts"))in t?Object.defineProperty(t,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[n]=i}var t=e.prototype;return t.add=function(){this._attempts++},t.reset=function(){this._attempts=0},t.matchMaxRetryAttempts=function(){return this._attempts>=this._maxRetryAttempts},(0,i._)(e,[{key:"attempts",get:function(){return this._attempts}}]),e}()},69046:function(e,t,n){"use strict";n.d(t,{WorkerStatus:function(){return i}});var r,i=((r={})[r.running=1]="running",r[r.idle=2]="idle",r)},83909:function(e,t,n){"use strict";n.d(t,{EventSourceWorker:function(){return A}});var r=n("47767"),i=n("92769"),o=n("69420"),a=n("93426"),s=n("73209"),u=n("9161"),c=n("16044"),l=n("6462"),d=n("29048"),g=n("26379"),f=n("88802"),v=n("68461"),_=n("61550"),p=n("49647"),m=n("72193"),h=n("87382"),y=n("78597"),M=n("64194"),S=n("26498"),b=n("69046"),C=n("74920"),L=n("31479"),I=n("91880"),E=n("10331"),T=n("52420"),k=n("2322"),R=n("10173");function w(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(void 0===t?"undefined":(0,d._)(t))?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var A=function(e){(0,s._)(n,e);var t=(0,g._)(n);function n(e){var i,a,s;return(0,o._)(this,n),(i=t.call(this))._config=e,w((0,r._)(i),"_retryCounter",void 0),w((0,r._)(i),"_abortTrigger",void 0),w((0,r._)(i),"_originFetchStream",void 0),w((0,r._)(i),"_baseURL",void 0),w((0,r._)(i),"_chunkTask",void 0),w((0,r._)(i),"_getCommonHttpParams",void 0),w((0,r._)(i),"_getCommonHttpHeaders",void 0),w((0,r._)(i),"id",void 0),w((0,r._)(i),"status",void 0),i._retryCounter=new C.RetryCounter(null===(a=i._config)||void 0===a?void 0:a.maxRetryAttempts),i.id=Symbol("eventSourceWorker"),i.status=b.WorkerStatus.idle,i._handleEvent=i._handleEvent.bind((0,r._)(i)),i._handleError=i._handleError.bind((0,r._)(i)),i._handleFinish=i._handleFinish.bind((0,r._)(i)),i._subscribeAbortTrigger=i._subscribeAbortTrigger.bind((0,r._)(i)),i._originFetchStream=i._config.fetchStream,i._getCommonHttpParams=i._config.getCommonHttpParams,i._getCommonHttpHeaders=i._config.getCommonHttpHeaders,i._baseURL=i._config.baseURL,i._emitThrottle=(s=i._emitThrottle.bind((0,r._)(i)),(0,v.default)(s,150,{leading:!0,trailing:!0})),i}var d=n.prototype;return d._fetchStream=function(e){var t=this;return(0,i._)(function(){var n,r;return(0,f.__generator)(this,function(i){switch(i.label){case 0:return[4,null===(n=(r=t)._originFetchStream)||void 0===n?void 0:n.call(r,{req:{url:"".concat(t._baseURL||"","/alice/message/stream_reply"),body:{seq_st:(Number(e.chunkSeq)||0)+1,reply_id:e.replyId,binary_type:(0,L.getBinaryType)()}},reportMeta:{conversation_id:(null==e?void 0:e.conversationId)||"",reply_id:e.replyId,seq_st:(Number(e.chunkSeq)||0)+1,binary_type:(0,L.getBinaryType)()},onMessage:t._handleEvent,onError:t._handleError,onFinish:t._handleFinish,subscribeAbortTrigger:t._subscribeAbortTrigger,getCommonHttpParams:t._getCommonHttpParams,getCommonHttpHeaders:t._getCommonHttpHeaders})];case 1:return i.sent(),[2]}})})()},d._subscribeAbortTrigger=function(e){this._abortTrigger=e},d._handleEvent=function(e,t){var n;(null===(n=T.FlowConfig.localFeatureConfig)||void 0===n?void 0:n.consoleIncrementMessagePacket)&&h.logger.getLogger({namespace:"http-chunk"}).info({message:"Increment Chunk Received",meta:{chunk:e}}),e.event_type===M.EventType.Message&&this._batchUpdateMessage(e,t)},d._batchUpdateMessage=function(e,t){var n=!1;if(e.message_list){var r=[],i=[],o=!0,a=!1,s=void 0;try{for(var l,d=e.message_list[Symbol.iterator]();!(o=(l=d.next()).done);o=!0){var g=l.value,f=this._mergeMessage(g,t),v=f.mergedMessage,_=f.needEmitImmediate,p=f.needEmitImmediatePreviousMessage;_&&(n=!0),r.push(v),p&&i.push(p)}}catch(e){a=!0,s=e}finally{try{!o&&null!=d.return&&d.return()}finally{if(a)throw s}}if(i.length){var m=(0,c._)((0,u._)({},e),{message_list:i});this._emit("event",[m],n)}var h=(0,c._)((0,u._)({},e),{message_list:r});this._emit("event",[h],n)}if(e.message){var y=e.message,M=this._mergeMessage(y,t),S=M.mergedMessage,b=M.needEmitImmediate,C=M.needEmitImmediatePreviousMessage;if(C){var L=(0,c._)((0,u._)({},e),{message:C});this._emit("event",[L],b)}var I=(0,c._)((0,u._)({},e),{message:S});this._emit("event",[I],b)}},d._emit=function(e,t){var n=!(arguments.length>2)||void 0===arguments[2]||arguments[2];n?this.emit.apply(this,[e].concat((0,l._)(t))):this._emitThrottle(e,t)},d._emitThrottle=function(e,t){this.emit.apply(this,[e].concat((0,l._)(t)))},d._mergeMessage=function(e,t){if(!this._chunkTask)return{mergedMessage:e,needEmitImmediate:!0};var n,r=this._chunkTask,i=r.completionMessageMap,o=r.replyId,a=(e||{}).message_id;i[R.thinkingConstantMessageId]&&delete i[R.thinkingConstantMessageId];var s=a||R.thinkingConstantMessageId,u=(0,I.mergeMessage)(i[s]||{},e,{from:k.MessageFrom.HttpChunk,logId:t,retried:!!(null===(n=this._retryCounter)||void 0===n?void 0:n.attempts)}),c=u.mergedMessage,l=u.needEmitImmediate,d=u.needEmitImmediatePreviousMessage,g=c||e;return i[s]=g,this._emit("update_task",[o,g]),{mergedMessage:g,needEmitImmediate:l,needEmitImmediatePreviousMessage:d}},d._handleError=function(e,t){if(e.code===E.ErrorCode.ServerError){var n=(0,y.parseJSON)(e.msg);switch(n.code){case S.ErrorCodes.NETWORK_TIMEOUT:case S.ErrorCodes.MYSQL_ERROR:case S.ErrorCodes.REDIS_ERROR:this._reFetchStream(n,t);return;default:this._batchEmitErrorMessage(n,t)}}else{if(e.code===E.ErrorCode.AbortFetch)return;this._reFetchStream({msg:e.msg,code:L.CLIENT_NETWORK_ERROR},t)}},d._reFetchStream=function(e,t){var n=this;return(0,i._)(function(){return(0,f.__generator)(this,function(r){switch(r.label){case 0:if(n._retryCounter.matchMaxRetryAttempts())return n._batchEmitErrorMessage(e,t),n._handleFinish(),[2];if(n._retryCounter.add(),!(n._retryCounter.attempts>1))return[3,2];return[4,n._wait(n._retryCounter.attempts)];case 1:r.sent(),r.label=2;case 2:return n._chunkTask&&n._fetchStream(n._chunkTask),[2]}})})()},d._wait=function(e){var t=this;return new Promise(function(n){setTimeout(n,t._getIntervalValue(e))})},d._getIntervalValue=function(e){var t=this._config||{},n=t.minFetchInterval,r=t.maxFetchInterval,i=void 0===r?5e3:r,o=t.fetchIntervalGrowFactor,a=(void 0===n?500:n)*Math.pow(void 0===o?2:o,e-1);return a>i?i:a},d._handleFinish=function(e){e&&this._batchFinishMessage(),this._reset(),this.emit("finish",this.id)},d._batchEmitErrorMessage=function(e,t){if(this._chunkTask){var n=this._chunkTask.completionMessageMap,r=!0,i=!1,o=void 0;try{for(var a,s=(0,_.default)(n)[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;this.emit("event",(0,L.createErrorPushMessage)(u,e,t))}}catch(e){i=!0,o=e}finally{try{!r&&null!=s.return&&s.return()}finally{if(i)throw o}}}},d._batchFinishMessage=function(){if(this._chunkTask){var e=this._chunkTask.completionMessageMap,t=!0,n=!1,r=void 0;try{for(var i,o=(0,p.default)(e)[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value,s=(0,c._)((0,u._)({},e[a]),{localInfo:(0,c._)((0,u._)({},e[a].localInfo||{}),{finishReply:!0,from:k.MessageFrom.HttpChunk})});e[a]=s,this.emit("event",{event_type:M.EventType.Message,message:s})}}catch(e){n=!0,r=e}finally{try{!t&&null!=o.return&&o.return()}finally{if(n)throw r}}}},d._reset=function(){var e;this.emit("clean",(null===(e=this._chunkTask)||void 0===e?void 0:e.replyId)||""),this._retryCounter.reset(),this._chunkTask=void 0,this.status=b.WorkerStatus.idle},d._init=function(e){this.status=b.WorkerStatus.running,this._chunkTask=(0,L.cloneDeepAndOmitLocalFromChunkTask)(e),this._retryCounter.reset()},d.startTask=function(e){this._init(e),this._fetchStream(e)},d.abort=function(){var e;null===(e=this._abortTrigger)||void 0===e||e.call(this,{msg:"breakdown",code:E.ErrorCode.AbortFetch}),this._reset()},(0,a._)(n,[{key:"replyId",get:function(){var e;return null===(e=this._chunkTask)||void 0===e?void 0:e.replyId}}]),n}(m.default)},70728:function(e,t,n){"use strict";n.d(t,{HttpAdaptor:function(){return E}});var r=n("47767"),i=n("69420"),o=n("73209"),a=n("9161"),s=n("16044"),u=n("29048"),c=n("26379"),l=n("90396"),d=n("2945"),g=n("72193"),f=n("87382"),v=n("78597"),_=n("64194"),p=n("78142"),m=n("68534"),h=n("10844"),y=n("69218"),M=n("2322"),S=n("73373"),b=n("87575"),C=n("26096"),L=n("10173");function I(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(void 0===t?"undefined":(0,u._)(t))?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var E=function(e){(0,o._)(n,e);var t=(0,c._)(n);function n(){var e;return(0,i._)(this,n),e=t.call(this),I((0,r._)(e),"from",M.MessageFrom.HttpLongPolling),I((0,r._)(e),"_config",void 0),I((0,r._)(e),"_pullMessageTasks",{}),I((0,r._)(e),"_hasInitiated",!1),e._handleEvent=e._handleEvent.bind((0,r._)(e)),e}var u=n.prototype;return u._handleEvent=function(e,t){var n=this;if(e.event_type===_.EventType.Message&&e.message){var r=(0,S.normalizeMessage)(e.message,{from:this.from,retried:!0,logId:t});e.message=r}if(e.event_type===_.EventType.Message&&e.message_list){var i=e.message_list.map(function(e,r,i){return(0,S.normalizeMessage)(e,{from:n.from,retried:!0,logId:t,messageListCount:i.length,inMessageListPos:r})});e.message_list=i}(0,C.dispatchEvent)({event:e,adaptor:this})},u.init=function(e,t){!this._hasInitiated&&(this._config=null==t?void 0:t.httpConfig,(0,C.subscribeEvent)({action:e,adaptor:this}),this._hasInitiated=!0)},u.sendMessage=function(e){var t,n=this;if(!(e.length<=0)){var r=1===e.length?{message:e[0]}:{message_list:e},i=(0,s._)((0,a._)({},r),{event_type:_.EventType.Message});p.FlowApi.apiService.message.MessageReplay({payload:h.protoBase64.enc(new TextEncoder().encode((0,v.stringifyJSON)(i)))},{overrideParams:{aid:null===(t=this._config)||void 0===t?void 0:t.ws_app_id},overrideConfig:{timeout:L.sendMessageWaitTimeout}}).then(function(e){if(!e.payload)throw Error("Invalid ack message");var t=h.protoBase64.dec(e.payload);n._handleEvent((0,v.parseJSON)(v.utf8.read(t,0,t.byteLength)),(0,y.getLogIdFromResponse)(e))}).catch(function(e){f.logger.info("get reply message failed: ".concat(e.message))})}},u._fetchMessage=function(e){var t=this;p.FlowApi.apiService.message.GetMessageReply({message_id:e.reply_id||e.message_id,conversation_id:e.conversation_id},{overrideConfig:{timeout:L.httpPullMessageTimeout}}).then(function(n){if(t._pullMessage(e,L.httpPullMessageInterval),!(null===(i=n.data)||void 0===i?void 0:null===(r=i.message_list)||void 0===r?void 0:r.length))throw Error("message_list is empty");var r,i,o=n.data.message_list.filter(function(e){return!(0,b.isSuggestMessage)(e)});o.sort(function(e,t){return(Number(e.index)||0)-(Number(t.index)||0)}),o.forEach(function(e){var r,i;t._handleEvent({message:e,event_type:_.EventType.Message},(0,y.getLogIdFromResponse)(n)),(null==e?void 0:null===(r=e.ext)||void 0===r?void 0:r.sp)&&t._handleEvent({message:(0,s._)((0,a._)({},(0,l.default)(e,["conversation_id","section_id","message_id","reply_id","message_type"])),{content_type:m.ContentType.Suggest,content:(0,v.stringifyJSON)({suggest:(0,v.parseJSON)(null==e?void 0:null===(i=e.ext)||void 0===i?void 0:i.sp)||""}),ext:{},meta_infos:[]}),event_type:_.EventType.Message},(0,y.getLogIdFromResponse)(n))})}).catch(function(n){t._pullMessage(e,L.httpPullMessageInterval),f.logger.info("get message reply failed: ".concat(n.message))})},u._pullMessage=function(e,t){var n,r=this,i=e.reply_id;if(!i||"0"===i){f.logger.info("reply_id is empty, skip pull message");return}if(!this._pullMessageTasks[i]){f.logger.info("task is empty, skip pull message");return}if(!(Date.now()-this._pullMessageTasks[i].expired>0)){null===(n=this._pullMessageTasks[i])||void 0===n||n.clear();var o=setTimeout(function(){r._fetchMessage(e)},t),a=function(){clearTimeout(o)};this._pullMessageTasks[i].clear=a,this._pullMessageTasks[i].finish=function(){a(),delete r._pullMessageTasks[i]}}},u.pullMessage=function(e,t){var n=e.reply_id;n&&"0"!==n&&(this._pullMessageTasks[n]?this._pullMessageTasks[n].clear():this._pullMessageTasks[n]={reply_id:n,finish:d.default,clear:d.default,expired:Date.now()+L.defaultReceiveMessageTimeout},this._pullMessage(e,t))},u.abortMessage=function(e){var t;null===(t=this._pullMessageTasks[e.replyId])||void 0===t||t.finish()},u.drop=function(){this._hasInitiated=!1,(0,C.unsubscribeEvent)({adaptor:this})},n}(g.default)},51890:function(e,t,n){"use strict";n.d(t,{SocketAdaptor:function(){return h}});var r=n("47767"),i=n("69420"),o=n("73209"),a=n("9161"),s=n("16044"),u=n("29048"),c=n("26379"),l=n("72193"),d=n("78597"),g=n("64194"),f=n("2322"),v=n("73373"),_=n("26096"),p=n("11534");function m(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(void 0===t?"undefined":(0,u._)(t))?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var h=function(e){(0,o._)(n,e);var t=(0,c._)(n);function n(){var e;return(0,i._)(this,n),e=t.call(this),m((0,r._)(e),"client",void 0),m((0,r._)(e),"from",f.MessageFrom.Socket),m((0,r._)(e),"_hasInitiated",!1),e._handleEvent=e._handleEvent.bind((0,r._)(e)),e}var u=n.prototype;return u._handleEvent=function(e){var t=this,n=e.event,r=e.traceId;if(n.event_type===g.EventType.Message&&n.message){var i=(0,v.normalizeMessage)(n.message,{from:this.from,traceId:r});n.message=i}if(n.event_type===g.EventType.Message&&n.message_list){var o=n.message_list.map(function(e,n,i){return(0,v.normalizeMessage)(e,{from:t.from,traceId:r,messageListCount:i.length,inMessageListPos:n})});n.message_list=o}(0,_.dispatchEvent)({event:n,adaptor:this})},u.init=function(e,t){if(!this._hasInitiated){var n=t.socketConfig;if(!n)throw Error("Invalid socket config, socket config is required");var r=n.socketClient,i=n.launchConfig,o=n.getSocketParams;this.client=r,this.client.init({onSocketStatusChange:e.setSocketStatus,config:i,onMessage:this._handleEvent,refreshSocketConfig:p.refreshLaunchConfigAndUpdateStore,getSocketParams:o}),(0,_.subscribeEvent)({action:e,adaptor:this}),this._hasInitiated=!0}},u.sendMessage=function(e){if(!(e.length<=0)){var t,n=1===e.length?{message:e[0]}:{message_list:e};null===(t=this.client)||void 0===t||t.send((0,d.stringifyJSON)((0,s._)((0,a._)({},n),{event_type:g.EventType.Message})))}},u.sendCmd=function(e){var t;null===(t=this.client)||void 0===t||t.send((0,d.stringifyJSON)({cmd:e,event_type:g.EventType.Cmd}))},u.drop=function(){var e;this._hasInitiated=!1,(0,_.unsubscribeEvent)({adaptor:this}),null===(e=this.client)||void 0===e||e.drop()},n}(l.default)},1525:function(e,t,n){"use strict";n.d(t,{UpCmdType:function(){return i}});var r,i=((r={})[r.Conversation_in=1]="Conversation_in",r[r.Conversation_out=2]="Conversation_out",r)},91880:function(e,t,n){"use strict";n.d(t,{checkIsNeedDiscardMessage:function(){return _},checkIsNeedDiscardMessageForMultipleReply:function(){return v},mergeMessage:function(){return f}});var r=n("9161"),i=n("16044"),o=n("6462"),a=n("61550"),s=n("45002"),u=n("73690"),c=n("83911"),l=n("68534"),d=n("73373"),g=n("87575");function f(e,t,n){var a,s,u,c,f,v,p,m,h,y=(0,d.normalizeMessage)(t,n),M=(0,g.isBrokenMessage)(y),S=(0,i._)((0,r._)({},e,y),{is_delta:!1});if(e.message_type!==y.message_type||e.content_type!==y.content_type)return{mergedMessage:y,needEmitImmediate:!0,needEmitImmediatePreviousMessage:e};if(!y.is_delta)return{mergedMessage:y,needEmitImmediate:!0};if(y.is_delta){;if(_(e,y))return{mergeMessage:e,needEmitImmediate:!0};if(y.contentObj)switch(y.content_type){case l.ContentType.Text:;S.contentObj=(a=e.contentObj,s=M?void 0:y.contentObj,{text:((null==a?void 0:a.text)||"")+((null==s?void 0:s.text)||"")});break;case l.ContentType.Suggest:;S.contentObj=(u=e.contentObj,c=M?void 0:y.contentObj,{suggest:(0,o._)(null!==(f=null==u?void 0:u.suggest)&&void 0!==f?f:[]).concat((0,o._)(null!==(v=null==c?void 0:c.suggest)&&void 0!==v?v:[]))});break;default:S.contentObj=M?e.contentObj:y.contentObj}if(!y.contentObj){;S.content=(p=e.content,(p||"")+(y.content||""))}S.meta_infos=(m=e.meta_infos,h=M?void 0:y.meta_infos,(0,o._)(null!=m?m:[]).concat((0,o._)(null!=h?h:[])))}return{mergedMessage:S,needEmitImmediate:!1}}var v=function(e,t,n,r){var i=(0,a.default)((0,s.default)(r.draftLocalMessageMap,function(e){return(null==e?void 0:e.reply_id)===n})),o=(0,u.default)(i.map(function(e){return e.chunk_seq}))||0,l=t.chunk_seq,d=null==e?void 0:e.chunk_seq;return!!(!(0,c.default)(l)&&!(0,c.default)(d)&&Number(l)<Number(d)&&Number(l)<Number(o))||!1},_=function(e,t){var n=t.chunk_seq,r=null==e?void 0:e.chunk_seq;return!!(!(0,c.default)(n)&&!(0,c.default)(r)&&Number(n)<Number(r))||!1}},31479:function(e,t,n){"use strict";n.d(t,{CLIENT_NETWORK_ERROR:function(){return g},cloneDeepAndOmitLocalFromChunkTask:function(){return f},createErrorPushMessage:function(){return v},getBinaryType:function(){return _}});var r=n("9161"),i=n("16044"),o=n("40509"),a=n("35680"),s=n("47282"),u=n("46593"),c=n("64194"),l=n("52420"),d=n("2322"),g=111111111;function f(e){var t=(0,a.default)(e),n=t.completionMessageMap,r=!0,i=!1,c=void 0;try{for(var l,d=(0,s.default)(n)[Symbol.iterator]();!(r=(l=d.next()).done);r=!0){var g=(0,o._)(l.value,2),f=g[0],v=g[1];n[f]=(0,u.default)(v,["local","local_message_id"])}}catch(e){i=!0,c=e}finally{try{!r&&null!=d.return&&d.return()}finally{if(i)throw c}}return t}function v(e,t,n){var o,a=t.msg,s=t.code,u=(0,i._)((0,r._)({},null!=e?e:{}),{ext:(0,i._)((0,r._)({},null!==(o=null==e?void 0:e.ext)&&void 0!==o?o:{}),{has_err:s===g?"":String(s),err_msg:s===g?"":a}),localInfo:{from:d.MessageFrom.HttpChunk,logId:n,errorCode:s,errorMsg:a}});return{event_type:c.EventType.Message,message:u}}var _=function(){var e;return(null===(e=l.FlowConfig.localFeatureConfig)||void 0===e?void 0:e.chunkWithJSON)?"json":"pb"}},54596:function(e,t,n){"use strict";n.d(t,{createChatInputSlice:function(){return _}});var r=n("83316"),i=n("9161"),o=n("16044"),a=n("89334"),s=n("40509"),u=n("6462"),c=n("97176"),l=n("87382"),d=n("18876"),g=n("45509"),f=n("5890"),v={activeSkillId:"",skill_drop_down_visible:void 0,skillMode:d.SkillMode.Wide,skillMap:{},skills:void 0,writingSkillState:{originTextEditorValue:"",composeEditorValue:"",replyEditorValue:"",writingEditorValue:{data:[]}},readSkillState:{linkEditorValue:"",promptEditorValue:""},skillReportEvents:{},userPreferences:{transTargetLang:""}},_=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var d=(0,s._)(t,2),_=d[0],p=d[1];return f.resetStoreManager.push(function(){return _(v)}),f.resetStoreManager.merge(v),(0,o._)((0,i._)({},g.createChatInputRefContentSlice.apply(void 0,(0,u._)(t)),v),{updateActiveSkillId:function(e){_(function(){return{activeSkillId:e}})},createSkillReportEvent:function(e){var t,n=e.skillType,s=e.eventName,u=(0,a._)(e,["skillType","eventName"]);return _((0,c.produce)(function(e){var t,a;null===(a=e.skillReportEvents[n])||void 0===a||null===(t=a[s])||void 0===t||t.cancel(),e.skillReportEvents[n]=(0,r._)({},s,(0,l.createReportEvent)((0,o._)((0,i._)({eventName:s},u),{once:!0})))})),null===(t=p().skillReportEvents[n])||void 0===t?void 0:t[s]},getSkillReportEvent:function(e){var t,n=e.skillType,r=e.eventName;return null===(t=p().skillReportEvents[n])||void 0===t?void 0:t[r]},updateOriginTextEditorValue:function(e){_((0,c.produce)(function(t){t.writingSkillState.originTextEditorValue=e}))},updateComposeEditorValue:function(e){_((0,c.produce)(function(t){t.writingSkillState.composeEditorValue=e}))},updateWritingEditorValue:function(e){_((0,c.produce)(function(t){t.writingSkillState.writingEditorValue=e}))},updateReplyEditorValue:function(e){_((0,c.produce)(function(t){t.writingSkillState.replyEditorValue=e}))},updateLinkEditorValue:function(e){_((0,c.produce)(function(t){t.readSkillState.linkEditorValue=e}))},updatePromptEditorValue:function(e){_((0,c.produce)(function(t){t.readSkillState.promptEditorValue=e}))},updateSkillMode:function(e){_((0,c.produce)(function(t){t.skillMode=e}))},updateUserPreferences:function(e,t){_((0,c.produce)(function(n){n.userPreferences[e]=t}))}})}},45509:function(e,t,n){"use strict";n.d(t,{createChatInputRefContentSlice:function(){return u}});var r=n("9161"),i=n("16044"),o=n("97176"),a=n("5890"),s={refContentMap:{}},u=function(e){return a.resetStoreManager.push(function(){return e(s)}),(0,i._)((0,r._)({},s),{addRefContent:function(t,n){e((0,o.produce)(function(e){e.refContentMap[n]=t}))},clearRefContent:function(t){e((0,o.produce)(function(e){delete e.refContentMap[t]}))},moveRefContent:function(t,n){e((0,o.produce)(function(r){var i=r.refContentMap[t];i&&(r.refContentMap[n]=i,setTimeout(function(){e((0,o.produce)(function(e){delete e.refContentMap[t]}))},1e4))}))}})}},18876:function(e,t,n){"use strict";n.d(t,{SkillMode:function(){return i}});var r,i=((r={}).Wide="Wide",r.Narrow="Narrow",r)},32237:function(e,t,n){"use strict";n.d(t,{createConversationSlice:function(){return w}});var r=n("92769"),i=n("9161"),o=n("16044"),a=n("89334"),s=n("40509"),u=n("6462"),c=n("88802"),l=n("33434"),d=n("83911"),g=n("59391"),f=n("78493"),v=n("51445"),_=n("97176"),p=n("87382"),m=n("78597"),h=n("78142"),y=n("66080"),M=n("51816"),S=n("9668"),b=n("37674"),C=n("20646"),L=n("5890"),I=n("53641"),E=n("87575"),T=n("46750"),k=n("62920"),R={conversationListStatus:{loading:!1,failed:!1,count:0,hasMore:!1,isReload:!1,initiated:!1},conversationLinks:[],threadIndex:0,botConversationIndex:0,threadListStatus:{loading:!1,failed:!1,count:0,hasMore:!1,isReload:!1,nextIndex:"",initiated:!1},threadFeedStatus:{loading:!1,failed:!1,count:0,hasMore:!1,isReload:!1,nextIndex:"",initiated:!1},guestCanChat:!1,chatNotReachLimit:!1},w=function(){for(var e,t,n,w=arguments.length,P=Array(w),x=0;x<w;x++)P[x]=arguments[x];var U=(0,s._)(P,2),B=U[0],F=U[1];L.resetStoreManager.push(function(){return B(R)}),L.resetStoreManager.merge(R);var N=function(){var e=F(),t=e.conversationLinks,n=e.botConversationIndex;return t.slice(n)},D=function(e){var t=F(),n=t.conversationLinks,r=t.botConversationIndex;B({conversationLinks:n.slice(0,r).concat(e)})},q=function(){var e=F(),t=e.conversationLinks,n=e.botConversationIndex,r=e.threadIndex;return t.slice(r,n)},j=function(e){var t=F(),n=t.conversationLinks,r=t.botConversationIndex,i=t.threadIndex,o=i+e.length;B({conversationLinks:n.slice(0,i).concat(e).concat(n.slice(r)),botConversationIndex:o})},W=function(e){var t=F(),n=t.conversationLinks,r=t.botConversationIndex,i=t.threadIndex,o=i>0;B({conversationLinks:[e].concat(n.slice(i)),botConversationIndex:o?r:r+1,threadIndex:o?i:i+1})},G=function(e){var t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];t&&e.forEach(function(e){if(e.bot_id&&e.bot_disable_tag){var t,n,r={bot_id:null==e?void 0:e.bot_id,id:null==e?void 0:e.bot_id,bot_type:null==e?void 0:e.bot_type,disabled_tag:null!==(t=null==e?void 0:e.bot_disable_tag)&&void 0!==t?t:"normal",creator_info:null!==(n=null==e?void 0:e.bot_creator_info)&&void 0!==n?n:{}};!I.FlowBot.actions.getBot(e.bot_id)&&I.FlowBot.actions.updateBot(r)}}),B(function(t){return{conversationMap:e.reduce(function(e,t){return t.conversation_id&&(e[t.conversation_id]=t),e},(0,i._)({},t.conversationMap)),lastMessageIndexMap:e.reduce(function(e,t){return t.conversation_id&&(e[t.conversation_id]={message_index:Number(t.message_index)||0,read_message_index:Number(t.read_message_index)||0}),e},(0,i._)({},t.lastMessageIndexMap))}})},H=function(e){var t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=q(),r=e.map(function(e){var t,n,r;return{threadId:null===(t=e.thread_id)||void 0===t?void 0:t.toString(),isLocalConversation:!1,conversationId:(null===(n=e.conversation)||void 0===n?void 0:n.conversation_id)||"",conversationType:null===(r=e.conversation)||void 0===r?void 0:r.conversation_type}}).filter(function(e){return!(0,d.default)(e.threadId)}),i=n.filter(function(e){return(0,T.isLocalThreadId)(e.threadId)});return O(t?(0,u._)(i).concat((0,u._)(n),(0,u._)(r)):(0,u._)(i).concat((0,u._)(r),(0,u._)(n)))},V=function(e,t){t>0&&(e.conversationLinks.splice(t,1),t>=e.threadIndex&&t<e.botConversationIndex&&(e.botConversationIndex-=1))},z=function(e,t){var n,r,i,o,a=t.conversationId,s=t.originConversationKey,u=t.index,c=t.threadId,l=t.pinOperation,d=t.isLocalConversation,g=void 0!==d&&d;if(!(e.threadIndex>0)||(null===(n=F().conversationLinks.find(function(e){return(0,E.isCocoConversationType)(e.conversationType)}))||void 0===n?void 0:n.conversationId)!==a){var f=!!c||!!(null===(r=e.conversationLinks.find(function(e){return e.conversationId===a}))||void 0===r?void 0:r.threadId)||(0,E.isCocoSubConversation)(e.conversationMap[a]),v=f?q():N(),_=v.length,p=-1,m=!1,h=g?null===(i=e.localConversationMap[a])||void 0===i?void 0:i.conversation_type:null===(o=e.conversationMap[a])||void 0===o?void 0:o.conversation_type,y=c,M=_,b=S.ConversationType.Conversation;if(v.forEach(function(t,n){var r,i,o,s,u=!1;u=t.isLocalConversation?null!==(i=null===(r=e.localConversationMap[t.conversationId])||void 0===r?void 0:r.pinned)&&void 0!==i&&i:null!==(s=null===(o=e.conversationMap[t.conversationId])||void 0===o?void 0:o.pinned)&&void 0!==s&&s,t.conversationId===a&&(p=n,m=u,h=t.conversationType,y=t.threadId,t.isLocalConversation&&(b=S.ConversationType.LocalConversation)),!u&&M===_&&(M=n)}),u){if(~p){var C=f?p+e.threadIndex:p+e.botConversationIndex;e.conversationLinks.splice(C,1),M=M>p?M-1:M,f&&(e.botConversationIndex-=1)}void 0!==l&&l?(M=m?M:0,b===S.ConversationType.Conversation?e.conversationMap[a]&&(e.conversationMap[a].pinned=!e.conversationMap[a].pinned):e.localConversationMap[a]&&(e.localConversationMap[a].pinned=!e.localConversationMap[a].pinned)):M=m?0:M;var L=f?M+e.threadIndex:M+e.botConversationIndex;e.conversationLinks.splice(L,0,{isLocalConversation:g,conversationId:a,originConversationKey:s,conversationType:h,threadId:null==y?void 0:y.toString()}),f&&(e.botConversationIndex+=1)}}};return(0,o._)((0,i._)({},R,C.createConversationMapSlice.apply(void 0,(0,u._)(P)),b.createConversationRecorderSlice.apply(void 0,(0,u._)(P))),{loadConversationList:(e=(0,r._)(function(e){var t,n,r,s,u,l,d,_;return(0,c.__generator)(this,function(c){switch(c.label){case 0:n=void 0===(t=e.type)?[S.LoadConversationListType.Feed,S.LoadConversationListType.Thread,S.LoadConversationListType.Bot]:t,r=(0,a._)(e,["type"]),s=(0,g.default)(n),u=(0,p.createReportEvent)({eventName:"load_conversation_list",meta:{type:s.join(","),isRefresh:r.isRefresh,isReload:r.isReload,isInit:!r.isRefresh&&0===r.index,size:r.size,index:r.index}}),l=s.map(function(e){switch(e){case S.LoadConversationListType.Bot:return F().loadBotConversationList(r);case S.LoadConversationListType.Feed:return F().loadThreadFeed(r);case S.LoadConversationListType.Thread:return F().loadThreadList((0,o._)((0,i._)({},r),{index:void 0}));case S.LoadConversationListType.Guest:return F().loadGuestThreadFeed(r);default:return Promise.resolve([])}}),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,Promise.all(l)];case 2:return d=c.sent(),u.success(),[2,(0,f.default)((0,v.default)(d),"conversation_id")];case 3:throw(_=c.sent())instanceof Error&&u.error({reason:"loadConversationList failed size:".concat(r.size," index:").concat(r.index," type:").concat(s.join(",")),error:_}),_;case 4:return[2]}})}),function(t){return e.apply(this,arguments)}),loadBotConversationList:(t=(0,r._)(function(e){var t,n,r,a,s,l,d,g,f,v,_,M,S,b,C,L,I;return(0,c.__generator)(this,function(c){switch(c.label){case 0:t=e.index,n=e.size,r=e.isReload,a=e.isRefresh,s=F().conversationListStatus,l=(0,p.createReportEvent)({eventName:"load_bot_conversation_list",meta:{isRefresh:a,isReload:r,size:n,index:t,isInit:!s.initiated}}),d=N(),g=!a&&0===t,B({conversationListStatus:(0,o._)((0,i._)({},s),{loading:!0,isReload:!!r})}),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,(0,m.retryAsync)(function(){return h.FlowApi.apiService.conversation.ConversationList({index:t,batch_size:n,conversation_types:[y.ConversationType.Bot]})},3,function(e){return 1e3*e})];case 2:return f=c.sent().data,l.addDurationPoint("fetch_success"),M=void 0===(_=(v=f||{}).conversation_list)?[]:_,S=v.has_more,G(M),b=M.map(function(e){return{isLocalConversation:!1,conversationId:e.conversation_id||"",conversationType:null==e?void 0:e.conversation_type}}).filter(Boolean),C=g?[]:d,D(L=O(a?(0,u._)(b).concat((0,u._)(d)):(0,u._)(C).concat((0,u._)(b)))),B(function(e){return{conversationListStatus:(0,o._)((0,i._)({loading:!1,failed:!1,count:L.length},a?{hasMore:e.conversationListStatus.hasMore}:{hasMore:S||!1}),{isReload:!1,initiated:!0})}}),l.success(),[2,M];case 3:throw I=c.sent(),B(function(e){return{conversationListStatus:(0,o._)((0,i._)({},e.conversationListStatus),{failed:!0,loading:!1})}}),I instanceof Error&&l.error({reason:"loadBotConversationList failed size:".concat(n," index:").concat(t),error:I}),I;case 4:return[2]}})}),function(e){return t.apply(this,arguments)}),loadThreadFeed:(0,r._)(function(){var e,t,n,r,a,s,u,l,g,f,v,_,y,M,S,b,C,L,I,E,T,k,R,w=arguments;return(0,c.__generator)(this,function(c){switch(c.label){case 0:t=(e=w.length>0&&void 0!==w[0]?w[0]:{}).isReload,r=void 0!==(n=e.isRefresh)&&n,a=F().threadFeedStatus,s=(0,p.createReportEvent)({eventName:"load_thread_feed",meta:{isRefresh:r,isReload:t,isInit:!a.initiated}}),B({threadFeedStatus:(0,o._)((0,i._)({},a),{loading:!0,isReload:!!t})}),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,(0,m.retryAsync)(function(){return h.FlowApi.apiService.samantha.GetFeed()},3,function(e){return 1e3*e})];case 2:return u=c.sent().data,s.addDurationPoint("fetch_success"),g=(l=u||{}).threads,f=l.main_thread,y=void 0===(_=(v=g||{}).thread_list)?[]:_,M=v.has_more,S=v.next_index,f&&W({conversationId:null!==(I=null===(b=f.conversation)||void 0===b?void 0:b.conversation_id)&&void 0!==I?I:"",conversationType:null===(C=f.conversation)||void 0===C?void 0:C.conversation_type,threadId:null!==(E=null===(L=f.thread_id)||void 0===L?void 0:L.toString())&&void 0!==E?E:"",isLocalConversation:!1}),G(T=[null==f?void 0:f.conversation].concat(y.map(function(e){return e.conversation})).filter(function(e){return!(0,d.default)(e)})),j(k=H(y,!1)),B(function(e){var t;return{threadFeedStatus:(0,o._)((0,i._)({loading:!1,failed:!1,count:k.length},r?{hasMore:e.threadFeedStatus.hasMore}:{hasMore:M||!1}),{isReload:!1,nextIndex:null!==(t=null==S?void 0:S.toString())&&void 0!==t?t:"",initiated:!0})}}),s.success(),[2,T];case 3:throw R=c.sent(),B(function(e){return{threadFeedStatus:(0,o._)((0,i._)({},e.threadFeedStatus),{failed:!0,loading:!1})}}),R instanceof Error&&s.error({reason:"loadThreadFeed failed",error:R}),R;case 4:return[2]}})}),loadGuestThreadFeed:(0,r._)(function(){var e,t,n,r,a,s,u,l,g,f,v,_,y,M,S,b,C,L,I,E,T,k,R,w,A=arguments;return(0,c.__generator)(this,function(c){switch(c.label){case 0:t=(e=A.length>0&&void 0!==A[0]?A[0]:{}).isReload,r=void 0!==(n=e.isRefresh)&&n,a=F().threadFeedStatus,s=(0,p.createReportEvent)({eventName:"load_guest_thread_feed",meta:{isRefresh:r,isReload:t,isInit:!a.initiated}}),B({threadFeedStatus:(0,o._)((0,i._)({},a),{loading:!0,isReload:!!t})}),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,(0,m.retryAsync)(function(){return h.FlowApi.apiService.samantha.GetTouristFeed()},3,function(e){return 1e3*e})];case 2:return u=c.sent().data,s.addDurationPoint("fetch_success"),g=(l=null!=u?u:{}).main_thread,f=l.threads,v=l.can_chat,M=void 0===(y=(_=f||{}).thread_list)?[]:y,S=_.has_more,b=_.next_index,g&&W({conversationId:null!==(E=null===(C=g.conversation)||void 0===C?void 0:C.conversation_id)&&void 0!==E?E:"",conversationType:null===(L=g.conversation)||void 0===L?void 0:L.conversation_type,threadId:null!==(T=null===(I=g.thread_id)||void 0===I?void 0:I.toString())&&void 0!==T?T:"",isLocalConversation:!1}),G(k=[null==g?void 0:g.conversation].concat(M.map(function(e){return e.conversation})).filter(function(e){return!(0,d.default)(e)})),j(R=H(M,!1)),B(function(e){var t;return{threadFeedStatus:(0,o._)((0,i._)({loading:!1,failed:!1,count:R.length},r?{hasMore:e.threadFeedStatus.hasMore}:{hasMore:S||!1}),{isReload:!1,nextIndex:null!==(t=null==b?void 0:b.toString())&&void 0!==t?t:"",initiated:!0}),chatNotReachLimit:v}}),s.success(),[2,k];case 3:throw w=c.sent(),B(function(e){return{threadFeedStatus:(0,o._)((0,i._)({},e.threadFeedStatus),{failed:!0,loading:!1})}}),w instanceof Error&&s.error({reason:"loadThreadFeed failed",error:w}),w;case 4:return[2]}})}),loadThreadList:(0,r._)(function(){var e,t,n,r,a,s,u,l,g,f,v,_,y,M,S,b,C,L=arguments;return(0,c.__generator)(this,function(c){switch(c.label){case 0:t=(e=L.length>0&&void 0!==L[0]?L[0]:{}).index,n=e.size,r=e.isReload,s=void 0!==(a=e.isRefresh)&&a,u=F().threadListStatus,l=(0,p.createReportEvent)({eventName:"load_thread_list",meta:{isRefresh:s,isReload:r,size:n,index:t,isInit:!u.initiated}}),B({threadListStatus:(0,o._)((0,i._)({},u),{loading:!0,isReload:!!r})}),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,(0,m.retryAsync)(function(){return h.FlowApi.apiService.samantha.ThreadList({index:t&&(0,m.isNumeric)(t)?Number(t):void 0,batch_size:n})},3,function(e){return 1e3*e})];case 2:return g=c.sent().data,l.addDurationPoint("fetch_success"),_=void 0===(v=(f=g||{}).thread_list)?[]:v,y=f.has_more,M=f.next_index,G(S=_.map(function(e){return e.conversation}).filter(function(e){return!(0,d.default)(e)})),j(b=H(_,!s)),B(function(e){var t;return{threadListStatus:(0,o._)((0,i._)({loading:!1,failed:!1,count:b.length},s?{hasMore:e.threadListStatus.hasMore}:{hasMore:y||!1}),{isReload:!1,nextIndex:null!==(t=null==M?void 0:M.toString())&&void 0!==t?t:"",initiated:!0})}}),l.success(),[2,S];case 3:throw C=c.sent(),B(function(e){return{threadListStatus:(0,o._)((0,i._)({},e.threadListStatus),{failed:!0,loading:!1})}}),C instanceof Error&&l.error({reason:"loadThreadList failed size:".concat(n," index:").concat(t),error:C}),C;case 4:return[2]}})}),addNewLocalConversation:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.reportEvent,n=e.conversation,r=k.useChatStore.getState().ttWidConfig.web_id,o=r&&r.length>0?"".concat(A(100,999)).concat(Math.floor(Date.now()/1e3)).concat(r):"".concat(A(1e5,999999)).concat(Date.now());return B((0,_.produce)(function(e){e.localConversationMap[o]=(0,i._)({local:{createStatus:S.CreateConversationStatus.Pending,reportEvent:t}},n)})),o},updateLocalConversation:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];B((0,_.produce)(function(r){if(n&&(null==t?void 0:t.conversation_id)){r.localConversationMap[t.conversation_id]=(0,i._)({},t),delete r.localConversationMap[e];return}Object.assign(r.localConversationMap[e]||{},t)}))},updateConversationIdInLinks:function(e,t){B((0,_.produce)(function(n){var r=n.conversationLinks.findIndex(function(t){return t.conversationId===e}),a=(0,o._)((0,i._)({},n.conversationLinks[r]),{conversationId:t,isLocalConversation:!1});n.conversationLinks[r]=a}))},fetchConversationAndUpdateLocalStatus:(n=(0,r._)(function(e){var t,n,r,i,o,a,s,u,d,g,f,v,_,p,m,y,b,C;return(0,c.__generator)(this,function(c){switch(c.label){case 0:if(t=e.token,n=e.botId,r=e.conversationId,i=e.localConversationId,o=e.messageId,s=void 0===(a=e.scene)?M.CreateScene.Default:a,u=e.createFrom,!(null==(d=F().localConversationMap[i])?void 0:d.local))return[2];g=d.local.reportEvent,c.label=1;case 1:if(c.trys.push([1,8,,9]),F().updateLocalConversation(i,{local:{createStatus:S.CreateConversationStatus.Creating,createFrom:u}}),!t)return[3,3];return[4,h.FlowApi.apiService.conversation.ConversationInfoAddBot({token:t})];case 2:return v=null===(_=c.sent())||void 0===_?void 0:_.data,[3,7];case 3:if(!n)return[3,5];return[4,h.FlowApi.apiService.conversation.ConversationInfo({bot_id:n})];case 4:return v=null===(p=c.sent())||void 0===p?void 0:p.data,[3,7];case 5:if(!r)return[3,7];return[4,h.FlowApi.apiService.conversation.CreateSubConversation({conversation_id:r,message_id:o,scene:s})];case 6:v=null===(m=c.sent())||void 0===m?void 0:m.data,c.label=7;case 7:if((y=null==v?void 0:null===(f=v.conversation)||void 0===f?void 0:f.conversation_id)&&v)F().updateConversationInfo(v),F().updateLocalConversation(i,{local:{createStatus:S.CreateConversationStatus.Done,newConversationId:y,createFrom:u}}),F().conversationListStatus.loading?b=k.useChatStore.subscribe(function(e){return{conversationListStatus:e.conversationListStatus}},function(e){!e.conversationListStatus.loading&&(null==b||b(),F().insertConversationToLinks({conversationId:y,index:1}))},{fireImmediately:!0,equalityFn:l.shallow}):F().insertConversationToLinks({conversationId:y,index:1});else throw Error("Expect newConversationId, but not found");return null==g||g.addDurationPoint("success"),null==g||g.success(),[2,v.conversation];case 8:throw C=c.sent(),F().updateLocalConversation(i,{local:{createStatus:S.CreateConversationStatus.Failed}}),C instanceof Error&&(null==g||g.error({error:C,reason:"create_conversation_error"})),C;case 9:return[2]}})}),function(e){return n.apply(this,arguments)}),removeConversationFromLinks:function(e){var t=e.conversationId,n=F().conversationLinks.findIndex(function(e){return e.conversationId===t});~n&&n&&B((0,_.produce)(function(e){return V(e,n)}))},removeConversationsFromLinks:function(e){var t=e.conversationIds,n=void 0===t?[]:t;B((0,_.produce)(function(e){var t=!1,r=e.botConversationIndex,i=e.conversationLinks.filter(function(i,o){var a=n.includes(i.conversationId);return a&&(t=!0,o>=e.threadIndex&&o<e.botConversationIndex&&(r-=1)),!a});t&&(e.conversationLinks=i,e.botConversationIndex=r)}))},insertConversationToLinks:function(e){B((0,_.produce)(function(t){return z(t,e)}))},insertNewConversationAndRemoveOldConversationFromLinks:function(e,t){B((0,_.produce)(function(n){z(n,e);var r=n.conversationLinks.findIndex(function(e){return e.conversationId===t.conversationId});V(n,r)}))},setGuestCanChat:function(e){B({guestCanChat:e})},setNotReachLimit:function(e){B({chatNotReachLimit:e})}})};function A(e,t){return e=Math.ceil(e),Math.floor(Math.random()*((t=Math.floor(t))-e+1))+e}var O=function(e){return(0,f.default)(e,"conversationId")}},20646:function(e,t,n){"use strict";n.d(t,{createConversationMapSlice:function(){return C}});var r=n("92769"),i=n("9161"),o=n("16044"),a=n("88802"),s=n("41553"),u=n("88001"),c=n("73934"),l=n("49647"),d=n("24837"),g=n("97176"),f=n("87382"),v=n("78142"),_=n("5890"),p=n("10016"),m=n("73373"),h=n("87575"),y=n("2322"),M=n("53641"),S=n("59157"),b={conversationMap:{},localConversationMap:{},lastSectionIdMap:{},lastMessageIndexMap:{},lastMessageMap:{},actionBarTemplateMap:{}},C=function(e,t){var n,C,L,I;return _.resetStoreManager.push(function(){return e(b)}),_.resetStoreManager.merge(b),(0,o._)((0,i._)({},b),{fetchUpdateConversationInfo:(n=(0,r._)(function(e){var n,r,i,o,s;return(0,a.__generator)(this,function(a){switch(a.label){case 0:n=t().prevActiveConversationId,r=(0,f.createReportEvent)({eventName:"load_conversation_info",meta:{cold_start:!n}}),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,v.FlowApi.apiService.conversation.ConversationInfo({conversation_id:e,ext:n?void 0:{cold_start:"true"}})];case 2:if(o=((i=a.sent().data)||{}).conversation,!i)throw Error("updateConversationInfo: invalid data from api");return r.addDurationPoint("success"),r.success(),t().updateConversationInfo(i),[2,o];case 3:throw s=a.sent(),r.error({reason:"load_conversation_info_failed",error:s}),s;case 4:return[2]}})}),function(e){return n.apply(this,arguments)}),updateConversationInfo:function(t){var n=t.conversation,r=t.bot_info,a=t.msg_templates,s=t.trace_map,u=(n||{}).conversation_id;if(!u||!n||!r){f.logger.persist.warning({message:"invalid conversationInfo to update",meta:{conversationInfo:t}});return}e((0,g.produce)(function(e){e.conversationMap[u]=n,(null==r?void 0:r.id)&&M.FlowBot.actions.updateBot(r),n.last_section_id&&(e.lastSectionIdMap[u]=n.last_section_id),a&&(e.actionBarTemplateMap[u]=a.map(function(e){return(0,o._)((0,i._)({},e),{req_id:null==s?void 0:s.request_id})})),e.lastMessageIndexMap[u]={message_index:Number(n.message_index)||0,read_message_index:Number(n.read_message_index)||0}}))},updateLastSectionId:function(t,n){e((0,g.produce)(function(e){n&&(e.lastSectionIdMap[t]=n)}))},clearContext:(C=(0,r._)(function(e){var n,r,i;return(0,a.__generator)(this,function(o){switch(o.label){case 0:return[4,v.FlowApi.apiService.conversation.CreateSection({conversation_id:e})];case 1:return(i=null==(r=o.sent())?void 0:null===(n=r.data)||void 0===n?void 0:n.section_id)&&(t().updateLastSectionId(e,i),(0,S.handleLocalBreak)(e||"")),[2]}})}),function(e){return C.apply(this,arguments)}),updateConversationMessageIndex:function(t){var n=t.conversationId,r=t.messageIndex,i=t.readMessageIndex;e((0,g.produce)(function(e){var t=e.lastMessageIndexMap[n];t&&r&&Number(t.message_index)<r&&(t.message_index=r),t&&i&&Number(t.read_message_index)<i&&(t.read_message_index=i)}))},removeConversationFromMap:function(t){var n=t.conversationId;e((0,g.produce)(function(e){(0,p.deleteConversationInMap)(e,n)}))},removeConversationsFromMap:function(t){var n=t.conversationIds;e((0,g.produce)(function(e){n.forEach(function(t){(0,p.deleteConversationInMap)(e,t)})}))},fetchLastMessages:(L=(0,r._)(function(e){var n,r,i,o,g,f,_,p,M,S,b,C,L,I;return(0,a.__generator)(this,function(a){switch(a.label){case 0:return n=e.conversationIds,i=void 0===(r=e.retryCount)?2:r,[4,v.FlowApi.apiService.message.LatestMessageList({request_list:n.map(function(e){return{conversation_id:e}})})];case 1:if(_=void 0===(f=(g=void 0===(o=a.sent().data)?{}:o).message_map)?{}:f,M=void 0===(p=g.regen_map)?{}:p,b=void 0===(S=g.retry_list)?null:S,C=(0,s.default)(_,M,function(e,t){return(0,u.default)(e,t,function(e){return e.message_id})}),L=Object.fromEntries((0,c.default)((0,l.default)(C),function(e){var t=(0,d.default)(C[e],function(e){return e.index}),n=t?(0,m.normalizeMessage)(t,{from:y.MessageFrom.Api}):null;return[e,n&&(0,h.isMessageAvailable)(n)?n:void 0]})),!((null==b?void 0:b.length)&&i>0))return[3,3];return[4,t().fetchLastMessages({conversationIds:b.map(String),retryCount:i-1})];case 2:I=a.sent(),Object.assign(L,I),a.label=3;case 3:return[2,L]}})}),function(e){return L.apply(this,arguments)}),updateLastMessageMap:(I=(0,r._)(function(n){var r,i;return(0,a.__generator)(this,function(o){switch(o.label){case 0:return r=n.conversationIds,[4,t().fetchLastMessages({conversationIds:r,retryCount:2})];case 1:return i=o.sent(),e((0,g.produce)(function(e){e.lastMessageMap=i})),[2]}})}),function(e){return I.apply(this,arguments)})})}},37674:function(e,t,n){"use strict";n.d(t,{createConversationRecorderSlice:function(){return r}});var r=function(e,t){return{prevActiveConversationId:null,currentActiveConversationId:null,setActiveConversation:function(n){e({prevActiveConversationId:t().currentActiveConversationId,currentActiveConversationId:n})}}}},9668:function(e,t,n){"use strict";n.d(t,{ConversationType:function(){return s},CreateConversationStatus:function(){return a},LoadConversationListType:function(){return u}});var r,i,o,a=((r={}).Pending="Pending",r.Creating="Creating",r.Done="Done",r.Failed="Failed",r);var s=((i={}).LocalConversation="LocalConversation",i.Conversation="Conversation",i);var u=((o={}).Bot="bot",o.Feed="feed",o.Thread="thread",o.Guest="guest",o)},67028:function(e,t,n){"use strict";n.d(t,{createChatGlobalSlice:function(){return c}});var r=n("9161"),i=n("16044"),o=n("97176"),a=n("5890"),s=n("10173"),u=(0,r._)({userInfo:{secUserId:void 0},systemConfig:{modelList:[],voiceList:[],canDebug:!1,unlikeFeedbackMeta:[],likeFeedbackMeta:[],feedbackPlaceholder:"",botReportMeta:[],messageReportMeta:[],uploadFileAllowedTypes:[],botLanguageList:[],uploadFileMaxSize:s.defaultUploadFileMaxSize,saveChatHistoryPopupEnable:!1},socketStatus:{loading:!1,connected:!1},rateLimitConfig:{isLimited:!1,limitExpired:void 0,limitTips:""},ttWidConfig:{},musicAutoPlay:!1},{}),c=function(e){return a.resetStoreManager.push(function(){return e(u)}),a.resetStoreManager.merge(u),(0,i._)((0,r._)({},u),{setSocketStatus:function(t){e(function(){return{socketStatus:t}})},updateRateLimitConfig:function(t){return e(function(){return{rateLimitConfig:t}})},setMusicAutoPlay:function(t){e(function(){return{musicAutoPlay:t}})},updateSystemConfig:function(t){e(function(){return{systemConfig:t}})},updateTtWidConfig:function(t){e(function(){return{ttWidConfig:t}})},updateUserData:function(t){e(function(){return{userInfo:t}})},updateCiciQuotaConfig:function(t){e(function(){return{userOgfQuota:t}})},updateCiciOgfQuota:function(t){e((0,o.produce)(function(e){e.userOgfQuota.ogfQuota=t}))},updateCiciQuotaSwitchState:function(t){e((0,o.produce)(function(e){e.userOgfQuota.quotaSwitchConfig.value=t}))},updateCiciQuotaSwitchConfig:function(t){e((0,o.produce)(function(e){e.userOgfQuota.quotaSwitchConfig=t}))},updateCiciQuotaNextState:function(t){e((0,o.produce)(function(e){e.userOgfQuota.nextMessageUseOgf=t}))}})}},62920:function(e,t,n){"use strict";n.d(t,{initChatStore:function(){return m},resetChatStore:function(){return _},useChatStore:function(){return p}});var r=n("9161"),i=n("6462"),o=n("37222"),a=n("85205"),s=n("5890"),u=n("34749"),c=n("31728"),l=n("67028"),d=n("32237"),g=n("54596"),f=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,r._)({},d.createConversationSlice.apply(void 0,(0,i._)(t)),c.createMessageSlice.apply(void 0,(0,i._)(t)),l.createChatGlobalSlice.apply(void 0,(0,i._)(t)),g.createChatInputSlice.apply(void 0,(0,i._)(t)))},v=function(e){var t=e.name,n=e.storage,r=e.isEnableDebug,i=e.merge,s=e.partialize,c=e.reduxDevToolsSnapshot,l=(0,u.createPersistOptions)({name:t,storage:n,merge:i,partialize:s}),d=(0,o.persist)((0,o.subscribeWithSelector)(f),l);return r&&c?(0,a.create)()((0,o.devtools)(d,{name:"flow-web-chat-store"})):(0,a.create)()(d)},_=function(){return s.resetStoreManager.resetAllSlice()},p=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=p.prototype._useChatStore;if(r)return r.apply(void 0,(0,i._)(t));throw Error("useChatStore is not initialized")};function m(e){if((p.prototype||{})._useChatStore)s.resetStoreManager.resetAllSlice();else{var t=v(e);Object.setPrototypeOf(p.prototype,t),Object.defineProperties(p,(0,r._)({},Object.getOwnPropertyDescriptors(t))),p.prototype._useChatStore=t}}},81590:function(e,t,n){"use strict";n.d(t,{createFeedbackSlice:function(){return d}});var r=n("92769"),i=n("9161"),o=n("16044"),a=n("88802"),s=n("97176"),u=n("78142"),c=n("5890"),l={messageFeedbackMap:{}},d=function(e){return c.resetStoreManager.push(function(){return e(l)}),c.resetStoreManager.merge(l),(0,o._)((0,i._)({},l),{updateMessageFeedback:function(t){var n=t.conversationId,i=t.messageId,o=t.detail,c=t.reportEvent,l=t.onlyLocal,d=void 0!==l&&l;return(0,r._)(function(){var t;return(0,a.__generator)(this,function(r){switch(r.label){case 0:if(r.trys.push([0,3,,4]),d)return[3,2];return[4,u.FlowApi.apiService.message.MessageReport({message_id:i,action:"feedback",feedbackDetail:o})];case 1:r.sent(),r.label=2;case 2:return e((0,s.produce)(function(e){var t=e.messageFeedbackMap;!t[n]&&(t[n]={}),t[n][i]=o})),null==c||c.success(),[3,4];case 3:return(t=r.sent())instanceof Error&&(null==c||c.error({reason:"message report failed",error:t})),[3,4];case 4:return[2]}})})()}})}},72951:function(e,t,n){"use strict";n.d(t,{createMessageAtomSlice:function(){return U},deleteLocalOnboarding:function(){return A},deleteLocalReplyMessageByReplyId:function(){return F},deleteMessageInLocalMessageMapByReplyId:function(){return N},deleteMockReplyMessage:function(){return B},logicalDeleteMessage:function(){return w},moveReportEvents:function(){return P},physicalDeleteMessage:function(){return R},replaceLocalMessageByRemote:function(){return x}});var r=n("92769"),i=n("83316"),o=n("9161"),a=n("16044"),s=n("40509"),u=n("88802"),c=n("43875"),l=n("46593"),d=n("80613"),g=n("83911"),f=n("40521"),v=n("1107"),_=n("97176"),p=n("87382"),m=n("68534"),h=n("78142"),y=n("2322"),M=n("46750"),S=n("73373"),b=n("5890"),C=n("87575"),L=n("68602"),I=n("10016"),E=n("69218"),T=n("10173"),k={messageMap:{},localMessageMap:{},messageLinkMap:{},messageListStatusMap:{},regenerateMessageMap:{},chunkTaskMap:{},searchResultIsFinishedMap:{},messageReportEventMap:{}};function R(e,t){var n=e.draftLocalMessageMap,r=e.draftMessageMap,i=e.draftMessageLinks,o=t.isLocalMessage,a=t.messageId;return o?delete n[a]:delete r[a],(0,c.default)(i,function(e){return e.messageId===a})}function w(e,t){var n=t.isLocalMessage,r=t.messageId,i=e.draftLocalMessageMap,o=e.draftMessageMap;n&&i[r]?i[r].status=m.PushMessageStatus.InVisible:o[r]&&(o[r].status=m.PushMessageStatus.InVisible)}function A(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=(0,M.getTemporaryReplyMessageId)(T.onBoardingConstantMessageId);null==t||t.error({reason:n});var i=R(e,{isLocalMessage:!0,messageId:r});i>-1&&e.draftMessageLinks.splice(i,1)}var O=function(e,t){var n=(0,o._)({},e.ext?e.ext:{},t.ext||{});return(e.content_type===m.ContentType.Image||e.content_type===m.ContentType.File)&&t.content?(0,S.normalizeMessage)((0,a._)((0,o._)({},(0,l.default)(e,["local","local_message_id"]),(0,d.default)(t,g.default)),{ext:n})):(0,a._)((0,o._)({},(0,l.default)(e,["local","local_message_id"]),(0,d.default)(t,g.default)),{ext:n})};function P(e){var t=e.draft,n=e.localMessage,r=e.message,i=e.omitReportEventProperty,o=r.message_id,a=n.local_message_id;if(!o||!a){p.logger.warning("skip moveReportEvents: invalid remote/local message");return}t.draftMessageReportEventMap[o]=(0,l.default)(t.draftMessageReportEventMap[a],void 0===i?[]:i)}function x(e){var t,n,r=e.draft,i=e.localMessage,o=e.message,a=e.useRemoteMessageKey,s=o.message_id,u=i.local_message_id;if(!s||!u){p.logger.warning("skip replaceLocalMessageWithRemoteMessage: invalid remote/local message");return}r.draftMessageMap[s]=O(i,o);var c=R(r,{isLocalMessage:!0,messageId:u});if(c>-1)return null===(t=r.draftMessageLinks.splice(c,1,{isLocalMessage:!1,messageId:s,messageKey:void 0===a||a?s:u,regen_head:null===(n=r.draftMessageLinks[c])||void 0===n?void 0:n.regen_head}))||void 0===t?void 0:t[0];p.logger.persist.warning({message:"not found local message to replace",meta:{localMessageId:u}})}var U=function(e,t){var n,s;return b.resetStoreManager.push(function(){return e(k)}),b.resetStoreManager.merge(k),(0,a._)((0,o._)({},k),{fetchMessageList:(n=(0,r._)(function(e){var t,n,r,i,o,a,s,c;return(0,u.__generator)(this,function(u){switch(u.label){case 0:if(t=e.conversationId,n=e.cursor,r=e.size,n<=0||r<=0)return p.logger.warning({message:"fetchUpdateMessageList: invalid cursor input",meta:{conversationId:t,cursor:n}}),[2];u.label=1;case 1:return u.trys.push([1,3,,4]),[4,h.FlowApi.apiService.message.MessageList({conversation_id:t,cursor:n,batch_size:r})];case 2:return a=((null==(o=(i=u.sent()).data)?void 0:o.message_list)||[]).reverse().filter(function(e){return!!(0,C.isRegenerateMessage)(e)||!(0,C.isStreamingMessage)(e)&&!0}),s={from:y.MessageFrom.Api,logId:(0,E.getLogIdFromResponse)(i)},[2,{messages:a.map(function(e){return(0,S.normalizeMessage)(e,s)}),messageLinks:a.map(function(e){return{messageId:e.message_id||"",isLocalMessage:!1}}),regenerateList:((null==o?void 0:o.regen_list)||[]).reverse().map(function(e){return(0,S.normalizeMessage)(e,s)})}];case 3:throw(c=u.sent())instanceof Error&&p.logger.persist.error({message:"fetchUpdateMessageList failed",error:c}),c;case 4:return[2]}})}),function(e){return n.apply(this,arguments)}),fetchEnoughMessageList:(s=(0,r._)(function(e){var n,r,i,o,a,s,c,l,d,g;return(0,u.__generator)(this,function(u){switch(u.label){case 0:n=e.conversationId,r=e.cursor,i=e.size,o=[],a=0,s=r,c=!0,l=5,u.label=1;case 1:if(!c)return[3,3];return[4,t().fetchMessageList({conversationId:n,cursor:s,size:i})];case 2:if(d=u.sent(),o.push(d),c=!1,!d)return[2];return d.messages.length===i&&(g=d.messages.filter(C.isMessageAvailable).length,(a+=g)<T.defaultCheckAvailableMessageSize&&(p.logger.persist.warning({message:"fetchEnoughMessageList: auto load more",meta:{fetchSize:d.messages.length,currentFetchAvailableMessageSize:g,fetchAvailableSize:a}}),s-=i,c=!0)),c&&o.length>=l&&(c=!1,p.logger.persist.warning({message:"fetchEnoughMessageList: break by maxTry",meta:{fetchAvailableSize:a}})),[3,1];case 3:return[2,1===o.length?o[0]:o.reduceRight(function(e,t){return t&&(e.messageLinks=e.messageLinks.concat(t.messageLinks),e.messages=e.messages.concat(t.messages),e.regenerateList=e.regenerateList.concat(t.regenerateList)),e},{messages:[],messageLinks:[],regenerateList:[]})]}})}),function(e){return s.apply(this,arguments)}),logicalDeleteMessage:function(e){var n=e.conversationId,r=e.messageLink,i=e.deleteReply,o=void 0!==i&&i;t().createUpdateMessageList(n)(function(e){if(w(e,r),o){var t=(0,L.findAllMessageLinkByMatchEqualId)({replyId:r.messageId,messageLinks:e.draftMessageLinks,getMessage:(0,M.createGetMessage)({localMessageMap:e.draftLocalMessageMap,messageMap:e.draftMessageMap})});(null==t?void 0:t.length)&&t.forEach(function(t){return w(e,t)})}})},clearConversationMessages:function(t){e((0,_.produce)(function(e){return(0,I.deleteConversationMessages)(e,t)}))},updateMessageList:function(t){var n=t.conversationId,r=t.immerUpdate;e((0,_.produce)(function(e){!e.messageMap[n]&&(e.messageMap[n]={}),!e.localMessageMap[n]&&(e.localMessageMap[n]={}),!e.messageReportEventMap[n]&&(e.messageReportEventMap[n]={}),!e.regenerateMessageMap[n]&&(e.regenerateMessageMap[n]={messageMap:{}}),!e.messageListStatusMap[n]&&(e.messageListStatusMap[n]={hasMore:!1,lastCursor:0,loading:!1}),!Array.isArray(e.messageLinkMap[n])&&(e.messageLinkMap[n]=[]);var t=function(e,t){var n=t.regenerateMessageMap,r=t.messageMap,i=t.messageLinkMap,a=t.messageListStatusMap;return{overrideMessages:function(t){Array.isArray(t)&&t.forEach(function(t){t.message_id&&(r[e][t.message_id]=t)})},overrideMessageLinks:function(t){i[e]=t},overrideRegenerateMessagesAndUpdateLink:function(t){if((0,f.default)(t)&&(null==t?void 0:t.length)){if(n[e]){var r,o,a=Object.values(n[e].messageMap);(null===(r=t[0])||void 0===r?void 0:r.reply_id)!==(null===(o=a[0])||void 0===o?void 0:o.reply_id)&&(n[e]={messageMap:{}})}else n[e]={messageMap:{}};var s=(0,v.default)(i[e],"messageId");t.forEach(function(t,r,i){var o,a=t.message_id;a&&(n[e].messageMap[a]=t,s[a]&&(s[a].regen_head=null===(o=i[0])||void 0===o?void 0:o.message_id))})}},resetMessageLink:function(t){var n=t.messageId,r=null!==(u=null===(s=i[e])||void 0===s?void 0:null===(a=s.findIndex)||void 0===a?void 0:a.call(s,function(e){return n===e.messageId}))&&void 0!==u?u:-1;if(~r){var a,s,u,c,l=i[e][r];null===(c=i[e])||void 0===c||c.splice(r,1,(0,o._)({},l))}},setMessageStatus:function(t){a[e]=t}}}(n,e);r({draftMessageMap:e.messageMap[n],draftLocalMessageMap:e.localMessageMap[n],draftMessageLinks:e.messageLinkMap[n],draftMessageListStatus:e.messageListStatusMap[n],draftRegenerateMessageMap:e.regenerateMessageMap[n],draftMessageReportEventMap:e.messageReportEventMap[n]},t)}))},createUpdateMessageList:function(e){return function(n){return t().updateMessageList({conversationId:e,immerUpdate:n})}},updateChunkTask:function(n,r){return e((0,_.produce)(function(e){n&&e.chunkTaskMap[n]&&(e.chunkTaskMap[n].completionMessageMap[r.message_id||T.thinkingConstantMessageId]=r)})),t().chunkTaskMap[n]},createChunkTask:function(n,r){return t().chunkTaskMap[n]?t().chunkTaskMap[n]:(e((0,_.produce)(function(e){if(n){var t=r.message_id,o={chunkSeq:Number((null==r?void 0:r.chunk_seq)||0),replyId:n,conversationId:(null==r?void 0:r.conversation_id)||"",completionMessageMap:(0,i._)({},t||T.thinkingConstantMessageId,r)};e.chunkTaskMap[n]=o}})),t().chunkTaskMap[n])},removeChunkTask:function(t){e((0,_.produce)(function(e){delete e.chunkTaskMap[t]}))},getSearchResultStatus:function(e){return t().searchResultIsFinishedMap[e]},updateSearchResultStatus:function(t,n){e((0,_.produce)(function(e){e.searchResultIsFinishedMap[t]=n}))},getReportEvents:function(e,n){var r;return(null===(r=t().messageReportEventMap[e])||void 0===r?void 0:r[n])||{}},setReportEvents:function(t,n,r){e((0,_.produce)(function(e){!e.messageReportEventMap[t]&&(e.messageReportEventMap[t]={}),e.messageReportEventMap[t][n]=r}))},mergeReportEvents:function(t,n,r){e((0,_.produce)(function(e){!e.messageReportEventMap[t]&&(e.messageReportEventMap[t]={}),e.messageReportEventMap[t][n]=(0,o._)({},e.messageReportEventMap[t][n],r)}))}})};function B(e,t){var n=e.draftLocalMessageMap[T.mockReplyConstantMessageId],r=null==n?void 0:n.reply_id;if((0,g.default)(t)||(0,g.default)(r)||t===r){var i=(0,c.default)(e.draftMessageLinks,function(e){return e.messageId===T.mockReplyConstantMessageId});if(~i){var o=e.draftMessageLinks[i].messageId;return R(e,{isLocalMessage:!0,messageId:o}),e.draftMessageLinks.splice(i,1)}}}function F(e,t){if(t){var n=(0,M.createGetMessage)({localMessageMap:e.draftLocalMessageMap,messageMap:e.draftMessageMap});(0,L.findAllMessageLinkByMatchEqualId)({messageLinks:e.draftMessageLinks,getMessage:n,replyId:t}).forEach(function(t){R(e,{isLocalMessage:!0,messageId:t.messageId});var n=e.draftMessageLinks.findIndex(function(e){return e.messageId===t.messageId});-1!==n&&e.draftMessageLinks.splice(n,1)})}}function N(e,t){t&&Object.entries(e.draftLocalMessageMap).forEach(function(n){var r=(0,s._)(n,2),i=r[0];r[1].reply_id===t&&R(e,{isLocalMessage:!0,messageId:i})})}},8026:function(e,t,n){"use strict";n.d(t,{createMessagePreprocessSlice:function(){return h}});var r=n("92769"),i=n("83316"),o=n("9161"),a=n("16044"),s=n("88802"),u=n("32023"),c=n("59574"),l=n("97176"),d=n("87382"),g=n("78142"),f=n("68534"),v=n("31566"),_=n("52420"),p=n("11372"),m={preprocessTaskMap:{},uploaderToken:{}},h=function(e,t){var n,h,y,M,S=function(t){var n=t.ctx,r=t.preParse,i=t.file,o=(0,d.createReportEvent)({eventName:"attachment_upload",meta:{upload_type:t.type,upload_from:t.ctx.uploadFrom}}),a=function(t,n){return function(r){e((0,l.produce)(function(e){var i=e.preprocessTaskMap[t];i&&n(r,i)}))}};return{complete:a(t.local_key,function(e,a){if(a.loading=!1,a.failed=!1,e){var s;a.percent=e.percent,a.uploadResult=e.uploadResult,a.key=e.uploadResult.ImageUri||"",a.fileKey=e.key,o.addDurationPoint("success"),o.success({meta:{upload_file_size:e.fileSize}}),v.FlowTea.trackEvent("upload_attachment_status",{bot_id:n.botId,current_page:"chat",message_type:"file"===t.type?"file":"pic",message_type_detail:i&&"name"in i?null===(s=(null==i?void 0:i.name).match(/\.([^.]+)$/))||void 0===s?void 0:s[1].toLowerCase():"",enter_method:n.from,uri:e.uploadResult.ImageUri||"",success:"1"}),v.FlowTea.trackEvent("upload_status",{status:"1",conversation_id:n.conversationId,conversation_type:(0,p.getConversationTypeById)(n.conversationId)||1,module_actionid:n.moduleActionId,bot_id:n.botId,current_page:"chat",chat_type:n.chatType,skill_name:(n.skillType||0).toString(),skill_id:n.skillId,upload_id:t.fileKey,duration:e.duration.toString(),upload_type:"file"===t.type?"pdf":"pic",upload_file_size:e.fileSize,upload_from:n.uploadFrom}),r&&g.FlowApi.apiService.message.MessagePreHandle({content:JSON.stringify({file_list:[{file_name:i&&"name"in i?null==i?void 0:i.name:"",key:e.uploadResult.ImageUri||""}]}),content_type:f.ContentType.File})}}),progress:a(t.local_key,function(e,t){t.loading=!0,t.failed=!1,e&&(t.percent=e.percent,t.fileKey=e.key)}),error:a(t.local_key,function(e,r){if(r.loading=!1,r.failed=!0,r.uploadResult=void 0,r.key="",e){var i,a;r.fileKey=e.key,o.error({reason:"upload attachment failed",meta:{upload_file_size:e.fileSize}}),v.FlowTea.trackEvent("upload_file_status",{bot_id:n.botId,current_page:"chat",message_type:t.type,enter_method:n.from,success:"0",result:null!==(a=null===(i=e.extra)||void 0===i?void 0:i.message)&&void 0!==a?a:""}),v.FlowTea.trackEvent("upload_status",{status:"0",conversation_id:n.conversationId,conversation_type:(0,p.getConversationTypeById)(n.conversationId)||1,module_actionid:n.moduleActionId,bot_id:n.botId,current_page:"chat",chat_type:n.chatType,skill_name:n.skillType?n.skillType.toString():"",skill_id:n.skillId,upload_id:t.fileKey,duration:e.duration.toString(),upload_type:"file"===t.type?"pdf":"pic",upload_file_size:e.fileSize,upload_from:n.uploadFrom})}})}};var b=(n=null,y=(h=(0,r._)(function(){var t,r,i;return(0,s.__generator)(this,function(i){switch(i.label){case 0:return[4,g.FlowApi.apiService.resource.GetUploadAuthToken({scene:"bot_chat",data_type:"image"})];case 1:t=i.sent().data,i.label=2;case 2:return i.trys.push([2,4,,5]),[4,g.FlowApi.apiService.resource.GetUploadAuthToken({scene:"bot_chat",data_type:"file"})];case 3:return r=i.sent().data,[3,5];case 4:return i.sent(),[3,5];case 5:return e(function(){return{uploaderToken:{image:t,file:r}}}),n=null,[2]}})}),function(){return h.apply(this,arguments)}),function(){return null!=n?n:n=y()}),C=void 0;var L=(M=(0,r._)(function(e){var n;return(0,s.__generator)(this,function(r){switch(r.label){case 0:if(C&&!C["file"===e?"fileConfigExpired":"imageConfigExpired"])return[2,C];if(null==C?void 0:C.client)return[3,4];if(!(0,c.default)(t().uploaderToken))return[3,2];return[4,b()];case 1:r.sent(),r.label=2;case 2:return[4,_.FlowConfig.createUploader({imageConfig:t().uploaderToken.image,fileConfig:t().uploaderToken.file,userId:null!==(n=_.FlowConfig.userId)&&void 0!==n?n:"",appId:_.FlowConfig.appId})];case 3:C=r.sent(),r.label=4;case 4:if(!C["file"===e?"fileConfigExpired":"imageConfigExpired"])return[3,6];return[4,b()];case 5:r.sent(),C.updateImageConfig(t().uploaderToken.image),C.updateFileConfig(t().uploaderToken.file),r.label=6;case 6:return[2,C]}})}),function(e){return M.apply(this,arguments)});return(0,a._)((0,o._)({},m),{refreshUploadToken:b,preprocessFile:function(t,n,r,s){var c,l,d,g,f=(c=t,l=n,d=r,g=s,{type:l,key:"",local_key:(0,u.default)(),percent:0,blobUrl:URL.createObjectURL(c),loading:!0,failed:!1,fileKey:"",file:c,ctx:d,preParse:g});e(function(e){var t=e.preprocessTaskMap;return{preprocessTaskMap:(0,a._)((0,o._)({},t),(0,i._)({},f.local_key,f))}});var v=S(f);return L(n).then(function(e){return null==e?void 0:e["file"===n?"uploadFile":"uploadImage"](t,{complete:v.complete,progress:v.progress,error:v.error})},function(){return v.error()}),{local_key:f.local_key,key:f.key}},reUpload:function(e){var n=t().preprocessTaskMap[e];if(!n){d.logger.persist.warning({eventName:"reUpload_mismatch_preprocessTask",meta:{local_key:e}});return}var r=S(n);r.progress(),L(n.type).then(function(e){var t;return null==e?void 0:null===(t=e.client)||void 0===t?void 0:t.start()},function(){return r.error()})},cancel:function(e){var t;null==C||null===(t=C.client)||void 0===t||t.cancel(e)}})}},31728:function(e,t,n){"use strict";n.d(t,{createMessageSlice:function(){return R}});var r=n("92769"),i=n("9161"),o=n("16044"),a=n("40509"),s=n("6462"),u=n("88802"),c=n("83911"),l=n("87382"),d=n("78597"),g=n("78142"),f=n("2322"),v=n("5472"),_=n("8026"),p=n("72951"),m=n("81590"),h=n("87575"),y=n("46750"),M=n("37422"),S=n("73874"),b=n("73373"),C=n("68602"),L=n("52420"),I=n("69218"),E=n("10173"),T=n("53277");function k(e,t,n){return e.filter(function(e){if(e.isLocalMessage){var r=t(e);if(!(null==r?void 0:r.message_id)&&(null==r?void 0:r.sec_sender)===E.localUser&&(0,h.isInPreProcessLocalMessage)(r))return n(r.localContent)}return!0})}var R=function(){for(var e,t,n,R,w,A=arguments.length,O=Array(A),P=0;P<A;P++)O[P]=arguments[P];var x=(0,a._)(O,2)[1];var U=(e=(0,r._)(function(e){var t,n,r,i,o,a,s;return(0,u.__generator)(this,function(u){switch(u.label){case 0:return t=e.conversationId,n=e.messageCursor,r=e.messageIndex,i=e.range,o=E.defaultFetchMessageSize,[4,x().fetchMergeMessageList({conversationId:t,cursor:r,size:o,range:i,checkMessageHole:!0})];case 1:return 0===(s=null!==(a=u.sent())&&void 0!==a?a:[]).length&&l.logger.persist.warning({message:"initMessageList empty",meta:{messageCursor:n,messageIndex:r}}),x().refreshSuggestMessage({conversationId:t}),[2,s]}})}),function(t){return e.apply(this,arguments)});return(0,o._)((0,i._)({},v.createSuggestMessageSlice.apply(void 0,(0,s._)(O)),p.createMessageAtomSlice.apply(void 0,(0,s._)(O)),m.createFeedbackSlice.apply(void 0,(0,s._)(O)),_.createMessagePreprocessSlice.apply(void 0,(0,s._)(O))),{fetchMergeMessageList:(t=(0,r._)(function(e){var t,n,r,i,o,a,s,c,d,g,f,v;return(0,u.__generator)(this,function(u){switch(u.label){case 0:if(t=e.conversationId,n=e.cursor,r=e.size,o=void 0===(i=e.actionName)?"fetchMergeMessageList":i,a=e.range,c=void 0!==(s=e.checkMessageHole)&&s,d=x().createUpdateMessageList(t),r<=0)return l.logger.persist.warning("skip ".concat(o,": invalid size")),[2];g={conversationId:t,cursor:n,size:r},u.label=1;case 1:return u.trys.push([1,3,,4]),[4,x().fetchEnoughMessageList(g)];case 2:if(!(f=u.sent())||!(null===L.FlowConfig||void 0===L.FlowConfig?void 0:L.FlowConfig.isGuest)&&f.messageLinks.length<0)return[2];return d(function(e,t){var n=e.draftMessageLinks,i=e.draftMessageMap,s=e.draftLocalMessageMap,u=(0,y.createGetMessage)({localMessageMap:s,messageMap:i});t.overrideMessages(f.messages);var d=(0,M.mergeMessageLinks)(f.messageLinks,n,u);c&&(d=(0,S.checkAndFixMessagesHole)(d,u)),d=k(d,u,function(e){var t=e.preprocess_key;return!!x().preprocessTaskMap[t]}),t.overrideMessageLinks(d);var v=a?(0,y.getMessageListStatusByRange)({messageLinks:d,getMessage:u,range:a}):(0,y.getMessageListStatusByFetchResult)({messageLinks:f.messageLinks,getMessage:u,size:r});t.setMessageStatus(v),t.overrideRegenerateMessagesAndUpdateLink(f.regenerateList),l.logger.info({message:"".concat(o," finish"),meta:{messages:f.messages,status:v,requestPayload:g}})}),[2,f.messageLinks];case 3:throw(v=u.sent())instanceof Error&&l.logger.persist.error({message:"".concat(o," failed"),error:v,meta:{request:g}}),v;case 4:return[2]}})}),function(e){return t.apply(this,arguments)}),initMessageList:(n=(0,r._)(function(e){var t,n,r,a,s,c,g,f,v,_,p;return(0,u.__generator)(this,function(u){switch(u.label){case 0:t=e.messageCursor,n=e.messageIndex,r=e.conversationId,a=5,s=x().createUpdateMessageList(r),(!Array.isArray(c=x().messageLinkMap[r])||0===c.length)&&s(function(e){e.draftMessageListStatus.loading=!0}),u.label=1;case 1:if(u.trys.push([1,15,16,17]),!(1===t&&0===n))return[3,11];g=0,u.label=2;case 2:if(!(g<a))return[3,10];f=500*Math.pow(2,g),u.label=3;case 3:return u.trys.push([3,5,,9]),[4,U((0,o._)((0,i._)({},e),{messageCursor:1,messageIndex:1}))];case 4:if(v=u.sent(),!(null===L.FlowConfig||void 0===L.FlowConfig?void 0:L.FlowConfig.isGuest)&&!(null==v?void 0:v.length))throw Error("Empty MessageList when invoke _initMessageList");return[2,v];case 5:if(_=u.sent(),g!==a-1)return[3,6];throw _;case 6:return[4,(0,d.timeoutPromise)(f)];case 7:u.sent(),u.label=8;case 8:return[3,9];case 9:return g++,[3,2];case 10:return[3,14];case 11:if(!(n<=0||n<t))return[3,12];return l.logger.persist.warning({message:"skip initMessageList",meta:{messageCursor:t,messageIndex:n}}),[2];case 12:return[4,U(e)];case 13:return[2,u.sent()];case 14:return[3,17];case 15:return p=u.sent(),l.logger.persist.error({eventName:"init_message_list_error",error:p}),[3,17];case 16:return s(function(e){e.draftMessageListStatus.loading=!1}),[7];case 17:return[2]}})}),function(e){return n.apply(this,arguments)}),refreshSuggestMessage:function(e){var t=e.conversationId,n=(0,T.findLastAvailableMessageFromStore)(t).lastAvailableMessage;n&&x().updateSuggestMessageWithRemote(t,n)},loadMoreMessageList:(R=(0,r._)(function(e){var t,n,r;return(0,u.__generator)(this,function(i){switch(i.label){case 0:if(!(t=x().messageListStatusMap[e])||t.lastCursor<=0)return l.logger.persist.warning("skip loadMoreMessageList: invalid status"),[2];return n=E.defaultFetchMessageSize,[4,x().fetchMergeMessageList({conversationId:e,cursor:t.lastCursor-1,size:n})];case 1:return r=i.sent(),(0,c.default)(r)&&l.logger.persist.warning({message:"skip loadMoreMessageList: invalid api response",meta:{}}),[2,r]}})}),function(e){return R.apply(this,arguments)}),initOnboarding:function(e){var t=e.conversationId;x().updateMessageList({conversationId:t,immerUpdate:function(e){var n=x().getReportEvents(t,E.onBoardingConstantMessageId);(0,p.deleteLocalOnboarding)(e,n.receiving_onboarding,"cancel duplicated onboarding");var r=(0,y.getTemporaryReplyMessageId)(E.onBoardingConstantMessageId);e.draftLocalMessageMap[r]=(0,b.createLocalMessage)({localMessageStatus:f.LocalMessageStatus.ReceivingFirstPackage,message:{conversation_id:t,local_message_id:r,reply_id:E.onBoardingConstantMessageId,ext:{onboarding:"1"}},failedExpired:Date.now()+E.onboardingWaitTimeout,messageLinks:e.draftMessageLinks,isRegenerate:!1}),e.draftMessageReportEventMap[r]={receiving_onboarding:(0,l.createReportEvent)({eventName:"receiving_onboarding",meta:{conversation_id:t,message_id:E.onBoardingConstantMessageId,is_regenerate:!1}})},e.draftMessageLinks.push({isLocalMessage:!0,messageId:r})}})},cancelOnboarding:function(e){var t=e.conversationId,n=e.reason;x().updateMessageList({conversationId:t,immerUpdate:function(e){var r=x().getReportEvents(t,E.onBoardingConstantMessageId);(0,p.deleteLocalOnboarding)(e,r.receiving_onboarding,n)}})},checkExistRemoteMessage:function(e){var t=e.conversationId,n=e.messageId,r=(0,y.createGetMessage)({localMessageMap:x().localMessageMap[t],messageMap:x().messageMap[t]}),i=x().messageLinkMap[t];return!!(0,C.findLastMessageLinkByMatchEqualId)({messageLinks:i,replyId:n,getMessage:r})},fetchAssistantMessageListWithBotId:(w=(0,r._)(function(e){var t,n,r,i,o,a,s,c,l,d,v;return(0,u.__generator)(this,function(u){switch(u.label){case 0:t=e.botId,n=x().createUpdateMessageList(E.assistantConvIdWithoutCache),(!Array.isArray(r=x().messageLinkMap[E.assistantConvIdWithoutCache])||0===r.length)&&n(function(e){e.draftMessageListStatus.loading=!0}),u.label=1;case 1:return u.trys.push([1,3,,4]),[4,g.FlowApi.apiService.message.MessageList({cursor:1e4,batch_size:E.defaultFetchMessageSize,bot_id:t,conversation_id:"0"})];case 2:return a=((null==(o=(i=u.sent()).data)?void 0:o.message_list)||[]).reverse().filter(function(e){return!!(0,h.isRegenerateMessage)(e)||!(0,h.isStreamingMessage)(e)&&!0}),s={from:f.MessageFrom.Api,logId:(0,I.getLogIdFromResponse)(i)},c=a.map(function(e){return(0,b.normalizeMessage)(e,s)}),l=a.map(function(e){return{messageId:e.message_id||"",isLocalMessage:!1}}),d=((null==o?void 0:o.regen_list)||[]).reverse().map(function(e){return(0,b.normalizeMessage)(e,s)}),n(function(e,t){var n=e.draftMessageLinks,r=e.draftMessageMap,i=e.draftLocalMessageMap,o=(0,y.createGetMessage)({localMessageMap:i,messageMap:r});t.overrideMessages(c);var a=(0,M.mergeMessageLinks)(l,n,o);a=k(a=(0,S.checkAndFixMessagesHole)(a,o),o,function(e){var t=e.preprocess_key;return!!x().preprocessTaskMap[t]}),t.overrideMessageLinks(a);var s=(0,y.getMessageListStatusByFetchResult)({messageLinks:l,getMessage:o,size:E.defaultFetchMessageSize});t.setMessageStatus(s),t.overrideRegenerateMessagesAndUpdateLink(d)}),[3,4];case 3:return u.sent(),n(function(e){e.draftMessageListStatus.loading=!1}),[3,4];case 4:return[2]}})}),function(e){return w.apply(this,arguments)})})}},5472:function(e,t,n){"use strict";n.d(t,{createSuggestMessageSlice:function(){return l}});var r=n("9161"),i=n("16044"),o=n("97176"),a=n("87382"),s=n("78597"),u=n("5890"),c={suggestMessageMap:{}},l=function(e,t){return u.resetStoreManager.push(function(){return e(c)}),u.resetStoreManager.merge(c),(0,i._)((0,r._)({},c),{clearSuggestMessage:function(t){e((0,o.produce)(function(e){e.suggestMessageMap[t]&&delete e.suggestMessageMap[t]}))},updateSuggestMessage:function(t,n){e(function(e){var i=n(e.suggestMessageMap[t]),o=(0,r._)({},e.suggestMessageMap);return i?o[t]=i:delete o[t],{suggestMessageMap:o}})},updateSuggestMessageWithRemote:function(e,n){t().updateSuggestMessage(e,function(t){try{if(!(null==n?void 0:n.reply_id))return t;var r,i=JSON.parse((null===(r=n.ext)||void 0===r?void 0:r.sp)||"[]");return{replyId:n.reply_id,loading:!1,failed:!1,expired:void 0,suggests:(0,s.isStringArray)(i)?i:[]}}catch(r){return a.logger.persist.warning({message:"load remote sp fail",meta:{conversationId:e,message_id:null==n?void 0:n.message_id,reply_id:null==n?void 0:n.reply_id}}),t}})}})}},2322:function(e,t,n){"use strict";n.d(t,{LocalMessageStatus:function(){return a},MessageFrom:function(){return o}});var r,i,o=((r={}).Api="Api",r.Socket="Socket",r.HttpChunk="HttpChunk",r.HttpLongPolling="HttpLongPolling",r);var a=((i={}).Preprocessing="preprocessing",i.PreprocessFailed="preprocessFailed",i.Sending="sending",i.WaitingAck="waitingAck",i.ReceivingFirstPackage="receivingFirstPackage",i.ReceivingStream="receivingStream",i.SendingRegenerate="sendingRegenerate",i.Timeout="timeout",i.StreamingTimeout="streamingTimeout",i.SentInLocalConversation="SentInLocalConversation",i.SentAndCreateConversationFailedInLocalConversation="SentAndCreateConversationFailedInLocalConversation",i.SafetyError="SafetyError",i)},34749:function(e,t,n){"use strict";n.d(t,{createPersistOptions:function(){return s}});var r=n("87382"),i=n("867"),o=n("48289"),a=n("16147"),s=function(e){var t,n;return{name:e.name,storage:(0,i.createStorage)(function(){var t;return null!==(t=e.storage)&&void 0!==t?t:(0,i.createDefaultStorage)()}),partialize:null!==(t=e.partialize)&&void 0!==t?t:o.partialize,version:1.5,merge:null!==(n=e.merge)&&void 0!==n?n:a.merge,onRehydrateStorage:function(e){var t=r.logger.getLogger({namespace:"persist"});return t.info({message:"hydration started",meta:{state:e}}),function(e,n){n?t.persist.error({message:"hydration error",error:n instanceof Error?n:Error(String(n))}):t.info({message:"hydration finished",meta:{state:e}})}}}}},25276:function(e,t,n){"use strict";n.d(t,{jsonFilterFormatter:function(){return s}});var r=n("35680"),i=n("45663"),o=n("87382"),a=[{pathExpression:"$.state.localMessageMap..local",callback:function(e){delete e.reportEvents}},{pathExpression:"$.state.suggestMessageMap.*[?(@property.match(/reportEvent$/i))]^",callback:function(e){delete e.reportEvent}},{pathExpression:"$.state.regenerateMessageMap.*[?(@property.match(/reportEvents$/i))]^",callback:function(e){delete e.reportEvents}}],s=function(e){try{var t=(0,r.default)(e);return a.forEach(function(e){(0,i.JSONPath)({path:e.pathExpression,json:t,callback:e.callback})}),t}catch(e){o.logger.getLogger({namespace:"persist"}).persist.error({message:"persist state filter error",error:e instanceof Error?e:Error(String(e))})}return e}},16147:function(e,t,n){"use strict";n.d(t,{merge:function(){return v}});var r=n("9161"),i=n("83911"),o=n("35680"),a=n("69581"),s=n("39279"),u=n("73934"),c=n("60032"),l=n("87382"),d=n("5890"),g=n("10016"),f=n("46750"),v=function(e,t){try{var n=d.resetStoreManager.defaultState,v=(0,i.default)(e)?n:e,_=(0,r._)({},(0,o.default)(t),v),p=_.conversationLinks.map(function(e){return e.conversationId});return Object.keys(_.messageLinkMap).filter(function(e){return!p.includes(e)}).forEach(function(e){return(0,g.deleteConversationMessages)(_,e)}),Object.keys(_.conversationMap).filter(function(e){return!p.includes(e)}).forEach(function(e){(0,g.deleteConversationInMap)(_,e)}),_.messageLinkMap&&(0,a.default)(_.messageLinkMap)&&Object.keys(_.messageLinkMap).forEach(function(e){var t=(0,f.getMessageState)(_,e),n=t.messageMap,r=t.localMessageMap,i=t.messageLinks,o=(0,s.default)(i,i.length-50),a=Object.fromEntries((0,u.default)((0,c.default)(o,function(e){return e.isLocalMessage}),function(e){return[e.messageId,r[e.messageId]]})),l=Object.fromEntries((0,u.default)((0,c.default)(o,function(e){return!e.isLocalMessage}),function(e){return[e.messageId,n[e.messageId]]}));_.messageLinkMap[e]=o,_.localMessageMap[e]=a,_.messageMap[e]=l}),_.messageLinkMap&&(0,a.default)(_.messageLinkMap)&&Object.keys(_.messageLinkMap).forEach(function(e){var t,n=(0,f.getMessageState)(_,e),r=n.messageMap,i=n.localMessageMap,o=n.messageLinks,a=null===(t=_.conversationMap)||void 0===t?void 0:t[e];a&&(_.messageListStatusMap[e]=(0,f.getMessageListStatusByRange)({messageLinks:o,getMessage:(0,f.createGetMessage)({messageMap:r,localMessageMap:i}),range:{start:Number(a.message_cursor),end:Number(a.message_cursor)}}))}),_}catch(e){e instanceof Error&&l.logger.getLogger({namespace:"persist"}).persist.error({message:"persist merge error",error:e})}return t}},48289:function(e,t,n){"use strict";n.d(t,{partialize:function(){return s}});var r=n("9161"),i=n("59574"),o=n("87382"),a=n("10630"),s=function(e){try{var t=(0,a.getThreadLinksFromConversationLinks)(a.useThreadListData.raw(e)).filter(function(e){return!e.isLocalConversation}).slice(0,5),n=(0,a.getBotConversationListFromConversationLinks)(a.useBotConversationListData.raw(e)).slice(0,5),s=a.useMainConversationLink.raw(e),u=s?1:0,c=u+t.length,l=(s?[s]:[]).concat(t).concat(n),d=l.map(function(e){return e.conversationId}),g={},f={},v={},_={},p={};return d.forEach(function(t){var n;g[t]=e.conversationMap[t],v[t]=e.lastMessageIndexMap[t],p[t]=e.suggestMessageMap[t],(null===(n=e.messageLinkMap)||void 0===n?void 0:n[t])&&(f[t]=e.messageLinkMap[t].slice(Math.max(e.messageLinkMap[t].length-30,0)))}),d.forEach(function(t){var n;(null==f?void 0:f[t])&&(null===(n=e.messageMap)||void 0===n?void 0:n[t])&&(_[t]={},f[t].forEach(function(n){var r,i;(null===(i=e.messageMap)||void 0===i?void 0:null===(r=i[t])||void 0===r?void 0:r[n.messageId])&&(_[t][n.messageId]=e.messageMap[t][n.messageId])}))}),(0,r._)({conversationLinks:l,threadIndex:u,botConversationIndex:c,conversationMap:g,messageLinkMap:f,messageListStatusMap:e.messageListStatusMap,lastSectionIdMap:e.lastSectionIdMap,lastMessageIndexMap:v,skills:(0,i.default)(e.skillMap)?void 0:e.skills,skillMap:e.skillMap,userPreferences:e.userPreferences,messageMap:_,suggestMessageMap:p,localMessageMap:e.localMessageMap,regenerateMessageMap:e.regenerateMessageMap,actionBarTemplateMap:e.actionBarTemplateMap,chunkTaskMap:e.chunkTaskMap,userInfo:e.userInfo,messageFeedbackMap:e.messageFeedbackMap},{})}catch(e){return o.logger.getLogger({namespace:"persist"}).persist.error({message:"persist state limit error",error:e instanceof Error?e:Error(String(e))}),{}}}},867:function(e,t,n){"use strict";n.d(t,{createDefaultStorage:function(){return d},createStorage:function(){return g}});var r=n("92769"),i=n("6462"),o=n("88802"),a=n("68461"),s=n("83680"),u=n.n(s),c=n("87382"),l=n("25276"),d=function(){var e,t,n,i=u().createInstance({name:"flow-web",storeName:"store"});return{getItem:(e=(0,r._)(function(e){return(0,o.__generator)(this,function(t){return[2,new Promise(function(t,n){i.getItem(e).then(function(e){t(e)}).catch(function(e){n(e)}),setTimeout(function(){n(Error("getItem ".concat(e," timeout, timeout after 10000ms")))},1e4)})]})}),function(t){return e.apply(this,arguments)}),setItem:(t=(0,r._)(function(e,t){var n;return(0,o.__generator)(this,function(r){switch(r.label){case 0:return n=(0,l.jsonFilterFormatter)(t),[4,i.setItem(e,n)];case 1:return r.sent(),[2]}})}),function(e,n){return t.apply(this,arguments)}),removeItem:(n=(0,r._)(function(e){return(0,o.__generator)(this,function(t){switch(t.label){case 0:return[4,i.removeItem(e)];case 1:return t.sent(),[2]}})}),function(e){return n.apply(this,arguments)})}},g=function(e){var t=e();if(t){var n=t.getItem,r=t.setItem,i=t.removeItem;t.setItem=(0,a.default)(f(r,"setItem"),1e3),t.getItem=f(n,"getItem"),t.removeItem=f(i,"removeItem")}return t},f=function(e,t){return(0,r._)(function(){var n,r,a,s,u,l,d,g,f,v,_,p,m,h=arguments;return(0,o.__generator)(this,function(o){switch(o.label){case 0:for(r=Array(n=h.length),a=0;a<n;a++)r[a]=h[a];o.label=1;case 1:return o.trys.push([1,3,,6]),[4,e.apply(void 0,(0,i._)(r))];case 2:return[2,o.sent()];case 3:if(!((s=o.sent())instanceof Error))return[3,5];return[4,null===(d=navigator)||void 0===d?void 0:null===(l=d.storage)||void 0===l?void 0:null===(u=l.estimate)||void 0===u?void 0:u.call(l)];case 4:_=void 0===(v=(f=null!==(g=o.sent())&&void 0!==g?g:{usage:0,quota:0}).usage)?0:v,m=void 0===(p=f.quota)?0:p,c.logger.getLogger({namespace:"persist"}).persist.error({message:"persist storage action error: ".concat(t," failed"),error:s,meta:{usageSpace:"".concat(_/1024/1024," MB"),quotaSpace:"".concat(m/1024/1024," MB")}}),o.label=5;case 5:return[3,6];case 6:return[2]}})})}},10016:function(e,t,n){"use strict";function r(e,t){e.messageMap[t]&&delete e.messageMap[t],e.localMessageMap[t]&&delete e.localMessageMap[t],e.regenerateMessageMap[t]&&delete e.regenerateMessageMap[t],e.messageLinkMap[t]&&delete e.messageLinkMap[t],e.messageListStatusMap[t]&&delete e.messageListStatusMap[t]}function i(e,t){e.conversationMap[t]&&delete e.conversationMap[t],e.lastMessageIndexMap[t]&&delete e.lastMessageIndexMap[t]}n.d(t,{deleteConversationInMap:function(){return i},deleteConversationMessages:function(){return r}})},68602:function(e,t,n){"use strict";n.d(t,{findAllMessageLinkByMatchEqualId:function(){return s},findLastLink:function(){return o},findLastMessageLinkByMatchEqualId:function(){return u},findLastRemoteMessageLink:function(){return a}});var r=n("33229"),i=n("60032"),o=function(e,t){return(0,r.default)(e||[],function(e){return t(e)})},a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return o(e,function(e){var n;return!e.isLocalMessage&&!!e.messageId&&(null===(n=null==t?void 0:t(e))||void 0===n||n)})},s=function(e){var t=e.messageLinks,n=e.replyId,r=e.getMessage;return(0,i.default)(void 0===t?[]:t,function(e){var t;return(null===(t=r(e))||void 0===t?void 0:t.reply_id)===n})},u=function(e){var t=e.messageLinks,n=e.replyId,r=e.getMessage;return o(void 0===t?[]:t,function(e){var t;return(null===(t=r(e))||void 0===t?void 0:t.reply_id)===n})}},46750:function(e,t,n){"use strict";n.d(t,{createGetMessage:function(){return a},getLocalThreadId:function(){return u},getMessageListStatusByFetchResult:function(){return i},getMessageListStatusByRange:function(){return r},getMessageState:function(){return o},getTemporaryReplyMessageId:function(){return s},isLocalThreadId:function(){return c}});var r=function(e){var t,n=e.messageLinks,r=e.getMessage,i=e.range,o=Number(null===(t=r(n[0]))||void 0===t?void 0:t.index)||0;return{hasMore:o>i.start,lastCursor:o,loading:!1}},i=function(e){var t=e.messageLinks,n=e.getMessage,r=e.size;if(!Array.isArray(t)||!(t.length>0))return{hasMore:!1,lastCursor:0,loading:!1};var i,o=Number(null===(i=n(t[0]))||void 0===i?void 0:i.index)||0,a=t.length>=r;return{hasMore:o>1&&a,lastCursor:o,loading:!1}},o=function(e,t){return{messageMap:e.messageMap[t],localMessageMap:e.localMessageMap[t],messageLinks:e.messageLinkMap[t],messageListStatus:e.messageListStatusMap[t]}},a=function(e){return function(t){if(t){var n,r,i=t.isLocalMessage,o=t.messageId;return i?null===(n=e.localMessageMap)||void 0===n?void 0:n[o]:null===(r=e.messageMap)||void 0===r?void 0:r[o]}}},s=function(e){return"replyTo".concat(e)},u=function(e,t){return"localThread_".concat(t||"","_").concat(e)},c=function(e,t){var n,r;return t?null==e?void 0:null===(n=e.startsWith)||void 0===n?void 0:n.call(e,"localThread_".concat(t,"_")):null==e?void 0:null===(r=e.startsWith)||void 0===r?void 0:r.call(e,"localThread_")}},87575:function(e,t,n){"use strict";n.d(t,{isActionBarMessage:function(){return el},isAvailableCrowdTestMessage:function(){return x},isBotCardMessage:function(){return en},isBotChat:function(){return e_},isBotConversation:function(){return z},isBrokenMessage:function(){return D},isCardListMessage:function(){return ea},isCardMessage:function(){return ef},isCocoBotType:function(){return eR},isCocoConversation:function(){return G},isCocoConversationType:function(){return j},isCocoSubConversation:function(){return H},isCocoSubConversationType:function(){return W},isCompositeMessage:function(){return em},isCompositeMessageWithFiles:function(){return ey},isCompositeMessageWithImages:function(){return eh},isCompositeMessageWithLinks:function(){return eM},isCrowdTestMessage:function(){return P},isDisableActionViewMessage:function(){return ep},isFileMessage:function(){return eo},isFinishReplyLocalMessage:function(){return er},isGuanFangBotType:function(){return eA},isImageMessage:function(){return ei},isInPreProcessLocalMessage:function(){return m},isInSearchLoading:function(){return y},isLocalMessage:function(){return p},isMessageAvailable:function(){return E},isMessageCached:function(){return R},isMessageFailed:function(){return M},isMessageFinished:function(){return C},isMessageHasSuggest:function(){return L},isMessageIllegalError:function(){return ev},isMessageLoading:function(){return h},isMessageNotCompliant:function(){return S},isMessagePreprocessing:function(){return X},isMessageReceiving:function(){return K},isMessageReceivingFirstPackage:function(){return Q},isMessageReceivingStream:function(){return $},isMessageSending:function(){return Z},isMessageSendingRegenerate:function(){return J},isMessageVisible:function(){return T},isMusicMessage:function(){return et},isOnBoardingMessage:function(){return U},isQuoteMessage:function(){return eS},isReadPDFSkillMessageWithPDFLink:function(){return ek},isReadWebsiteMessage:function(){return eL},isReadWebsiteMessageWithLink:function(){return eE},isReadWebsiteMessageWithPrompt:function(){return eT},isRegenerateMessage:function(){return N},isSamantha:function(){return V},isSearchMessage:function(){return eu},isSendMessage:function(){return I},isStreamMessage:function(){return b},isStreamingMessage:function(){return q},isSuggestMessage:function(){return A},isSupportedReceiveMessage:function(){return eg},isSupportedSendMessage:function(){return ed},isTemplateMessage:function(){return ec},isTextMessage:function(){return es},isThinkingMessage:function(){return w},isUnselectedCrowdTestMessage:function(){return O},isUserBotType:function(){return ew},isValidReadWebsiteLink:function(){return eI},isVideoMessage:function(){return ee},isWritingOrImageSkillMessage:function(){return eb},isWritingSkillAnswer:function(){return eC},onBoardingMessageScene:function(){return F},onBoardingMessageType:function(){return B}});var r=n("83911"),i=n("50002"),o=n("24682"),a=n("83936"),s=n("68534"),u=n("26498"),c=n("25026"),l=n("24815"),d=n("26689"),g=n("2322"),f=n("23518"),v=n("10173"),_=n("87681"),p=function(e){return!!(e&&"local"in e)},m=function(e){return p(e)&&[g.LocalMessageStatus.PreprocessFailed,g.LocalMessageStatus.Preprocessing].includes(e.local.status)&&!!e.localContent},h=function(e){return!!(p(e)&&(Q(e)||J(e)||Y(e)))||!1},y=function(e){var t;return(null==e?void 0:null===(t=e.ext)||void 0===t?void 0:t.coco_web_new_search_result_style)==="1"},M=function(e){var t,n,r;return p(e)?e.local.failed||!!(null==e?void 0:null===(t=e.ext)||void 0===t?void 0:t.has_err)||!!(null==e?void 0:null===(n=e.localInfo)||void 0===n?void 0:n.errorCode):!!(null==e?void 0:null===(r=e.ext)||void 0===r?void 0:r.has_err)},S=function(e){return(null==e?void 0:e.status)===s.PushMessageStatus.NotCompliant},b=function(e){var t;return(null==e?void 0:null===(t=e.ext)||void 0===t?void 0:t.stream)==="1"},C=function(e){if(h(e))return!1;if(b(e)){var t;return(null==e?void 0:null===(t=e.ext)||void 0===t?void 0:t.is_finish)==="1"}if(w(e))return!1;if(p(e)&&Z(e))return!1;else return!0},L=function(e){var t,n,r;return(!!(null==e?void 0:null===(t=e.ext)||void 0===t?void 0:t.has_suggest)||!!(null==e?void 0:null===(n=e.ext)||void 0===n?void 0:n.sp))&&!(null==e?void 0:null===(r=e.ext)||void 0===r?void 0:r.browser_explain)},I=function(e,t){if(e&&p(e)&&e.local.isRegenerate)return!1;var n=(e||{}).sec_sender;return!!n&&(n===t||n===v.localUser)},E=function(e){return!(0,r.default)(null==e?void 0:e.status)&&(null==e?void 0:e.status)!==s.PushMessageStatus.InVisible},T=function(e,t,n){return!(!e||!(0,r.default)(e.index)&&Number(e.index)<(t||0)||U(e)&&n)&&(!!(M(e)&&k(e))||E(e))},k=function(e){var t;return[String(u.ErrorCodes.SYSTEM_ERROR),String(u.ErrorCodes.UNKNOWN_ERROR)].includes((null==e?void 0:null===(t=e.ext)||void 0===t?void 0:t.has_err)||"")},R=function(e){var t;return(null==e?void 0:null===(t=e.ext)||void 0===t?void 0:t.guidance_use_cache_answer)==="1"},w=function(e){return(null==e?void 0:e.message_type)===s.MessageType.Loading},A=function(e){return(null==e?void 0:e.content_type)===s.ContentType.Suggest},O=function(e){return P(e)&&(null==e?void 0:e.status)!==s.PushMessageStatus.Available},P=function(e){var t;return(null==e?void 0:null===(t=e.ext)||void 0===t?void 0:t.is_crowd_testing)==="1"&&es(e)},x=function(e){return P(e)&&E(e)},U=function(e){var t,n;return!!(null==e?void 0:e.ext)&&!!(null==e?void 0:null===(t=e.ext)||void 0===t?void 0:t.onboarding)&&(null==e?void 0:null===(n=e.ext)||void 0===n?void 0:n.onboarding)!=="0"},B=function(e){var t;switch(Number(null==e?void 0:null===(t=e.ext)||void 0===t?void 0:t.onboarding)){case 1:return"first_met";case 2:return"welcome_back";default:return"unknown"}},F=function(e){var t;switch(Number(null==e?void 0:null===(t=e.ext)||void 0===t?void 0:t.onboarding)){case 1:return"onboarding_first_met";case 2:return"onboarding_welcome_back";default:return"unknown"}},N=function(e){var t;if(p(e))return e.local.isRegenerate;return(null===(t=e.ext)||void 0===t?void 0:t.regen)==="1"},D=function(e){return(null==e?void 0:e.status)===s.PushMessageStatus.Broken},q=function(e){return b(e)&&!C(e)},j=function(e){return e===c.ConversationType.CocoWeb||e===c.ConversationType.Coco},W=function(e){return e===c.ConversationType.CocoWebSub||e===c.ConversationType.CocoSub},G=function(e){return j(null==e?void 0:e.conversation_type)},H=function(e){return W(null==e?void 0:e.conversation_type)},V=function(e,t){var n=G(e),r=H(e);return n||r||t===_.ChatType.NewThread},z=function(e){return(null==e?void 0:e.conversation_type)===c.ConversationType.Bot},K=function(e){var t=e.local.status;return t===g.LocalMessageStatus.ReceivingFirstPackage||t===g.LocalMessageStatus.ReceivingStream},J=function(e){return e.local.status===g.LocalMessageStatus.SendingRegenerate},Y=function(e){return e.local.status===g.LocalMessageStatus.WaitingAck},Q=function(e){return e.local.status===g.LocalMessageStatus.ReceivingFirstPackage},$=function(e){return e.local.status===g.LocalMessageStatus.ReceivingStream},X=function(e){return e.local.status===g.LocalMessageStatus.Preprocessing},Z=function(e){return e.local.status===g.LocalMessageStatus.Sending},ee=function(e){var t;return(null==e?void 0:e.content_type)===s.ContentType.Video&&Array.isArray(null==e?void 0:null===(t=e.contentObj)||void 0===t?void 0:t.video_list)},et=function(e){var t;return(null==e?void 0:e.content_type)===s.ContentType.Music&&Array.isArray(null==e?void 0:null===(t=e.contentObj)||void 0===t?void 0:t.music_list)},en=function(e){return(null==e?void 0:e.content_type)===s.ContentType.BotCard&&!!(null==e?void 0:e.contentObj)},er=function(e){var t;return!!(null==e?void 0:null===(t=e.localInfo)||void 0===t?void 0:t.finishReply)},ei=function(e){var t;return(null==e?void 0:e.content_type)===s.ContentType.Image&&Array.isArray(null==e?void 0:null===(t=e.contentObj)||void 0===t?void 0:t.image_list)},eo=function(e){var t;return(null==e?void 0:e.content_type)===s.ContentType.File&&Array.isArray(null==e?void 0:null===(t=e.contentObj)||void 0===t?void 0:t.file_list)},ea=function(e){return(null==e?void 0:e.content_type)===s.ContentType.PluginSearchResult&&!0},es=function(e){return(null==e?void 0:e.content_type)===s.ContentType.Text},eu=function(e){return(null==e?void 0:e.content_type)===s.ContentType.PluginSearchResult},ec=function(e){var t;return!!(null==e?void 0:null===(t=e.ext)||void 0===t?void 0:t.msg_template_id)},el=function(e){var t;return!!(null==e?void 0:null===(t=e.ext)||void 0===t?void 0:t.input_action)},ed=function(e){return!!e&&(es(e)||ei(e)||eo(e)||em(e))},eg=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[es,ei,ee,et,ef,eo,ea,en,em];return e?t.reduce(function(t,n){return t||n(e)},!1):!!e},ef=function(e){var t;return(null==e?void 0:null===(t=e.contentObj)||void 0===t?void 0:t.card_type)===_.CardType.CARD_BUILDER&&(null==e?void 0:e.content_type)===s.ContentType.Card};function ev(e){var t;return(null===(t=e.ext)||void 0===t?void 0:t.has_err)===String(u.ErrorCodes.CLEAR_LAST_PROMPT)}var e_=function(e){return!!e&&[_.ChatType.Bot,_.ChatType.ProfileBot].includes(e)};function ep(e){var t;return(null==e?void 0:null===(t=e.ext)||void 0===t?void 0:t.disable_action_view)==="true"}function em(e){return(null==e?void 0:e.content_type)===s.ContentType.Composite}function eh(e){return em(e)&&Array.isArray((0,i.default)(e,["contentObj","image_model","image_list"]))}function ey(e){return em(e)&&Array.isArray((0,i.default)(e,["contentObj","file_model","file_list"]))}function eM(e){return em(e)&&(0,o.default)((0,i.default)(e,["contentObj","link_model","url"]))}function eS(e){var t,n,r,i,o,a,u,c,l;return(null==e?void 0:e.content_type)===s.ContentType.Text&&!!((null==e?void 0:null===(t=e.ext)||void 0===t?void 0:t.browser_explain)||(null==e?void 0:null===(n=e.ext)||void 0===n?void 0:n.browser_youtube_summary_transcript)||(null==e?void 0:null===(r=e.ext)||void 0===r?void 0:r.explain)||(null==e?void 0:null===(i=e.ext)||void 0===i?void 0:i.translate)||(null==e?void 0:null===(o=e.ext)||void 0===o?void 0:o.summarize)||(null==e?void 0:null===(a=e.ext)||void 0===a?void 0:a.grammar)||(null==e?void 0:null===(u=e.ext)||void 0===u?void 0:u.rewrite)||(null==e?void 0:null===(c=e.ext)||void 0===c?void 0:c.browser_user_query)||(null==e?void 0:null===(l=e.ext)||void 0===l?void 0:l.browser_ask))}function eb(e){var t,n=(0,i.default)(e,["ext","input_skill"]),r=(0,a.parseJSON)(n);return(0,a.parseJSON)(n).skill_type===l.SkillType.WriteAssistant&&!!r.show_variables||!!n&&[l.SkillType.ImageGeneration,l.SkillType.Translate].includes(null===(t=(0,a.parseJSON)(n))||void 0===t?void 0:t.skill_type)}function eC(e){var t=(0,i.default)(e,["ext","input_skill"]);return!!t&&(0,a.parseJSON)(t).skill_type===l.SkillType.WriteAssistant&&(null==e?void 0:e.reply_id)&&(null==e?void 0:e.reply_id)!=="0"}function eL(e){var t;if(!e)return!1;return(0,a.parseJSON)((0,i.default)(e,["ext","input_skill"])).skill_type===l.SkillType.ReadWebsite&&!!(null===(t=e.contentObj)||void 0===t?void 0:t.text)&&(0,o.default)(e.contentObj.text)}function eI(e){return(0,f.isValidUrl)(e,{allowedProtocols:["https:"]})}function eE(e){return eL(e)&&!!e.contentObj&&!!e.contentObj.text&&(0,o.default)(e.contentObj.text)&&eI(e.contentObj.text)}function eT(e){return eL(e)&&!eE(e)}function ek(e){return!!e&&(0,a.parseJSON)((0,i.default)(e,["ext","input_skill"])).skill_type===l.SkillType.ReadPDF&&!!e.contentObj&&!e.contentObj.file_model&&!e.contentObj.image_model&&!!e.contentObj.link_model}var eR=function(e){return e===d.BotType.Coco||e===d.BotType.CocoWeb},ew=function(e){return e===d.BotType.User},eA=function(e){return e===d.BotType.GuanFang}},37422:function(e,t,n){"use strict";n.d(t,{mergeMessageLinks:function(){return u}});var r=n("6462"),i=n("43875"),o=n("88001"),a=n("35050"),s=n("87575"),u=function(e,t,n){var u,c,l=(u=(0,o.default)((0,r._)(e).concat((0,r._)(t)),function(e){return e.messageId}),c=n,u.filter(function(e){if(e.isLocalMessage){var t=c(e),n=null==t?void 0:t.message_id,r=null==t?void 0:t.reply_id;if(~(0,i.default)(u,function(i,o){if(i===e)return!1;var a=c(i),l=!i.isLocalMessage;return!!(l&&a&&i.messageId===n||l&&!n&&r&&(null==a?void 0:a.reply_id)===r&&(0,s.isMessageAvailable)(a)&&(!e.regen_head||(0,s.isTextMessage)(a)||"local"in t&&t.local.prevRemoteMessageId===a.message_id&&u[o+1]&&!u[o+1].isLocalMessage))||(!l||n||r||(null==a||a.local_message_id,null!=t&&t.local_message_id),!1)}))return!1}return!0}));return(0,a.sortMessageLinks)(l,n),l}},73373:function(e,t,n){"use strict";n.d(t,{createLocalMessage:function(){return d},normalizeMessage:function(){return l}});var r=n("9161"),i=n("16044"),o=n("83911"),a=n("78597"),s=n("68534"),u=n("87575"),c=n("68602"),l=function(e,t){var n=(0,i._)((0,r._)({},e),{localInfo:t,contentObj:(0,u.isMessageAvailable)(e)||(0,u.isSuggestMessage)(e)||(0,u.isThinkingMessage)(e)?(0,a.parseJSON)(e.content)||{}:void 0});return!(0,o.default)(n.contentObj)&&delete n.content,n},d=function(e){var t,n=e.prevMessageId,o=e.message,a=e.messageLinks,u=e.localMessageStatus,l=e.failedExpired,d=e.sendLoadingExpired,g=e.isRegenerate,f=e.localContent,v=e.enterFrom;return(0,i._)((0,r._)({},o),{message_type:s.MessageType.Message,create_time:Date.now(),status:s.PushMessageStatus.Available,localContent:f,local:{prevRemoteMessageId:n||(null===(t=(0,c.findLastRemoteMessageLink)(a))||void 0===t?void 0:t.messageId)||"",status:u,failed:!1,isRetried:!1,failedExpired:l,sendLoadingExpired:d,isRegenerate:g,enterFrom:v}})}},37519:function(e,t,n){"use strict";n.d(t,{reportEventsHelper:function(){return r}});var r={addDuration:function(e,t){Object.values(e||{}).forEach(function(e){null==e||e.addDurationPoint(t)})},updateMeta:function(e,t){Object.values(e||{}).forEach(function(e){null==e||e.updateMeta({meta:t})})},success:function(e,t){Object.values(e||{}).forEach(function(e){null==e||e.success(t)})},error:function(e,t){Object.values(e||{}).forEach(function(e){null==e||e.error(t)})}}},5890:function(e,t,n){"use strict";n.d(t,{resetStoreManager:function(){return u}});var r=n("69420"),i=n("9161"),o=n("29048"),a=n("87382");function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(void 0===t?"undefined":(0,o._)(t))?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=new(function(){function e(){(0,r._)(this,e),s(this,"resetters",[]),s(this,"defaultState",{})}var t=e.prototype;return t.push=function(e){this.resetters.push(e)},t.merge=function(e){this.defaultState=(0,i._)({},this.defaultState,e)},t.resetAllSlice=function(){a.logger.persist.info("reset_chat_store"),this.resetters.forEach(function(e){return e()})},e}())},73874:function(e,t,n){"use strict";n.d(t,{checkAndFixMessagesHole:function(){return r}});var r=function(e,t){var n=function(e,t){i=e,r=t};if(0===e.length||1===e.length)return e;for(var r=e.length,i=-1,o=e.length-1;o>=0;o--)if(!e[o].isLocalMessage){var a=t(e[o]);if(!a)break;var s=Number(a.index);if(-1===i){n(s,o);continue}if(i===s){e.splice(r,1),n(s,o);continue}if(i-1!==s)break;n(s,o)}return e.slice(r)}},35050:function(e,t,n){"use strict";n.d(t,{compareMessageIndex:function(){return o},sortMessageLinks:function(){return a}});var r=n("12256"),i=n("87575");function o(e,t){return(Number(null==e?void 0:e.index)||0)-(Number(null==t?void 0:t.index)||0)}var a=function(e,t){e.sort(function(e,n){if(!e.isLocalMessage&&!n.isLocalMessage)return o(t(e),t(n));if(e.isLocalMessage&&n.isLocalMessage){var a,s;return a=t(e),s=t(n),((0,r.transToMilliSecondIfIsSecond)(Number(null==a?void 0:a.create_time))||0)-((0,r.transToMilliSecondIfIsSecond)(Number(null==s?void 0:s.create_time))||0)}if(e.isLocalMessage&&!n.isLocalMessage||!e.isLocalMessage&&n.isLocalMessage){var u=e.isLocalMessage&&!n.isLocalMessage,c=n.isLocalMessage&&!e.isLocalMessage,l=u?t(e):t(n),d=c?t(e):t(n);if(l&&"index"in l)return o(l,d);var g=l&&(0,i.isLocalMessage)(l)&&l.local.prevRemoteMessageId?t({messageId:l.local.prevRemoteMessageId,isLocalMessage:!1}):void 0;return g===d?u?1:-1:u?o(g,d):o(d,g)}return 0})}},4899:function(e,t,n){"use strict";n.d(t,{getBoardingMessageQue:function(){return u},getMessageText:function(){return s},getTextFromTextMessage:function(){return a}});var r=n("24682"),i=n("59574"),o=n("87575"),a=function(e){if(e&&(0,o.isTextMessage)(e)){var t,n;if((0,r.default)(null==e?void 0:null===(t=e.contentObj)||void 0===t?void 0:t.text))return null==e?void 0:null===(n=e.contentObj)||void 0===n?void 0:n.text;if((0,r.default)(e.tts_content)&&e.tts_content&&!(0,o.isOnBoardingMessage)(e))return e.tts_content}},s=function(e,t,n){if(!e)return;var s=a(e);if((0,r.default)(s))return s;if(!(0,o.isMessageFailed)(e)){if(!(0,o.isImageMessage)(e)){if(t)return(0,i.default)(null==e?void 0:e.contentObj)?"".concat(n," message.content\uFF1A").concat(null==e?void 0:e.content):"".concat(n," message.content\uFF1A\n\n```json\n").concat(JSON.stringify(null==e?void 0:e.contentObj,void 0,2),"\n```\n\n");return n}}},u=function(e){var t=null==e?void 0:e.match(/\[(\S*?)\](?=\(coco:\/\/sendMessage)/g);return(null==t?void 0:t.length)?t.map(function(e){return e.split(/[\[\]]/).join("")}):[]}},12256:function(e,t,n){"use strict";function r(e){var t=Date.now();if(e%Math.pow(10,t.toString().length-1)!==e)return e;var n=1e3*e;return n<t?n:e}n.d(t,{transToMilliSecondIfIsSecond:function(){return r}})},69218:function(e,t,n){"use strict";n.d(t,{getLogIdFromResponse:function(){return r}});var r=function(e){var t;return(null==e?void 0:null===(t=e._meta)||void 0===t?void 0:t.logId)||""}},53641:function(e,t,n){"use strict";n.d(t,{FlowBot:function(){return u}});var r=n("69420"),i=n("93426"),o=n("89334"),a=n("29048");function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(void 0===t?"undefined":(0,a._)(t))?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=function(){function e(){(0,r._)(this,e)}return e.init=function(e){var t=e.useBotInfo,n=(0,o._)(e,["useBotInfo"]);this._getter=n,this._useBotInfo=t},e.useBotInfo=function(e){var t;return null===(t=this._useBotInfo)||void 0===t?void 0:t.call(this,e)},(0,i._)(e,null,[{key:"actions",get:function(){if(!this._getter)throw Error("FlowBot.actions has not initialized");return this._getter}}]),e}();s(u,"_getter",void 0),s(u,"_useBotInfo",void 0)},35453:function(e,t,n){"use strict";n.d(t,{hasMoreThanTwoKeys:function(){return i}});var r=n("59574"),i=function(e){if((0,r.default)(e))return!1;var t=0;for(var n in e)if(e.hasOwnProperty(n)&&++t>=2)return!0;return!1}},52420:function(e,t,n){"use strict";n.d(t,{FlowConfig:function(){return s}});var r=n("69420"),i=n("93426"),o=n("29048");function a(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(void 0===t?"undefined":(0,o._)(t))?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=function(){function e(){(0,r._)(this,e)}return e.init=function(e,t){this._getter=e,this._isEnableDebug=t},e.createUploader=function(e){return this.config.createUploader(e)},(0,i._)(e,null,[{key:"hasInit",get:function(){return!!this._getter}},{key:"config",get:function(){if(!this._getter)throw Error("FlowConfig.config has not initialized");return this._getter()}},{key:"userId",get:function(){return this.config.userId}},{key:"storedUserId",get:function(){return this.config.storedUserId||""}},{key:"loginSource",get:function(){return this.config.loginSource||""}},{key:"lastLandingConversationId",get:function(){return this.config.lastLandingConversationId}},{key:"enterChatMethod",get:function(){return this.config.enterChatMethod||""}},{key:"appId",get:function(){return this.config.appId}},{key:"answerWithSuggest",get:function(){var e;return null===(e=this.config.answerWithSuggest)||void 0===e||e}},{key:"namedEntityHighlight",get:function(){var e;return null!==(e=this.config.namedEntityHighlight)&&void 0!==e&&e}},{key:"answerWithVideo",get:function(){var e;return null!==(e=this.config.answerWithVideo)&&void 0!==e&&e}},{key:"localFeatureConfig",get:function(){return this._isEnableDebug?this.config.localFeatureConfig:{}}},{key:"isGuest",get:function(){var e;return null!==(e=this.config.isGuest)&&void 0!==e&&e}}]),e}();a(s,"_getter",void 0),a(s,"_isEnableDebug",void 0)},76516:function(e,t,n){"use strict";n.d(t,{FlowEvent:function(){return r}});var r=new(n("72193")).EventEmitter},23518:function(e,t,n){"use strict";n.d(t,{isValidUrl:function(){return r}});var r=function(e,t){try{var n=new URL(e);if(!(null==t?void 0:t.allowedProtocols))return!0;return t.allowedProtocols.includes(n.protocol)}catch(e){return!1}}},78217:function(e,t,n){"use strict";n.d(t,{updateMessageSuggest:function(){return i}});var r=n("62920");function i(e,t,n){r.useChatStore.getState().updateMessageList({conversationId:e,immerUpdate:function(e){var r=e.draftMessageMap[t];r&&(r.ext?r.ext.sp=n:r.ext={sp:n})}})}},83375:function(e,t,n){"use strict";n.d(t,{getOnboardingContentSource:function(){return i}});var r=n("50002"),i=function(e){return{onboarding_content_source:(0,r.default)(e,"ext.onboarding_content_source","")}}},21171:function(e,t,n){"use strict";n.d(t,{pickAsString:function(){return o}});var r=n("50002"),i=n("24682"),o=function(e){return function(t){var n=(0,r.default)(t,e);return(0,i.default)(n)?n:""}}},31566:function(e,t,n){"use strict";n.d(t,{FlowTea:function(){return u}});var r,i,o,a=n("69420"),s=n("29048"),u=function(){function e(){(0,a._)(this,e)}return e.init=function(e){this._tracker=e},e.checkInit=function(){if(!this._tracker)throw Error("Global FlowTea has not initialized")},e.trackEvent=function(e,t,n){this.checkInit(),this._tracker(e,t,n)},e}();r=u,o=void 0,(i=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(void 0===t?"undefined":(0,s._)(t))?t:String(t)}(i="_tracker"))in r?Object.defineProperty(r,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[i]=o},12133:function(e,t,n){"use strict";function r(e){return e.tt_wid?e.web_id:""}function i(e){return e?{web_id:e.web_id,tt_wid:e.ttwid}:{}}n.d(t,{getDeviceID:function(){return r},getTtWidConfig:function(){return i}})},96930:function(e,t,n){"use strict";n.d(t,{createReportEvent:function(){return c}});var r=n("9161"),i=n("16044"),o=n("89334"),a=n("16541"),s=n("20000"),u=function(e){var t,n=e.eventName,o=e.logger,a=e.meta,u=e.once,c=void 0!==u&&u,l=[],d=0,g=!1,f=function(){d=Date.now(),o.persist.info({eventName:"".concat(n,"_start"),meta:(0,r._)({},v())})},v=function(){return(0,r._)({},a,g?{event_has_finished:!0}:{})},_=function(){if(0!==l.length)return l.reduce(function(e,t,n){var r=t.pointName;return e[r]=t.time-d,(0,s.default)(e,["interval",r],0===n?e[r]:t.time-l[n-1].time),e},{})},p=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).meta;(!c||!g)&&(o.persist.success({eventName:n,meta:(0,r._)((0,i._)((0,r._)({},v()),{success:1,duration:_()}),e)}),g=!0)},m=function(e){var t=e.reason,a=e.error,s=e.meta;(!c||!g)&&(o.persist.error({eventName:n,error:a||Error(t),meta:(0,r._)((0,i._)((0,r._)({},v()),{success:0,reason:t,duration:_()}),s)}),g=!0)};return f(),{name:"ReportEvent",start:f,cancel:function(){clearTimeout(t),g=!0},success:p,successIfIdle:function(e,n,r){clearTimeout(t),t=setTimeout(function(){return g?void 0:(p(n),null==r?void 0:r())},e)},error:m,errorIfIdle:function(e,n,r){clearTimeout(t),t=setTimeout(function(){return g?void 0:(m(n),null==r?void 0:r())},e)},addDurationPoint:function(e){var t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=l.find(function(t){return t.pointName===e});n?t&&(n.time=Date.now()):l.push({pointName:e,time:Date.now()}),l.sort(function(e,t){return e.time-t.time})},getDuration:_,getMeta:v,updateMeta:function(e){a=(0,r._)({},a,e)},getFinishStatus:function(){return g},setStartTime:function(e){d=e}}},c=function(e){var t=e.logger,n=void 0===t?a.default:t,i=(0,o._)(e,["logger"]);return u((0,r._)({logger:n},i))}},87382:function(e,t,n){"use strict";n.d(t,{ApiError:function(){return o.ApiError},ErrorBoundary:function(){return o.ErrorBoundary},Logger:function(){return o.Logger},LoggerContext:function(){return o.LoggerContext},SlardarReportClient:function(){return o.SlardarReportClient},createReportEvent:function(){return i.createReportEvent},logger:function(){return r.default},useErrorBoundary:function(){return o.useErrorBoundary},withErrorBoundary:function(){return o.withErrorBoundary}});var r=n("16541"),i=n("96930"),o=n("79662")},16541:function(e,t,n){"use strict";var r=n("56607"),i={config:{},loggers:{default:new r.Logger},init:function(e){this.config=e,this.loggers.default=new r.Logger(this.config)},tryCreateWith:function(e){var t,n=(null===(t=e.ctx)||void 0===t?void 0:t.namespace)||"default";return this.loggers[n]?this.loggers[n]:(this.loggers[n]=this.loggers.default.createLoggerWith(e),this.loggers[n])},getLogger:function(e){var t=e.namespace,n=void 0===t?"default":t;return this.loggers[n]?this.loggers[n]:this.tryCreateWith({ctx:{namespace:n}})}};t.default=new Proxy(i,{get:function(e,t,n){return["config","loggers","init","tryCreateWith","getLogger"].find(function(e){return e===t})?Reflect.get(e,t,n):Reflect.get(e.getLogger({namespace:"default"}),t,n)}})},34704:function(e,t,n){"use strict";n.d(t,{assert:function(){return g}});var r=n("47767"),i=n("69420"),o=n("73209"),a=n("6462"),s=n("29048"),u=n("67941"),c=n("26379"),l=n("51247"),d=function(e){(0,o._)(n,e);var t=(0,c._)(n);function n(){for(var e,o,u,c,l=arguments.length,d=Array(l),g=0;g<l;g++)d[g]=arguments[g];return(0,i._)(this,n),c=t.call.apply(t,[this].concat((0,a._)(d))),e=(0,r._)(c),u="assert_error",(o=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(void 0===t?"undefined":(0,s._)(t))?t:String(t)}(o="name"))in e?Object.defineProperty(e,o,{value:u,enumerable:!0,configurable:!0,writable:!0}):e[o]=u,c}return n}((0,u._)(Error)),g=function(e,t){if(!e){if((0,l.default)(t))throw t;throw new d(t)}}},46218:function(e,t,n){"use strict";n.d(t,{compressImage:function(){return c},getCroppedImg:function(){return s}});var r=n("92769"),i=n("88802");function o(e){return new Promise(function(t,n){var r=new Image;r.addEventListener("load",function(){return t(r)}),r.addEventListener("error",function(e){return n(e)}),r.setAttribute("crossOrigin","anonymous"),r.src=e})}function a(e){return e*Math.PI/180}function s(e,t){return u.apply(this,arguments)}function u(){return(u=(0,r._)(function(e,t){var n,r,s,u,c,l,d,g,f,v,_,p,m,h,y=arguments;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return n=y.length>2&&void 0!==y[2]?y[2]:0,r=y.length>3&&void 0!==y[3]?y[3]:{horizontal:!1,vertical:!1},[4,o(e)];case 1:var M,S,b;if(s=i.sent(),!(c=(u=document.createElement("canvas")).getContext("2d")))return[2,null];if(l=a(n),M=s.width,S=s.height,g=(d={width:Math.abs(Math.cos(b=a(n))*M)+Math.abs(Math.sin(b)*S),height:Math.abs(Math.sin(b)*M)+Math.abs(Math.cos(b)*S)}).width,f=d.height,u.width=g,u.height=f,c.translate(g/2,f/2),c.rotate(l),c.scale(r.horizontal?-1:1,r.vertical?-1:1),c.translate(-s.width/2,-s.height/2),c.drawImage(s,0,0),!(_=(v=document.createElement("canvas")).getContext("2d")))return[2,null];return v.width=t.width,v.height=t.height,_.drawImage(u,t.x,t.y,t.width,t.height,0,0,t.width,t.height),p="image/jpeg",m=v.toDataURL(p),[4,new Promise(function(e){v.toBlob(function(t){e(t)},p)})];case 2:return h=i.sent(),[2,{base64:m,blob:h,fileType:p}]}})})).apply(this,arguments)}function c(e){var t=e.url,n=e.quality,r=void 0===n?1:n,i=e.maxWidth,a=void 0===i?1/0:i,s=e.maxHeight,u=void 0===s?1/0:s;return new Promise(function(e,n){o(t).then(function(t){var i=document.createElement("canvas"),o=t.width,s=t.height;o>a&&(s=a/o*s,o=a),s>u&&(o=u/s*o,s=u),i.width=o,i.height=s;var c=i.getContext("2d");c?(c.drawImage(t,0,0,o,s),e(i.toDataURL("image/jpeg",r))):n(Error("Failed to get canvas context."))}).catch(function(e){n(e)})})}},66792:function(e,t,n){"use strict";n.d(t,{autoExpandFunction:function(){return p},isNumeric:function(){return v},isStringArray:function(){return f},loadScript:function(){return _}});var r,i=n("92769"),o=n("88802"),a=n("40521"),s=n("24682"),u=n("77590"),c=n("3820"),l=n("6361"),d=n.n(l),g=n("51572"),f=function(e){return(0,a.default)(e)&&e.every(s.default)},v=function(e){var t=e.replace(/,/g,"");return!isNaN(t)&&!isNaN(parseFloat(t))};var _=(r=(0,i._)(function(e){var t,n,r=arguments;return(0,o.__generator)(this,function(i){switch(i.label){case 0:if(t=(r.length>1&&void 0!==r[1]?r[1]:{}).timeout,n=new Promise(function(t,n){d()(e,function(e){e?n(e):t()})}),!(0,u.default)(t))return[3,2];return[4,Promise.race([n,(0,g.timeoutPromise)(t)])];case 1:return i.sent(),[3,4];case 2:return[4,n];case 3:i.sent(),i.label=4;case 4:return[2]}})}),function(e){return r.apply(this,arguments)}),p=function(e){return(0,c.default)(e)?e():e}},17997:function(e,t,n){"use strict";n.d(t,{getBasename:function(){return i},getEntry:function(){return r},getFullPath:function(){return o},isCurrentEntry:function(){return a}});function r(){return""}function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"/".concat(e)}function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i();return"/"===t?e:"".concat(t).concat(e)}function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return""===e}},45178:function(e,t,n){"use strict";n.d(t,{getFileExt:function(){return r},getFileType:function(){return g},isCsv:function(){return a},isExcel:function(){return s},isImage:function(){return u},isPdf:function(){return c},isPpt:function(){return l},isTxt:function(){return o},isWord:function(){return d}});var r=function(e){var t;return(null===(t=e.match(/\.([^.]+)$/))||void 0===t?void 0:t[1].toLowerCase())||""},i=function(e){return function(t){return e.includes(t)}},o=i(["txt"]),a=i(["csv"]),s=i(["xlsx","xls"]),u=i(["xbm","tif","pjp","svgz","jpg","jpeg","ico","tiff","gif","svg","jfif","webp","png","bmp","pjpeg","avif"]),c=i(["pdf"]),l=i(["ppt","pptx"]),d=i(["doc","docx"]),g=function(e){return a(e)?"CSV":c(e)?"PDF":s(e)?"Spreadsheet":u(e)?"Image":l(e)?"PPT":d(e)?"Document":o(e)?"Txt":"File"}},25363:function(e,t,n){"use strict";n.d(t,{execute:function(){return r},schedule:function(){return i}});var r=function(e){return e()},i=function(e,t){var n=setTimeout(e,t);return{cancel:function(){clearTimeout(n)},exec:function(){return this.cancel(),e()}}}},8331:function(e,t,n){"use strict";n.d(t,{useClickOutside:function(){return s.default},useCompareMemo:function(){return c.useCompareMemo},useDebounceFn:function(){return r.useDebounceFn},useDeepCompareEffect:function(){return r.useDeepCompareEffect},useDeepCompareMemo:function(){return u.useDeepCompareMemo},useEstablished:function(){return l.useEstablished},useEventListener:function(){return r.useEventListener},useFirstScreenInView:function(){return d.useFirstScreenInView},useHover:function(){return r.useHover},useInterval:function(){return r.useInterval},useKeyboardEvent:function(){return u.useKeyboardEvent},useLatest:function(){return r.useLatest},useLoadMore:function(){return o.default},useLocalStorageState:function(){return r.useLocalStorageState},useMedia:function(){return i.default},usePrevious:function(){return r.usePrevious},useRequest:function(){return r.useRequest},useResizeObserver:function(){return g.useResizeObserver},useSize:function(){return r.useSize},useThrottleFn:function(){return r.useThrottleFn},useTimeout:function(){return r.useTimeout},useTimeoutWithExpired:function(){return f.useTimeoutWithExpired},useUnmount:function(){return r.useUnmount},useUpdateEffect:function(){return r.useUpdateEffect},useUrlParams:function(){return a.default}});var r=n("24230"),i=n("47898"),o=n("88969"),a=n("32009"),s=n("63369"),u=n("10374");n("2535");var c=n("18084"),l=n("19556"),d=n("65570"),g=n("84487");n("38336");var f=n("38534")},18084:function(e,t,n){"use strict";n.d(t,{useCompareMemo:function(){return i}});var r=n("52983"),i=function(e,t){var n=(0,r.useRef)(e);return!t(e,n.current)&&(n.current=e),n.current}},19556:function(e,t,n){"use strict";n.d(t,{useEstablished:function(){return i}});var r=n("52983"),i=function(e){var t=(0,r.useRef)(e);return t.current=t.current||e,t.current}},65570:function(e,t,n){"use strict";n.d(t,{useFirstScreenInView:function(){return u}});var r=n("89334"),i=n("40509"),o=n("52983"),a=function(e,t,n){return e>=t&&e<=n},s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.getBoundingClientRect(),r=n.top,i=n.left,o=n.bottom,s=n.right,u=t.topOffset,c=void 0===u?0:u,l=t.bottomOffset,d=void 0===l?0:l,g=t.leftOffset,f=void 0===g?0:g,v=t.rightOffset,_=void 0===v?0:v,p=window.innerWidth||document.documentElement.clientWidth,m=window.innerHeight||document.documentElement.clientHeight;return(a(r,-c,m+d)||a(o,-c,m+d))&&(a(i,-f,p+_)||a(s,-f,p+_))},u=function(e){var t=e.ref,n=(0,r._)(e,["ref"]),a=(0,i._)((0,o.useState)(!1),2),u=a[0],c=a[1];return(0,o.useLayoutEffect)(function(){(null==t?void 0:t.current)&&s(t.current,n)&&c(!0)},[]),{ref:t,inView:u}}},84487:function(e,t,n){"use strict";n.d(t,{useResizeObserver:function(){return u}});var r=n("40509"),i=n("52983"),o=n("91646"),a=n("37903"),s=n("57684");"undefined"!=typeof window&&!window.ResizeObserver&&(window.ResizeObserver=s.ResizeObserver);var u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.ref,n=e.onlyBothNilIsFirstScreen,s=e.onResize,u=(0,i.useRef)(null),c=null!=t?t:u;(0,i.useLayoutEffect)(function(){if(c.current){var e=c.current.getBoundingClientRect(),t=e.width,n=e.height;g(t),_(n)}},[]);var l=(0,r._)((0,i.useState)(),2),d=l[0],g=l[1],f=(0,r._)((0,i.useState)(),2),v=f[0],_=f[1],p=(0,o.default)({ref:c,onResize:s}),m=p.width,h=p.height;return(void 0===n||n)&&(0,a.default)(m)&&(0,a.default)(h)?{ref:c,width:d,height:v}:{ref:c,width:null!=m?m:0,height:null!=h?h:0}}},38336:function(e,t,n){"use strict";n("52983")},2535:function(e,t,n){"use strict";n("52983")},38534:function(e,t,n){"use strict";n.d(t,{useTimeoutWithExpired:function(){return o}});var r=n("52983"),i=n("37903"),o=function(e){var t=(0,r.useRef)(),n=function(){t.current&&(clearTimeout(t.current),t.current=null)};return(0,r.useEffect)(function(){return n},[]),{setExpired:function(r){if(n(),!(0,i.default)(r)){var o=Math.max(r-Date.now(),0);t.current=window.setTimeout(function(){e()},o)}},reset:n}}},96014:function(e,t,n){"use strict";n.d(t,{rtlLocaleList:function(){return r}});var r=["ae","aeb","ajt","apc","apd","ar","ara","arb","arc","arq","ars","ary","arz","ave","avl","bal","bcc","bej","bft","bgn","bqi","brh","cja","ckb","cld","dcc","dgl","div","drw","dv","fa","fas","fia","fub","gbz","gjk","gju","glk","grc","gwc","gwt","haz","he","heb","hnd","hno","iw","ji","kas","kby","khw","ks","kvx","kxp","kzh","lad","lah","lki","lrc","luz","mde","mfa","mki","mvy","myz","mzn","nqo","oru","ota","otk","oui","pal","pbu","per","pes","phl","phn","pnb","pra","prd","prs","ps","pus","rhg","rmt","scl","sd","sdh","shu","skr","smp","snd","sog","swb","syr","tnf","trw","ug","uig","ur","urd","wni","xco","xld","xmn","xmr","xna","xpr","xsa","ydd","yi","yid","zdj"]},64383:function(e,t,n){"use strict";n.d(t,{getLanguageDirection:function(){return g},getUnreactiveLanguage:function(){return l},isRTL:function(){return d},useGetLanguageDirectionOfText:function(){return v}});var r,i=n("92769"),o=n("40509"),a=n("88802"),s=n("52983");n("14794");var u=n("96014"),c=n("51635"),l=function(){return"undefined"==typeof navigator?"":navigator.language},d=function(e){return!1},g=function(e){return d(e)?"rtl":"ltr"};var f=(r=(0,i._)(function(e){var t,r,i,o,s=arguments;return(0,a.__generator)(this,function(o){switch(o.label){case 0:t=s.length>1&&void 0!==s[1]&&s[1],o.label=1;case 1:if(o.trys.push([1,3,,4]),!(r=e.trim()))return[2,t];return[4,(0,c.retryLoad)(function(){return Promise.all([n.e("8798"),n.e("147")]).then(n.bind(n,"6276"))})];case 2:if("und"===(i=(0,o.sent().franc)(r,{minLength:20}))){var a;return[2,(a=r.charAt(0),new RegExp("^[^".concat("A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02B8\u0300-\u0590\u0800-\u1FFF\u2C00-\uFB1C\uFDFE-\uFE6F\uFEFD-\uFFFF","]*[").concat("\u0591-\u07FF\uFB1D-\uFDFD\uFE70-\uFEFC","]")).test(a))]}return[2,u.rtlLocaleList.includes(i)];case 3:return o.sent(),[2,t];case 4:return[2]}})}),function(e){return r.apply(this,arguments)}),v=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=(0,o._)((0,s.useState)("ltr"),2),u=r[0],c=r[1];var l=(t=(0,i._)(function(){return(0,a.__generator)(this,function(t){switch(t.label){case 0:return[4,f(e,n)];case 1:return c(t.sent()?"rtl":"ltr"),[2]}})}),function(){return t.apply(this,arguments)});return(0,s.useEffect)(function(){l()},[e,n]),u}},78597:function(e,t,n){"use strict";n.d(t,{SyncStorage:function(){return d.SyncStorage},addQuery:function(){return f.addQuery},assert:function(){return o.assert},autoExpandFunction:function(){return r.autoExpandFunction},bindPromiseProperty:function(){return m.bindPromiseProperty},convertBase64ToBlob:function(){return s.convertBase64ToBlob},convertBlobToBase64:function(){return s.convertBlobToBase64},execute:function(){return M.execute},getChromeVersion:function(){return c.getChromeVersion},getCroppedImg:function(){return a.getCroppedImg},getEntry:function(){return _.getEntry},getFileExt:function(){return y.getFileExt},getFileType:function(){return y.getFileType},getIsIPad:function(){return c.getIsIPad},getIsIPhoneOrIPad:function(){return c.getIsIPhoneOrIPad},getIsMobile:function(){return c.getIsMobile},getIsMobileOrIPad:function(){return c.getIsMobileOrIPad},getLanguageDirection:function(){return l.getLanguageDirection},getShortVersionCode:function(){return v.getShortVersionCode},getUnreactiveLanguage:function(){return l.getUnreactiveLanguage},getVideoCover:function(){return s.getVideoCover},inBrowser:function(){return c.inBrowser},isAppleWebkit:function(){return c.isAppleWebkit},isArc:function(){return c.isArc},isChromeChromium:function(){return c.isChromeChromium},isCsv:function(){return y.isCsv},isExcel:function(){return y.isExcel},isFirefox:function(){return c.isFirefox},isImage:function(){return y.isImage},isInSuperApp:function(){return c.isInSuperApp},isMac:function(){return c.isMac},isMacosSafari:function(){return c.isMacosSafari},isMobile:function(){return c.isMobile},isNumeric:function(){return r.isNumeric},isPWA:function(){return c.isPWA},isPdf:function(){return y.isPdf},isPpt:function(){return y.isPpt},isRTL:function(){return l.isRTL},isSamanthaClient:function(){return c.isSamanthaClient},isStringArray:function(){return r.isStringArray},isTxt:function(){return y.isTxt},isVideoOfMimeType:function(){return s.isVideoOfMimeType},isWindows:function(){return c.isWindows},isWord:function(){return y.isWord},loadScript:function(){return r.loadScript},openWindowInvisibleIframe:function(){return h.openWindowInvisibleIframe},openWindowPopup:function(){return h.openWindowPopup},parseHashOrQuery:function(){return f.parseHashOrQuery},parseJSON:function(){return i.parseJSON},retryAsync:function(){return u.retryAsync},retryLoad:function(){return u.retryLoad},safeParseUrl:function(){return f.safeParseUrl},stringifyJSON:function(){return i.stringifyJSON},timeoutPromise:function(){return m.timeoutPromise},toURL:function(){return f.toURL},useClickOutside:function(){return g.useClickOutside},useCompareMemo:function(){return g.useCompareMemo},useDebounceFn:function(){return g.useDebounceFn},useDeepCompareEffect:function(){return g.useDeepCompareEffect},useDeepCompareMemo:function(){return g.useDeepCompareMemo},useEstablished:function(){return g.useEstablished},useEventListener:function(){return g.useEventListener},useFirstScreenInView:function(){return g.useFirstScreenInView},useGetLanguageDirectionOfText:function(){return l.useGetLanguageDirectionOfText},useHover:function(){return g.useHover},useInterval:function(){return g.useInterval},useKeyboardEvent:function(){return g.useKeyboardEvent},useLatest:function(){return g.useLatest},useLoadMore:function(){return g.useLoadMore},useLocalStorageState:function(){return g.useLocalStorageState},useMedia:function(){return g.useMedia},usePrevious:function(){return g.usePrevious},useRequest:function(){return g.useRequest},useResizeObserver:function(){return g.useResizeObserver},useSize:function(){return g.useSize},useThrottleFn:function(){return g.useThrottleFn},useTimeout:function(){return g.useTimeout},useTimeoutWithExpired:function(){return g.useTimeoutWithExpired},useUnmount:function(){return g.useUnmount},useUpdateEffect:function(){return g.useUpdateEffect},useUrlParams:function(){return g.useUrlParams},utf8:function(){return p.utf8}});var r=n("66792"),i=n("83936"),o=n("34704");n("64554");var a=n("46218"),s=n("29604"),u=n("51635"),c=n("65042"),l=n("64383"),d=n("17072"),g=n("8331"),f=n("45194"),v=n("72695"),_=n("17997"),p=n("12831"),m=n("51572"),h=n("49329"),y=n("45178"),M=n("25363")},83936:function(e,t,n){"use strict";n.d(t,{parseJSON:function(){return o},stringifyJSON:function(){return i}});var r=n("37903"),i=function(e){try{return JSON.stringify(e)}catch(e){return""}},o=function(e,t){try{return e?JSON.parse(e):{}}catch(e){return(0,r.default)(t)?{}:t}}},29604:function(e,t,n){"use strict";n.d(t,{convertBase64ToBlob:function(){return i},convertBlobToBase64:function(){return r},getVideoCover:function(){return o},isVideoOfMimeType:function(){return a}});var r=function(e){return new Promise(function(t,n){var r=new FileReader;r.readAsDataURL(e),r.onload=function(){var e,n;t(null!==(n=null===(e=r.result)||void 0===e?void 0:e.toString())&&void 0!==n?n:"")},r.onerror=function(e){n(e)}})},i=function(e){for(var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:512,i=atob(null!==(t=e.split(",")[1])&&void 0!==t?t:e),o=[],a=0;a<i.length;a+=r){for(var s=i.slice(a,a+r),u=Array(s.length),c=0;c<s.length;c++)u[c]=s.charCodeAt(c);var l=new Uint8Array(u);o.push(l)}return new Blob(o,{type:n})},o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new Promise(function(n){var r=document.createElement("video");r.setAttribute("src",URL.createObjectURL(e)),r.load(),r.addEventListener("error",function(e){n(null)}),r.addEventListener("loadedmetadata",function(){if(r.duration<t){n(null);return}setTimeout(function(){r.currentTime=t},200),r.addEventListener("seeked",function(){var e=document.createElement("canvas");e.width=r.videoWidth,e.height=r.videoHeight;var t=e.getContext("2d");if(!t){n(null);return}t.drawImage(r,0,0,e.width,e.height),t.canvas.toBlob(function(e){n(e)},"image/jpeg",.75)})})})},a=function(e){return e.startsWith("video/")}},65042:function(e,t,n){"use strict";n.d(t,{getChromeVersion:function(){return w},getIsIPad:function(){return g},getIsIPhoneOrIPad:function(){return d},getIsMobile:function(){return l},getIsMobileOrIPad:function(){return f},getSamanthaClientType:function(){return P},getSamanthaClientVersion:function(){return O},inBrowser:function(){return R},isAppleWebkit:function(){return v},isArc:function(){return k},isChrome:function(){return h},isChromeChromium:function(){return m},isEdge:function(){return p},isFirefox:function(){return _},isIOS:function(){return S},isInSuperApp:function(){return L},isMac:function(){return b},isMacosSafari:function(){return M},isMobile:function(){return c},isPWA:function(){return E},isSafari:function(){return y},isSamanthaClient:function(){return A},isWeChat:function(){return I},isWindows:function(){return C}});var r,i,o,a=n("40509"),s=n("73706"),u=n.n(s),c=function(){return u().getParser(navigator.userAgent).getPlatformType(!0).includes("mobile")},l=function(){return void 0===r&&(r=c()),r},d=function(){if(void 0===i){var e=navigator.userAgent,t=/iPad|iPhone|iPod/.test(e),n=e.includes("Macintosh")&&"ontouchstart"in document.documentElement;i=t||n}return i},g=function(){if(void 0===o){var e=navigator.userAgent,t=/iPad/.test(e),n=e.includes("Macintosh")&&"ontouchstart"in document.documentElement;o=t||n}return o},f=function(){return l()||d()},v=function(){return"function"==typeof window.webkitConvertPointFromNodeToPage},_=function(){return navigator.userAgent.toLowerCase().includes("firefox")},p=function(){return/edge?\//.test(navigator.userAgent.toLowerCase())},m=function(){return/chrome?\//.test(navigator.userAgent.toLowerCase())},h=function(){return navigator.userAgent.indexOf("Chrome")>-1&&-1===navigator.userAgent.indexOf("Edg")},y=function(){return navigator.userAgent.indexOf("safari")>-1&&-1===navigator.userAgent.indexOf("chrome")},M=function(){return v()&&!f()},S=function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)},b=function(){return/Mac/.test(navigator.userAgent)},C=function(){return/Win/.test(navigator.userAgent)},L=function(){return navigator.userAgent.includes(Array.from("F eLiasrhku").filter(function(e,t){return t%2}).join("").trim())},I=function(){return navigator.userAgent.toLowerCase().includes("micromessenger")},E=function(){return"standalone"in navigator&&!!navigator.standalone||!!window.matchMedia("(display-mode: standalone)").matches||!1},T=null,k=function(){return null===T&&(T=!!getComputedStyle(document.documentElement).getPropertyValue("--arc-palette-title")),T},R="undefined"!=typeof window,w=function(){if("undefined"!=typeof navigator){var e=navigator.userAgent.match(/Chrom(?:e|ium)\/([0-9]+)\.([0-9]+)\.([0-9]+)\.([0-9]+)/);if(null!==e&&5===e.length){var t=(0,a._)(e.map(function(e){return parseInt(e,10)}),5);return{major:t[1],minor:t[2],build:t[3],patch:t[4]}}}},A=function(){if("undefined"!=typeof window){var e=navigator.userAgent;return/Samantha/.test(e)}return!1},O=function(){return A()&&"undefined"!=typeof window&&(navigator.userAgent.match(/Samantha(Cici|Doubao)?\/((\d+\.)+\d+)/)||[])[2]||""},P=function(){if("undefined"==typeof window)return"";var e=navigator.userAgent,t=/SamanthaCici/.test(e),n=/SamanthaDoubao/.test(e);return t?"Cici":n?"Doubao":""}},51572:function(e,t,n){"use strict";n.d(t,{bindPromiseProperty:function(){return u},timeoutPromise:function(){return s}});var r=n("92769"),i=n("88802"),o=n("37903"),a=n("2945");function s(e,t,n){return new Promise(function(r,i){setTimeout(function(){if(n){i(Error("Mock to reject."));return}(0,o.default)(t)?r(void 0):r(t)},e)})}function u(e){var t,n,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var s=(t=(0,r._)(function(){return(0,i.__generator)(this,function(t){switch(t.label){case 0:if(n)return[3,2];return[4,e];case 1:n=t.sent(),t.label=2;case 2:return[2,n]}})}),function(){return t.apply(this,arguments)});return new Proxy({},{get:function(e,t){var n;return new Proxy(a.default,{apply:o?void 0:(n=(0,r._)(function(e,n,r){var o,a;return(0,i.__generator)(this,function(e){switch(e.label){case 0:return[4,s()];case 1:if(!(t in(o=e.sent())))throw Error("".concat(t," is undefined"));if("function"!=typeof(a=o[t]))throw Error("".concat(t," is not function"));return[2,a.apply(o,r)]}})}),function(e,t,r){return n.apply(this,arguments)}),get:function(e,n){var o,a,u;if("then"===n){;return o=(0,r._)(function(e){var n,r,o;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),[4,s()];case 1:if(!(t in(n=i.sent())))throw Error("".concat(t," is undefined"));return r=n[t],o=Promise.resolve,[4,r];case 2:return[2,o.apply(Promise,[e.apply(void 0,[i.sent()])])];case 3:return[2,Promise.reject(i.sent())];case 4:return[2]}})}),function(e){return o.apply(this,arguments)}}if("catch"===n){;return a=(0,r._)(function(e){var n,r,o;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,8]),[4,s()];case 1:if(!(t in(n=i.sent())))throw Error("".concat(t," is undefined"));return[4,n[t]];case 2:return i.sent(),[3,8];case 3:r=i.sent(),i.label=4;case 4:return i.trys.push([4,6,,7]),o=Promise.resolve,[4,e(r)];case 5:return[2,o.apply(Promise,[i.sent()])];case 6:return[2,Promise.reject(i.sent())];case 7:return[3,8];case 8:return[2]}})}),function(e){return a.apply(this,arguments)}}if("finally"===n){;return u=(0,r._)(function(e){var n,r;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,4,8]),[4,s()];case 1:if(!(t in(n=i.sent())))throw Error("".concat(t," is undefined"));return[4,n[t]];case 2:return i.sent(),[3,8];case 3:case 6:return[2,Promise.reject(i.sent())];case 4:return i.trys.push([4,6,,7]),r=Promise.resolve,[4,e()];case 5:return[2,r.apply(Promise,[i.sent()])];case 7:return[7];case 8:return[2]}})}),function(e){return u.apply(this,arguments)}}else throw Error("Bind a none-promise and none-function value is not supported")}})}})}},51635:function(e,t,n){"use strict";n.d(t,{retryAsync:function(){return u},retryLoad:function(){return s},useInitPreloadChunkCore:function(){return c}});var r,i=n("92769"),o=n("88802"),a=n("52983"),s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;return new Promise(function(r,i){e().then(r).catch(function(o){setTimeout(function(){if(1===t){i(o);return}s(e,t-1,n).then(r,i)},n)})})};var u=(r=(0,i._)(function(e,t,n,r){var i,a,s;return(0,o.__generator)(this,function(o){switch(o.label){case 0:i=0,o.label=1;case 1:if(!(i<t))return[3,8];a=i+1,o.label=2;case 2:return o.trys.push([2,4,,5]),[4,e()];case 3:return[2,o.sent()];case 4:if(s=o.sent(),a>=t)throw s;return null==r||r(s,i),[3,5];case 5:var u;return[4,(u="number"==typeof n?n:n(a),new Promise(function(e){setTimeout(e,u)}))];case 6:o.sent(),o.label=7;case 7:return i++,[3,1];case 8:throw Error("retry times out of limit")}})}),function(e,t,n,i){return r.apply(this,arguments)}),c=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4,n=function(){try{e()}catch(e){}};(0,a.useEffect)(function(){var e=window.setTimeout(function(){n()},t);return function(){window.clearTimeout(e)}},[])}},17072:function(e,t,n){"use strict";n.d(t,{SyncStorage:function(){return o},SyncStorageWithCache:function(){return s}});var r={},i=function(){return window},o={setItem:function(e,t){var n;if(null===(n=i())||void 0===n?void 0:n.localStorage){localStorage.setItem(e,t);return}r[e]=t},getItem:function(e){var t,n;return(null===(t=i())||void 0===t?void 0:t.localStorage)?localStorage.getItem(e):null!==(n=r[e])&&void 0!==n?n:null},removeItem:function(e){var t;if(null===(t=i())||void 0===t?void 0:t.localStorage){localStorage.removeItem(e);return}delete r[e]}},a={},s={setItem:function(e,t){a[e]=t,o.setItem(e,t)},getItem:function(e){return a[e]?a[e]:o.getItem(e)}}},64554:function(e,t,n){"use strict";n("27860")},45194:function(e,t,n){"use strict";n.d(t,{addQuery:function(){return u},getUrlParams:function(){return l},parseHashOrQuery:function(){return s},safeParseUrl:function(){return c},toURL:function(){return a}});var r=n("9161"),i=n("40509"),o=n("80627"),a=function(e,t){try{var n=new URL(e);return Object.entries(t).forEach(function(e){var t=(0,i._)(e,2),r=t[0],o=t[1];n.searchParams.append(r,String(o))}),n.toString()}catch(n){return"".concat(e,"?").concat(o.default.stringify(t))}},s=function(e){for(var t=e.startsWith("#")||e.startsWith("?")?e.slice(1):e,n={},r=/([^&=]+)=([^&]*)/g,o=null;o=r.exec(t);){var a=(0,i._)(o,3),s=a[1],u=a[2];n[decodeURIComponent(s)]=decodeURIComponent(u)}return n},u=function(e,t){var n=(0,r._)({},s(e.split("#")[0].split("?")[1]||""),s(e.split("#")[1]||""));return a(e.split("#")[0].split("?")[0],(0,r._)({},n,t)).replace(/\?$/,"")},c=function(e){try{return new URL(e)}catch(e){return null}},l=function(e){var t=new URL(window.location.href);return new URLSearchParams(t.search).get(e)}},12831:function(e,t,n){"use strict";n.d(t,{utf8:function(){return o}});var r=n("35680"),i=n("23813"),o={length:function(e){for(var t=0,n=0,r=0;r<e.length;++r)(n=e.charCodeAt(r))<128?t+=1:n<2048?t+=2:(64512&n)==55296&&(64512&e.charCodeAt(r+1))==56320?(++r,t+=4):t+=3;return t},read:function(e,t,n){if(n-t<1)return"";for(var r="",i=t;i<n;){var o=e[i++];if(o<=127)r+=String.fromCharCode(o);else if(o>=192&&o<224)r+=String.fromCharCode((31&o)<<6|63&e[i++]);else if(o>=224&&o<240)r+=String.fromCharCode((15&o)<<12|(63&e[i++])<<6|63&e[i++]);else if(o>=240){var a=((7&o)<<18|(63&e[i++])<<12|(63&e[i++])<<6|63&e[i++])-65536;r+=String.fromCharCode(55296+(a>>10))+String.fromCharCode(56320+(1023&a))}}return r},write:function(e,t,n){for(var r,i,o=n,a=0;a<e.length;++a)(r=e.charCodeAt(a))<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:((64512&r)==55296&&(64512&(i=e.charCodeAt(a+1)))==56320?(r=65536+((1023&r)<<10)+(1023&i),++a,t[n++]=r>>18|240,t[n++]=r>>12&63|128):t[n++]=r>>12|224,t[n++]=r>>6&63|128),t[n++]=63&r|128);return n-o},posCalcRange:function(e,t){var n=0,o={},a=(0,r.default)(t);a=(0,i.default)(a.sort(function(e,t){return e-t}));for(var s=0;s<e.length&&(n===a[0]&&(o[a[0]]=s,a.shift()),(64512&e[s].charCodeAt(0))==55296&&(64512&e[s+1].charCodeAt(0))==56320?(n+=this.length("".concat(e[s]).concat(e[s+1])),s++):n+=this.length(e[s]),a.length);s++);return o},posCalc:function(e,t){for(var n="",r=0,i=0;i<e.length;i++)if(n+=e[i],this.length(n)===t){r=i+1;break}return r}}},72695:function(e,t,n){"use strict";n.d(t,{getShortVersionCode:function(){return r}});var r=function(e){for(var t=Math.ceil(String(e).length/2),n=[];t;)t--,n.push(Math.pow(10,2*t));return n.map(function(t){return Math.floor(e/t)%100}).join(".")}},49329:function(e,t,n){"use strict";n.d(t,{openWindowInvisibleIframe:function(){return o},openWindowPopup:function(){return i}});var r=function(e,t){var n=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,r=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height;return{left:n/2-e/2+window.screenLeft,top:r/2-t/2+window.screenTop}},i=function(e){var t=e.path,n=e.width,i=void 0===n?700:n,o=e.height,a=void 0===o?700:o,s=r(i,a),u=s.left,c=s.top;window.open(t,"_blank","width=".concat(i,",height=").concat(a,",left=").concat(u,",top=").concat(c,",resizable=no,location=no,menubar=no"))},o=function(e){var t=document.createElement("iframe");t.src=e,t.style.display="none",document.body.appendChild(t)}},51785:function(e){},19449:function(e,t,n){"use strict";n("58989"),n("5782"),n("30808"),n("43913"),n("89989"),n("68538"),n("15326"),n("92502"),n("36619"),n("38420"),n("10787"),n("94204"),n("74021"),n("66844"),n("55089"),n("69391"),n("12066"),n("52994"),n("50301"),n("3392"),n("27879"),n("47269"),n("28442"),n("61218"),n("8669"),n("81809"),n("28845"),n("58511"),n("69606"),n("47297"),n("31257"),n("42029"),n("85603"),n("86933"),n("71350"),n("98366"),n("15388"),n("42607"),n("13332"),n("73040"),n("57653"),n("53036"),n("29144"),n("41183"),n("34418"),n("19049"),n("59402"),n("37876"),n("27774"),n("92760"),n("50079"),n("8600"),n("10490"),n("7887"),n("23502"),n("35063"),n("16777"),n("48032"),n("33258"),n("90787"),n("77101"),n("26236"),n("22401"),n("6382"),n("20795"),n("13258"),n("78448"),n("84225"),n("73848"),n("11528"),n("30505"),n("64103"),n("8005"),n("71205"),n("66475"),n("61415"),n("64196"),n("62921"),n("8769"),n("84539"),n("68073"),n("13787"),n("30230"),n("46387"),n("75835"),n("43996"),n("97456"),n("91273"),n("893"),n("74618"),n("25503"),n("409"),n("77711"),n("73069"),n("52933"),n("64586"),n("60932"),n("53876"),n("76428"),n("97404"),n("33805"),n("88674"),n("99598"),n("60143"),n("2756"),n("14435"),n("48271"),n("87967"),n("11745"),n("70713"),n("16690"),n("37623"),n("60432"),n("1145"),n("17342"),n("45881"),n("30742"),n("81673"),n("88857"),n("96241"),n("67069"),n("52923"),n("21390"),n("80500"),n("42190"),n("18608"),n("89859"),n("15993"),n("54125"),n("4411"),n("10395"),n("43552"),n("62837"),n("17877"),n("95875"),n("25745"),n("43140"),n("90845"),n("6343"),n("61930"),n("36618"),n("85153"),n("53195"),n("18245"),n("61858"),n("84026"),n("82550"),n("81071"),n("86065"),n("60328"),n("58951"),n("60674"),n("55818"),n("71035"),n("3691"),n("3030"),n("29124"),n("74148"),n("22601"),n("62387"),n("81717"),n("46503"),n("65306"),n("46902"),n("39064"),n("41298"),n("51800"),n("23570"),n("5245"),n("85085"),n("22129"),n("43064"),n("60349"),n("291"),n("50957"),n("81357"),n("26423"),n("35947"),n("77513"),n("65559"),n("83026"),n("81911"),n("24154"),n("15657"),n("75196"),n("92946"),n("99423"),n("73202"),n("7770"),n("91784"),n("70808"),n("97966"),n("948"),n("96668"),n("18142"),n("87207"),n("76732"),n("33115"),n("88449"),n("22921"),n("24186"),n("97414"),n("963"),n("24517"),n("88235"),n("89026"),n("48907"),n("47608"),n("59619"),n("31913"),n("98328"),n("43801"),n("57743"),n("24583"),n("9378"),n("91313"),n("14262"),n("63558"),n("12338"),n("66565"),n("32234"),n("32322"),n("32559"),n("55753"),n("35123"),n("14686"),n("63616"),n("77694"),n("56021"),n("98296"),n("13766"),n("33417"),n("12104"),n("14060"),n("68991"),n("70936"),n("75760"),n("72471"),n("76771"),n("5381"),n("37145"),n("78875"),n("14815"),n("54194"),n("75053"),n("23852"),n("10542"),n("9133"),n("56327"),n("68687"),n("14223"),n("11093"),n("98320"),n("21739"),n("25641"),n("19057"),n("22023"),n("73507"),n("80719"),n("92907"),n("2011"),n("94692"),n("7135"),n("43113"),n("36439"),n("40337"),n("96745"),n("79609"),n("28605"),n("93474"),n("43463"),n("14620"),n("6304"),n("54700"),n("14405"),n("12907"),n("22588"),n("9697"),n("51166"),n("3368"),n("43513"),n("12182"),n("17887"),n("13266"),n("52023"),n("37521"),n("91014"),n("64012"),n("57086"),n("14597"),n("49529"),n("90793"),n("64381"),n("19639"),n("1427"),n("83200"),n("54809"),n("20390"),n("11923"),n("61213"),n("34340"),n("17079"),n("98520"),n("84767"),n("81906"),n("86273"),n("83856"),n("28022"),n("87694"),n("70651"),n("64096"),n("59178"),n("21706"),n("6386"),n("19977"),n("25225"),n("57738"),n("57225"),n("37893"),n("33209"),n("3527"),n("60975"),n("3611"),n("27634"),n("59145"),n("14142"),n("39812"),n("71942"),n("78070"),n("11825"),n("73546"),n("25804"),n("16249"),n("96344"),n("51236"),n("52552"),n("22372"),n("987"),n("47902"),n("92056"),n("25045"),n("71241"),n("94178"),n("87936"),n("55670"),n("11394"),n("78086"),n("13949"),n("95054"),n("27515"),n("45698"),n("18217"),n("32847"),n("71851"),n("24810"),n("60232"),n("51308"),n("55479"),n("57185"),n("45757"),n("82080"),n("83738"),n("86685"),n("85154"),n("59598"),n("22855"),n("56028"),n("91252"),n("96534"),n("21615")},17545:function(){"use strict";window.__assetPrefix__="//lf-flow-web-cdn.doubao.com/obj/flow-doubao/doubao/web"}}]);