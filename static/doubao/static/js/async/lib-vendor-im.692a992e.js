/*! For license information please see lib-vendor-im.692a992e.js.LICENSE.txt */
(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["8896"],{67907:function(e,t,i){var s,n;s=this,n=function(e){"use strict";var t;let s,n;function r(e,t,i,s){return new(i||(i=Promise))(function(n,r){function o(e){try{l(s.next(e))}catch(e){r(e)}}function a(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(o,a)}l((s=s.apply(e,t||[])).next())})}let o="";function a(){return 1e4*Date.now()+Math.floor(1e4*Math.random())}function l(e){return("000"+parseInt(e,2).toString(16)).slice(-4)}function c(e,t){switch(t){case 0:for(;128&y(e););break;case 2:f(e,b(e));break;case 5:f(e,4);break;case 1:f(e,8);break;default:throw Error("Unimplemented type: "+t)}}function h(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let u=[];function d(){let e=u.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function f(e,t){if(e.offset+t>e.limit)throw Error("Skip past limit");e.offset+=t}function p(e){return e.offset>=e.limit}function g(e,t){let i=e.bytes,s=e.offset,n=e.limit,r=s+t;if(r>i.length){let t=new Uint8Array(2*r);t.set(i),e.bytes=t}return e.offset=r,r>n&&(e.limit=r),s}function _(e,t){let i=e.offset;if(i+t>e.limit)throw Error("Read past limit");return e.offset+=t,i}function m(e,t){let i=_(e,t),s=String.fromCharCode,n=e.bytes,r="";for(let e=0;e<t;e++){let o,a,l,c;let h=n[e+i];(128&h)==0?r+=s(h):(224&h)==192?e+1>=t?r+="\uFFFD":(192&(o=n[e+i+1]))!=128?r+="\uFFFD":(c=(31&h)<<6|63&o)<128?r+="\uFFFD":(r+=s(c),e++):(240&h)==224?e+2>=t?r+="\uFFFD":(o=n[e+i+1],((o|(a=n[e+i+2])<<8)&49344)!=32896?r+="\uFFFD":(c=(15&h)<<12|(63&o)<<6|63&a)<2048||c>=55296&&c<=57343?r+="\uFFFD":(r+=s(c),e+=2)):(248&h)==240?e+3>=t?r+="\uFFFD":(o=n[e+i+1],a=n[e+i+2],((o|a<<8|(l=n[e+i+3])<<16)&12632256)!=8421504?r+="\uFFFD":(c=(7&h)<<18|(63&o)<<12|(63&a)<<6|63&l)<65536||c>1114111?r+="\uFFFD":(c-=65536,r+=s((c>>10)+55296,(1023&c)+56320),e+=3)):r+="\uFFFD"}return r}function v(e,t){let i=t.length,s=0;for(let e=0;e<i;e++){let n=t.charCodeAt(e);n>=55296&&n<=56319&&e+1<i&&(n=(n<<10)+t.charCodeAt(++e)-56613888),s+=n<128?1:n<2048?2:n<65536?3:4}E(e,s);let n=g(e,s),r=e.bytes;for(let e=0;e<i;e++){let s=t.charCodeAt(e);s>=55296&&s<=56319&&e+1<i&&(s=(s<<10)+t.charCodeAt(++e)-56613888),s<128?r[n++]=s:(s<2048?r[n++]=s>>6&31|192:(s<65536?r[n++]=s>>12&15|224:(r[n++]=s>>18&7|240,r[n++]=s>>12&63|128),r[n++]=s>>6&63|128),r[n++]=63&s|128)}}function y(e){return e.bytes[_(e,1)]}function w(e,t){let i=g(e,1);e.bytes[i]=t}function b(e){let t,i=0,s=0;do t=y(e),i<32&&(s|=(127&t)<<i),i+=7;while(128&t);return s}function E(e,t){for(t>>>=0;t>=128;)w(e,127&t|128),t>>>=7;w(e,t)}function C(e,t){let i,s=0,n=0,r=0;return s=127&(i=y(e)),128&i&&(s|=(127&(i=y(e)))<<7,128&i&&(s|=(127&(i=y(e)))<<14,128&i&&(s|=(127&(i=y(e)))<<21,128&i&&(n=127&(i=y(e)),128&i&&(n|=(127&(i=y(e)))<<7,128&i&&(n|=(127&(i=y(e)))<<14,128&i&&(n|=(127&(i=y(e)))<<21,128&i&&(r=127&(i=y(e)),128&i&&(r|=(127&(i=y(e)))<<7))))))))),{low:s|n<<28,high:n>>>4|r<<24,unsigned:t}}function k(e,t){let i=t.low>>>0,s=(t.low>>>28|t.high<<4)>>>0,n=t.high>>>24,r=0===n?0===s?i<16384?i<128?1:2:i<2097152?3:4:s<16384?s<128?5:6:s<2097152?7:8:n<128?9:10,o=g(e,r),a=e.bytes;switch(r){case 10:a[o+9]=n>>>7&1;case 9:a[o+8]=9!==r?128|n:127&n;case 8:a[o+7]=8!==r?s>>>21|128:s>>>21&127;case 7:a[o+6]=7!==r?s>>>14|128:s>>>14&127;case 6:a[o+5]=6!==r?s>>>7|128:s>>>7&127;case 5:a[o+4]=5!==r?128|s:127&s;case 4:a[o+3]=4!==r?i>>>21|128:i>>>21&127;case 3:a[o+2]=3!==r?i>>>14|128:i>>>14&127;case 2:a[o+1]=2!==r?i>>>7|128:i>>>7&127;case 1:a[o]=1!==r?128|i:127&i}}function T(e){return function(e){let t={};e:for(;!p(e);){let i=b(e);switch(i>>>3){case 0:break e;case 1:t.SeqID=C(e,!0);break;case 2:t.LogID=C(e,!0);break;case 3:t.service=b(e);break;case 4:t.method=b(e);break;case 5:{let i=function(e){let t=b(e),i=e.limit;return e.limit=e.offset+t,i}(e);(t.headers||(t.headers=[])).push(function(e){let t={};e:for(;!p(e);){let i=b(e);switch(i>>>3){case 0:break e;case 1:t.key=m(e,b(e));break;case 2:t.value=m(e,b(e));break;default:c(e,7&i)}}if(void 0===t.key)throw Error("Missing required field: key");if(void 0===t.value)throw Error("Missing required field: value");return t}(e)),e.limit=i;break}case 6:t.payloadEncoding=m(e,b(e));break;case 7:t.payloadType=m(e,b(e));break;case 8:t.payload=function(e,t){let i=_(e,t);return e.bytes.subarray(i,i+t)}(e,b(e));break;case 9:t.LogIDNew=m(e,b(e));break;default:c(e,7&i)}}if(void 0===t.SeqID)throw Error("Missing required field: SeqID");if(void 0===t.LogID)throw Error("Missing required field: LogID");if(void 0===t.service)throw Error("Missing required field: service");if(void 0===t.method)throw Error("Missing required field: method");return t}(function(e){return{bytes:e,offset:0,limit:e.length}}(e))}function S(e){return function(e){let t=d();return function(e,t){let i=e.SeqID;void 0!==i&&(E(t,8),k(t,i));let s=e.LogID;void 0!==s&&(E(t,16),k(t,s));let n=e.service;void 0!==n&&(E(t,24),k(t,h(n)));let r=e.method;void 0!==r&&(E(t,32),k(t,h(r)));let o=e.headers;if(void 0!==o)for(let e of o){E(t,42);let i=d();!function(e,t){let i=e.key;void 0!==i&&(E(t,10),v(t,i));let s=e.value;void 0!==s&&(E(t,18),v(t,s))}(e,i),E(t,i.limit),function(e,t){let i=g(e,t.limit),s=e.bytes,n=t.bytes;for(let e=0,r=t.limit;e<r;e++)s[e+i]=n[e]}(t,i),function(e){u.push(e)}(i)}let a=e.payloadEncoding;void 0!==a&&(E(t,50),v(t,a));let l=e.payloadType;void 0!==l&&(E(t,58),v(t,l));let c=e.payload;void 0!==c&&(E(t,66),E(t,c.length),function(e,t){let i=g(e,t.length);e.bytes.set(t,i)}(t,c));let f=e.LogIDNew;void 0!==f&&(E(t,74),v(t,f))}(e,t),function(e){let t=e.bytes,i=e.limit;return t.length===i?t:t.subarray(0,i)}(t)}(e)}let O=4294967296,L=18446744073709552e3,x=0x7fffffffffffffff,M=String.prototype.charCodeAt;class A{constructor(e,t,i){this.isLong=!0,this.low=0|e,this.high=0|t,this.unsigned=!!i}static isLong(e){return e&&!0===e.isLong}static fromBits(e,t,i){return new A(e,t,i)}static fromBytes(e,t,i){return i?A.fromBytesLE(e,t):A.fromBytesBE(e,t)}static fromBytesLE(e,t){return new A(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)}static fromBytesBE(e,t){return new A(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}static fromHash(e){return"\0\0\0\0\0\0\0\0"===e?I:new A((M.call(e,0)|M.call(e,1)<<8|M.call(e,2)<<16|M.call(e,3)<<24)>>>0,(M.call(e,4)|M.call(e,5)<<8|M.call(e,6)<<16|M.call(e,7)<<24)>>>0,!0)}toHash(){return String.fromCharCode(255&this.low,this.low>>>8&255,this.low>>>16&255,this.low>>>24,255&this.high,this.high>>>8&255,this.high>>>16&255,this.high>>>24)}static fromNumber(e,t=!0){if(isNaN(e))return t?D:I;if(t){if(e>=L)return B}else{if(e<=-x)return R;if(e+1>=x)return N}return A.fromBits(e%O|0,e/O|0,t)}toNumber(){return this.unsigned?(this.high>>>0)*O+(this.low>>>0):this.high*O+(this.low>>>0)}isZero(){return 0===this.high&&0===this.low}add(e){!A.isLong(e)&&(e=A.fromNumber(e));let t=this.high>>>16,i=65535&this.high,s=this.low>>>16,n=65535&this.low,r=e.high>>>16,o=65535&e.high,a=e.low>>>16,l=65535&e.low,c=0,h=0,u,d;return u=0+((d=0+(n+l))>>>16),d&=65535,u+=s+a,h+=u>>>16,u&=65535,h+=i+o,c+=h>>>16,h&=65535,c+=t+r,c&=65535,A.fromBits(u<<16|d,c<<16|h,this.unsigned)}equals(e){return!A.isLong(e)&&(e=A.fromNumber(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low}addOne(){return -1===this.low&&-1===this.high?A.fromBits(0,0,this.unsigned):-1===this.low?A.fromBits(0,this.high+1,this.unsigned):A.fromBits(this.low+1,this.high,this.unsigned)}toBytes(e){return e?this.toBytesLE():this.toBytesBE()}toBytesLE(){let e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]}toBytesBE(){let e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]}}let I=new A(0,0,!1),D=new A(0,0,!0),N=A.fromBits(-1,2147483647,!1),B=A.fromBits(-1,-1,!0),R=A.fromBits(0,-2147483648,!1);e.ErrorCode=void 0,(t=e.ErrorCode||(e.ErrorCode={}))[t.NATIVE_ERROR=5001]="NATIVE_ERROR",t[t.CONNECTING_ERROR=5002]="CONNECTING_ERROR",t[t.MAX_RETRIES_ERROR=5003]="MAX_RETRIES_ERROR",t[t.MESSAGE_ERROR=5004]="MESSAGE_ERROR",t[t.OPEN_ERROR=5005]="OPEN_ERROR";class P{constructor(e){this.type=e,this.target=null}}class $ extends P{constructor(e,t){super(e),this.message=t&&t.message||null}}class j extends P{constructor(t,i){super(t),this.error=i&&i.error||null,this.colno=i&&i.colno||0,this.filename=i&&i.filename||"",this.lineno=i&&i.lineno||0,this.message=i&&i.message||"",this.code=i&&i.code||e.ErrorCode.NATIVE_ERROR}}class q extends P{constructor(e,t){super(e),this.code=t&&t.code||0,this.reason=t&&t.reason||"",this.wasClean=t&&t.wasClean||!1,this.willReconnect=t&&t.willReconnect||!1}}class W extends P{constructor(e,t){super(e),this.data=t&&t.data||null}}class F extends W{constructor(e,t){super(e),this.data=t&&t.data||null,this.message=t&&t.message||null}}class H extends P{constructor(e,t){super(e),this.data=t&&t.data||null}}function G(e,{message:t,code:i}){return new j(e,{message:t,code:i})}function U(e,{code:t,reason:i,wasClean:s,willReconnect:n}){return new q(e,{code:t,reason:i,wasClean:s,willReconnect:n})}function J(e,{data:t,message:i}){return new F(e,{data:t,message:i})}function z(e,{data:t}){return new H(e,{data:t})}function Q(e,{message:t}){return new $(e,{message:t})}class X{constructor(e,t){this.endpoints=e,this.maxRetries=t,this.currentIndex=0,this.currentEndpointTriesCount=0}resetEndpointConfig(){this.currentIndex=0,this.currentEndpointTriesCount=0}resetTries(){this.currentEndpointTriesCount=0}getCurrentEndpoint(){return this.endpoints[this.currentIndex]}getCurrentEndpointTriesCount(){return this.currentEndpointTriesCount}checkReachMaxTries(){return!!(this.currentIndex>=this.endpoints.length)||this.currentIndex===this.endpoints.length-1&&this.currentEndpointTriesCount===this.maxRetries||!1}checkCurrentEndpointReachedMaxRetries(){return this.currentIndex==this.endpoints.length||this.currentEndpointTriesCount>this.maxRetries}replaceBackupEndpointAndUpdateCount(){return this.currentEndpointTriesCount=1,this.currentIndex++,this.endpoints[this.currentIndex]}getCurrentEndpointAndUpdateCount(){return this.currentEndpointTriesCount++,this.getCurrentEndpoint()}}let K=("undefined"!=typeof globalThis&&"Window"===globalThis.constructor.name||"undefined"!=typeof window&&"Window"===window.constructor.name)&&"undefined"!=typeof document,V="undefined"!=typeof globalThis&&("Object"===globalThis.constructor.name||"DedicatedWorkerGlobalScope"===globalThis.constructor.name)&&"undefined"!=typeof tt,Z=("undefined"!=typeof globalThis&&"Object"===globalThis.constructor.name||"undefined"==typeof globalThis||"undefined"!=typeof globalThis&&!!globalThis.WeixinJSBridge)&&"undefined"!=typeof wx,Y="undefined"!=typeof globalThis&&("DedicatedWorkerGlobalScope"===globalThis.constructor.name||"SharedWorkerGlobalScope"===globalThis.constructor.name||"ServiceWorkerGlobalScope"===globalThis.constructor.name)&&"undefined"!=typeof self,ee="undefined"!=typeof globalThis&&"Object"===globalThis.constructor.name&&"Object"===i.g.constructor.name&&"undefined"!=typeof process&&process.version;class et{constructor(){this._listeners={}}emit(e,...t){let i=this._listeners[e];if(i)i.slice().forEach(e=>e.fn.apply(e.ctx,t));else if("error"===e&&!this.onerror){let e=t.length&&t[0];if(e instanceof Error)throw e;throw Error("Unhandled error."+(e?" ("+e.message+")":"")).context=e,e}return this}off(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=null;else{let i=this._listeners[e];if(i)for(let e=0;e<i.length;)i[e].fn===t?i.splice(e,1):++e}return this}on(e,t,i){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:i||this}),this}}class ei extends et{constructor(e,t,i){super(),this._socket=null,Z&&wx.connectSocket&&(this._socket=wx.connectSocket({url:e,protocols:t,header:i,fail:this._createSocketFailHandler.bind(this),success:this._createSocketSuccessHandler.bind(this)})),V&&tt.connectSocket&&(this._socket=tt.connectSocket({url:e,protocols:t,header:i,fail:this._createSocketFailHandler.bind(this),success:this._createSocketSuccessHandler.bind(this)}))}_createSocketSuccessHandler(){Promise.resolve().then(()=>{this._addWsListeners()})}_createSocketFailHandler(e){Promise.resolve().then(()=>{let t=G("error",{message:e.errMsg||e.errNo?`message: ${e.errMsg}`||`code: ${e.errNo}`||"":JSON.stringify(e)});this.emit("error",t);let i=U("close",{reason:e.errMsg||e.errNo?`message: ${e.errMsg}`||`code: ${e.errNo}`||"":JSON.stringify(e)});this.emit("close",i)})}_addWsListeners(){this._socket.onOpen(e=>{this.emit("open",z("open",Object.assign(Object.assign({},e),{data:e.errMsg||""})))}),this._socket.onClose(e=>{this.emit("close",U("close",Object.assign({},e)))}),this._socket.onMessage(e=>{this.emit("message",J("message",Object.assign({},e)))}),this._socket.onError(e=>{this.emit("error",G("error",Object.assign(Object.assign({},e),{message:e.errMsg||""})))})}send(e){if(e instanceof Uint8Array){let t=e.buffer.slice(e.byteOffset,e.byteLength+e.byteOffset);this._socket&&this._socket.send({data:t,fail:e=>{this.emit("error",G("error",{message:e.errMsg||e.errNo?`message: ${e.errMsg}`||`code: ${e.errNo}`||"":JSON.stringify(e)}))}})}else this._socket&&this._socket.send({data:e,fail:e=>{this.emit("error",G("error",{message:e.errMsg||e.errNo?`message: ${e.errMsg}`||`code: ${e.errNo}`||"":JSON.stringify(e)}))}})}close(e,t){this._socket&&this._socket.close({code:e,reason:t})}addEventListener(e,t){this.on(e,t)}removeEventListener(e,t){this.off(e,t)}get readyState(){return this._socket.readyState}get binaryType(){return this._socket.binaryType}set binaryType(e){}get url(){return this._socket.url}get protocol(){return this._socket.protocol}get extensions(){return this._socket.extensions}get bufferedAmount(){return 0}}function es(e,t,i){return!!(null==e?void 0:e.find(e=>e.key===t&&e.value===i))}function en(e,t){var i;return null===(i=null==e?void 0:e.find(e=>e.key===t))||void 0===i?void 0:i.value}function er(e){return r(this,void 0,void 0,function*(){let{enableAutoAck:t}=this._options,i=es(e.message.headers,"need_ack","1"),s=es(e.message.headers,"is_ack","1"),n=es(e.message.headers,"x_frontier_qos_ack","1");if(t&&i){let{SeqID:t,LogID:i,service:s,LogIDNew:n,method:r}=e.message;this._sendAck({SeqID:t,LogID:i,LogIDNew:n,service:s,method:r,headers:[{key:"is_ack",value:"1"},{key:"ack_id",value:n||""},{key:"ack_code",value:"0"}]})}s&&!n&&this._dispatchAckMessageEvent(e)})}function eo(e){return r(this,void 0,void 0,function*(){if("string"==typeof e){let t=new Uint8Array(function(e){let t=0,i=0;for(let s=0;s<e.length;++s)(i=e.charCodeAt(s))<128?t+=1:i<2048?t+=2:(64512&i)==55296&&(64512&e.charCodeAt(s+1))==56320?(++s,t+=4):t+=3;return t}(e));return!function(e,t,i){let s,n;let r=i;for(let r=0;r<e.length;++r)(s=e.charCodeAt(r))<128?t[i++]=s:(s<2048?t[i++]=s>>6|192:((64512&s)==55296&&(64512&(n=e.charCodeAt(r+1)))==56320?(s=65536+((1023&s)<<10)+(1023&n),++r,t[i++]=s>>18|240,t[i++]=s>>12&63|128):t[i++]=s>>12|224,t[i++]=s>>6&63|128),t[i++]=63&s|128);}(e,t,0),t}if(e instanceof ArrayBuffer)return new Uint8Array(e);return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)})}function ea(e){return r(this,void 0,void 0,function*(){let t=T((yield eo(e.data)));try{if(t.payload instanceof Uint8Array){let e=this._options.payloadEncoding instanceof Object?{force:!!this._options.payloadEncoding.force,encoding:this._options.payloadEncoding.encoding?this._options.payloadEncoding.encoding.replace(/\s/g,"").toLowerCase():""}:{force:!1,encoding:this._options.payloadEncoding?this._options.payloadEncoding.replace(/\s/g,"").toLowerCase():""},i=t.payloadEncoding?t.payloadEncoding.replace(/\s/g,"").toLowerCase():"",s=this._options.payloadType instanceof Object?{force:!!this._options.payloadType.force,type:this._options.payloadType.type?this._options.payloadType.type.replace(/\s/g,"").toLowerCase():""}:{force:!1,type:this._options.payloadType?this._options.payloadType.replace(/\s/g,"").toLowerCase():""},n=t.payloadType?t.payloadType.replace(/\s/g,"").toLowerCase():"",r=s.force?s.type:n||s.type,o=e.force?e.encoding:i||e.encoding;this._options.enableTransformTextPayload&&["text/plain;charset=utf-8","application/json","application/json;charset=utf-8","string"].includes(r)&&(!o||["none_none","binary"].includes(o))?t.textPayload=function(e,t,i){if(i-t<1)return"";let s="";for(let n=t;n<i;){let t=e[n++];if(t<=127)s+=String.fromCharCode(t);else if(t>=192&&t<224)s+=String.fromCharCode((31&t)<<6|63&e[n++]);else if(t>=224&&t<240)s+=String.fromCharCode((15&t)<<12|(63&e[n++])<<6|63&e[n++]);else if(t>=240){let i=((7&t)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;s+=String.fromCharCode(55296+(i>>10))+String.fromCharCode(56320+(1023&i))}}return s}(t.payload,0,t.payload.byteLength):t.textPayload=""}else t.textPayload=""}catch(e){t.textPayload=""}e.message=t})}function el(e,t,i){let s=-1;return function t(n){return++s<i.length?i[s].bind(e)(n).then(()=>t(n)):Promise.resolve()}(t)}let ec=(e,t)=>t.some(t=>e instanceof t),eh=new WeakMap,eu=new WeakMap,ed=new WeakMap,ef=new WeakMap,ep=new WeakMap,eg={get(e,t,i){if(e instanceof IDBTransaction){if("done"===t)return eu.get(e);if("objectStoreNames"===t)return e.objectStoreNames||ed.get(e);if("store"===t)return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return e_(e[t])},set:(e,t,i)=>(e[t]=i,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function e_(e){if(e instanceof IDBRequest)return function(e){let t=new Promise((t,i)=>{let s=()=>{e.removeEventListener("success",n),e.removeEventListener("error",r)},n=()=>{t(e_(e.result)),s()},r=()=>{i(e.error),s()};e.addEventListener("success",n),e.addEventListener("error",r)});return t.then(t=>{t instanceof IDBCursor&&eh.set(t,e)}).catch(()=>{}),ep.set(t,e),t}(e);if(ef.has(e))return ef.get(e);let t=function(e){if("function"==typeof e){var t;return(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(n||(n=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(em(this),e),e_(eh.get(this))}:function(...e){return e_(t.apply(em(this),e))}:function(e,...i){let s=t.call(em(this),e,...i);return ed.set(s,e.sort?e.sort():[e]),e_(s)}}return(e instanceof IDBTransaction&&!function(e){if(eu.has(e))return;let t=new Promise((t,i)=>{let s=()=>{e.removeEventListener("complete",n),e.removeEventListener("error",r),e.removeEventListener("abort",r)},n=()=>{t(),s()},r=()=>{i(e.error||new DOMException("AbortError","AbortError")),s()};e.addEventListener("complete",n),e.addEventListener("error",r),e.addEventListener("abort",r)});eu.set(e,t)}(e),ec(e,s||(s=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(e,eg):e}(e);return t!==e&&(ef.set(e,t),ep.set(t,e)),t}let em=e=>ep.get(e),ev=["get","getKey","getAll","getAllKeys","count"],ey=["put","add","delete","clear"],ew=new Map;function eb(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(ew.get(t))return ew.get(t);let i=t.replace(/FromIndex$/,""),s=t!==i,n=ey.includes(i);if(!(i in(s?IDBIndex:IDBObjectStore).prototype)||!(n||ev.includes(i)))return;let r=async function(e,...t){let r=this.transaction(e,n?"readwrite":"readonly"),o=r.store;return s&&(o=o.index(t.shift())),(await Promise.all([o[i](...t),n&&r.done]))[0]};return ew.set(t,r),r}eg=(e=>({...e,get:(t,i,s)=>eb(t,i)||e.get(t,i,s),has:(t,i)=>!!eb(t,i)||e.has(t,i)}))(eg);class eE extends et{constructor(){super(),this._qosDB=void 0,this._intervalTimeoutId=null,this._interval=36e5,this._init()}openDB(){return r(this,void 0,void 0,function*(){yield this._init()})}_init(){return r(this,void 0,void 0,function*(){return new Promise(e=>{this._qosDB?e(this):((function(e,t,{blocked:i,upgrade:s,blocking:n,terminated:r}={}){let o=indexedDB.open(e,1),a=e_(o);return s&&o.addEventListener("upgradeneeded",e=>{s(e_(o.result),e.oldVersion,e.newVersion,e_(o.transaction))}),i&&o.addEventListener("blocked",()=>i()),a.then(e=>{r&&e.addEventListener("close",()=>r()),n&&e.addEventListener("versionchange",()=>n())}).catch(()=>{}),a})("frontier",1,{upgrade(e,t,i,s){e.createObjectStore("qos",{keyPath:"message_id"})}}).then(e=>{this._qosDB=e,this._intervalFlush(),this.emit("ready")}),this.on("ready",()=>{e(this),this.off()}))})})}_intervalFlush(){return r(this,void 0,void 0,function*(){clearInterval(this._intervalTimeoutId),this._intervalTimeoutId=setInterval(()=>{this.flushExpired()},this._interval)})}get(e){var t;return r(this,void 0,void 0,function*(){return yield null===(t=this._qosDB)||void 0===t?void 0:t.get("qos",e)})}set(e,t){var i;return r(this,void 0,void 0,function*(){return yield null===(i=this._qosDB)||void 0===i?void 0:i.put("qos",{message_id:e,timestamp:t})})}del(e){var t;return r(this,void 0,void 0,function*(){return yield null===(t=this._qosDB)||void 0===t?void 0:t.delete("qos",e)})}clear(){var e;return r(this,void 0,void 0,function*(){return yield null===(e=this._qosDB)||void 0===e?void 0:e.clear("qos")})}keys(){var e;return r(this,void 0,void 0,function*(){return yield null===(e=this._qosDB)||void 0===e?void 0:e.getAllKeys("qos")})}getAll(){var e;return r(this,void 0,void 0,function*(){return yield null===(e=this._qosDB)||void 0===e?void 0:e.getAll("qos")})}flushExpired(){var e;return r(this,void 0,void 0,function*(){((yield null===(e=this._qosDB)||void 0===e?void 0:e.getAll("qos"))||[]).filter(({timestamp:e})=>e<Date.now()).forEach(e=>{var t;null===(t=this._qosDB)||void 0===t||t.delete("qos",e.message_id)})})}closeDB(){var e;return r(this,void 0,void 0,function*(){clearInterval(this._intervalTimeoutId),null===(e=this._qosDB)||void 0===e||e.close(),this._qosDB=void 0})}get isReady(){return this._qosDB}}class eC{constructor(){this._qosDB=localStorage,this._intervalTimeoutId=null,this._interval=36e5,this._intervalFlush()}openDB(){return r(this,void 0,void 0,function*(){if(!this._intervalTimeoutId)return this._intervalFlush(),this})}_intervalFlush(){return r(this,void 0,void 0,function*(){clearInterval(this._intervalTimeoutId),this._intervalTimeoutId=setInterval(()=>{this.flushExpired()},this._interval)})}_add_prefix(e){return`${this._prefix}${e}`}get _prefix(){return"frontier_qos_msg_id_"}get(e){return r(this,void 0,void 0,function*(){return JSON.parse(this._qosDB.getItem(this._add_prefix(e))||"{}")})}set(e,t){return r(this,void 0,void 0,function*(){return this._qosDB.setItem(this._add_prefix(e),JSON.stringify({message_id:e,timestamp:t}))})}del(e){return r(this,void 0,void 0,function*(){return this._qosDB.removeItem(this._add_prefix(e))})}clear(){return r(this,void 0,void 0,function*(){return this._qosDB.clear()})}keys(){return r(this,void 0,void 0,function*(){let e=[];for(let t=0;t<this._qosDB.length;t++)e.push(this._qosDB.key(t));return e.filter(e=>null==e?void 0:e.startsWith(this._prefix))})}getAll(){return r(this,void 0,void 0,function*(){let e=[],t=yield this.keys();for(let i in t){let t=this._qosDB.getItem(i);e.push(JSON.parse(t||"{}"))}return e})}flushExpired(){return r(this,void 0,void 0,function*(){((yield this.getAll())||[]).filter(({timestamp:e})=>e<Date.now()).forEach(e=>{this.del(e.message_id)})})}closeDB(){clearInterval(this._intervalTimeoutId)}get isReady(){return this._qosDB}}class ek{constructor(){this._qosDB=V?tt:Z?wx:null,this._intervalTimeoutId=null,this._interval=36e5,this._intervalFlush()}openDB(){return r(this,void 0,void 0,function*(){if(!this._intervalTimeoutId)return this._intervalFlush(),this})}_intervalFlush(){return r(this,void 0,void 0,function*(){clearInterval(this._intervalTimeoutId),this._intervalTimeoutId=setInterval(()=>{this.flushExpired()},this._interval)})}_add_prefix(e){return`${this._prefix}${e}`}get _prefix(){return"frontier_qos_msg_id_"}get(e){return r(this,void 0,void 0,function*(){return JSON.parse(this._qosDB.getStorageSync(this._add_prefix(e))||"{}")})}set(e,t){return r(this,void 0,void 0,function*(){return this._qosDB.setStorageSync(this._add_prefix(e),JSON.stringify({message_id:e,timestamp:t}))})}del(e){return r(this,void 0,void 0,function*(){return this._qosDB.removeStorageSync(this._add_prefix(e))})}clear(){return r(this,void 0,void 0,function*(){return this._qosDB.clearStorageSync()})}keys(){return r(this,void 0,void 0,function*(){let{keys:e}=this._qosDB.getStorageInfoSync();return e.filter(e=>null==e?void 0:e.startsWith(this._prefix))})}getAll(){return r(this,void 0,void 0,function*(){let e=[];for(let t of yield this.keys()){let i=yield this.get(t);e.push(i)}return e})}flushExpired(){return r(this,void 0,void 0,function*(){((yield this.getAll())||[]).filter(({timestamp:e})=>e<Date.now()).forEach(e=>{this.del(e.message_id)})})}closeDB(){clearInterval(this._intervalTimeoutId)}get isReady(){return this._qosDB}}function eT(){return V||V?new ek:K||Y?new eE:K||Y?new eC:null}function eS(e){var t,i,s,n;return r(this,void 0,void 0,function*(){let r=es(e.message.headers,"code","-1"),o=es(e.message.headers,"is_ack","1"),a=en(e.message.headers,"x_frontier_msgid"),l=Number(en(e.message.headers,"x_frontier_ttl"))||0,c=es(e.message.headers,"x_frontier_qos","2");if(!es(e.message.headers,"x_frontier_qos_ack","1")||!c){if(c&&!this._qosDB&&(this._qosDB=eT(),this._qosDB&&(yield this._qosDB.openDB())),c&&!this._qosDB.isReady&&(yield this._qosDB.openDB()),e.message.service>0&&o&&!r){a&&c?!(yield null===(t=this._qosDB)||void 0===t?void 0:t.get(a))&&(this._dispatchMessageEvent(e),yield null===(i=this._qosDB)||void 0===i?void 0:i.set(a,Date.now()+l)):this._dispatchMessageEvent(e);return}if(e.message.service>0){a&&c?!(yield null===(s=this._qosDB)||void 0===s?void 0:s.get(a))&&(this._dispatchMessageEvent(e),yield null===(n=this._qosDB)||void 0===n?void 0:n.set(a,Date.now()+l)):this._dispatchMessageEvent(e);return}}})}function eO(e){return r(this,void 0,void 0,function*(){this._uptimeTimeoutId=setTimeout((()=>eL.bind(this)(e)).bind(this),this._options.uptimeInterval)})}function eL(e){var t,i;return r(this,void 0,void 0,function*(){if(!this._ws||this._ws.readyState!==this.OPEN)return;let{pingInterval:s}=this._options;null===(t=this._endpointManager)||void 0===t||t.resetEndpointConfig();for(let e=0;e<this._messageQueue.length;e++){let t=this._messageQueue[e];if(this._ws.readyState===this.OPEN&&null!==t)this._ws&&this._ws.send(t),this._messageQueue[e]=null;else break}this._messageQueue=this._messageQueue.filter(e=>!!e),this._pingPongTimeoutId=setTimeout(()=>this._ping(),s),this._dispatchOpenEvent(e),this._isBrowser&&this._ws&&(this._ws.binaryType=this._binaryType);let n=null===(i=this._endpointManager)||void 0===i?void 0:i.getCurrentEndpoint();this._debug(`open ${n} success`)})}function ex(){return r(this,void 0,void 0,function*(){this._isInit=!1,clearTimeout(this._connectionTimeoutId)})}function eM(e){var t,i;return r(this,void 0,void 0,function*(){let s=es(e.message.headers,"x_frontier_qos","2"),n=es(e.message.headers,"x_frontier_is_ack","1"),r=null===(t=en(e.message.headers,"x_frontier_ack_msgid"))||void 0===t?void 0:t.split(",");if(s&&!this._qosDB&&(this._qosDB=eT(),this._qosDB&&(yield this._qosDB.openDB())),s&&!this._qosDB.isReady&&(yield this._qosDB.openDB()),s&&n&&r&&r.length)for(let e of r)yield null===(i=this._qosDB)||void 0===i?void 0:i.del(e)})}let eA=(e,t)=>{switch(e){case"boe":case"ppe":return{[`x-use-${e}`]:1,"x-tt-env":t};default:return{}}};class eI{constructor(e){this.maxLossCount=e,this.count=0}addCount(){this.count++}checkReachMaxCount(){return this.count>=this.maxLossCount}resetCounter(e=0){this.maxLossCount=e,this.count=0}}e.CustomCloseEvent=q,e.CustomErrorEvent=j,e.Event=P,e.FWS=class t extends et{constructor(t){super(),this._miniNavigatorOnline=!0,this._isBrowser=K,this._isNode=ee,this._isMiniTT=V,this._isMiniWX=Z,this._isWorker=Y,this._messageQueue=[],this._endpointManager=null,this._readyClosed=!1,this._binaryType="arraybuffer",this._connectLock=!1,this._connectionTimeoutId=null,this._uptimeTimeoutId=null,this._reconnectTimeoutId=null,this._pingPongTimeoutId=null,this._seqId=0,this._isInit=!1,this._url="",this._qosDB=null,this._pingLossCounter=null,this._protocols="pbbp2",this.CLOSED=3,this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this._onOpen=t=>{el(this,t,[ex,eO]).then(()=>{var e;let t=null===(e=this._endpointManager)||void 0===e?void 0:e.getCurrentEndpoint();this._debug(`open ${t}`)}).catch(t=>{let i=G("error",{message:t.message,code:e.ErrorCode.OPEN_ERROR});this._dispatchErrorEvent(i)})},this._onMessage=t=>r(this,void 0,void 0,function*(){let{pingInterval:i,pingFrequency:s}=this._options;("hi"===t.data&&"always"===s||"auto"===s)&&(this._clearPingTimer(),this.emit("ping_once_success","success"),this._pingPongTimeoutId=setTimeout(()=>this._ping(),i)),"hi"!==t.data&&el(this,t,[ea,er,eM,eS]).then(()=>{this._debug("received",t.message)}).catch(t=>{let i=G("error",{message:t.message,code:e.ErrorCode.MESSAGE_ERROR});this._dispatchErrorEvent(i)})}),this._onError=t=>{var i,s;let n=null===(i=this._endpointManager)||void 0===i?void 0:i.checkReachMaxTries(),r=null===(s=this._endpointManager)||void 0===s?void 0:s.getCurrentEndpoint();if(n&&!t.message){let t=`connect ${r} fail, max retries reached`;this._dispatchErrorEvent(G("error",{message:t,code:e.ErrorCode.MAX_RETRIES_ERROR}));return}this._ws&&this._ws.readyState===this.OPEN&&this._disconnect(),this._dispatchErrorEvent(G("error",{message:t.message,code:e.ErrorCode.NATIVE_ERROR}))},this._onClose=t=>r(this,void 0,void 0,function*(){var i,s,n,o,a,l,c,h,u,d,f,p;this._clearTimer(),this._clearPingTimer(),this._removeWsListeners(),this._ws=null,this._connectLock=!1;let g=null===(i=this._endpointManager)||void 0===i?void 0:i.checkReachMaxTries();if(!g&&this._navigatorOnline()&&!this._readyClosed){let e=null===(s=this._endpointManager)||void 0===s?void 0:s.getCurrentEndpoint(),i=this._options.reconnectInterceptor(t.code,t.reason);this._dispatchCloseEvent(U("close",{code:1006,reason:t.reason||`connecting failed, unknown reason, hostname: ${e}`,willReconnect:i})),i&&this._connect();return}if(1e3!==t.code&&this._readyClosed){this._dispatchCloseEvent(U("close",{code:1e3,reason:"bye"})),null===(n=this._endpointManager)||void 0===n||n.resetEndpointConfig(),null===(o=this._pingLossCounter)||void 0===o||o.resetCounter();return}if(1e3!==t.code&&g){let i=null===(a=this._endpointManager)||void 0===a?void 0:a.getCurrentEndpoint(),s=t.reason;!s&&(s=yield function(e){return r(this,void 0,void 0,function*(){return new Promise(t=>{if(!K)return t("unknown reason");try{let i=document.createElement("script");window.frontierJSONP=e=>{document.body.removeChild(i),window.frontierJSONP=void 0,t(e&&e.msg||"unknown reason")},i.type="text/javascript",i.src=e.replace(/^ws/,"http")+"&jscallback=frontierJSONP";try{document.body.appendChild(i)}catch(e){document.body.removeChild(i)}}catch(e){window.frontierJSONP=void 0,t("unknown reason")}})})}(this._url)),s=`connecting failed, ${s}, hostname: ${i}, max retries reached`,this._dispatchCloseEvent(U("close",{code:t.code,reason:s}));let n=`connect ${i} fail, max retries reached`;this._dispatchErrorEvent(G("error",{message:n,code:e.ErrorCode.MAX_RETRIES_ERROR})),null===(l=this._endpointManager)||void 0===l||l.resetEndpointConfig(),null===(c=this._pingLossCounter)||void 0===c||c.resetCounter();return}if(1e3!==t.code&&!t.reason){let e=null===(h=this._endpointManager)||void 0===h?void 0:h.getCurrentEndpoint();this._dispatchCloseEvent(U("close",{code:t.code,reason:`connecting failed, unknown reason, hostname: ${e}`})),null===(u=this._endpointManager)||void 0===u||u.resetEndpointConfig(),null===(d=this._pingLossCounter)||void 0===d||d.resetCounter();return}this._dispatchCloseEvent(t),null===(f=this._endpointManager)||void 0===f||f.resetEndpointConfig(),null===(p=this._pingLossCounter)||void 0===p||p.resetCounter()}),this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this.onStartReconnect=null,this.onReceiveAck=null,this.onStopImmediatelyReconnect=null,this._options={url:"",automaticOpen:!0,initReconnectInterval:1e3,maxReconnectInterval:1e4,reconnectIntervalGrowFactor:2,timeoutInterval:5e3,uptimeInterval:1e3,maxRetries:5,debug:!1,maxMessageQueueLength:1/0,service:0,logIDGenerator:a,headers:void 0,payloadEncoding:"",payloadType:"",fpID:"",deviceID:"",accessKey:"",ttwID:"",bddID:"",aID:"",disableAutoReconnect:!1,customParams:{},pingInterval:15e3,pingTimeoutInterval:4e3,pingFrequency:"auto",pingLossCount:2,enableTransformTextPayload:!1,logIDNewConfig:{enableAutoGenerateLogIDNew:!1,userIp:""},miniProgramParams:{customHttpHeader:{}},enableAutoAck:!1,reconnectInterceptor:()=>!0,enableQoS:!1,env:{xTTEnv:"",xUseEnv:""},listenNetworkChanged:!0};let{url:i,ws:s}=t,n=Array.isArray(i)?i:"string"==typeof i?[i]:[];if(!n||0===n.length)throw Error("please provide valid url");if(!(s||Z&&wx.connectSocket||V&&tt.connectSocket||(K||Y)&&"undefined"!=typeof WebSocket&&WebSocket))throw Error("please provide ws params, WebSocket constructor is undefined");Object.assign(this._options,t),this._endpointManager=new X(n,this._options.maxRetries),this._pingLossCounter=new eI(this._options.pingLossCount),this._options.automaticOpen&&(this._isInit=!0,this._connect()),this._options.listenNetworkChanged&&(this._isMiniTT||this._isMiniWX?this._onPageNetWorkChange():this._isBrowser&&this._initGlobalEventListener())}_handleOnLine(){!this._options.disableAutoReconnect&&!this._readyClosed&&this._handleReconnect()}_handleOffLine(){this._destroyWebSocket();let e=Q("reconnect",{message:"stop immediately reconnect"});this.onStopImmediatelyReconnect&&this.onStopImmediatelyReconnect(e)}_initGlobalEventListener(){this._isBrowser&&window.addEventListener("online",this._handleOnLine.bind(this)),this._isBrowser&&window.addEventListener("offline",this._handleOffLine.bind(this)),this._isBrowser&&window.addEventListener("pagehide",this._handlePageHide.bind(this)),this._isBrowser&&window.addEventListener("pageshow",this._handlePageShow.bind(this))}_dropGlobalEventListener(){this._isBrowser&&window.removeEventListener("online",this._handleOnLine),this._isBrowser&&window.removeEventListener("offline",this._handleOffLine),this._isBrowser&&window.removeEventListener("pagehide",this._handlePageHide),this._isBrowser&&window.removeEventListener("pageshow",this._handlePageShow)}_handlePageHide(e){!e.persisted&&(this._isBrowser&&window.removeEventListener("pagehide",this._handlePageHide),this._isBrowser&&window.removeEventListener("pageshow",this._handlePageShow),this.close()),this._isBrowser&&window.removeEventListener("online",this._handleOnLine),this._isBrowser&&window.removeEventListener("offline",this._handleOffLine)}_handlePageShow(e){e.persisted&&(this._navigatorOnline()&&(!this._ws||this._ws.readyState!==this.OPEN||this._ws.readyState!==this.CONNECTING)&&this._handleOnLine(),this._isBrowser&&window.addEventListener("online",this._handleOnLine.bind(this)),this._isBrowser&&window.addEventListener("offline",this._handleOffLine.bind(this)))}_generateUrl(e){return r(this,void 0,void 0,function*(){let t,i,s;let{fpID:n,deviceID:r,bddID:o,ttwID:a,accessKey:l,aID:c,customParams:h={},enableAutoAck:u,enableQoS:d,env:f}=this._options;this._isBrowser||this._isMiniWX||this._isMiniTT?(t=location&&"https:"==location.protocol?"wss://":"ws://",i=e.replace(/((^ws)|(^http))((?:[s]*:\/\/))/,""),s=/^wss(.*:\/\/)/.test(e)?e:`${t}${i}`):(t="wss://",i=e.replace(/(^http)((?:[s]*:\/\/))/,""),s=/(^ws)((?:[s]*:\/\/))/.test(i)?i:`${t}${i}`);let p=o?"bd_did":a?"ttwid":"device_id",g=o||a||r;if(!g||!p)throw Error("please provide bddID, deviceID or ttwID");let _="function"==typeof h?yield h():h,m=Object.assign(Object.assign({device_platform:"web",version_code:"fws_1.0.0",access_key:l,fpid:n,aid:c,[p]:g,xsack:u?1:0,xaack:u?1:0,xsqos:d?1:0},f?eA(f.xUseEnv,f.xTTEnv):{}),_),v=Object.keys(m).reduce((e,t)=>`${e}${e?"&":"?"}${t}=${m[t]}`,"");return`${s}/ws/v2${v}`})}_connect(){var t,i,s,n,o,a,l;return r(this,void 0,void 0,function*(){if(!this._connectLock&&!this._readyClosed){this._connectLock=!0;try{var r,c;let h=null===(t=this._endpointManager)||void 0===t?void 0:t.checkCurrentEndpointReachedMaxRetries(),{timeoutInterval:u}=this._options;if(h){let t=null===(i=this._endpointManager)||void 0===i?void 0:i.getCurrentEndpoint(),r=null===(s=this._endpointManager)||void 0===s?void 0:s.replaceBackupEndpointAndUpdateCount(),o=null===(n=this._endpointManager)||void 0===n?void 0:n.getCurrentEndpointTriesCount();if(r){let i=`connect ${t} timeout, max retries reached, will use backup endpoint ${r} to retry`,s=G("error",{message:i,code:e.ErrorCode.MAX_RETRIES_ERROR});this._debug(i),this._dispatchErrorEvent(s),this._url=yield this._generateUrl(r),this._debug(`connect ${r} ${o} times`),this._removeWsListeners()}else{let i=`connect ${t} timeout, max retries reached`;this._debug(i),this._dispatchErrorEvent(G("error",{message:i,code:e.ErrorCode.MAX_RETRIES_ERROR}));return}}else{let e=null===(o=this._endpointManager)||void 0===o?void 0:o.getCurrentEndpointAndUpdateCount(),t=null===(a=this._endpointManager)||void 0===a?void 0:a.getCurrentEndpointTriesCount();this._url=yield this._generateUrl(e||""),this._debug(`connect ${e} ${t} times`),this._removeWsListeners()}if(this._isInit)this._isInit=!1;else{let e=Q("reconnect",{message:"start"});this.onStartReconnect&&this.onStartReconnect(e)}let d=(null===(l=this._endpointManager)||void 0===l?void 0:l.getCurrentEndpointTriesCount())||0;d>1&&(yield this._wait(d-1)),this._debug(`connecting url: ${this._url} protocols: ${this._protocols}`),this._ws=(r={url:this._url,protocols:[this._protocols],headers:this._options.miniProgramParams.customHttpHeader},(c=this._options.ws)?new c(r.url,r.protocol):Z||V?new ei(r.url,r.protocol,r.headers):(K||Y)&&"undefined"!=typeof WebSocket&&WebSocket?new WebSocket(r.url,r.protocols):void 0),(this._isBrowser||this._isWorker)&&this._ws&&(this._ws.binaryType=this._binaryType),this._addWsListeners(),this._connectionTimeoutId=setTimeout(()=>this._onTimeout(),u)}catch(e){throw this._connectLock=!1,e}}})}_clearTimer(){clearTimeout(this._connectionTimeoutId),clearTimeout(this._uptimeTimeoutId),this._connectionTimeoutId=null,this._uptimeTimeoutId=null}_clearPingTimer(){clearTimeout(this._pingPongTimeoutId),clearTimeout(this._reconnectTimeoutId),this._pingPongTimeoutId=null,this._reconnectTimeoutId=null}_debug(...e){this._options.debug}_getIntervalValue(e){let{initReconnectInterval:t,maxReconnectInterval:i,reconnectIntervalGrowFactor:s}=this._options,n=t*Math.pow(s,e-1);return n>i?i:n}_ping(){if(this._ws&&this._ws.readyState===this.CONNECTING){this._pingPongTimeoutId=setTimeout(()=>this._ping(),this._options.pingInterval);return}if(!this._ws||this._ws.readyState!==this.OPEN){this._handleReconnect();return}this._ws&&this._ws.send("hi"),this._reconnectTimeoutId=setTimeout(()=>{var e,t;null===(e=this._pingLossCounter)||void 0===e||e.addCount(),this.emit("ping_once_timeout","timeout"),(null===(t=this._pingLossCounter)||void 0===t?void 0:t.checkReachMaxCount())?this._handleReconnect():this._ping()},this._options.pingTimeoutInterval)}_navigatorOnline(){return this._isMiniTT||this._isMiniWX?this._miniNavigatorOnline:!this._isBrowser&&!this._isWorker||!this._options.listenNetworkChanged||navigator.onLine}_handleReconnect(){var e,t;this._navigatorOnline()&&!this._readyClosed&&(null===(e=this._endpointManager)||void 0===e||e.resetEndpointConfig(),null===(t=this._pingLossCounter)||void 0===t||t.resetCounter(),this._ws?this._disconnect(1001,"going away, try reconnecting server",!0):this._connect())}_onPageNetWorkChange(){this._isMiniTT?tt.onNetworkStatusChange(({isConnected:e})=>{this._miniNavigatorOnline=e,e?this._handleOnLine():this._handleOffLine()}):this._isMiniWX&&wx.onNetworkStatusChange(({isConnected:e})=>{this._miniNavigatorOnline=e,e?this._handleOnLine():this._handleOffLine()})}_wait(e){return new Promise(t=>{setTimeout(t,this._getIntervalValue(e))})}_disconnect(e=1e3,t="",i=!1){this._ws&&this._destroyWebSocket(e,t,i)}_onTimeout(){var e;let t=null===(e=this._endpointManager)||void 0===e?void 0:e.getCurrentEndpoint();this._debug(`connect ${t} timeout`),this._disconnect(1001,"timeout, try reconnecting",!0)}_sendAck(e){let t=S(e);this._ws&&this._ws.readyState===this.OPEN&&(this._ws&&this._ws.send(t),this._debug("send_ack",e))}_removeWsListeners(){this._ws&&(this._ws.removeEventListener("open",this._onOpen),this._ws.removeEventListener("close",this._onClose),this._ws.removeEventListener("message",this._onMessage),this._ws.removeEventListener("error",this._onError))}_addWsListeners(){this._ws&&(this._ws.addEventListener("open",this._onOpen),this._ws.addEventListener("close",this._onClose),this._ws.addEventListener("message",this._onMessage),this._ws.addEventListener("error",this._onError))}_wsInstanceClose(e=1e3,t=""){try{this._ws&&this._ws.close(e,t)}catch(e){}}_destroyWebSocket(e=1e3,t="",i=!1){var s,n,r,o;if(this._clearPingTimer(),this._clearTimer(),this._removeWsListeners(),this._wsInstanceClose(1e3,t),this._connectLock=!1,i&&this._navigatorOnline()&&!this._readyClosed){if(null===(s=this._endpointManager)||void 0===s?void 0:s.checkReachMaxTries()){let e=null===(n=this._endpointManager)||void 0===n?void 0:n.getCurrentEndpoint();this._dispatchCloseEvent(U("close",{code:1006,reason:`connect ${e} timeout, max retries reached`,wasClean:!0}))}else{let i=this._options.reconnectInterceptor(e,t);this._dispatchCloseEvent(U("close",{code:e,reason:t,wasClean:!0,willReconnect:i})),i&&this._connect()}return}this._navigatorOnline()||this._readyClosed?this._dispatchCloseEvent(U("close",{code:e,reason:"bye"})):this._dispatchCloseEvent(U("close",{code:1006,reason:"going away, network offline"})),this._ws=null,null===(r=this._endpointManager)||void 0===r||r.resetEndpointConfig(),null===(o=this._pingLossCounter)||void 0===o||o.resetCounter()}_dispatchOpenEvent(e){this.emit("open",e),this.onopen&&this.onopen(e)}_dispatchMessageEvent(e){this.emit("message",e),this.onmessage&&this.onmessage(e)}_dispatchAckMessageEvent(e){this.emit("ack",e),this.onReceiveAck&&this.onReceiveAck(e)}_dispatchErrorEvent(e){this.emit("error",e),this.onerror&&this.onerror(e)}_dispatchCloseEvent(e){this.emit("close",e),this.onclose&&this.onclose(e)}get binaryType(){return this._ws?this._ws.binaryType:this._binaryType}set binaryType(e){this._binaryType=e,this._ws&&(this._ws.binaryType=e)}get retryCount(){var e;return(null===(e=this._endpointManager)||void 0===e?void 0:e.getCurrentEndpointTriesCount())||0}get bufferedAmount(){return this._messageQueue.reduce((e,t)=>e+=t&&t.byteLength||0,0)+(this._ws?this._ws.bufferedAmount:0)}get extensions(){return this._ws?this._ws.extensions:""}get protocol(){return this._ws?this._ws.protocol:""}get readyState(){return this._ws?this._ws.readyState:this._options.automaticOpen?this.CONNECTING:this.CLOSED}get url(){return this._ws?this._ws.url:this._url}close(e=1e3,t){var i;if(this._readyClosed=!0,this._clearTimer(),this._clearPingTimer(),null===(i=this._qosDB)||void 0===i||i.closeDB(),this._dropGlobalEventListener(),!this._ws){this._debug("close, ws instance not initialized");return}if(this._ws.readyState===this.CLOSED||this._ws.readyState===this.CLOSING){this._debug("close, ws already closed");return}this._destroyWebSocket(e,t)}send(e,t){return r(this,void 0,void 0,function*(){if(null==e)throw Error("please provide a valid data, data must be a string or an arraybuffer");"number"==typeof e&&(e=JSON.stringify(e)),"string"!=typeof e&&!(e instanceof ArrayBuffer)&&!(e.buffer&&e.buffer instanceof ArrayBuffer)&&(e=JSON.stringify(e));let i=yield eo(e),s=function(e){try{if("string"!=typeof e&&(e instanceof ArrayBuffer||e.buffer&&e.buffer instanceof ArrayBuffer))return"";if("string"==typeof e)return JSON.parse(e),"application/json";else return""}catch(t){if("string"==typeof e)return"text/plain;charset=utf-8";return""}}(e),{method:n=0,service:r=this._options.service,logID:a=this._options.logIDGenerator(),headers:c=this._options.headers,payloadEncoding:h=this._options.payloadEncoding,payloadType:u=this._options.payloadType,logIDNew:d=this._options.logIDNewConfig.enableAutoGenerateLogIDNew?function(e=""){let t=`${Date.now()}`,i=o||(o=function(e){let t=/(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}/.test(e),i=/(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))/.test(e);return t?function(e){let t=e.split(/\./).map(e=>{var t;return t=e,(Array(8).join("0")+parseInt(t,10).toString(2)).slice(-8)}),i=[];return i[0]=l(t[0]+t[1]),i[1]=l(t[2]+t[3]),["0000","0000","0000","0000","0000","ffff",i[0],i[1]].join("")}(e):i?function(e){let t="",i=[],s=0,n=0,r=!0,o="0000";if(e.indexOf("::")>-1){let a=e.split("::");for(let e=0;e<a.length;e++){let t=a[e];if(t.indexOf(":")>0){let e=t.split(":");r&&(s=e.length),n+=e.length;for(let t=0;t<e.length;t++)if(4!==e[t].length){let s=o.substring(0,4-e[t].length).concat(e[t]);i.push(s)}else i.push(e[t]);r=!1}else{if(4!==t.length){let e=o.substring(0,4-t.length).concat(t);i.push(e)}else i.push(t);r&&(s+=1),n+=1,r=!1}}let l="";for(let e=0;e<8-n;e++)l=l.concat(o);for(let e=0;e<i.length;e++)t=e===s?(t=t.concat(l)).concat(i[e]):t.concat(i[e]);return t}{let i=e.split(":");for(let e=0;e<i.length;e++){let s=i[e];if(4!==i[e].length){let n=o.substring(0,4-i[e].length).concat(s);t=t.concat(n)}else t=t.concat(s)}return t}}(e):"00000000000000000000000000000000"}(e));return"02"+t+i+Math.random().toString(16).slice(-6)}(this._options.logIDNewConfig.userIp):""}=t||{};if(!r)throw Error("please provide a valid service");let f={SeqID:A.fromNumber(this._seqId++),LogID:A.fromNumber(a),service:r,method:n,headers:c,payloadEncoding:h instanceof Object?h.encoding?h.encoding:"":h,payloadType:u instanceof Object?u.type?u.type:s:u||s,payload:i,LogIDNew:d},p=S(f);return this._ws&&this._ws.readyState===this.OPEN?(this._ws&&this._ws.send(p),this._debug("sent",f)):this._messageQueue.length<this._options.maxMessageQueueLength?(this._messageQueue.push(p),this._debug("enqueue",f)):(this._messageQueue.shift(),this._messageQueue.push(p)),this._seqId})}reconnect(e){var t,i;return r(this,void 0,void 0,function*(){let{url:s}=e||{},n=Array.isArray(s)?s:"string"==typeof s?[s]:[];e&&Object.assign(this._options,e),n&&n.length?this._endpointManager=new X(n,this._options.maxRetries):null===(t=this._endpointManager)||void 0===t||t.resetEndpointConfig(),null===(i=this._pingLossCounter)||void 0===i||i.resetCounter(this._options.pingLossCount),this._readyClosed=!1,this._ws&&this._ws.readyState!==this.CLOSED?this._disconnect(1e3,"manual reconnecting",!0):(this._isInit=!0,this._connect())})}connect(){var e,t;return r(this,void 0,void 0,function*(){!this._connectLock&&(null===(e=this._endpointManager)||void 0===e||e.resetEndpointConfig(),null===(t=this._pingLossCounter)||void 0===t||t.resetCounter(),this._readyClosed=!1,this._isInit=!0,this._connect())})}addEventListener(e,t){this.on(e,t)}dispatchEvent(e){let{type:t}=e;this.emit(t,e)}removeEventListener(e,t){this.off(e,t)}pingOnce(){return new Promise((e,t)=>{this._clearPingTimer(),this._pingPongTimeoutId=setTimeout(()=>this._ping(),this._options.pingInterval);let i=()=>{e("success"),this.off("ping_once_success",i),this.off("ping_once_timeout",s)},s=()=>{t("timeout"),this.off("ping_once_success",i),this.off("ping_once_timeout",s)};this.on("ping_once_success",i),this.on("ping_once_timeout",s),this._ping()})}},e.FrontierMessageEvent=F,e.MessageEvent=W,e.OpenEvent=H,e.ReconnectEvent=$,e.createCloseEvent=U,e.createErrorEvent=G,e.createMessageEvent=J,e.createOpenEvent=z,e.createReconnectEvent=Q,e.decodedFrame=T,e.encodeFrame=S,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof t?n(t):"function"==typeof define&&define.amd?define(["exports"],n):n((s="undefined"!=typeof globalThis?globalThis:s||self).fws={})},47546:function(e,t,i){"use strict";i.d(t,{AsyncHook:function(){return r},AsyncWaterfallHook:function(){return l},PluginSystem:function(){return c},SyncHook:function(){return n},SyncWaterfallHook:function(){return a}});var s=i("44698"),n=class{constructor(e){this.type="",this.listeners=new Set,e&&(this.type=e)}on(e){"function"==typeof e?this.listeners.add(e):("undefined"!=typeof process&&process.env,!1)}once(e){let t=this;this.on(function i(...s){return t.remove(i),e.apply(null,s)})}emit(...e){this.listeners.size>0&&this.listeners.forEach(t=>t.apply(null,e))}remove(e){return this.listeners.delete(e)}removeAll(){this.listeners.clear()}},r=class extends n{emit(...e){let t;let i=Array.from(this.listeners);if(i.length>0){let s=0,n=t=>!1!==t&&(s<i.length?Promise.resolve(i[s++].apply(null,e)).then(n):t);t=n()}return Promise.resolve(t)}};function o(e,t){if(!(0,s.isObject)(t))return!1;if(e!==t){for(let i in e)if(!(i in t))return!1}return!0}var a=class extends n{constructor(e){super(),this.onerror=s.error,this.type=e}emit(e){for(let t of(!(0,s.isObject)(e)&&(0,s.error)(`"${this.type}" hook response data must be an object.`),this.listeners))try{let i=t(e);if(o(e,i))e=i;else{this.onerror(`The return value of hook "${this.type}" is incorrect.`);break}}catch(e){"undefined"!=typeof process&&process.env,this.onerror(e)}return e}},l=class extends n{constructor(e){super(),this.onerror=s.error,this.type=e}emit(e){!(0,s.isObject)(e)&&(0,s.error)(`"${this.type}" hook response data must be an object.`);let t=Array.from(this.listeners);if(t.length>0){let i=0,s=t=>("undefined"!=typeof process&&process.env,this.onerror(t),e),n=r=>{if(!1===r)return!1;if(o(e,r)){if(e=r,i<t.length)try{return Promise.resolve(t[i++](e)).then(n,s)}catch(e){return s(e)}}else this.onerror(`The return value of hook "${this.type}" is incorrect.`);return e};return Promise.resolve(n(e))}return Promise.resolve(e)}},c=class{constructor(e){this.registerPlugins={},this.lifecycle=e,this.lifecycleKeys=Object.keys(e)}usePlugin(e){(0,s.assert)((0,s.isPlainObject)(e),"Invalid plugin configuration.");let t=e.name;if((0,s.assert)(t,"Plugin must provide a name."),this.registerPlugins[t])(0,s.warn)(`Repeat to register plugin hooks "${t}".`);else for(let i in this.registerPlugins[t]=e,this.lifecycle){let t=e[i];t&&this.lifecycle[i].on(t)}}removePlugin(e){(0,s.assert)(e,"Must provide a name.");let t=this.registerPlugins[e];for(let i in(0,s.assert)(t,`plugin "${e}" is not registered.`),t)"name"!==i&&this.lifecycle[i].remove(t[i])}inherit({lifecycle:e,registerPlugins:t}){for(let t in e)(0,s.assert)(!this.lifecycle[t],`"${t}" hook has conflict and cannot be inherited.`),this.lifecycle[t]=e[t];for(let e in t)(0,s.assert)(!this.registerPlugins[e],`"${e}" plugin has conflict and cannot be inherited.`),this.usePlugin(t[e]);return this}}},72873:function(e,t,i){"use strict";i.d(t,{Loader:function(){return T}});var s,n=i("47546"),r=i("44698"),o=Object.defineProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,h=(e,t,i)=>t in e?o(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,u=(e,t)=>{for(var i in t||(t={}))l.call(t,i)&&h(e,i,t[i]);if(a)for(var i of a(t))c.call(t,i)&&h(e,i,t[i]);return e},d=/url\(\s*(['"])?(.*?)\1\s*\)/g,f=/@charset\s+(['"])(.*?)\1\s*;?/g,p=/@import\s+(['"])(.*?)\1/g,g=class{constructor(e,t){this.depsStack=new Set,this.scopeData=null,this.url=t||null,this.styleCode=e}correctPath(e){let{url:t,styleCode:i}=this;!e&&(e=t),e&&"string"==typeof i&&(this.styleCode=i.replace(f,"").replace(p,function(e,t,i){return i?`@import url(${t}${i}${t})`:e}).replace(d,(t,i,s)=>(0,r.isAbsolute)(s)?t:`url("${e?(0,r.transformUrl)(e,s):s}")`))}transformCode(e){return e}setDep(e){this.depsStack.add(e)}setScope(e){this.scopeData=e}isSameOrigin(e){return this.depsStack.has(e)}renderAsStyleElement(e=""){let t=document.createElement("style"),i=e+(this.styleCode?this.styleCode:"/**empty style**/");return t.setAttribute("type","text/css"),t.textContent=this.transformCode(i),t}clone(){let e=new this.constructor;return e.url=this.url,e.styleCode=this.styleCode,e.scopeData=this.scopeData,e.depsStack=new Set(this.depsStack),e}},_=class{constructor(e,t){this.alias=null,this.url=t||null,this.moduleCode=e}setAlias(e){e&&"string"==typeof e&&(this.alias=e)}clone(){let e=new this.constructor;return e.url=this.url,e.alias=this.alias,e.moduleCode=this.moduleCode,e}},m=class{constructor(e,t){if(this.DOMApis=new r.DOMApis,this.astTree=[],this.pretreatmentStore={},this.url=t,e){let[t,i]=(0,r.templateParse)(e,["meta","link","style","script"]);this.astTree=t,this.pretreatmentStore=i}}getNodesByTagName(...e){let t=0,i={};for(let s of e)this.pretreatmentStore[s]?(t++,i[s]=this.pretreatmentStore[s]):i[s]=[];if(t!==e.length){let t=s=>{if("element"===s.type)for(let n of(e.indexOf(s.tagName)>-1&&!this.pretreatmentStore[s.tagName]&&i[s.tagName].push(s),s.children))t(n)};for(let e of this.astTree)t(e)}return i}createElements(e,t,i){let s=[],n=(s,r)=>{var o;let a;if(this.DOMApis.isCommentNode(s));else if(this.DOMApis.isText(s))a=this.DOMApis.createTextNode(s),r&&r.appendChild(a);else if(this.DOMApis.isNode(s)){let{tagName:l,children:c}=s;if("function"==typeof i&&(a=null==(o=i(s,t))?void 0:o.customElement),!a&&(a=e[l]?e[l](s):this.DOMApis.createElement(s)),r&&a&&r.appendChild(a),a){let{nodeType:e,_ignoreChildNodes:t}=a;if(!t&&8!==e&&10!==e)for(let e of c)n(e,a)}}return a};for(let e of this.astTree)if(this.DOMApis.isNode(e)&&"!doctype"!==e.tagName){let i=n(e,t);i&&s.push(i)}return s}toResolveUrl(e,t,i){var s;let n=null==(s=e.attributes)?void 0:s.find(({key:e})=>e===t);n&&n.value&&i&&(n.value=(0,r.transformUrl)(i,n.value))}ignoreChildNodesCreation(e){return e&&(e._ignoreChildNodes=!0),e}findAllMetaNodes(){return this.getNodesByTagName("meta").meta}findAllLinkNodes(){return this.getNodesByTagName("link").link}findAllJsNodes(){return this.getNodesByTagName("script").script}findAttributeValue(e,t){var i,s,n;return null!=(n=null==(s=null==(i=e.attributes)?void 0:i.find(({key:e})=>e===t))?void 0:s.value)?n:void 0}cloneNode(e){return(0,r.deepMerge)(e,{})}clone(){let e=new this.constructor;return e.url=this.url,e.astTree=this.astTree,e.pretreatmentStore=this.pretreatmentStore,e.DOMApis=new r.DOMApis(this.DOMApis.document),e}},v=class{constructor(e,t){this.depsStack=new Set,this.mimeType="",this.async=!1,this.defer=!1,this.url=t,this.scriptCode=e}isModule(){return"module"===this.mimeType}isInlineScript(){return!this.url}setMimeType(e){this.mimeType=e||""}setAsyncAttribute(e){this.async=!!e}setDefferAttribute(e){this.defer=!!e}setDep(e){this.depsStack.add(e)}isSameOrigin(e){return this.depsStack.has(e)}clone(){let e=new this.constructor;return e.url=this.url,e.async=this.async,e.mimeType=this.mimeType,e.scriptCode=this.scriptCode,e.depsStack=new Set(this.depsStack),e}};function y(e){return e.resourceManager&&(e.resourceManager=e.resourceManager.clone()),e}var w=new WeakSet,b=Symbol("__defaultBufferPoll__"),E=["js","css","module","template",b],C=class{constructor(e=52428800){this.totalSize=0,this.recorder={},this.maxSize=e,E.forEach(e=>{this.recorder[e]=0,this[e]=new Map})}bufferPool(e){return this[e]}has(e){return E.some(t=>this[t].has(e))}get(e){for(let t of E)if(this[t].has(e))return this[t].get(e)}set(e,t,i){let s=w.has(t)?0:t.size,n=this.totalSize+s;if(n<this.maxSize){let r=i,o=this.bufferPool(i);return!o&&(r=b,o=this.bufferPool(b)),o.set(e,t),this.totalSize=n,this.recorder[r]+=s,!0}return!1}clear(e){if("string"==typeof e){let t=this.bufferPool(e);if(t&&t instanceof Map){let i=this.recorder[e];this.totalSize-=i,this.recorder[e]=0,t.clear()}}else E.forEach(e=>{this[e].clear(),this.recorder[e]=0}),this.totalSize=0}};var k=((s=k||{}).anonymous="same-origin",s["use-credentials"]="include",s),T=class{constructor(e){this.personalId=r.__LOADER_FLAG__,this.StyleManager=g,this.ModuleManager=_,this.TemplateManager=m,this.JavaScriptManager=v,this.hooks=new n.PluginSystem({error:new n.SyncHook,loaded:new n.SyncWaterfallHook("loaded"),clear:new n.SyncWaterfallHook("clear"),beforeLoad:new n.SyncWaterfallHook("beforeLoad"),fetch:new n.AsyncHook("fetch")}),this.options=e||{},this.loadingList=Object.create(null),this.cacheStore=Object.create(null)}setOptions(e){this.options=u(u({},this.options),e)}clear(e,t){let i=this.cacheStore[e];i&&(i.clear(t),this.hooks.lifecycle.clear.emit({scope:e,fileType:t}))}clearAll(e){for(let t in this.cacheStore)this.clear(t,e)}usePlugin(e){this.hooks.usePlugin(e)}setLifeCycle(e){this.hooks.usePlugin(u({name:"loader-lifecycle"},e))}loadModule(e){return this.load({scope:"modules",url:e,isRemoteModule:!0})}async load({scope:e,url:t,isRemoteModule:i=!1,crossOrigin:s="anonymous",defaultContentType:n=""}){var o;let{options:a,loadingList:l,cacheStore:c}=this,h=l[t];if(h&&Object.keys(h).includes(e))return(0,r.macroTask)(h[e],4);let d=c[e];if(!d&&(d=c[e]=new C(a.maxSize)),d.has(t))return(0,r.macroTask)(y(d.get(t)),4);for(let e in c){let i=c[e];if(i!==d&&i.has(t)){let e=i.get(t);return w.add(e),d.set(t,e,e.fileType),(0,r.macroTask)(y(e),4)}}let f=function(e,t){let i=e.requestConfig,s="function"==typeof i?i(t):i;return u({mode:"cors"},s)}(this,t);f.credentials=k[s];let p=this.hooks.lifecycle.beforeLoad.emit({url:t,scope:e,requestConfig:f});let g=(o=this.hooks.lifecycle.fetch,async function(e,t){let i=await o.emit(e,t||{});(!i||!(i instanceof Response))&&(i=await fetch(e,t||{})),i.status>=400&&(0,r.error)(`"${e}" load failed with status "${i.status}"`);let s=await i.text(),n=i.headers.get("content-type")||"",a=Number(i.headers.get("content-size"));return{code:s,result:i,mimeType:(0,r.parseContentType)(n||""),type:n,size:Number.isNaN(a)?null:a}})(p.url,p.requestConfig).then(({code:s,size:o,result:a,type:l})=>{let c,h="";i?(h="module",c=this.ModuleManager):(0,r.isHtmlType)({type:l,src:a.url})||(0,r.isHtmlType)({type:n})?(h="template",c=this.TemplateManager):(0,r.isJsType)({type:n})||(0,r.isJsType)({type:l,src:a.url})?(h="js",c=this.JavaScriptManager):((0,r.isCssType)({src:a.url,type:l})||(0,r.isCssType)({type:n}))&&(h="css",c=this.StyleManager);let u=c?new c(s,a.url):null,f=this.hooks.lifecycle.loaded.emit({result:a,value:{url:t,scope:e,resourceManager:u,fileType:h||"",size:o||s.length,code:u?"":s}});return h&&d.set(t,f.value,h),y(f.value)}).catch(t=>{throw"undefined"!=typeof process&&process.env,this.hooks.lifecycle.error.emit(t,{scope:e}),t}).finally(()=>{});return l[t]?l[t][e]=g:l[t]={[e]:g},g}}},25090:function(e,t,i){"use strict";i.d(t,{loadModule:function(){return E},setModuleConfig:function(){return w}});var s,n,r=i("47546"),o=i("72873"),a=i("44698"),l=Object.defineProperty,c=Object.defineProperties,h=Object.getOwnPropertyDescriptors,u=Object.getOwnPropertySymbols,d=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable,p=(e,t,i)=>t in e?l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,g=(e,t)=>{for(var i in t||(t={}))d.call(t,i)&&p(e,i,t[i]);if(u)for(var i of u(t))f.call(t,i)&&p(e,i,t[i]);return e},_=(e,t)=>c(e,h(t)),m=new r.PluginSystem({preloaded:new r.SyncHook,initModule:new r.SyncHook("initModule"),beforeLoadModule:new r.SyncWaterfallHook("beforeLoadModule"),asyncBeforeLoadModule:new r.AsyncWaterfallHook("asyncBeforeLoadModule"),afterLoadModule:new r.SyncWaterfallHook("afterLoadModule"),asyncAfterLoadModule:new r.AsyncWaterfallHook("asyncAfterLoadModule")}),v=class{constructor(e,t){this.manager=e,this.env={exports:{},module:null,require:e=>{var i,n;return(t||{})[e]||S.externals&&S.externals[e]||(null==(n=null==(i=s)?void 0:i.context)?void 0:n.externals[e])}},this.env.module=this.env,m.lifecycle.initModule.emit(this)}execScript(){let{url:e,moduleCode:t}=this.manager;if(s)s.execScript(t,this.env,e,{noEntry:!0});else{let i=`
${e?`//# sourceURL=${e}
`:""}`;(0,a.evalWithEnv)(`;${t}
${i}`,this.env,window)}return this.env}},y=e=>{for(let t in e){let i=e[t];(0,a.assert)((0,a.isAbsolute)(i),`The loading of the remote module must be an absolute path. "${i}"`),S.alias[t]=i}};function w(e){for(let t in(0,a.assert)((0,a.isPlainObject)(e),"Module configuration must be an object."),e)if((0,a.hasOwn)(S,t)){if("env"===t)Object.assign(S[t],e[t]);else if("alias"===t){let i=e[t];i&&y(i)}else S[t]=e[t]}else"undefined"!=typeof process&&process.env}function b(e,t){if(Array.isArray(t)){let i=t.length;if(i>1)for(let s=1;s<i;s++){let i=t[s];(0,a.assert)((0,a.isObject)(e),`Remote module "${t.slice(0,s).join(".")}" is ${e}, cannot get "${i}" attribute from it.`),e=e[i]}}return e}async function E(e,t){let i=await m.lifecycle.asyncBeforeLoadModule.emit({options:t,url:e});if(!1===i)return null;e=i.url,t=i.options,(0,a.assert)(e,"Missing url for loading remote module."),(0,a.assert)("string"==typeof e,"The type of URL needs to be a string.");let[s,n]=function(e){if(e&&e.startsWith("@")){let t=e.slice(1).split("."),i=t[0],s=S.alias[i];return(0,a.assert)(s,`Alias "${i}" is not defined.`),[s,t]}return[e,void 0]}(e);(0,a.assert)((0,a.isAbsolute)(s)||s.startsWith("//"),`The loading of the remote module must be an absolute path. "${s}"`);let r=L(s,t),{cache:o,version:l,externals:c,error:h,adapter:u}=r,d=`${l||"latest"}@${s}`,f=async()=>{let e=null,t=k[d];if(o&&t)(0,a.isPromise)(t)&&(t=await t),e=b(t,n);else try{let t=await O.loadModule(s);if(t.resourceManager){let i=new v(t.resourceManager,c);k[d]=i.env.exports;let r=i.execScript().exports;"function"==typeof u&&(r=u(r));let o=await m.lifecycle.asyncAfterLoadModule.emit({url:s,exports:r,code:t.resourceManager.moduleCode});if(!1===o)return null;r=o.exports,k[d]=r,(0,a.isPromise)(r)&&(r=await r),e=b(r,n)}}catch(i){delete k[d];let t=n?n[0]:"";if("function"==typeof h)e=h(i,r,t);else throw x(i,t,s)}return e};return T[d]?T[d].then(()=>Promise.resolve(k[d]).then(e=>b(e,n))):(T[d]=f().then(e=>(T[d]=null,e)),T[d])}var C=[],k=Object.create(null),T=Object.create(null),S={alias:{},cache:!0,error:null,adapter:null,externals:{loadModule:E}};(0,a.safeWrapper)(()=>{if(n=__GARFISH_GLOBAL_ENV__,(0,a.isObject)(n)){let{externals:e,currentApp:t,remoteModulesCode:i}=n;t&&(s=t),(0,a.isObject)(e)&&Object.assign(S.externals,e),Array.isArray(i)&&(C=C.concat(i),i.forEach(e=>{e.alias&&(S.alias[e.alias]=e.url)}))}});var O=(()=>{if((0,a.isObject)(n)){let e=n.loader;if((0,a.isObject)(e)&&e.personalId===a.__LOADER_FLAG__)return e}return new o.Loader})(),L=(e,t)=>{let i;let s=S.externals;if(delete S.externals,(0,a.isPlainObject)(t)){let n=t.externals;delete t.externals,i=(0,a.deepMerge)(S,_(g({},t),{url:e})),t.externals=n,i.externals=g(g({},s),n)}else(i=(0,a.deepMerge)(S,{url:e})).externals=s;return S.externals=s,i},x=(e,t,i)=>{let n=[s&&s.name,t,i],r=n.reduce((e,t,i)=>t?i===n.length-1?e+`"${t}"`:e+`"${t}" -> `:e,"remoteModule: ");return(r=` (${r})`,"number"==typeof e&&(e=String(e)),"string"!=typeof e||e.endsWith(r))?(e instanceof Error&&!e.message.endsWith(r)&&(e.message=`${e.message}${r}`),e):`${e}${r}`}},44698:function(e,t,i){"use strict";i.d(t,{DOMApis:function(){return O},__LOADER_FLAG__:function(){return L},assert:function(){return v},deepMerge:function(){return b},error:function(){return g},evalWithEnv:function(){return _},hasOwn:function(){return h},isAbsolute:function(){return E},isCssType:function(){return A},isHtmlType:function(){return I},isJsType:function(){return M},isObject:function(){return o},isPlainObject:function(){return a},isPromise:function(){return l},macroTask:function(){return k},parseContentType:function(){return x},safeWrapper:function(){return m},templateParse:function(){return R},transformUrl:function(){return C},warn:function(){return p}});var s=i("54681"),n=i.n(s),r=Object.prototype.toString;function o(e){return e&&"object"==typeof e}function a(e){return"[object Object]"===r.call(e)}function l(e){return o(e)&&"function"==typeof e.then}window.requestIdleCallback||window.requestAnimationFrame;var c=Object.prototype.hasOwnProperty;function h(e,t){return c.call(e,t)}function u(e){let t=Object.create(null);for(let i=0;i<e.length;i++)t[e[i]]=!0;return e=>!!t[e]}var d="[Garfish warning]",f=(e,t)=>{try{"string"==typeof e?(e=`${d}: ${e}

`,t(e,!0)):e instanceof Error&&(!e.message.startsWith(d)&&(e.message=`${d}: ${e.message}`),t(e,!1))}catch(i){t(e,"string"==typeof e)}};function p(e){f(e,(e,t)=>{t||e.message})}function g(e){f(e,(e,t)=>{if(t)throw Error(e);throw e})}function _(e,t,i,s=!1){let n=Object.keys(t),r=(0,eval)("window;"),o="__garfish__exec_temporary__",a=n.map(e=>`window.${o}.${e}`),l="__garfish_exec_temporary_context__";try{r[o]=t,r[l]=i;let c=[`;(function(${n.join(",")}){${s?'"use strict";':""}`,`
}).call(window.${l},${a.join(",")});`],h=function(e){let t={};return t[e]=!0,Object.keys(t)[0]}(c[0]+e+c[1]);(0,eval)(h)}catch(e){throw e}finally{delete r[o],delete r[l]}}function m(e,t){try{e()}catch(e){t||"undefined"!=typeof process&&process.env}}function v(e,t){!e&&g(t||"unknow reason")}function y(e){let t=[];for(let i=0,s=e.length;i<s;i++){for(let t=i+1;t<s;t++)e[i]===e[t]&&(t=++i);t.push(e[i])}return t}function w(e){return null===e||"string"==typeof e||"number"==typeof e||"bigint"==typeof e||"symbol"==typeof e||"boolean"==typeof e||void 0===e||"[object RegExp]"===r.call(e)}function b(e,t,i,s){let n=new WeakMap,r=new WeakMap,o=new WeakMap,l=u(s||[]),c=Array.isArray,d=(e,t)=>{if(n.has(e)||r.has(e))return n.has(t)||r.has(t)},f=e=>{if(w(e)||"function"==typeof e)return e;if(o.has(e))return o.get(e);if(n.has(e))return n.get(e);else if(r.has(e))return r.get(e);else if(c(e)){i&&(e=y(e));let t=[];o.set(e,t);for(let i=0,s=e.length;i<s;i++)t[i]=f(e[i]);return t}else if("object"==typeof e){let t={};return o.set(e,t),Reflect.ownKeys(e).forEach(i=>t[i]=f(e[i])),t}},p=(e,t,i)=>{if(e.has(t))return e.get(t);{if(l[i])return t;let s=f(t);return!w(s)&&"function"!=typeof s&&e.set(t,s),s}},g=(e,t)=>{let s={},o=Reflect.ownKeys(e),l=Reflect.ownKeys(t);return n.set(e,s),r.set(t,s),o.forEach(o=>{let l=e[o],u=t[o];if(h(t,o)){if(c(l)&&c(u)){let e=f([...l,...u]);s[o]=i?y(e):e}else a(l)&&a(u)?s[o]=d(l,u)?n.get(l):g(l,u):s[o]=p(r,u,o)}else s[o]=p(n,l,o)}),l.forEach(e=>{!h(s,e)&&(s[e]=p(r,t[e],e))}),s};return g(e,t)}function E(e){return!!(!/^[a-zA-Z]:\\/.test(e)&&/^[a-zA-Z][a-zA-Z\d+\-.]*:/.test(e))||!1}function C(e,t){let i=new URL(e,location.href);return new URL(t,i.href).href}function k(e,t=0){return new Promise(i=>{setTimeout(()=>i(e),t)})}u(["link","style","script","img","video","audio","iframe"]);var T=u("svg,animate,animateMotion,animateTransform,circle,clipPath,color-profile,defs,desc,discard,ellipse,feBlend,feColorMatrix,feComponentTransfer,feComposite,feConvolveMatrix,feDiffuseLighting,feDisplacementMap,feDistanceLight,feDropShadow,feFlood,feFuncA,feFuncB,feFuncG,feFuncR,feGaussianBlur,feImage,feMerge,feMergeNode,feMorphology,feOffset,fePointLight,feSpecularLighting,feSpotLight,feTile,feTurbulence,filter,foreignObject,g,hatch,hatchpath,image,line,linearGradient,marker,mask,mesh,meshgradient,meshpatch,meshrow,metadata,mpath,path,pattern,polygon,polyline,radialGradient,rect,set,solidcolor,stop,switch,symbol,text,textPath,title,tspan,unknown,use,view".split(","));function S(e){return e&&0!==e.length?e.reduce((e,{key:t,value:i})=>e+(i?`${t}="${i}" `:t),""):""}var O=class{constructor(e){this.document=e||document}isText(e){return e&&"text"===e.type}isNode(e){return e&&"element"===e.type}isCommentNode(e){return e&&"comment"===e.type}isCssLinkNode(e){return!!this.isNode(e)&&"link"===e.tagName&&!!e.attributes.find(({key:e,value:t})=>"rel"===e&&"stylesheet"===t)}isIconLinkNode(e){return!!this.isNode(e)&&"link"===e.tagName&&!!e.attributes.find(({key:e,value:t})=>"rel"===e&&"icon"===t)}isPrefetchJsLinkNode(e){let t,i;if(!this.isNode(e)||"link"!==e.tagName)return!1;for(let{key:s,value:n}of e.attributes)if("rel"===s){if(t=!0,"preload"!==n&&"prefetch"!==n)return!1}else if("as"===s&&(i=!0,"script"!==n))return!1;return!!(t&&i)}isRemoteModule(e){let t,i;if(!this.isNode(e)||"meta"!==e.tagName)return!1;for(let{key:s,value:n}of e.attributes)if("name"===s){if(t=!0,"garfish-remote-module"!==n)return!1}else if("src"===s&&(i=!0,void 0===n||""===n))return!1;return!!(t&&i)}removeElement(e){let t=e&&e.parentNode;t&&t.removeChild(e)}createElement(e){let{tagName:t,attributes:i}=e,s=T(t)?this.document.createElementNS("http://www.w3.org/2000/svg",t):this.document.createElement(t);return this.applyAttributes(s,i),s}createTextNode(e){return this.document.createTextNode(e.content)}createStyleNode(e){let t=this.document.createElement("style");return e&&(t.textContent=e),this.applyAttributes(t,[{key:"type",value:"text/css"}]),t}createLinkCommentNode(e){if(!this.isNode(e))return e=e?`src="${e}" `:"",this.document.createComment(`<link ${e}execute by garfish(dynamic)></link>`);{let t=S(e.attributes);return`<link ${t.slice(0,-1)}></link>`}}createScriptCommentNode(e){if(this.isNode(e)){let{attributes:t,children:i}=e,s=S(t),n=(null==i?void 0:i[0])?i[0].content:"";return this.document.createComment(`<script ${s} execute by garfish>${n}</script>`)}{let{src:t,code:i}=e,s=t?`src="${t}" `:"";return this.document.createComment(`<script ${s}execute by garfish(dynamic)>${i}</script>`)}}applyAttributes(e,t){if(t&&0!==t.length)for(let{key:i,value:s}of t)i&&(null===s?e.setAttribute(i,""):"string"==typeof s&&(120!==i.charCodeAt(0)?e.setAttribute(i,s):58===i.charCodeAt(3)?e.setAttributeNS("http://www.w3.org/XML/1998/namespace",i,s):58===i.charCodeAt(5)&&"xlink"===i.slice(0,5)?e.setAttributeNS("http://www.w3.org/1999/xlink",i,s):e.setAttribute(i,s)))}},L=Symbol.for("__LOADER_FLAG__");function x(e){if(!(e=null==e?void 0:e.trim()))return null;let t=0,i="",s="";for(;t<e.length&&"/"!==e[t];)i+=e[t],t++;if(0===i.length||t>=e.length)return null;for(t++;t<e.length&&";"!==e[t];)s+=e[t],t++;return 0===(s=s.replace(/[ \t\n\r]+$/,"")).length?null:{type:i.toLocaleLowerCase(),subtype:s.toLocaleLowerCase()}}Symbol.for("__GARFISH_FLAG__");function M({src:e="",type:t}){if(/\.js$/.test(e))return!0;if(t){if("module"===t)return!0;let i=x(t);if(function(e,t){try{let i=new URL(t).search,{type:s,subtype:n}=e||{};if("application"===s&&"json"===n&&/callback/.test(i))return!0}catch(e){}return!1}(i,e)||function(e){let{type:t,subtype:i}=e||{};switch(t){case"text":switch(i){case"ecmascript":case"javascript":case"javascript1.0":case"javascript1.1":case"javascript1.2":case"javascript1.3":case"javascript1.4":case"javascript1.5":case"jscript":case"livescript":case"x-ecmascript":case"x-javascript":return!0;default:return!1}case"application":switch(i){case"ecmascript":case"javascript":case"x-ecmascript":case"x-javascript":return!0;default:return!1}default:return!1}}(i))return!0}return!1}function A({src:e="",type:t}){if(/\.css$/.test(e))return!0;if(t){var i;if((i=x(t))&&"text"===i.type&&"css"===i.subtype)return!0}return!1}function I({src:e="",type:t}){if(/\.html$/.test(e))return!0;if(t){var i;if((i=x(t))&&"text"===i.type&&"html"===i.subtype)return!0}return!1}function D({name:e,value:t}){this.key=e,this.value=t}var N=e=>{let t=[],i=e.attributes,s=i.length;if(s>0){if(1===s)t[0]=new D(i[0]);else if(2===s)t[0]=new D(i[0]),t[1]=new D(i[1]);else for(let e=0;e<s;e++)t[e]=new D(i[e])}return t},B=(e,t)=>{switch(e.nodeType){case 3:return{type:"text",content:e.textContent};case 8:return{type:"comment",content:e.textContent};case 1:var i;return t({type:"element",tagName:T(i=e.tagName)?i:i.toLowerCase(),attributes:N(e),children:Array.from(e.childNodes).map(e=>B(e,t))});default:g(`Invalid node type "${e.nodeType}"`)}};function R(e,t){let i=[],s=document.createElement("html"),n={},r=e=>(t.includes(e.tagName)&&n[e.tagName].push(e),e);for(let i of(s.innerHTML=e,t))n[i]=[];return[i=Array.from(s.childNodes).map(e=>B(e,r)),n]}var P=n()("garfish");P.extend("core"),P.extend("router")}}]);