import{u as e,j as t,g as a,B as n,C as r,i,_ as o}from"../index-CR06pHgF.js";import{k as s,aa as c,r as l,f as d,l as u,m as p,p as m,P as g,S as v,W as h,u as _,a0 as f,a4 as y,Y as w}from"./vue-CmQldkW7.js";import{i as x}from"./fetch-I3PI3dyF.js";import{u as k}from"./useEmitter-Ce9DhNQt.js";const I=m("div",null,null,-1),b=["value"],C=s({__name:"ShareBar",props:{isAllChecked:{type:Boolean,default:!1},checkedIds:{type:Array,default:()=>[]},conversationId:{type:String,default:""},origin:{type:String,default:"search_page"},query:{type:String,default:""}},emits:["update:checkedAll","cancel:share","create:link"],setup(s,{emit:f}){const{currentAgentId:y}=c(e()),w=s,x=l(""),k=d((()=>"agent_chat_page"===w.origin?{agent_id:y.value}:{})),C=f,A=e=>{e.stopPropagation()},S=()=>{t().reportImmediate({event:"".concat(w.origin,"_answer_share_cancel_click"),event_info:{origin:w.origin,entity:"answer_share_cancel",event:"click",conversation_id:w.conversationId,...k.value}}),C("cancel:share",!1)},j=async()=>{if(0===w.checkedIds.length)return void a("请选择要分享的记录",{icon:"info"});const e=await n.post(r.getShareLink,{conversation_id:w.conversationId,ask_id:w.checkedIds.join(",")});200===e.code&&(x.value=e.data.url,t().reportImmediate({event:"".concat(w.origin,"_answer_share_confirm_click"),event_info:{origin:w.origin,entity:"answer_share_confirm",event:"click",conversation_id:w.conversationId,ask_id:w.checkedIds.join(","),query:w.query,set:w.checkedIds.length,...k.value}}),setTimeout((()=>{var e=document.querySelector("#copy-input");e.focus(),e.select();try{document.execCommand("copy")?a("分享链接已复制到剪贴板，快分享给你的朋友们吧！",{icon:"success"}):a("不支持复制",{icon:"error"}),S()}catch(t){a("不支持复制",{icon:"error"})}})))};return(e,t)=>{const a=i,n=o;return u(),p("div",{class:"fixed bottom-0 flex w-[662px] cursor-default items-center justify-between bg-[#fff] pb-10 pt-4",onClick:A},[I,m("div",null,[g(a,{class:"!w-[120px] rounded-[8px] !border-[var(--el-color-primary)] !px-[20px] !py-[12px] !text-base !text-[var(--el-color-primary)]",size:"large",onClick:S},{default:v((()=>[h("取消")])),_:1}),g(a,{class:"!w-[260px] rounded-[8px] !bg-[#2785ff] !px-[20px] !py-[12px]",size:"large",type:"primary",onClick:j},{default:v((()=>[g(n,{class:"mr-[10px] text-[16px]",name:"i-link"}),h(" 生成分享链接 ")])),_:1})]),m("input",{class:"absolute left-[-1000px] top-[-1000px]",id:"copy-input",value:_(x)},null,8,b)])}}}),A={key:0,class:"my-image-preview"},S=s({__name:"ImageViewer",setup(e){const t=k(),a=l([]),n=l(!1),r=l(!1);t.on("imageViewer",(({urlList:e,isDownload:t=!1})=>{r.value=!0,a.value=e,n.value=t})),t.on("closeImgViewer",(()=>{r.value=!1,a.value=[],n.value=!1}));const i=()=>{r.value=!1},s=(e,a)=>{const n=document.createElement("a");n.setAttribute("download",e.replace(/\./g,"。"));const r=new Image;r.src=a+"?time="+(new Date).getTime(),r.setAttribute("crossOrigin","Anonymous"),r.onload=()=>{n.href=(e=>{const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const a=t.getContext("2d");null==a||a.drawImage(e,0,0,e.width,e.height);const n=e.src.substring(e.src.lastIndexOf(".")+1).toLowerCase();return t.toDataURL("image/"+n,1)})(r),n.click()},t.emit("downloadImage",a)},c=()=>{const e=[...document.querySelectorAll(".el-image-viewer__wrapper .el-image-viewer__img")].filter((e=>(e.style.height="40vh","none"!==getComputedStyle(e).display)))[0];s((e=>{for(var t=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],a="",n=0;n<e;n++)a+=t[Math.ceil(35*Math.random())];return a})(8),e.src)};return(e,t)=>{const s=x,l=o;return r.value?(u(),p("div",A,[g(s,{"hide-on-click-modal":"",onClose:i,"url-list":a.value},null,8,["url-list"]),f(m("div",{class:"download-btn z-[3000]",onClick:c},[g(l,{name:"i_download"}),h(" 下载图片 ")],512),[[y,n.value]])])):w("",!0)}}});export{C as _,S as a};
